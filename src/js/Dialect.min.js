/**
*   Dialect, 
*   a simple and flexible Cross-Platform SQL Builder for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 0.7.0
*   https://github.com/foo123/Dialect
*
*   Abstract the construction of SQL queries
*   Support multiple DB vendors
*   Intuitive and Flexible API
**/
!function(e,n,t){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.$deps=e.$deps||{})&&(e.EXPORTED_SYMBOLS=[n])&&(e[n]=e.$deps[n]=t.call(e)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=t.call(e)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(n,[],function(l){l(n,t.call(e))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return t.moduleUri=n.uri,t.call(e)}):n in e||(e[n]=t.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[n]})}(this,"Dialect",function(e){"use strict";function n(){return""+(new Date).getTime()+"--"+ ++F}function t(e,n,l){var s=this;return s instanceof t?(s.id=null,s.tpl=null,s._renderer=null,s._args=[e||"",n||t.defaultArgs,l],void(s._parsed=!1)):new t(e,n,l)}function l(e,n){for(var t,l=e,s=n.length,r=0;s>r;){if(t=n[r++],null==l||null==l[t])return null;l=l[t]}return l}function s(e,n){this.prev=e||null,this.value=n||null}function r(e,n){n&&(n.next=this),this.node=e||null,this.prev=n||null,this.next=null}function i(e,t){var l,i,o,u,a,c,d,_,f,h,p,v,E,g,w,b,m,q,R,T,A,S,y,N,O,I,D,L=t[0],W=t[1],k=t[2],C=t[3],F=t[4],B=L.length,M=W.length,U=k.length,V=C.length,x=F.length,P="\\",G="?",Y="*",X="!",$="|",Q="{",J="}",z=".",K=":",Z=null,ee=0,ne=0,te=e.length;for(f=new r({type:0,val:""}),A={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,start:0,end:0},y=f,N=null,S=null,m={},R=null,q={},T=null,d=null,p="",w=!1,v=0;te>v;)if(b=e[H](v),P===b&&(w=!w,v+=1),L===e.substr(v,B)){if(v+=B,w){p+=L,w=!1;continue}p.length&&(0===f.node.type?f.node.val+=p:f=new r({type:0,val:p},f)),p=""}else if(W===e.substr(v,M)){if(v+=M,w){p+=W,w=!1;continue}if(a=p,p="",-1<(c=a.indexOf($))?(Z=a.slice(c+1),a=a.slice(0,c)):Z=null,_=a[H](0),G===_||Y===_)ne=1,Y===_?(i=1,o=-1):(i=0,o=0),a=a.slice(1),X===a[H](0)?(ee=1,a=a.slice(1)):ee=0;else if(Q===_){for(p="",E=1,g=a.length;g>E&&J!==a[H](E);)p+=a[H](E++);a=a.slice(E+1),p=p.split(","),p.length>1?(i=j(p[0]),i=i.length?parseInt(i,10)||0:0,o=j(p[1]),o=o.length?parseInt(o,10)||0:-1,ne=1):(i=j(p[0]),i=i.length?parseInt(i,10)||0:0,o=i,ne=0),p="",ee=0}else ne=0,ee=0,i=0,o=0;if(ee&&null===Z&&(Z=""),u=-1<a.indexOf(K)?a.split(K):[a,null],a=u[0],u=u[1],l=-1<a.indexOf(z)?a.split(z):null,R&&!q[R]&&(q[R]={}),F+k===e.substr(v,x+U)&&(v+=x,u=u&&u.length?u:"grtpl--"+n(),T=u,R&&a.length&&(q[R][a]=u)),!a.length)continue;null==u&&R&&q[R]&&q[R][a]&&(u=q[R][a]),ne&&!A.opt?(A.name=a,A.key=l,A.stpl=u,A.dval=Z,A.opt=ne,A.neg=ee,A.start=i,A.end=o,S=new s(null,[a,l,ee,i,o])):ne?S=new s(S,[a,l,ee,i,o]):ne||null!==A.name||(A.name=a,A.key=l,A.stpl=u,A.dval=Z,A.opt=0,A.neg=ee,A.start=i,A.end=o,S=new s(null,[a,l,ee,i,o])),f=new r({type:1,name:a,key:l,stpl:u,dval:Z,start:i,end:o},f)}else if(k===e.substr(v,U)){if(v+=U,w){p+=k,w=!1;continue}p.length&&(0===f.node.type?f.node.val+=p:f=new r({type:0,val:p},f)),p="",d=new s(d,[f,N,A,S,R,T]),T&&(R=T),T=null,A={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,start:0,end:0},S=null,f=new r({type:0,val:""}),N=f}else if(C===e.substr(v,V)){if(v+=V,w){p+=C,w=!1;continue}h=f,O=N,I=A,D=S,d?(f=d.value[0],N=d.value[1],A=d.value[2],S=d.value[3],R=d.value[4],T=d.value[5],d=d.prev):f=null,p.length&&(0===h.node.type?h.node.val+=p:h=new r({type:0,val:p},h)),p="",T?(m[T]=new r({type:2,name:I.name,key:I.key,start:0,end:0,opt_args:null,tpl:O}),T=null):f=new r({type:-1,name:I.name,key:I.key,start:I.start,end:I.end,opt_args:D,tpl:O},f)}else p+=P===b?b:e[H](v++);return p.length&&(0===f.node.type?f.node.val+=p:f=new r({type:0,val:p},f)),[y,m]}function o(e,n,t,s){var r,i,o,u,c,d,_,f="";if(-1===t.type){if(r=t.opt_args,!r)return"";for(;r;){if(i=r.value,o=i[1]?l(n,i[1]):n[i[0]],0===i[2]&&null==o||1===i[2]&&null!=o)return"";r=r.prev}}if(t.key?(o=l(n,t.key),null==o&&n[O](t.name)&&(o=n[t.name])):o=n[t.name],u=p(o),u&&o.length>t.start)for(c=t.start,d=-1===t.end?o.length-1:Math.min(t.end,o.length-1),_=c;d>=_;_++)f+=a(e,n,t.tpl,_);else u||t.start!==t.end||(f=a(e,n,t.tpl,null));return f}function u(e,n,t,s){var r,i,u,a="";return e&&t.stpl&&e[t.stpl]?(t.key?(r=l(n,t.key),null==r&&n[O](t.name)&&(r=n[t.name])):r=n[t.name],null!=s&&p(r)&&(r=r[s]),null==r&&null!==t.dval?a=t.dval:(u=e[t.stpl].node,i={},null!=r&&(p(r)?i[u.name]=r:i=r),a=o(e,i,u,null))):(t.key?(r=l(n,t.key),null==r&&n[O](t.name)&&(r=n[t.name])):r=n[t.name],p(r)&&(r=null!=s?r[s]:r[t.start]),a=null==r&&null!==t.dval?t.dval:String(r)),a}function a(e,n,t,l){for(var s,r="";t;)s=t.node.type,r+=-1===s?o(e,n,t.node,l):1===s?u(e,n,t.node,l):t.node.val,t=t.next;return r}function c(e,n){var t=this;return t instanceof c?(t.id=null,t.tpl=null,t._args=[e||"",n||c.defaultDelims],void(t._parsed=!1)):new c(e,n)}function d(e,n){return new RegExp(e,n||"")}function _(e){return e.replace(W,"\\$&")}function f(e){return"function"==typeof e}function h(e){return"string"==typeof e}function p(e){return e instanceof Array||"[object Array]"===D.call(e)}function v(e){return e instanceof Object||"[object Object]"===D.call(e)}function E(e){if(!e)return!0;var n=D.call(e);return(e instanceof Array||e instanceof String||"[object Array]"===n||"[object String]"===n)&&!e.length?!0:(e instanceof Object||"[object Array]"===n)&&!I(e).length}function g(e){return parseInt(e||0,10)||0}function w(e){return e===+e&&isFinite(e)&&!(e%1)}function b(e){return p(e)?e:[e]}function m(e,n,t){var l,s,r,i="";for(3>arguments.length&&(t="\\"),2>arguments.length&&(n="\\\"'"+C),l=0,s=e.length;s>l;l++)r=e[H](l),i+=-1===n.indexOf(r)?r:0===r[L](0)?"\\0":t+r;return i}function q(e,n,t,l){t=!0===t,l=!0===l;for(var s in n)n[O](s)&&(!t&&e[O](s)||(e[s]=l&&n[s].slice?n[s].slice():n[s]));return e}function R(e,n){var t=e.length;if(!t)return[];var l,s,r=15&t,i=1&r,o=new Array(t);for(i&&(o[0]=n(e[0])),l=i;r>l;l+=2)s=l,o[l]=n(e[s]),o[l+1]=n(e[s+1]);for(l=r;t>l;l+=16)s=l,o[l]=n(e[s]),o[l+1]=n(e[s+1]),o[l+2]=n(e[s+2]),o[l+3]=n(e[s+3]),o[l+4]=n(e[s+4]),o[l+5]=n(e[s+5]),o[l+6]=n(e[s+6]),o[l+7]=n(e[s+7]),o[l+8]=n(e[s+8]),o[l+9]=n(e[s+9]),o[l+10]=n(e[s+10]),o[l+11]=n(e[s+11]),o[l+12]=n(e[s+12]),o[l+13]=n(e[s+13]),o[l+14]=n(e[s+14]),o[l+15]=n(e[s+15]);return o}function T(e,n){var t=e.length;if(!t)return[];var l,s,r=15&t,i=1&r,o=[];for(i&&n(e[0])&&o.push(e[0]),l=i;r>l;l+=2)s=l,n(e[s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]);for(l=r;t>l;l+=16)s=l,n(e[s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]);return o}function A(e,n,t){var l,s,r="";if(e&&e.length)for(t=null==t?",":t,r=e[0][n],l=1,s=e.length;s>l;l++)r+=t+e[l][n];return r}function S(e,n,t,l,s,r,i,o,u,a,c){var d=this;if(d._col=e,d.col=n,d._tbl=t,d.tbl=l,d._dtb=s,d.dtb=r,d._alias=i,d._qualified=u,d.qualified=a,d.full=d.qualified,d._func=null==c?[]:c,d._func.length)for(var _=0,f=d._func.length;f>_;_++)d.full=d._func[_]+"("+d.full+")";null!=d._alias?(d.alias=o,d.aliased=d.full+" AS "+d.alias):(d.alias=d.full,d.aliased=d.full)}function y(e){var n=this;if(!(n instanceof y))return new y(e);if(arguments.length||(e="mysql"),!e||!y.dialects[e]||!y.dialects[e].clauses)throw new TypeError('Dialect: SQL dialect does not exist for "'+e+'"');n.clau=null,n.clus=null,n.tbls=null,n.cols=null,n.vews={},n.tpls={},n.db=null,n.escdb=null,n.p="",n.type=e,n.clauses=y.dialects[n.type].clauses,n.q=y.dialects[n.type].quotes[0],n.qn=y.dialects[n.type].quotes[1],n.e=y.dialects[n.type].quotes[2]||["",""]}var N="prototype",O="hasOwnProperty",I=Object.keys,D=Object[N].toString,H="charAt",L="charCodeAt",W=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,k=/^\s+|\s+$/g,j=String[N].trim?function(e){return e.trim()}:function(e){return e.replace(k,"")},C=String.fromCharCode(0),F=0;t.VERSION="1.0.0",t.defaultArgs=/\$(-?[0-9]+)/g,t.guid=n,t.multisplit=function(e,n,t){var l,s,r,i,o,u,a,c,d,_;t=!!t,u=[[1,e]];for(l in n)if(n.hasOwnProperty(l)){for(c=[],s=t?n[l]:l,r=[0,n[l]],i=0,d=u.length;d>i;i++)if(1===u[i][0]){if(a=u[i][1].split(s),_=a.length,c.push([1,a[0]]),_>1)for(o=0;_-1>o;o++)c.push(r),c.push([1,a[o+1]])}else c.push(u[i]);u=c}return u},t.multisplit_re=function(e,n){n=n.global?n:new RegExp(n.source,n.ignoreCase?"gi":"g");for(var t,l=[],s=0;t=n.exec(e);)l.push([1,e.slice(s,n.lastIndex-t[0].length)]),l.push([0,t[1]?t[1]:t[0]]),s=n.lastIndex;return l.push([1,e.slice(s)]),l},t.arg=function(e,n){var t,l,s,r,i,o="args";if(arguments.length&&null!=e)for(e=e.substr?e.length?e.split("."):[]:[e],r=e.length,i=!(!n||!n.substr),t=0;r>t;t++)l=e[t],s=+l,isNaN(s)?o+='["'+l+'"]':(0>s&&(l=i?n+-s:o+".length-"+-s),o+="["+l+"]");return o},t.compile=function(e,n){var l,s,r,i,o=e.length;if(!0===n){for(i='"use strict"; return (',l=0;o>l;l++)s=e[l][0],r=e[l][1],i+=s?r:t.arg(r);i+=");"}else{for(i='"use strict"; var argslen=args.length; return (',l=0;o>l;l++)s=e[l][0],r=e[l][1],i+=s?"'"+r.replace(SQUOTE,"\\'").replace(NEWLINE,"' + \"\\n\" + '")+"'":" + String("+t.arg(r,"argslen")+") + ";i+=");"}return new Function("args",i)},t[N]={constructor:t,id:null,tpl:null,_parsed:!1,_args:null,_renderer:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e._parsed=null,e._args=null,e._renderer=null,e},fixRenderer:function(){var e=this;return e.render="function"==typeof e._renderer?e._renderer:e.constructor[N].render,e},parse:function(){var e=this;if(!1===e._parsed){e._parsed=!0;var n=e._args[0],l=e._args[1],s=e._args[2];e._args=null,e.tpl=l instanceof RegExp?t.multisplit_re(n,l):t.multisplit(n,l),!0===s&&(e._renderer=t.compile(e.tpl),e.fixRenderer())}return e},render:function(e){var n=this;if(e=e||[],!1===n._parsed&&(n.parse(),n._renderer))return n._renderer(e);var t,l,s,r=n.tpl,i=r.length,o=e.length,u="";for(t=0;i>t;t++)l=r[t],1===l[0]?u+=l[1]:(s=l[1],+s===s&&0>s&&(s=o+s),u+=e[s]);return u}},c.VERSION="2.0.0",c.defaultDelims=["<",">","[","]",":="],c.guid=n,c.multisplit=i,c.main=a,c[N]={constructor:c,id:null,tpl:null,_parsed:!1,_args:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e._args=null,e._parsed=null,e},parse:function(){var e=this;return!1===e._parsed&&(e._parsed=!0,e.tpl=c.multisplit(e._args[0],e._args[1]),e._args=null),e},render:function(e){var n=this;return!1===n._parsed&&n.parse(),c.main(n.tpl[1],null==e?{}:e,n.tpl[0])}};var B=/\s/,M=/[0-9]/,U=/[a-z_]/i;S.parse=function(e,n){var t,l,s,r,i,o,u,a,c,d,_,f,h,p,v,E,g,w,b,m,q,R,T,A,y=["AS"];for(e=j(e),l=e.length,t=0,s=[[]],r=s[0],i=[],o=[],u="",a=null,_=0,f=null;l>t;){if(h=e.charAt(t++),'"'===h||"`"===h||"'"===h||"["===h||"]"===h){if(!f){if(u.length||"]"===h){a=["invalid",t];break}f="["===h?"]":h;continue}if(f===h){if(!u.length){a=["invalid",t];break}r.unshift([1,u]),i.unshift(u),u="",f=null;continue}if(f){u+=h;continue}}if(f)u+=h;else if("*"===h){if(u.length){a=["invalid",t];break}r.unshift([10,"*"]),i.unshift(10)}else if("."===h){if(u.length&&(r.unshift([1,u]),i.unshift(u),u=""),!r.length||1!==r[0][0]){a=["invalid",t];break}r.unshift([0,"."]),i.unshift(0)}else if("("===h){if(_++,u.length&&(r.unshift([2,u]),o.unshift(u),u=""),!r.length||2!==r[0][0]&&1!==r[0][0]){a=["invalid",t];break}1===r[0][0]&&(r[0][0]=2,o.unshift(i.shift())),s.unshift([]),r=s[0]}else if(")"===h){if(_--,u.length&&(p=-1<y.indexOf(u.toUpperCase()),r.unshift([p?5:1,u]),i.unshift(p?5:u),u=""),s.length<2){a=["invalid",t];break}s[1].unshift([100,s.shift()]),r=s[0]}else{if(B.test(h)){u.length&&(p=-1<y.indexOf(u.toUpperCase()),r.unshift([p?5:1,u]),i.unshift(p?5:u),u="");continue}if(M.test(h)){if(!u.length){a=["invalid",t];break}u+=h}else{if(!U.test(h)){a=["invalid",t];break}u+=h}}}if(u.length&&(r.unshift([1,u]),i.unshift(u),u=""),!a&&_&&(a=["paren",l]),!a&&f&&(a=["quote",l]),a||1===s.length||(a=["invalid",l]),a)throw c=a[1]-1,d=a[0],"paren"==d?new TypeError('Dialect: Mismatched parentheses "'+e+'" at position '+c+"."):"quote"==d?new TypeError('Dialect: Mismatched quotes "'+e+'" at position '+c+"."):new TypeError('Dialect: Invalid character "'+e+'" at position '+c+".");return q=null,R="",i.length>=3&&5===i[1]&&"string"==typeof i[0]&&(q=i.shift(),R=n.quote_name(q),i.shift()),v=null,E="",!i.length||"string"!=typeof i[0]&&10!==i[0]||(10===i[0]?(i.shift(),v=E="*"):(v=i.shift(),E=n.quote_name(v))),g=null,w="",i.length>=2&&0===i[0]&&"string"==typeof i[1]&&(i.shift(),g=i.shift(),w=n.quote_name(g)),b=null,m="",i.length>=2&&0===i[0]&&"string"==typeof i[1]&&(i.shift(),b=i.shift(),m=n.quote_name(b)),T=(b?b+".":"")+(g?g+".":"")+(v?v:""),A=(b?m+".":"")+(g?w+".":"")+(v?E:""),new S(v,E,g,w,b,m,q,R,T,A,o)},S[N]={constructor:S,_func:null,_col:null,col:null,_tbl:null,tbl:null,_dtb:null,dtb:null,_alias:null,alias:null,_qualified:null,qualified:null,full:null,aliased:null,cloned:function(e,n,t){var l=this;return arguments.length?n=n||e:(e=l._alias,n=l.alias),null==t&&(t=l._func),new S(l._col,l.col,l._tbl,l.tbl,l._dtb,l.dtb,e,n,l._qualified,l.qualified,t)},dispose:function(){var e=this;return e._func=null,e._col=null,e.col=null,e._tbl=null,e.tbl=null,e._dtb=null,e.dtb=null,e._alias=null,e.alias=null,e._qualified=null,e.qualified=null,e.full=null,e.aliased=null,e}};var V={mysql:{quotes:[["'","'","\\'","\\'"],["`","`"],["",""]],functions:{strpos:["POSITION(",2," IN ",1,")"],strlen:["LENGTH(",1,")"],strlower:["LCASE(",1,")"],strupper:["UCASE(",1,")"],trim:["TRIM(",1,")"],quote:["QUOTE(",1,")"],random:["RAND()"],now:["NOW()"]},clauses:{create:"CREATE TABLE IF NOT EXISTS <create_table>\n(<create_defs>)[<?create_opts>]",alter:"ALTER TABLE <alter_table>\n<alter_defs>[<?alter_opts>]",drop:"DROP TABLE IF EXISTS <drop_tables>[,<*drop_tables>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>[\n<*join_clauses>]][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?where_conditions_required><?!where_conditions>][\nWHERE <?!where_conditions_required><?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING (<?having_conditions_required>) AND (<?having_conditions>)][\nHAVING <?having_conditions_required><?!having_conditions>][\nHAVING <?!having_conditions_required><?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?where_conditions_required><?!where_conditions>][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]","delete":"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?where_conditions_required><?!where_conditions>][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]"}},postgres:{quotes:[["E'","'","''","''"],['"','"'],["",""]],functions:{strpos:["position(",2," in ",1,")"],strlen:["length(",1,")"],strlower:["lower(",1,")"],strupper:["upper(",1,")"],trim:["trim(",1,")"],quote:["quote(",1,")"],random:["random()"],now:["now()"]},clauses:{create:"CREATE TABLE IF NOT EXISTS <create_table>\n(<create_defs>)[<?create_opts>]",alter:"ALTER TABLE <alter_table>\n<alter_defs>[<?alter_opts>]",drop:"DROP TABLE IF EXISTS <drop_tables>[,<*drop_tables>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>[\n<*join_clauses>]][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?where_conditions_required><?!where_conditions>][\nWHERE <?!where_conditions_required><?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING (<?having_conditions_required>) AND (<?having_conditions>)][\nHAVING <?having_conditions_required><?!having_conditions>][\nHAVING <?!having_conditions_required><?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?where_conditions_required><?!where_conditions>][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]","delete":"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?where_conditions_required><?!where_conditions>][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]"}},sqlserver:{quotes:[["'","'","''","''"],["[","]"],[""," ESCAPE '\\'"]],functions:{strpos:["CHARINDEX(",2,",",1,")"],strlen:["LEN(",1,")"],strlower:["LOWER(",1,")"],strupper:["UPPER(",1,")"],trim:["LTRIM(RTRIM(",1,"))"],quote:["QUOTENAME(",1,',"\'")'],random:["RAND()"],now:["CURRENT_TIMESTAMP"]},clauses:{create:"CREATE TABLE IF NOT EXISTS <create_table>\n(<create_defs>)[<?create_opts>]",alter:"ALTER TABLE <alter_table>\n<alter_defs>[<?alter_opts>]",drop:"DROP TABLE IF EXISTS <drop_tables>[,<*drop_tables>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>[\n<*join_clauses>]][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?where_conditions_required><?!where_conditions>][\nWHERE <?!where_conditions_required><?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING (<?having_conditions_required>) AND (<?having_conditions>)][\nHAVING <?having_conditions_required><?!having_conditions>][\nHAVING <?!having_conditions_required><?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>][\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]][<?!order_conditions>[\nORDER BY 1\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?where_conditions_required><?!where_conditions>][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]","delete":"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?where_conditions_required><?!where_conditions>][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]"}},sqlite:{quotes:[["'","'","''","''"],['"','"'],[""," ESCAPE '\\'"]],functions:{strpos:["instr(",2,",",1,")"],strlen:["length(",1,")"],strlower:["lower(",1,")"],strupper:["upper(",1,")"],trim:["trim(",1,")"],quote:["quote(",1,")"],random:["random()"],now:["datetime('now')"]},clauses:{create:"CREATE TABLE IF NOT EXISTS <create_table>\n(<create_defs>)[<?create_opts>]",alter:"ALTER TABLE <alter_table>\n<alter_defs>[<?alter_opts>]",drop:"DROP TABLE IF EXISTS <drop_tables>[,<*drop_tables>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>[\n<*join_clauses>]][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?where_conditions_required><?!where_conditions>][\nWHERE <?!where_conditions_required><?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING (<?having_conditions_required>) AND (<?having_conditions>)][\nHAVING <?having_conditions_required><?!having_conditions>][\nHAVING <?!having_conditions_required><?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?where_conditions_required><?!where_conditions>][\nWHERE <?!where_conditions_required><?where_conditions>]","delete":"[<?!order_conditions><?!count>DELETE FROM <from_tables> [, <*from_tables>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?where_conditions_required><?!where_conditions>][\nWHERE <?!where_conditions_required><?where_conditions>]][DELETE FROM <from_tables> [, <*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables> [, <*from_tables>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?where_conditions_required><?!where_conditions>][\nWHERE <?!where_conditions_required><?where_conditions>]\nORDER BY <?order_conditions> [, <*order_conditions>][\nLIMIT <?count> OFFSET <offset|0>]\n)][<?!order_conditions>DELETE FROM <from_tables> [, <*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables> [, <*from_tables>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?where_conditions_required><?!where_conditions>][\nWHERE <?!where_conditions_required><?where_conditions>]\nLIMIT <?count> OFFSET <offset|0>\n)]"}}};return y.VERSION="0.7.0",y.dialects=V,y.StringTemplate=t,y.GrammarTemplate=c,y.Ref=S,y[N]={constructor:y,clau:null,clus:null,tbls:null,cols:null,vews:null,tpls:null,db:null,escdb:null,p:null,type:null,clauses:null,q:null,qn:null,e:null,dispose:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e.vews=null,e.tpls=null,e.db=null,e.escdb=null,e.p=null,e.type=null,e.clauses=null,e.q=null,e.qn=null,e.e=null,e},toString:function(){return this.sql()||""},driver:function(e){var n=this;return arguments.length?(n.db=e?e:null,n):n.db},escape:function(e){var n=this;return arguments.length?(n.escdb=e&&f(e)?e:null,n):n.escdb},prefix:function(e){var n=this;return arguments.length?(n.p=e&&e.length?e:"",n):n.p},reset:function(e){var n=this;if(!e||!n.clauses[O](e))throw new TypeError('Dialect: SQL clause "'+e+'" does not exist for dialect "'+n.type+'"');return n.clus={},n.tbls={},n.cols={},n.clau=e,n.clauses[n.clau]instanceof y.GrammarTemplate||(n.clauses[n.clau]=new y.GrammarTemplate(n.clauses[n.clau])),n},clear:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e},sql:function(){var e=this,n=null;return e.clau&&e.clauses[O](e.clau)&&(e.clus[O]("select_columns")&&(e.clus.select_columns=A(e.clus.select_columns,"aliased")),e.clus[O]("from_tables")&&(e.clus.from_tables=A(e.clus.from_tables,"aliased")),e.clus[O]("insert_tables")&&(e.clus.insert_tables=A(e.clus.insert_tables,"aliased")),e.clus[O]("insert_columns")&&(e.clus.insert_columns=A(e.clus.insert_columns,"full")),e.clus[O]("update_tables")&&(e.clus.update_tables=A(e.clus.update_tables,"aliased")),e.clus[O]("create_table")&&(e.clus.create_table=A(e.clus.create_table,"full")),e.clus[O]("alter_table")&&(e.clus.alter_table=A(e.clus.alter_table,"full")),e.clus[O]("drop_tables")&&(e.clus.drop_tables=A(e.clus.drop_tables,"full")),n=e.clauses[e.clau].render(e.clus)||""),e.clear(),n},createView:function(e){var n=this;return e&&n.clau&&(n.vews[e]={clau:n.clau,clus:n.clus,tbls:n.tbls,cols:n.cols},n.vews[e].clus[O]("where_conditions")&&(n.vews[e].clus.where_conditions&&(n.vews[e].clus.where_conditions_required=n.vews[e].clus.where_conditions),delete n.vews[e].clus.where_conditions),n.vews[e].clus[O]("having_conditions")&&(n.vews[e].clus.having_conditions&&(n.vews[e].clus.having_conditions_required=n.vews[e].clus.having_conditions),delete n.vews[e].clus.having_conditions),n.clear()),n},useView:function(e){var n,t,l=this;if(n=l.clus.select_columns,e=l.vews[e],l.clus=q(l.clus,e.clus,!0,!0),l.tbls=q({},e.tbls,!0),l.cols=q({},e.cols,!0),n){n=l.refs(n,l.cols,!0),t=[];for(var s=0,r=n.length;r>s;s++)"*"===n[s].full?t=t.concat(l.clus.select_columns):t.push(n[s]);l.clus.select_columns=t}return l},dropView:function(e){var n=this;return e&&n.vews[O](e)&&delete n.vews[e],n},prepareTpl:function(e){var n,t,l,s,r,i,o,u,a=this;return E(e)||(l=arguments,s=l.length,1===s?(r=null,i=null,o=null,u=!0):2===s?(r=l[1],i=null,o=null,u=!1):3===s?(r=null,i=l[1],o=l[2],u=!0):(r=l[1],i=l[2],o=l[3],u=!1),i=i?_(i):"%",o=o?_(o):"%",n=d(i+"(([rlfds]:)?[0-9a-zA-Z_]+)"+o),t=u?new y.StringTemplate(a.sql(),n):new y.StringTemplate(r,n),a.tpls[e]={sql:t,types:null}),a},prepared:function(e,n){var t,l,s,r,i,o,u,a,c,d,i,_=this;if(!E(e)&&_.tpls[O](e)){if(t=_.tpls[e].sql,l=_.tpls[e].types,null===l){for(t.parse(),l={},a=0,c=t.tpl.length;c>a;a++)d=t.tpl[a],0===d[0]&&(i=d[1].split(":"),i.length>1?(l[i[1]]=i[0],t.tpl[a][1]=i[1]):(l[i[0]]="s",t.tpl[a][1]=i[0]));_.tpls[e].types=l}r={};for(i in n)if(n[O](i))switch(o=n[i],s=l[O](i)?l[i]:"s"){case"r":p(o)?r[i]=o.join(","):r[i]=o;break;case"l":r[i]=_.like(o);break;case"f":if(p(o))for(u=b(o),r[i]=S.parse(u[0],_).aliased,a=1,c=u.length;c>a;a++)r[i]+=","+S.parse(u[a],_).aliased;else r[i]=S.parse(o,_).aliased;break;case"d":p(o)?r[i]=_.intval(b(o)).join(","):r[i]=_.intval(o);break;case"s":default:p(o)?r[i]=_.quote(b(o)).join(","):r[i]=_.quote(o)}return t.render(r)}return""},prepare:function(e,n,t,l){var s,r,i,o,u,a,c,f,h,v,E=this;if(e&&n){for(t=t?_(t):"%",l=l?_(l):"%",s=d(t+"([rlfds]:)?([0-9a-zA-Z_]+)"+l),v="";e.length&&(r=e.match(s));){if(i=r.index,o=r[0].length,f=r[2],n[O](f)){switch(h=r[1]?r[1].slice(0,-1):"s"){case"r":f=p(n[f])?n[f].join(","):n[f];break;case"l":f=E.like(n[f]);break;case"f":if(p(n[f]))for(c=b(n[f]),f=S.parse(c[0],E).aliased,u=1,a=c.length;a>u;u++)f+=","+S.parse(c[u],E).aliased;else f=S.parse(n[f],E).aliased;break;case"d":f=p(n[f])?E.intval(b(n[f])).join(","):E.intval(n[f]);break;case"s":default:f=p(n[f])?E.quote(b(n[f])).join(","):E.quote(n[f])}v+=e.slice(0,i)+f}else v+=e.slice(0,i)+E.quote("");e=e.slice(i+o)}return e.length&&(v+=e),v}return e},dropTpl:function(e){var n=this;return!E(e)&&n.tpls[O](e)&&(n.tpls[e].sql.dispose(),delete n.tpls[e]),n},Create:function(e,n,t,l){var s=this;return l=l||"create",s.clau!==l&&s.reset(l),s.clus.create_table=s.refs(e,s.tbls),s.clus.create_defs&&(n=s.clus.create_defs+","+n),s.clus.create_defs=n,t&&(s.clus.create_opts&&(t=s.clus.create_opts+","+t),s.clus.create_opts=t),s},Alter:function(e,n,t,l){var s=this;return l=l||"alter",s.clau!==l&&s.reset(l),s.clus.alter_table=s.refs(e,s.tbls),s.clus.alter_defs&&(n=s.clus.alter_defs+","+n),s.clus.alter_defs=n,t&&(s.clus.alter_opts&&(t=s.clus.alter_opts+","+t),s.clus.alter_opts=t),s},Drop:function(e,n){var t,l=this;return n=n||"drop",l.clau!==n&&l.reset(n),t=p(e)?e[0]:e,l.vews[O](t)?(l.dropView(t),l):(e=l.refs(null==e?"*":e,l.tbls),l.clus.drop_tables?l.clus.drop_tables=l.clus.drop_tables.concat(e):l.clus.drop_tables=e,l)},Select:function(e,n){var t=this;return n=n||"select",t.clau!==n&&t.reset(n),e=t.refs(null==e?"*":e,t.cols),t.clus.select_columns?t.clus.select_columns=t.clus.select_columns.concat(e):t.clus.select_columns=e,t},Insert:function(e,n,t){var l,s=this;return t=t||"insert",s.clau!==t&&s.reset(t),l=p(e)?e[0]:e,s.vews[O](l)&&s.clau===s.vews[l].clau?s.useView(l):(e=s.refs(e,s.tbls),n=s.refs(n,s.cols),s.clus.insert_tables?s.clus.insert_tables=s.clus.insert_tables.concat(e):s.clus.insert_tables=e,s.clus.insert_columns?s.clus.insert_columns=s.clus.insert_columns.concat(n):s.clus.insert_columns=n),s},Values:function(n){var t,l,s,r,i,o,u,a,c=this;if(E(n))return c;for(e!==n[0]&&p(n[0])||(n=[n]),t=n.length,l=[],r=0;t>r;r++)if(a=b(n[r]),a.length){for(s=[],o=0,u=a.length;u>o;o++)i=a[o],v(i)?i[O]("integer")?s.push(c.intval(i.integer)):i[O]("raw")?s.push(i.raw):i[O]("string")&&s.push(c.quote(i.string)):s.push(w(i)?i:c.quote(i));l.push("("+s.join(",")+")")}return l=l.join(","),c.clus.values_values&&(l=c.clus.values_values+","+l),c.clus.values_values=l,c},Update:function(e,n){var t,l=this;return n=n||"update",l.clau!==n&&l.reset(n),t=p(e)?e[0]:e,l.vews[O](t)&&l.clau===l.vews[t].clau?l.useView(t):(e=l.refs(e,l.tbls),l.clus.update_tables?l.clus.update_tables=l.clus.update_tables.concat(e):l.clus.update_tables=e),l},Set:function(e){var n,t,l,s,r,i,o=this;if(E(e))return o;n=[],i=o.cols;for(l in e)if(e[O](l))if(s=o.refs(l,i)[0].full,r=e[l],v(r)){if(r[O]("integer"))n.push(s+" = "+o.intval(r.integer));else if(r[O]("raw"))n.push(s+" = "+r.raw);else if(r[O]("string"))n.push(s+" = "+o.quote(r.string));else if(r[O]("increment"))n.push(s+" = "+s+" + "+o.intval(r.increment));else if(r[O]("decrement"))n.push(s+" = "+s+" - "+o.intval(r.increment));else if(r[O]("case")){if(t=s+" = CASE",r["case"][O]("when")){for(case_value in r["case"].when)r["case"].when[O](case_value)&&(t+="\nWHEN "+o.conditions(r["case"].when[case_value],!1)+" THEN "+o.quote(case_value));r["case"][O]("else")&&(t+="\nELSE "+o.quote(r["case"]["else"]))}else for(case_value in r["case"])r["case"][O](case_value)&&(t+="\nWHEN "+o.conditions(r["case"][case_value],!1)+" THEN "+o.quote(case_value));t+="\nEND",n.push(t)}}else n.push(s+" = "+(w(r)?r:o.quote(r)));return n=n.join(","),o.clus.set_values&&(n=o.clus.set_values+","+n),o.clus.set_values=n,o},Delete:function(e){var n=this;return e=e||"delete",n.clau!==e&&n.reset(e),n},From:function(e){var n,e,t=this;return E(e)?t:(n=p(e)?e[0]:e,t.vews[O](n)&&t.clau===t.vews[n].clau?t.useView(n):(e=t.refs(e,t.tbls),t.clus.from_tables?t.clus.from_tables=t.clus.from_tables.concat(e):t.clus.from_tables=e),t)},Join:function(e,n,t){var l,s,r,i=this;if(e=i.refs(e,i.tbls)[0].aliased,E(n))l=e;else{if(h(n))n=i.refs(n.split("="),i.cols),n="("+n[0].full+"="+n[1].full+")";else{for(s in n)n[O](s)&&(r=n[s],v(r)||(n[s]={eq:r,type:"identifier"}));n="("+i.conditions(n,!1)+")"}l=e+" ON "+n}return l=(E(t)?"JOIN ":t.toUpperCase()+" JOIN ")+l,i.clus.join_clauses&&(l=i.clus.join_clauses+"\n"+l),i.clus.join_clauses=l,i},Where:function(e,n){var t=this;return E(e)?t:(n=n?n.toUpperCase():"AND","OR"!==n&&(n="AND"),e=t.conditions(e,!1),t.clus.where_conditions&&(e=t.clus.where_conditions+" "+n+" "+e),t.clus.where_conditions=e,t)},Group:function(e,n){var t,l=this;return n=n?n.toUpperCase():"ASC","DESC"!==n&&(n="ASC"),t=l.refs(e,l.cols)[0].alias+" "+n,l.clus.group_conditions&&(t=l.clus.group_conditions+","+t),l.clus.group_conditions=t,l},Having:function(e,n){var t=this;return E(e)?t:(n=n?n.toUpperCase():"AND","OR"!==n&&(n="AND"),e=t.conditions(e,!0),t.clus.having_conditions&&(e=t.clus.having_conditions+" "+n+" "+e),t.clus.having_conditions=e,t)},Order:function(e,n){var t,l=this;return n=n?n.toUpperCase():"ASC","DESC"!==n&&(n="ASC"),t=l.refs(e,l.cols)[0].alias+" "+n,l.clus.order_conditions&&(t=l.clus.order_conditions+","+t),l.clus.order_conditions=t,l},Limit:function(e,n){var t=this;return t.clus.count=g(e),t.clus.offset=g(n),t},Page:function(e,n){var t=this;return e=g(e),n=g(n),t.Limit(n,e*n)},conditions:function(e,n){var t,l,s,r,i,o,u,a,c,d,_,f,p,g=this;if(E(e))return"";if(h(e))return e;t="",l=[],d=g.cols,o=!0===n?"alias":"full";for(s in e)if(e[O](s))if(i=e[s],v(i)){if(i[O]("raw")){l.push(String(i.raw));continue}if(i[O]("or")){_=[];for(var m=0,q=i.or.length;q>m;m++)f=i.or[m],_.push(g.conditions(f,n));l.push(_.join(" OR "));continue}if(i[O]("and")){_=[];for(var m=0,q=i.and.length;q>m;m++)f=i.and[m],_.push(g.conditions(f,n));l.push(_.join(" AND "));continue}if(i[O]("either")){_=[];for(var m=0,q=i.either.length;q>m;m++)f={},f[s]=i.either[m],_.push(g.conditions(f,n));l.push(_.join(" OR "));continue}if(i[O]("together")){_=[];for(var m=0,q=i.together.length;q>m;m++)f={},f[s]=i.together[m],_.push(g.conditions(f,n));l.push(_.join(" AND "));continue}if(r=g.refs(s,d)[0][o],a=i[O]("type")?i.type:"string",
i[O]("case")){if(_=r+" = CASE",i["case"][O]("when")){for(p in i["case"].when)i["case"].when[O](p)&&(_+=" WHEN "+g.conditions(i["case"].when[p],n)+" THEN "+g.quote(p));i["case"][O]("else")&&(_+=" ELSE "+g.quote(i["case"]["else"]))}else for(p in i["case"])i["case"][O](p)&&(_+=" WHEN "+g.conditions(i["case"][p],n)+" THEN "+g.quote(p));_+=" END",l.push(_)}else i[O]("multi_like")?l.push(g.multi_like(r,i.multi_like)):i[O]("like")?l.push(r+" LIKE "+("raw"===a?i.like:g.like(i.like))):i[O]("not_like")?l.push(r+" NOT LIKE "+("raw"===a?i.not_like:g.like(i.not_like))):i[O]("contains")?(c=String(i.contains),"raw"===a||(c=g.quote(c)),l.push(g.sql_function("strpos",[r,c])+" > 0")):i[O]("not_contains")?(c=String(i.not_contains),"raw"===a||(c=g.quote(c)),l.push(g.sql_function("strpos",[r,c])+" = 0")):i[O]("in")?(c=b(i["in"]),"raw"===a||(c="integer"===a||w(c[0])?g.intval(c):g.quote(c)),l.push(r+" IN ("+c.join(",")+")")):i[O]("not_in")?(c=b(i.not_in),"raw"===a||(c="integer"===a||w(c[0])?g.intval(c):g.quote(c)),l.push(r+" NOT IN ("+c.join(",")+")")):i[O]("between")?(c=b(i.between),null==c[0]?("raw"===a||("integer"===a||w(c[1])?c[1]=g.intval(c[1]):c[1]=g.quote(c[1])),l.push(r+" <= "+c[1])):null==c[1]?("raw"===a||("integer"===a||w(c[0])?c[0]=g.intval(c[0]):c[0]=g.quote(c[0])),l.push(r+" >= "+c[0])):("raw"===a||(c="integer"===a||w(c[0])&&w(c[1])?g.intval(c):g.quote(c)),l.push(r+" BETWEEN "+c[0]+" AND "+c[1]))):i[O]("not_between")?(c=b(i.not_between),null==c[0]?("raw"===a||("integer"===a||w(c[1])?c[1]=g.intval(c[1]):c[1]=g.quote(c[1])),l.push(r+" > "+c[1])):null==c[1]?("raw"===a||("integer"===a||w(c[0])?c[0]=g.intval(c[0]):c[0]=g.quote(c[0])),l.push(r+" < "+c[0])):("raw"===a||(c="integer"===a||w(c[0])&&w(c[1])?g.intval(c):g.quote(c)),l.push(r+" < "+c[0]+" OR "+r+" > "+c[1]))):i[O]("gt")||i[O]("gte")?(u=i[O]("gt")?"gt":"gte",c=i[u],"raw"===a||(c="integer"===a||w(c)?g.intval(c):"identifier"===a||"field"===a?g.refs(c,d)[0][o]:g.quote(c)),l.push(r+("gt"===u?" > ":" >= ")+c)):i[O]("lt")||i[O]("lte")?(u=i[O]("lt")?"lt":"lte",c=i[u],"raw"===a||(c="integer"===a||w(c)?g.intval(c):"identifier"===a||"field"===a?g.refs(c,d)[0][o]:g.quote(c)),l.push(r+("lt"===u?" < ":" <= ")+c)):i[O]("not_equal")||i[O]("not_eq")?(u=i[O]("not_eq")?"not_eq":"not_equal",c=i[u],"raw"===a||(c="integer"===a||w(c)?g.intval(c):"identifier"===a||"field"===a?g.refs(c,d)[0][o]:g.quote(c)),l.push(r+" <> "+c)):(i[O]("equal")||i[O]("eq"))&&(u=i[O]("eq")?"eq":"equal",c=i[u],"raw"===a||(c="integer"===a||w(c)?g.intval(c):"identifier"===a||"field"===a?g.refs(c,d)[0][o]:g.quote(c)),l.push(r+" = "+c))}else r=g.refs(s,d)[0][o],l.push(r+" = "+(w(i)?i:g.quote(i)));return l.length&&(t="("+l.join(") AND (")+")"),t},joinConditions:function(e,n){var t,l,s,r,i,o,u,a,c,d,_,f,h=this,p=0;for(t in n)n[O](t)&&(l=S.parse(t,h),s=l._col,e[O](s)&&(r=n[t],o=e[s].table,u=e[s].id,a=e[s].join,c=e[s].join_id,p++,d=a+p,i={},e[s][O]("key")&&s!==e[s].key?(_=e[s].key,i[d+"."+_]=s):_=s,e[s][O]("value")?(f=e[s].value,i[d+"."+f]=r):(f=_,i[d+"."+f]=r),h.Join(a+" AS "+d,o+"."+u+"="+d+"."+c,"inner").Where(i),delete n[t]));return h},refs:function(e,n,t){var l=this;if(!0===t){var s,r,i,o,u,a,c,d,_;for(s=0,r=e.length;r>s;s++)i=e[s],u=i.alias,a=i.qualified,c=i.full,"*"!==c&&(n[O](u)?e[s]=n[u]:n[O](c)?(o=n[c],d=o.alias,_=o.full,_!==c&&d!==u&&d===c&&(o=o.cloned(i.alias),e[s]=n[u]=o)):n[O](a)?(o=n[a],o.qualified!==a&&(o=n[o.qualified]),o=i.full!==i.alias?o.cloned(i.alias,null,i._func):o.cloned(null,o.alias,i._func),e[s]=n[o.alias]=o,o.alias===o.full||n[O](o.full)||(n[o.full]=o)):(n[u]=i,u===c||n[O](c)||(n[c]=i)))}else{var s,r,f,h,p,v,i,u,a;for(v=b(e),e=[],s=0,r=v.length;r>s;s++)for(p=v[s].split(","),f=0,h=p.length;h>f;f++)i=S.parse(p[f],l),u=i.alias,a=i.full,n[O](u)?i=n[u]:(n[u]=i,a===u||n[O](a)||(n[a]=i)),e.push(i)}return e},tbl:function(e){var n=this;if(p(e)){for(var t=0,l=e.length;l>t;t++)e[t]=n.tbl(e[t]);return e}return n.p+e},intval:function(e){var n=this;if(p(e)){for(var t=0,l=e.length;l>t;t++)e[t]=n.intval(e[t]);return e}return parseInt(e,10)},quote_name:function(e,n){var t=this,l=t.qn;if(n=!0===n,p(e)){for(var s=0,r=e.length;r>s;s++)e[s]=t.quote_name(e[s],n);return e}return n?(l[0]==e.slice(0,l[0].length)?"":l[0])+e+(l[1]==e.slice(-l[1].length)?"":l[1]):l[0]+e+l[1]},quote:function(e){var n=this,t=n.q;if(p(e)){for(var l=0,s=e.length;s>l;l++)e[l]=n.quote(e[l]);return e}return t[0]+n.esc(e)+t[1]},like:function(e){var n,t,l=this;if(p(e)){for(var s=0,r=e.length;r>s;s++)e[s]=l.like(e[s]);return e}return n=l.q,t=l.escdb?["",""]:l.e,t[0]+n[0]+"%"+l.esc_like(l.esc(e))+"%"+n[1]+t[1]},multi_like:function(e,n,t){var l,s,r,i,o,u,a,c=this;for(t=!1!==t,l=e+" LIKE ",s=n.split(","),t&&(s=T(R(s,j),Boolean)),i=0,o=s.length;o>i;i++){for(r=s[i].split("+"),t&&(r=T(R(r,j),Boolean)),u=0,a=r.length;a>u;u++)r[u]=l+c.like(r[u]);s[i]="("+r.join(" AND ")+")"}return s.join(" OR ")},esc:function(e){var n,t,l,s,r,i,o,u=this;if(p(e)){for(l=0,s=e.length;s>l;l++)e[l]=u.esc(e[l]);return e}if(u.escdb)return u.escdb(e);for(o=u.q,n="\\"+C,t="\\",e=String(e),r="",l=0,s=e.length;s>l;l++)i=e.charAt(l),r+=o[0]===i?o[2]:o[1]===i?o[3]:m(i,n,t);return r},esc_like:function(e){var n=this;if(p(e)){for(var t=0,l=e.length;l>t;t++)e[t]=n.esc_like(e[t]);return e}return m(e,"_%","\\")},sql_function:function(e,n){var t,l,s,r,i,o,u=this;if(null==y.dialects[u.type].functions[e])throw new TypeError('Dialect: SQL function "'+e+'" does not exist for dialect "'+u.type+'"');for(e=y.dialects[u.type].functions[e],n=null!=n?b(n):[],o=n.length,t="",l=!1,s=0,r=e.length;r>s;s++)i=e[s],t+=l?i>0&&o>=i?n[i-1]:"":i,l=!l;return t}},y});