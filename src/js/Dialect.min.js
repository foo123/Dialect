/**
*   Dialect, 
*   a simple and flexible Cross-Platform SQL Builder for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 0.8.1
*   https://github.com/foo123/Dialect
*
*   Abstract the construction of SQL queries
*   Support multiple DB vendors
*   Intuitive and Flexible API
**/
!function(e,n,t){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.$deps=e.$deps||{})&&(e.EXPORTED_SYMBOLS=[n])&&(e[n]=e.$deps[n]=t.call(e)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=t.call(e)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(n,[],function(l){l(n,t.call(e))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return t.moduleUri=n.uri,t.call(e)}):n in e||(e[n]=t.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[n]})}(this,"Dialect",function(e){"use strict";function n(){return""+(new Date).getTime()+"--"+ ++F}function t(e,n,l){var s=this;return s instanceof t?(s.id=null,s.tpl=null,s._renderer=null,s._args=[e||"",n||t.defaultArgs,l],void(s._parsed=!1)):new t(e,n,l)}function l(e,n,t,l){var s,i,u,r,o=0;if(n)for(s=e,i=n.length,u=0,o=1;i>u;){if(r=n[u++],null==s||null==s[r]){o=0;break}s=s[r]}if(!o&&t)for(s=e,i=t.length,u=0,o=1;i>u;){if(r=t[u++],null==s||null==s[r]){o=0;break}s=s[r]}if(!o&&null!=l&&l!==e){if(n)for(s=l,i=n.length,u=0,o=1;i>u;){if(r=n[u++],null==s||null==s[r]){o=0;break}s=s[r]}if(!o&&t)for(s=l,i=t.length,u=0,o=1;i>u;){if(r=t[u++],null==s||null==s[r]){o=0;break}s=s[r]}}return o?s:null}function s(e,n){this.prev=e||null,this.value=n||null}function i(e,n){n&&(n.next=this),this.node=e||null,this.prev=n||null,this.next=null}function u(e,t,l){var u,r,o,a,c,f,p,d,_,h,v,E,g,m,b,T,w,O,R,y,q,A,I,N,S,L,k,D=t[0],M=t[1],j=t[2],F=t[3],x=t[4],W=D.length,H=M.length,B=j.length,Y=F.length,P=x.length,V="\\",G="?",K="*",X="!",J="|",Q="{",$="}",z=".",Z=":",ee=null,ne=0,te=0,le=e.length;for(l=!0===l,_=new i({type:0,val:""}),q={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,start:0,end:0},I=_,N=null,A=null,w={},R=null,O={},y=null,p=null,v="",b=!1,E=0;le>E;)if(b=!1,T=e[C](E),V===T&&(b=!0,E+=1),D===e.substr(E,W)){if(E+=W,b){v+=D;continue}v.length&&(0===_.node.type?_.node.val+=v:_=new i({type:0,val:v},_)),v=""}else if(M===e.substr(E,H)){if(E+=H,b){v+=M;continue}if(c=v,v="",-1<(f=c.indexOf(J))?(ee=c.slice(f+1),c=c.slice(0,f)):ee=null,d=l?le>E?e[C](E):"":c[C](0),G===d||K===d)te=1,K===d?(r=1,o=-1):(r=0,o=0),l?(E+=1,le>E&&X===e[C](E)?(ne=1,E+=1):ne=0):X===c[C](1)?(ne=1,c=c.slice(2)):(ne=0,c=c.slice(1));else if(Q===d){if(l){for(v="",g=E+1,m=le;m>g&&$!==e[C](g);)v+=e[C](g++);E=g+1}else{for(v="",g=1,m=c.length;m>g&&$!==c[C](g);)v+=c[C](g++);c=c.slice(g+1)}v=v.split(","),v.length>1?(r=U(v[0]),r=r.length?0|+r:0,o=U(v[1]),o=o.length?0|+o:-1,te=1):(r=U(v[0]),r=r.length?0|+r:0,o=r,te=0),v="",ne=0}else te=0,ne=0,r=0,o=0;if(ne&&null===ee&&(ee=""),a=-1<c.indexOf(Z)?c.split(Z):[c,null],c=a[0],a=a[1],u=-1<c.indexOf(z)?c.split(z):null,R&&!O[R]&&(O[R]={}),x+j===e.substr(E,P+B)&&(E+=P,a=a&&a.length?a:"grtpl--"+n(),y=a,R&&c.length&&(O[R][c]=a)),!c.length)continue;null==a&&R&&O[R]&&O[R][c]&&(a=O[R][c]),te&&!q.opt?(q.name=c,q.key=u,q.stpl=a,q.dval=ee,q.opt=te,q.neg=ne,q.start=r,q.end=o,A=new s(null,[c,u,ne,r,o,te])):te?(r!==o&&q.start===q.end&&(q.name=c,q.key=u,q.stpl=a,q.dval=ee,q.opt=te,q.neg=ne,q.start=r,q.end=o),A=new s(A,[c,u,ne,r,o,te])):te||null!==q.name||(q.name=c,q.key=u,q.stpl=a,q.dval=ee,q.opt=0,q.neg=ne,q.start=r,q.end=o,A=new s(null,[c,u,ne,r,o,0])),_=new i({type:1,name:c,key:u,stpl:a,dval:ee,opt:te,start:r,end:o},_)}else if(j===e.substr(E,B)){if(E+=B,b){v+=j;continue}v.length&&(0===_.node.type?_.node.val+=v:_=new i({type:0,val:v},_)),v="",p=new s(p,[_,N,q,A,R,y]),y&&(R=y),y=null,q={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,start:0,end:0},A=null,_=new i({type:0,val:""}),N=_}else if(F===e.substr(E,Y)){if(E+=Y,b){v+=F;continue}h=_,S=N,L=q,k=A,p?(_=p.value[0],N=p.value[1],q=p.value[2],A=p.value[3],R=p.value[4],y=p.value[5],p=p.prev):_=null,v.length&&(0===h.node.type?h.node.val+=v:h=new i({type:0,val:v},h)),v="",y?(w[y]=new i({type:2,name:L.name,key:L.key,start:0,end:0,opt_args:null,tpl:S}),y=null):_=new i({type:-1,name:L.name,key:L.key,start:L.start,end:L.end,opt_args:k,tpl:S},_)}else v+=e[C](E++);return v.length&&(0===_.node.type?_.node.val+=v:_=new i({type:0,val:v},_)),[I,w]}function r(e,n,t,s,i,u){var r,o,c,f,p,d,_,v,E=null,g="";if(-1===n.type){if(r=n.opt_args,r&&r.value[5])for(;r;){if(o=r.value,c=l(e,o[1],[String(o[0])],u),null===E&&n.name===o[0]&&(E=c),0===o[2]&&null==c||1===o[2]&&null!=c)return"";r=r.prev}}else E=l(e,n.key,[String(n.name)],u);if(f=h(E),v=f?E.length:-1,f&&v>n.start)for(p=n.start,d=-1===n.end?v-1:Math.min(n.end,v-1),_=p;d>=_;_++)g+=a(e,n.tpl,t,s,_,u);else f||n.start!==n.end||(g=a(e,n.tpl,t,s,null,u));return g}function o(e,n,t,s,i,u){var o,a,f,p,d="";return n.stpl&&(t&&t[n.stpl]||s&&s[n.stpl]||c.fnGlobal[n.stpl])?(o=l(e,n.key,[String(n.name)],u),t&&t[n.stpl]?(null==i||0===i&&n.opt||!h(o)||(o=o[i]),null==o&&null!==n.dval?d=n.dval:(f=t[n.stpl].node,a={},null!=o&&(h(o)?a[f.name]=o:a=o),d=r(a,f,t,s,null,null==u?e:u))):(p=s&&s[n.stpl]?s[n.stpl]:c.fnGlobal[n.stpl]?c.fnGlobal[n.stpl]:null,h(o)&&(i=null!=i?i:n.start,o=i<o.length?o[i]:null),o="function"==typeof p?p(o,i,e,u,n):String(p),d=null==o&&null!==n.dval?n.dval:String(o))):n.opt&&null!==n.dval?d=n.dval:(o=l(e,n.key,[String(n.name)],u),h(o)&&(i=null!=i?i:n.start,o=i<o.length?o[i]:null),d=null==o&&null!==n.dval?n.dval:String(o)),d}function a(e,n,t,l,s,i){for(var u,a="";n;)u=n.node.type,a+=-1===u?r(e,n.node,t,l,s,i):1===u?o(e,n.node,t,l,s,i):n.node.val,n=n.next;return a}function c(e,n,t){var l=this;return l instanceof c?(l.id=null,l.tpl=null,l.fn={},void(l._args=[e||"",n||c.defaultDelims,t||!1])):new c(e,n,t)}function f(e,n){return new RegExp(e,n||"")}function p(e){return e.replace(D,"\\$&")}function d(e){return"function"==typeof e}function _(e){return"string"==typeof e}function h(e){return e instanceof Array||"[object Array]"===L.call(e)}function v(e){return e instanceof Object||"[object Object]"===L.call(e)}function E(e){if(!e)return!0;var n=L.call(e);return(e instanceof Array||e instanceof String||"[object Array]"===n||"[object String]"===n)&&!e.length?!0:(e instanceof Object||"[object Array]"===n)&&!S(e).length}function g(e){return parseInt(e||0,10)||0}function m(e){return e===+e&&isFinite(e)&&!(e%1)}function b(e){return h(e)?e:[e]}function T(e,n,t){var l,s,i,u="";for(3>arguments.length&&(t="\\"),2>arguments.length&&(n="\\\"'"+j),l=0,s=e.length;s>l;l++)i=e[C](l),u+=-1===n.indexOf(i)?i:0===i[k](0)?"\\0":t+i;return u}function w(e,n,t,l){t=!0===t,l=!0===l;for(var s in n)n[N](s)&&(!t&&e[N](s)||(e[s]=l&&n[s].slice?n[s].slice():n[s]));return e}function O(e,n){var t=e.length;if(!t)return[];var l,s,i=15&t,u=1&i,r=new Array(t);for(u&&(r[0]=n(e[0])),l=u;i>l;l+=2)s=l,r[l]=n(e[s]),r[l+1]=n(e[s+1]);for(l=i;t>l;l+=16)s=l,r[l]=n(e[s]),r[l+1]=n(e[s+1]),r[l+2]=n(e[s+2]),r[l+3]=n(e[s+3]),r[l+4]=n(e[s+4]),r[l+5]=n(e[s+5]),r[l+6]=n(e[s+6]),r[l+7]=n(e[s+7]),r[l+8]=n(e[s+8]),r[l+9]=n(e[s+9]),r[l+10]=n(e[s+10]),r[l+11]=n(e[s+11]),r[l+12]=n(e[s+12]),r[l+13]=n(e[s+13]),r[l+14]=n(e[s+14]),r[l+15]=n(e[s+15]);return r}function R(e,n){var t=e.length;if(!t)return[];var l,s,i=15&t,u=1&i,r=[];for(u&&n(e[0])&&r.push(e[0]),l=u;i>l;l+=2)s=l,n(e[s])&&r.push(e[s]),n(e[++s])&&r.push(e[s]);for(l=i;t>l;l+=16)s=l,n(e[s])&&r.push(e[s]),n(e[++s])&&r.push(e[s]),n(e[++s])&&r.push(e[s]),n(e[++s])&&r.push(e[s]),n(e[++s])&&r.push(e[s]),n(e[++s])&&r.push(e[s]),n(e[++s])&&r.push(e[s]),n(e[++s])&&r.push(e[s]),n(e[++s])&&r.push(e[s]),n(e[++s])&&r.push(e[s]),n(e[++s])&&r.push(e[s]),n(e[++s])&&r.push(e[s]),n(e[++s])&&r.push(e[s]),n(e[++s])&&r.push(e[s]),n(e[++s])&&r.push(e[s]),n(e[++s])&&r.push(e[s]);return r}function y(e,n,t){var l,s,i="";if(e&&e.length)for(t=null==t?",":t,i=e[0][n],l=1,s=e.length;s>l;l++)i+=t+e[l][n];return i}function q(e,n,t,l,s,i,u,r,o,a,c){var f=this;if(f._col=e,f.col=n,f._tbl=t,f.tbl=l,f._dtb=s,f.dtb=i,f._alias=u,f._qualified=o,f.qualified=a,f.full=f.qualified,f._func=null==c?[]:c,f._func.length)for(var p=0,d=f._func.length;d>p;p++)f.full=f._func[p]+"("+f.full+")";null!=f._alias?(f.alias=r,f.aliased=f.full+" AS "+f.alias):(f.alias=f.full,f.aliased=f.full)}function A(e){var n=this;if(!(n instanceof A))return new A(e);if(arguments.length||(e="mysql"),!e||!A.dialects[e]||!A.dialects[e].clauses)throw new TypeError('Dialect: SQL dialect does not exist for "'+e+'"');n.clau=null,n.clus=null,n.tbls=null,n.cols=null,n.vews={},n.tpls={},n.db=null,n.escdb=null,n.p="",n.type=e,n.clauses=A.dialects[n.type].clauses,n.q=A.dialects[n.type].quotes[0],n.qn=A.dialects[n.type].quotes[1],n.e=A.dialects[n.type].quotes[2]||["",""]}var I="prototype",N="hasOwnProperty",S=Object.keys,L=Object[I].toString,C="charAt",k="charCodeAt",D=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,M=/^\s+|\s+$/g,U=String[I].trim?function(e){return e.trim()}:function(e){return e.replace(M,"")},j=String.fromCharCode(0),F=0;t.VERSION="1.0.0",t.defaultArgs=/\$(-?[0-9]+)/g,t.guid=n,t.multisplit=function(e,n,t){var l,s,i,u,r,o,a,c,f,p;t=!!t,o=[[1,e]];for(l in n)if(n.hasOwnProperty(l)){for(c=[],s=t?n[l]:l,i=[0,n[l]],u=0,f=o.length;f>u;u++)if(1===o[u][0]){if(a=o[u][1].split(s),p=a.length,c.push([1,a[0]]),p>1)for(r=0;p-1>r;r++)c.push(i),c.push([1,a[r+1]])}else c.push(o[u]);o=c}return o},t.multisplit_re=function(e,n){n=n.global?n:new RegExp(n.source,n.ignoreCase?"gi":"g");for(var t,l=[],s=0;t=n.exec(e);)l.push([1,e.slice(s,n.lastIndex-t[0].length)]),l.push([0,t[1]?t[1]:t[0]]),s=n.lastIndex;return l.push([1,e.slice(s)]),l},t.arg=function(e,n){var t,l,s,i,u,r="args";if(arguments.length&&null!=e)for(e=e.substr?e.length?e.split("."):[]:[e],i=e.length,u=!(!n||!n.substr),t=0;i>t;t++)l=e[t],s=+l,isNaN(s)?r+='["'+l+'"]':(0>s&&(l=u?n+-s:r+".length-"+-s),r+="["+l+"]");return r},t.compile=function(e,n){var l,s,i,u,r=e.length;if(!0===n){for(u='"use strict"; return (',l=0;r>l;l++)s=e[l][0],i=e[l][1],u+=s?i:t.arg(i);u+=");"}else{for(u='"use strict"; var argslen=args.length; return (',l=0;r>l;l++)s=e[l][0],i=e[l][1],u+=s?"'"+i.replace(SQUOTE,"\\'").replace(NEWLINE,"' + \"\\n\" + '")+"'":" + String("+t.arg(i,"argslen")+") + ";u+=");"}return new Function("args",u)},t[I]={constructor:t,id:null,tpl:null,_parsed:!1,_args:null,_renderer:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e._parsed=null,e._args=null,e._renderer=null,e},fixRenderer:function(){var e=this;return e.render="function"==typeof e._renderer?e._renderer:e.constructor[I].render,e},parse:function(){var e=this;if(!1===e._parsed){e._parsed=!0;var n=e._args[0],l=e._args[1],s=e._args[2];e._args=null,e.tpl=l instanceof RegExp?t.multisplit_re(n,l):t.multisplit(n,l),!0===s&&(e._renderer=t.compile(e.tpl),e.fixRenderer())}return e},render:function(e){var n=this;if(e=e||[],!1===n._parsed&&(n.parse(),n._renderer))return n._renderer(e);var t,l,s,i=n.tpl,u=i.length,r=e.length,o="";for(t=0;u>t;t++)l=i[t],1===l[0]?o+=l[1]:(s=l[1],+s===s&&0>s&&(s=r+s),o+=e[s]);return o}},c.VERSION="2.1.1",c.defaultDelims=["<",">","[","]",":="],c.fnGlobal={},c.guid=n,c.multisplit=u,c.main=a,c[I]={constructor:c,id:null,tpl:null,fn:null,_args:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e.fn=null,e._args=null,e},parse:function(){var e=this;return null===e.tpl&&null!==e._args&&(e.tpl=c.multisplit(e._args[0],e._args[1],e._args[2]),e._args=null),e},render:function(e){var n=this;return null===n.tpl&&n.parse(),c.main(null==e?{}:e,n.tpl[0],n.tpl[1],n.fn)}};var x=/\s/,W=/[0-9]/,H=/[a-z_]/i;q.parse=function(e,n){var t,l,s,i,u,r,o,a,c,f,p,d,_,h,v,E,g,m,b,T,w,O,R,y,A=["AS"];for(e=U(e),l=e.length,t=0,s=[[]],i=s[0],u=[],r=[],o="",a=null,p=0,d=null;l>t;){if(_=e.charAt(t++),'"'===_||"`"===_||"'"===_||"["===_||"]"===_){if(!d){if(o.length||"]"===_){a=["invalid",t];break}d="["===_?"]":_;continue}if(d===_){if(!o.length){a=["invalid",t];break}i.unshift([1,o]),u.unshift(o),o="",d=null;continue}if(d){o+=_;continue}}if(d)o+=_;else if("*"===_){if(o.length){a=["invalid",t];break}i.unshift([10,"*"]),u.unshift(10)}else if("."===_){if(o.length&&(i.unshift([1,o]),u.unshift(o),o=""),!i.length||1!==i[0][0]){a=["invalid",t];break}i.unshift([0,"."]),u.unshift(0)}else if("("===_){if(p++,o.length&&(i.unshift([2,o]),r.unshift(o),o=""),!i.length||2!==i[0][0]&&1!==i[0][0]){a=["invalid",t];break}1===i[0][0]&&(i[0][0]=2,r.unshift(u.shift())),s.unshift([]),i=s[0]}else if(")"===_){if(p--,o.length&&(h=-1<A.indexOf(o.toUpperCase()),i.unshift([h?5:1,o]),u.unshift(h?5:o),o=""),s.length<2){a=["invalid",t];break}s[1].unshift([100,s.shift()]),i=s[0]}else{if(x.test(_)){o.length&&(h=-1<A.indexOf(o.toUpperCase()),i.unshift([h?5:1,o]),u.unshift(h?5:o),o="");continue}if(W.test(_)){if(!o.length){a=["invalid",t];break}o+=_}else{if(!H.test(_)){a=["invalid",t];break}o+=_}}}if(o.length&&(i.unshift([1,o]),u.unshift(o),o=""),!a&&p&&(a=["paren",l]),!a&&d&&(a=["quote",l]),a||1===s.length||(a=["invalid",l]),a)throw c=a[1]-1,f=a[0],"paren"==f?new TypeError('Dialect: Mismatched parentheses "'+e+'" at position '+c+"."):"quote"==f?new TypeError('Dialect: Mismatched quotes "'+e+'" at position '+c+"."):new TypeError('Dialect: Invalid character "'+e+'" at position '+c+".");return w=null,O="",u.length>=3&&5===u[1]&&"string"==typeof u[0]&&(w=u.shift(),O=n.quote_name(w),u.shift()),v=null,E="",!u.length||"string"!=typeof u[0]&&10!==u[0]||(10===u[0]?(u.shift(),v=E="*"):(v=u.shift(),E=n.quote_name(v))),g=null,m="",u.length>=2&&0===u[0]&&"string"==typeof u[1]&&(u.shift(),g=u.shift(),m=n.quote_name(g)),b=null,T="",u.length>=2&&0===u[0]&&"string"==typeof u[1]&&(u.shift(),b=u.shift(),T=n.quote_name(b)),R=(b?b+".":"")+(g?g+".":"")+(v?v:""),y=(b?T+".":"")+(g?m+".":"")+(v?E:""),new q(v,E,g,m,b,T,w,O,R,y,r)},q[I]={constructor:q,_func:null,_col:null,col:null,_tbl:null,tbl:null,_dtb:null,dtb:null,_alias:null,alias:null,_qualified:null,qualified:null,full:null,aliased:null,cloned:function(e,n,t){var l=this;return arguments.length?n=n||e:(e=l._alias,n=l.alias),null==t&&(t=l._func),new q(l._col,l.col,l._tbl,l.tbl,l._dtb,l.dtb,e,n,l._qualified,l.qualified,t)},dispose:function(){var e=this;return e._func=null,e._col=null,e.col=null,e._tbl=null,e.tbl=null,e._dtb=null,e.dtb=null,e._alias=null,e.alias=null,e._qualified=null,e.qualified=null,e.full=null,e.aliased=null,e}};var B={mysql:{quotes:[["'","'","\\'","\\'"],["`","`"],["",""]],functions:{strpos:["POSITION(",2," IN ",1,")"],strlen:["LENGTH(",1,")"],strlower:["LCASE(",1,")"],strupper:["UCASE(",1,")"],trim:["TRIM(",1,")"],quote:["QUOTE(",1,")"],random:["RAND()"],now:["NOW()"]},clauses:"[<?transact_clause|>START TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE VIEW <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]UNIQUE KEY <name|> <type|> (<?uniquekey>[,<*uniquekey>])][[CONSTRAINT <?constraint> ]PRIMARY KEY <type|> (<?primarykey>)][[<?!index>KEY][<?index|>INDEX] <name|> <type|> (<?key>[,<*key>])][CHECK (<?check>)][<?column> <type>[ <?!isnull><?isnotnull|>NOT NULL][ <?!isnotnull><?isnull|>NULL][ DEFAULT <?default_value>][ <?auto_increment|>AUTO_INCREMENT][ <?!primary><?unique|>UNIQUE KEY][ <?!unique><?primary|>PRIMARY KEY][ COMMENT '<?comment>'][ COLUMN_FORMAT <?format>][ STORAGE <?storage>]]][,\n<*col:COL>]]\n)][ <?options>:=[<opt:OPT>:=[[ENGINE=<?engine>][AUTO_INCREMENT=<?auto_increment>][CHARACTER SET=<?charset>][COLLATE=<?collation>]][, <*opt:OPT>]]][\nAS <?query>]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>[<?temporary|>TEMPORARY ]TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]][<?delete_clause|>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]]"},postgres:{quotes:[["E'","'","''","''"],['"','"'],["",""]],functions:{strpos:["position(",2," in ",1,")"],strlen:["length(",1,")"],strlower:["lower(",1,")"],strupper:["upper(",1,")"],trim:["trim(",1,")"],quote:["quote(",1,")"],random:["random()"],now:["now()"]},clauses:"[<?transact_clause|>START TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>:=[<col:COL>:=[[<?column> <type>[ COLLATE <?collation>][ CONSTRAINT <?constraint>][ <?!isnull><?isnotnull|>NOT NULL][ <?!isnotnull><?isnull|>NULL][ DEFAULT <?default_value>][ CHECK (<?check>)][ <?unique|>UNIQUE][ <?primary|>PRIMARY KEY]]][,\n<*col:COL>]]\n)]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]][<?delete_clause|>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]]"},sqlserver:{quotes:[["'","'","''","''"],["[","]"],[""," ESCAPE '\\'"]],functions:{strpos:["CHARINDEX(",2,",",1,")"],strlen:["LEN(",1,")"],strlower:["LOWER(",1,")"],strupper:["UPPER(",1,")"],trim:["LTRIM(RTRIM(",1,"))"],quote:["QUOTENAME(",1,',"\'")'],random:["RAND()"],now:["CURRENT_TIMESTAMP"]},clauses:"[<?transact_clause|>BEGIN TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>[<?ifnotexists|>IF NOT EXISTS (SELECT * FROM sysobjects WHERE name=<create_table> AND xtype='U')\n]CREATE TABLE <create_table> [<?!query>(\n<columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]<?column> <type|>[ <?isnotnull|>NOT NULL][ [CONSTRAINT <?constraint> ]DEFAULT <?default_value>][ CHECK (<?check>)][ <?!primary><?unique|>UNIQUE][ <?!unique><?primary|>PRIMARY KEY[ COLLATE <?collation>]]]][,\n<*col:COL>]]\n)][<?ifnotexists|>\nGO]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>][\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]][<?!order_conditions>[\nORDER BY 1\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]][<?delete_clause|>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]]"},sqlite:{quotes:[["'","'","''","''"],['"','"'],[""," ESCAPE '\\'"]],functions:{strpos:["instr(",2,",",1,")"],strlen:["length(",1,")"],strlower:["lower(",1,")"],strupper:["upper(",1,")"],trim:["trim(",1,")"],quote:["quote(",1,")"],random:["random()"],now:["datetime('now')"]},clauses:"[<?transact_clause|>BEGIN <type|> TRANSACTION;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [<?!query>(\n<columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]<?column> <type|>[ <?isnotnull|>NOT NULL][ DEFAULT <?default_value>][ CHECK (<?check>)][ <?!primary><?unique|>UNIQUE][ <?!unique><?primary|>PRIMARY KEY[ <?auto_increment|>AUTOINCREMENT][ COLLATE <?collation>]]]][,\n<*col:COL>]]\n)[ <?without_rowid|>WITHOUT ROWID]][AS <?query>]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>]][<?delete_clause|>[<?!order_conditions><?!count>DELETE FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]][DELETE FROM <from_tables> [, <*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]\nORDER BY <?order_conditions> [, <*order_conditions>][\nLIMIT <?count> OFFSET <offset|0>]\n)][<?!order_conditions>DELETE FROM <from_tables> [, <*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]\nLIMIT <?count> OFFSET <offset|0>\n)]]"}};return A.VERSION="0.8.1",A.dialects=B,A.StringTemplate=t,A.GrammarTemplate=c,A.Ref=q,A[I]={constructor:A,clau:null,clus:null,tbls:null,cols:null,vews:null,tpls:null,db:null,escdb:null,p:null,type:null,clauses:null,q:null,qn:null,e:null,dispose:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e.vews=null,e.tpls=null,e.db=null,e.escdb=null,e.p=null,e.type=null,e.clauses=null,e.q=null,e.qn=null,e.e=null,e},toString:function(){return this.sql()||""},driver:function(e){var n=this;return arguments.length?(n.db=e?e:null,n):n.db},escape:function(e){var n=this;return arguments.length?(n.escdb=e&&d(e)?e:null,n):n.escdb},prefix:function(e){var n=this;return arguments.length?(n.p=e&&e.length?e:"",n):n.p},reset:function(e){var n=this;return n.clus={},n.tbls={},n.cols={},n.clau=e,n.clauses instanceof A.GrammarTemplate||(n.clauses=new A.GrammarTemplate(n.clauses)),n},clear:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e},subquery:function(){var e,n=this;return e=new A(n.type),e.driver(n.driver()).escape(n.escape()).prefix(n.prefix()),e.vews=n.vews,e},sql:function(){var e=this,n=null;return e.clau&&(e.clus[N]("select_columns")&&(e.clus.select_columns=y(e.clus.select_columns,"aliased")),e.clus[N]("from_tables")&&(e.clus.from_tables=y(e.clus.from_tables,"aliased")),e.clus[N]("insert_tables")&&(e.clus.insert_tables=y(e.clus.insert_tables,"aliased")),e.clus[N]("insert_columns")&&(e.clus.insert_columns=y(e.clus.insert_columns,"full")),e.clus[N]("update_tables")&&(e.clus.update_tables=y(e.clus.update_tables,"aliased")),e.clus[N]("create_table")&&(e.clus.create_table=y(e.clus.create_table,"full")),e.clus[N]("alter_table")&&(e.clus.alter_table=y(e.clus.alter_table,"full")),e.clus[N]("drop_tables")&&(e.clus.drop_tables=y(e.clus.drop_tables,"full")),e.clus[N]("where_conditions_required")&&(e.clus.where_conditions=e.clus[N]("where_conditions")?"("+e.clus.where_conditions_required+") AND ("+e.clus.where_conditions+")":e.clus.where_conditions_required,delete e.clus.where_conditions_required),e.clus[N]("having_conditions_required")&&(e.clus.having_conditions=e.clus[N]("having_conditions")?"("+e.clus.having_conditions_required+") AND ("+e.clus.having_conditions+")":e.clus.having_conditions_required,delete e.clus.having_conditions_required),e.clus[e.clau+"_clause"]=1,n=e.clauses.render(e.clus)||""),e.clear(),n},createView:function(e){var n=this;return e&&n.clau&&(n.vews[e]={clau:n.clau,clus:n.clus,tbls:n.tbls,cols:n.cols},n.vews[e].clus[N]("where_conditions")&&(n.vews[e].clus.where_conditions&&(n.vews[e].clus.where_conditions_required=n.vews[e].clus.where_conditions),delete n.vews[e].clus.where_conditions),n.vews[e].clus[N]("having_conditions")&&(n.vews[e].clus.having_conditions&&(n.vews[e].clus.having_conditions_required=n.vews[e].clus.having_conditions),delete n.vews[e].clus.having_conditions),n.clear()),n},useView:function(e){var n,t,l=this;if(n=l.clus.select_columns,e=l.vews[e],l.clus=w(l.clus,e.clus,!0,!0),l.tbls=w({},e.tbls,!0),l.cols=w({},e.cols,!0),n){n=l.refs(n,l.cols,!0),t=[];for(var s=0,i=n.length;i>s;s++)"*"===n[s].full?t=t.concat(l.clus.select_columns):t.push(n[s]);l.clus.select_columns=t}return l},dropView:function(e){var n=this;return e&&n.vews[N](e)&&delete n.vews[e],n},prepareTpl:function(e){var n,t,l,s,i,u,r,o,a=this;return E(e)||(l=arguments,s=l.length,1===s?(i=null,u=null,r=null,o=!0):2===s?(i=l[1],u=null,r=null,o=!1):3===s?(i=null,u=l[1],r=l[2],o=!0):(i=l[1],u=l[2],r=l[3],o=!1),u=u?p(u):"%",r=r?p(r):"%",n=f(u+"(([rlfds]:)?[0-9a-zA-Z_]+)"+r),t=o?new A.StringTemplate(a.sql(),n):new A.StringTemplate(i,n),a.tpls[e]={sql:t,types:null}),a},prepared:function(e,n){var t,l,s,i,u,r,o,a,c,f,u,p=this;if(!E(e)&&p.tpls[N](e)){if(t=p.tpls[e].sql,l=p.tpls[e].types,null===l){for(t.parse(),l={},a=0,c=t.tpl.length;c>a;a++)f=t.tpl[a],0===f[0]&&(u=f[1].split(":"),u.length>1?(l[u[1]]=u[0],t.tpl[a][1]=u[1]):(l[u[0]]="s",t.tpl[a][1]=u[0]));p.tpls[e].types=l}i={};for(u in n)if(n[N](u))switch(r=n[u],s=l[N](u)?l[u]:"s"){case"r":h(r)?i[u]=r.join(","):i[u]=r;break;case"l":i[u]=p.like(r);break;case"f":if(h(r))for(o=b(r),i[u]=q.parse(o[0],p).aliased,a=1,c=o.length;c>a;a++)i[u]+=","+q.parse(o[a],p).aliased;else i[u]=q.parse(r,p).aliased;break;case"d":h(r)?i[u]=p.intval(b(r)).join(","):i[u]=p.intval(r);break;case"s":default:h(r)?i[u]=p.quote(b(r)).join(","):i[u]=p.quote(r)}return t.render(i)}return""},prepare:function(e,n,t,l){var s,i,u,r,o,a,c,d,_,v,E=this;if(e&&n){for(t=t?p(t):"%",l=l?p(l):"%",s=f(t+"([rlfds]:)?([0-9a-zA-Z_]+)"+l),v="";e.length&&(i=e.match(s));){if(u=i.index,r=i[0].length,d=i[2],n[N](d)){switch(_=i[1]?i[1].slice(0,-1):"s"){case"r":d=h(n[d])?n[d].join(","):n[d];break;case"l":d=E.like(n[d]);break;case"f":if(h(n[d]))for(c=b(n[d]),d=q.parse(c[0],E).aliased,o=1,a=c.length;a>o;o++)d+=","+q.parse(c[o],E).aliased;else d=q.parse(n[d],E).aliased;break;case"d":d=h(n[d])?E.intval(b(n[d])).join(","):E.intval(n[d]);break;case"s":default:d=h(n[d])?E.quote(b(n[d])).join(","):E.quote(n[d])}v+=e.slice(0,u)+d}else v+=e.slice(0,u)+E.quote("");e=e.slice(u+r)}return e.length&&(v+=e),v}return e},dropTpl:function(e){var n=this;return!E(e)&&n.tpls[N](e)&&(n.tpls[e].sql.dispose(),delete n.tpls[e]),n},Transaction:function(e,n){var t,l=this;return n=n||"transact",l.clau!==n&&l.reset(n),e=e||{},l.clus.type=e.type||null,l.clus.rollback=e.rollback?1:null,E(e.statements)||(t=b(t),l.clus.statements?l.clus.statements=l.clus.statements.concat(t):l.clus.statements=t),l},Create:function(e,n,t){var l,s,i=this;return t=t||"create",i.clau!==t&&i.reset(t),n=n||{ifnotexists:1},i.clus.create_table=i.refs(e,i.tbls),i.clus.view=n.view?1:null,i.clus.ifnotexists=n.ifnotexists?1:null,i.clus.temporary=n.temporary?1:null,i.clus.query=E(n.query)?null:n.query,E(n.columns)||(l=b(n.columns),i.clus.columns?i.clus.columns=i.clus.columns.concat(l):i.clus.columns=l),E(n.table)||(s=b(n.table),i.clus.options?i.clus.options=i.clus.options.concat(s):i.clus.options=s),i},Alter:function(e,n,t){var l,s,i=this;return t=t||"alter",i.clau!==t&&i.reset(t),i.clus.alter_table=i.refs(e,i.tbls),n=n||{},i.clus.view=n.view?1:null,E(n.columns)||(l=b(n.columns),i.clus.columns?i.clus.columns=i.clus.columns.concat(l):i.clus.columns=l),E(n.table)||(s=b(n.table),i.clus.options?i.clus.options=i.clus.options.concat(s):i.clus.options=s),i},Drop:function(e,n,t){var l,s=this;return t=t||"drop",s.clau!==t&&s.reset(t),l=h(e)?e[0]:e,s.vews[N](l)?(s.dropView(l),s):(e=s.refs(null==e?"*":e,s.tbls),n=n||{ifexists:1},s.clus.view=n.view?1:null,s.clus.ifexists=n.ifexists?1:null,s.clus.temporary=n.temporary?1:null,s.clus.drop_tables?s.clus.drop_tables=s.clus.drop_tables.concat(e):s.clus.drop_tables=e,s)},Select:function(e,n){var t=this;return n=n||"select",t.clau!==n&&t.reset(n),e=t.refs(null==e?"*":e,t.cols),t.clus.select_columns?t.clus.select_columns=t.clus.select_columns.concat(e):t.clus.select_columns=e,t},Insert:function(e,n,t){var l,s=this;return t=t||"insert",s.clau!==t&&s.reset(t),l=h(e)?e[0]:e,s.vews[N](l)&&s.clau===s.vews[l].clau?s.useView(l):(e=s.refs(e,s.tbls),n=s.refs(n,s.cols),s.clus.insert_tables?s.clus.insert_tables=s.clus.insert_tables.concat(e):s.clus.insert_tables=e,s.clus.insert_columns?s.clus.insert_columns=s.clus.insert_columns.concat(n):s.clus.insert_columns=n),s},Values:function(n){var t,l,s,i,u,r,o,a,c=this;if(E(n))return c;for(e!==n[0]&&h(n[0])||(n=[n]),t=n.length,l=[],i=0;t>i;i++)if(a=b(n[i]),a.length){for(s=[],r=0,o=a.length;o>r;r++)u=a[r],v(u)?u[N]("integer")?s.push(c.intval(u.integer)):u[N]("raw")?s.push(u.raw):u[N]("string")&&s.push(c.quote(u.string)):s.push(m(u)?u:c.quote(u));l.push("("+s.join(",")+")")}return l=l.join(","),c.clus.values_values&&(l=c.clus.values_values+","+l),c.clus.values_values=l,c},Update:function(e,n){var t,l=this;return n=n||"update",l.clau!==n&&l.reset(n),t=h(e)?e[0]:e,l.vews[N](t)&&l.clau===l.vews[t].clau?l.useView(t):(e=l.refs(e,l.tbls),l.clus.update_tables?l.clus.update_tables=l.clus.update_tables.concat(e):l.clus.update_tables=e),l},Set:function(e){var n,t,l,s,i,u,r=this;if(E(e))return r;n=[],u=r.cols;for(l in e)if(e[N](l))if(s=r.refs(l,u)[0].full,i=e[l],v(i)){if(i[N]("integer"))n.push(s+" = "+r.intval(i.integer));else if(i[N]("raw"))n.push(s+" = "+i.raw);else if(i[N]("string"))n.push(s+" = "+r.quote(i.string));else if(i[N]("increment"))n.push(s+" = "+s+" + "+r.intval(i.increment));else if(i[N]("decrement"))n.push(s+" = "+s+" - "+r.intval(i.increment));else if(i[N]("case")){if(t=s+" = CASE",i["case"][N]("when")){for(case_value in i["case"].when)i["case"].when[N](case_value)&&(t+="\nWHEN "+r.conditions(i["case"].when[case_value],!1)+" THEN "+r.quote(case_value));i["case"][N]("else")&&(t+="\nELSE "+r.quote(i["case"]["else"]))}else for(case_value in i["case"])i["case"][N](case_value)&&(t+="\nWHEN "+r.conditions(i["case"][case_value],!1)+" THEN "+r.quote(case_value));
t+="\nEND",n.push(t)}}else n.push(s+" = "+(m(i)?i:r.quote(i)));return n=n.join(","),r.clus.set_values&&(n=r.clus.set_values+","+n),r.clus.set_values=n,r},Delete:function(e){var n=this;return e=e||"delete",n.clau!==e&&n.reset(e),n},From:function(e){var n,e,t=this;return E(e)?t:(n=h(e)?e[0]:e,t.vews[N](n)&&t.clau===t.vews[n].clau?t.useView(n):(e=t.refs(e,t.tbls),t.clus.from_tables?t.clus.from_tables=t.clus.from_tables.concat(e):t.clus.from_tables=e),t)},Join:function(e,n,t){var l,s,i,u=this;if(e=u.refs(e,u.tbls)[0].aliased,t=E(t)?null:t.toUpperCase(),E(n))l={table:e,type:t};else{if(_(n))n=u.refs(n.split("="),u.cols),n="("+n[0].full+"="+n[1].full+")";else{for(s in n)n[N](s)&&(i=n[s],v(i)||(n[s]={eq:i,type:"identifier"}));n="("+u.conditions(n,!1)+")"}l={table:e,type:t,cond:n}}return u.clus.join_clauses?u.clus.join_clauses.push(l):u.clus.join_clauses=[l],u},Where:function(e,n){var t=this;return E(e)?t:(n=n?n.toUpperCase():"AND","OR"!==n&&(n="AND"),e=t.conditions(e,!1),t.clus.where_conditions&&(e=t.clus.where_conditions+" "+n+" "+e),t.clus.where_conditions=e,t)},Group:function(e,n){var t,l=this;return n=n?n.toUpperCase():"ASC","DESC"!==n&&(n="ASC"),t=l.refs(e,l.cols)[0].alias+" "+n,l.clus.group_conditions&&(t=l.clus.group_conditions+","+t),l.clus.group_conditions=t,l},Having:function(e,n){var t=this;return E(e)?t:(n=n?n.toUpperCase():"AND","OR"!==n&&(n="AND"),e=t.conditions(e,!0),t.clus.having_conditions&&(e=t.clus.having_conditions+" "+n+" "+e),t.clus.having_conditions=e,t)},Order:function(e,n){var t,l=this;return n=n?n.toUpperCase():"ASC","DESC"!==n&&(n="ASC"),t=l.refs(e,l.cols)[0].alias+" "+n,l.clus.order_conditions&&(t=l.clus.order_conditions+","+t),l.clus.order_conditions=t,l},Limit:function(e,n){var t=this;return t.clus.count=g(e),t.clus.offset=g(n),t},Page:function(e,n){var t=this;return e=g(e),n=g(n),t.Limit(n,e*n)},conditions:function(e,n){var t,l,s,i,u,r,o,a,c,f,p,d,h,g=this;if(E(e))return"";if(_(e))return e;t="",l=[],f=g.cols,r=!0===n?"alias":"full";for(s in e)if(e[N](s))if(u=e[s],v(u)){if(u[N]("raw")){l.push(String(u.raw));continue}if(u[N]("or")){p=[];for(var T=0,w=u.or.length;w>T;T++)d=u.or[T],p.push(g.conditions(d,n));l.push(p.join(" OR "));continue}if(u[N]("and")){p=[];for(var T=0,w=u.and.length;w>T;T++)d=u.and[T],p.push(g.conditions(d,n));l.push(p.join(" AND "));continue}if(u[N]("either")){p=[];for(var T=0,w=u.either.length;w>T;T++)d={},d[s]=u.either[T],p.push(g.conditions(d,n));l.push(p.join(" OR "));continue}if(u[N]("together")){p=[];for(var T=0,w=u.together.length;w>T;T++)d={},d[s]=u.together[T],p.push(g.conditions(d,n));l.push(p.join(" AND "));continue}if(i=g.refs(s,f)[0][r],a=u[N]("type")?u.type:"string",u[N]("case")){if(p=i+" = CASE",u["case"][N]("when")){for(h in u["case"].when)u["case"].when[N](h)&&(p+=" WHEN "+g.conditions(u["case"].when[h],n)+" THEN "+g.quote(h));u["case"][N]("else")&&(p+=" ELSE "+g.quote(u["case"]["else"]))}else for(h in u["case"])u["case"][N](h)&&(p+=" WHEN "+g.conditions(u["case"][h],n)+" THEN "+g.quote(h));p+=" END",l.push(p)}else u[N]("multi_like")?l.push(g.multi_like(i,u.multi_like)):u[N]("like")?l.push(i+" LIKE "+("raw"===a?u.like:g.like(u.like))):u[N]("not_like")?l.push(i+" NOT LIKE "+("raw"===a?u.not_like:g.like(u.not_like))):u[N]("contains")?(c=String(u.contains),"raw"===a||(c=g.quote(c)),l.push(g.sql_function("strpos",[i,c])+" > 0")):u[N]("not_contains")?(c=String(u.not_contains),"raw"===a||(c=g.quote(c)),l.push(g.sql_function("strpos",[i,c])+" = 0")):u[N]("in")?(c=b(u["in"]),"raw"===a||(c="integer"===a||m(c[0])?g.intval(c):g.quote(c)),l.push(i+" IN ("+c.join(",")+")")):u[N]("not_in")?(c=b(u.not_in),"raw"===a||(c="integer"===a||m(c[0])?g.intval(c):g.quote(c)),l.push(i+" NOT IN ("+c.join(",")+")")):u[N]("between")?(c=b(u.between),null==c[0]?("raw"===a||("integer"===a||m(c[1])?c[1]=g.intval(c[1]):c[1]=g.quote(c[1])),l.push(i+" <= "+c[1])):null==c[1]?("raw"===a||("integer"===a||m(c[0])?c[0]=g.intval(c[0]):c[0]=g.quote(c[0])),l.push(i+" >= "+c[0])):("raw"===a||(c="integer"===a||m(c[0])&&m(c[1])?g.intval(c):g.quote(c)),l.push(i+" BETWEEN "+c[0]+" AND "+c[1]))):u[N]("not_between")?(c=b(u.not_between),null==c[0]?("raw"===a||("integer"===a||m(c[1])?c[1]=g.intval(c[1]):c[1]=g.quote(c[1])),l.push(i+" > "+c[1])):null==c[1]?("raw"===a||("integer"===a||m(c[0])?c[0]=g.intval(c[0]):c[0]=g.quote(c[0])),l.push(i+" < "+c[0])):("raw"===a||(c="integer"===a||m(c[0])&&m(c[1])?g.intval(c):g.quote(c)),l.push(i+" < "+c[0]+" OR "+i+" > "+c[1]))):u[N]("gt")||u[N]("gte")?(o=u[N]("gt")?"gt":"gte",c=u[o],"raw"===a||(c="integer"===a||m(c)?g.intval(c):"identifier"===a||"field"===a?g.refs(c,f)[0][r]:g.quote(c)),l.push(i+("gt"===o?" > ":" >= ")+c)):u[N]("lt")||u[N]("lte")?(o=u[N]("lt")?"lt":"lte",c=u[o],"raw"===a||(c="integer"===a||m(c)?g.intval(c):"identifier"===a||"field"===a?g.refs(c,f)[0][r]:g.quote(c)),l.push(i+("lt"===o?" < ":" <= ")+c)):u[N]("not_equal")||u[N]("not_eq")?(o=u[N]("not_eq")?"not_eq":"not_equal",c=u[o],"raw"===a||(c="integer"===a||m(c)?g.intval(c):"identifier"===a||"field"===a?g.refs(c,f)[0][r]:g.quote(c)),l.push(i+" <> "+c)):(u[N]("equal")||u[N]("eq"))&&(o=u[N]("eq")?"eq":"equal",c=u[o],"raw"===a||(c="integer"===a||m(c)?g.intval(c):"identifier"===a||"field"===a?g.refs(c,f)[0][r]:g.quote(c)),l.push(i+" = "+c))}else i=g.refs(s,f)[0][r],l.push(i+" = "+(m(u)?u:g.quote(u)));return l.length&&(t="("+l.join(") AND (")+")"),t},joinConditions:function(e,n){var t,l,s,i,u,r,o,a,c,f,p,d,_=this,h=0;for(t in n)n[N](t)&&(l=q.parse(t,_),s=l._col,e[N](s)&&(i=n[t],r=e[s].table,o=e[s].id,a=e[s].join,c=e[s].join_id,h++,f=a+h,u={},e[s][N]("key")&&s!==e[s].key?(p=e[s].key,u[f+"."+p]=s):p=s,e[s][N]("value")?(d=e[s].value,u[f+"."+d]=i):(d=p,u[f+"."+d]=i),_.Join(a+" AS "+f,r+"."+o+"="+f+"."+c,"inner").Where(u),delete n[t]));return _},refs:function(e,n,t){var l=this;if(!0===t){var s,i,u,r,o,a,c,f,p;for(s=0,i=e.length;i>s;s++)u=e[s],o=u.alias,a=u.qualified,c=u.full,"*"!==c&&(n[N](o)?e[s]=n[o]:n[N](c)?(r=n[c],f=r.alias,p=r.full,p!==c&&f!==o&&f===c&&(r=r.cloned(u.alias),e[s]=n[o]=r)):n[N](a)?(r=n[a],r.qualified!==a&&(r=n[r.qualified]),r=u.full!==u.alias?r.cloned(u.alias,null,u._func):r.cloned(null,r.alias,u._func),e[s]=n[r.alias]=r,r.alias===r.full||n[N](r.full)||(n[r.full]=r)):(n[o]=u,o===c||n[N](c)||(n[c]=u)))}else{var s,i,d,_,h,v,u,o,a;for(v=b(e),e=[],s=0,i=v.length;i>s;s++)for(h=v[s].split(","),d=0,_=h.length;_>d;d++)u=q.parse(h[d],l),o=u.alias,a=u.full,n[N](o)?u=n[o]:(n[o]=u,a===o||n[N](a)||(n[a]=u)),e.push(u)}return e},tbl:function(e){var n=this;if(h(e)){for(var t=0,l=e.length;l>t;t++)e[t]=n.tbl(e[t]);return e}return n.p+e},intval:function(e){var n=this;if(h(e)){for(var t=0,l=e.length;l>t;t++)e[t]=n.intval(e[t]);return e}return parseInt(e,10)},quote_name:function(e,n){var t=this,l=t.qn;if(n=!0===n,h(e)){for(var s=0,i=e.length;i>s;s++)e[s]=t.quote_name(e[s],n);return e}return n?(l[0]==e.slice(0,l[0].length)?"":l[0])+e+(l[1]==e.slice(-l[1].length)?"":l[1]):l[0]+e+l[1]},quote:function(e){var n=this,t=n.q;if(h(e)){for(var l=0,s=e.length;s>l;l++)e[l]=n.quote(e[l]);return e}return t[0]+n.esc(e)+t[1]},like:function(e){var n,t,l=this;if(h(e)){for(var s=0,i=e.length;i>s;s++)e[s]=l.like(e[s]);return e}return n=l.q,t=l.escdb?["",""]:l.e,t[0]+n[0]+"%"+l.esc_like(l.esc(e))+"%"+n[1]+t[1]},multi_like:function(e,n,t){var l,s,i,u,r,o,a,c=this;for(t=!1!==t,l=e+" LIKE ",s=n.split(","),t&&(s=R(O(s,U),Boolean)),u=0,r=s.length;r>u;u++){for(i=s[u].split("+"),t&&(i=R(O(i,U),Boolean)),o=0,a=i.length;a>o;o++)i[o]=l+c.like(i[o]);s[u]="("+i.join(" AND ")+")"}return s.join(" OR ")},esc:function(e){var n,t,l,s,i,u,r,o=this;if(h(e)){for(l=0,s=e.length;s>l;l++)e[l]=o.esc(e[l]);return e}if(o.escdb)return o.escdb(e);for(r=o.q,n="\\"+j,t="\\",e=String(e),i="",l=0,s=e.length;s>l;l++)u=e.charAt(l),i+=r[0]===u?r[2]:r[1]===u?r[3]:T(u,n,t);return i},esc_like:function(e){var n=this;if(h(e)){for(var t=0,l=e.length;l>t;t++)e[t]=n.esc_like(e[t]);return e}return T(e,"_%","\\")},sql_function:function(e,n){var t,l,s,i,u,r,o=this;if(null==A.dialects[o.type].functions[e])throw new TypeError('Dialect: SQL function "'+e+'" does not exist for dialect "'+o.type+'"');for(e=A.dialects[o.type].functions[e],n=null!=n?b(n):[],r=n.length,t="",l=!1,s=0,i=e.length;i>s;s++)u=e[s],t+=l?u>0&&r>=u?n[u-1]:"":u,l=!l;return t}},A});