/**
*   Dialect, 
*   a simple and flexible Cross-Platform & Cross-Vendor SQL Query Builder for PHP, Python, Node/XPCOM/JS
* 
*   @version: 1.1.0
*   https://github.com/foo123/Dialect
*
*   Abstract the construction of SQL queries
*   Support multiple DB vendors
*   Intuitive and Flexible API
**/
!function(e,l,n){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import?(e.$deps=e.$deps||{})&&(e.EXPORTED_SYMBOLS=[l])&&(e[l]=e.$deps[l]=n.call(e)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[l]=n.call(e)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System.import?System.register(l,[],function(t){t(l,n.call(e))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(l)?define(l,["module"],function(l){return n.moduleUri=l.uri,n.call(e)}):l in e||(e[l]=n.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[l]})}("undefined"!=typeof self?self:this,"Dialect",function(e){"use strict";function l(){return l.GUID+=1,s((new Date).getTime().toString(16),12)+"--"+s(l.GUID.toString(16),4)}function n(e,l,t){var s=this;if(!(s instanceof n))return new n(e,l,t);s.id=null,s.tpl=null,s._renderer=null,s._args=[e||"",l||n.defaultArgs,t],s._parsed=!1}function t(e,l){return e&&D.call(e,l)?1:0}function s(e,l,n,t){var s=String(e);if(n=n||"0",t)for(;s.length<l;)s+=n;else for(;s.length<l;)s=n+s;return s}function r(e,l,n){for(var t,s="";l<n&&(" "===(t=e[B](l))||"\r"===t||"\t"===t||"\v"===t||"\0"===t);)s+=t,l+=1;return s}function i(e,l){var n,t,s,r=e.length;if(r&&l.length)for(n="",s=0;s<r;s++)n+=t=e[B](s),"\n"===t&&(n+=l);else n=e;return n}function u(e,l,n,t){var s,r,i,u,a=0;if(l)for(s=e,r=l.length,i=0,a=1;i<r;){if(u=l[i++],null==s||null==s[u]){a=0;break}s=s[u]}if(!a&&n)for(s=e,r=n.length,i=0,a=1;i<r;){if(u=n[i++],null==s||null==s[u]){a=0;break}s=s[u]}if(!a&&null!=t&&t!==e){if(l)for(s=t,r=l.length,i=0,a=1;i<r;){if(u=l[i++],null==s||null==s[u]){a=0;break}s=s[u]}if(!a&&n)for(s=t,r=n.length,i=0,a=1;i<r;){if(u=n[i++],null==s||null==s[u]){a=0;break}s=s[u]}}return a?s:null}function a(e,l){this.prev=e||null,this.value=l||null}function o(e,l){l&&(l.next=this),this.node=e||null,this.prev=l||null,this.next=null}function c(e,l,n,t,s,r,i){var a,o,c,f,p,_,h,E,T=null,g="";if(-1===l.type){if((a=l.opt_args)&&a.value[5])for(;a;){if(o=a.value,c=u(e,o[1],[String(o[0])],o[6]?null:i),null===T&&l.name===o[0]&&(T=c),0===o[2]&&null==c||1===o[2]&&null!=c)return"";a=a.prev}}else T=u(e,l.key,[String(l.name)],l.loc?null:i);if(f=v(T),E=f?T.length:-1,f&&E>l.start)for(p=l.start,_=-1===l.end?E-1:Math.min(l.end,E-1),h=p;h<=_;h++)g+=d(e,l.tpl,n,t,h,r,i);else f||l.start!==l.end||(g=d(e,l.tpl,n,t,null,r,i));return g}function f(e,l,n,s,r,a,o){var f,d,_,h,E="";return l.stpl&&(t(n,l.stpl)||t(p.subGlobal,l.stpl)||t(s,l.stpl)||t(s,"*")||t(p.fnGlobal,l.stpl)||t(p.fnGlobal,"*"))?(f=u(e,l.key,[String(l.name)],l.loc?null:o),t(n,l.stpl)||t(p.subGlobal,l.stpl)?(null==r||0===r&&l.start===l.end&&l.opt||!v(f)||(f=r<f.length?f[r]:null),null==f&&null!==l.dval?E=l.dval:(_=t(n,l.stpl)?n[l.stpl].node:p.subGlobal[l.stpl].node,d={},null!=f&&(v(f)?d[_.name]=f:d=f),E=c(d,_,n,s,null,l.algn?a:"",null==o?e:o))):(h=null,t(s,l.stpl)?h=s[l.stpl]:t(s,"*")?h=s["*"]:t(p.fnGlobal,l.stpl)?h=p.fnGlobal[l.stpl]:p.fnGlobal["*"]&&(h=p.fnGlobal["*"]),v(f)&&(f=(r=null!=r?r:l.start)<f.length?f[r]:null),E=null==(f="function"==typeof h?h(f,{symbol:l,index:r,currentArguments:e,originalArguments:o,alignment:a}):String(h))&&null!==l.dval?l.dval:String(f),l.algn&&(E=i(E,a)))):l.opt&&null!==l.dval?E=l.dval:(v(f=u(e,l.key,[String(l.name)],l.loc?null:o))&&(f=(r=null!=r?r:l.start)<f.length?f[r]:null),E=null==f&&null!==l.dval?l.dval:String(f),l.algn&&(E=i(E,a))),E}function d(e,l,n,t,s,r,i){for(var u,a=r=r||"",o="";l;)-1===(u=l.node.type)?o+=c(e,l.node,n,t,s,l.node.algn?a:r,i):1===u?o+=f(e,l.node,n,t,s,l.node.algn?a:r,i):0===u?(a+=l.node.algn,o+=l.node.val):100===u&&(a=r,o+="\n"+r),l=l.next;return o}function p(e,l,n){var t=this;if(!(t instanceof p))return new p(e,l,n);t.id=null,t.tpl=null,t.fn={},t._args=[e||"",l||p.defaultDelimiters,n||!1]}function _(e,l){return new RegExp(e,l||"")}function h(e){return e.replace(U,"\\$&")}function E(e){return"function"==typeof e}function T(e){return e instanceof String||"[object String]"===C.call(e)}function v(e){return e instanceof Array||"[object Array]"===C.call(e)}function g(e){return e instanceof Object||"[object Object]"===C.call(e)}function I(e){if(!e)return!0;var l=C.call(e);return(e instanceof Array||e instanceof String||"[object Array]"===l||"[object String]"===l)&&!e.length||(e instanceof Object||"[object Object]"===l)&&!M(e).length}function m(e){return parseInt(e||0,10)||0}function b(e){return e===+e&&isFinite(e)&&!(e%1)}function N(e){return v(e)?e:[e]}function A(e,l,n){var t,s,r,i="";for(3>arguments.length&&(n="\\"),2>arguments.length&&(l="\\\"'"+j),t=0,s=e.length;t<s;t++)r=e[B](t),i+=-1===l.indexOf(r)?r:0===r[k](0)?"\\0":n+r;return i}function O(e,l,n,t){n=!0===n,t=!0===t;for(var s in l)D.call(l,s)&&(!n&&D.call(e,s)||(e[s]=t&&l[s].slice?l[s].slice():l[s]));return e}function R(e,l){var n=e.length;if(!n)return[];var t,s,r=15&n,i=1&r,u=new Array(n);for(i&&(u[0]=l(e[0])),t=i;t<r;t+=2)s=t,u[t]=l(e[s]),u[t+1]=l(e[s+1]);for(t=r;t<n;t+=16)s=t,u[t]=l(e[s]),u[t+1]=l(e[s+1]),u[t+2]=l(e[s+2]),u[t+3]=l(e[s+3]),u[t+4]=l(e[s+4]),u[t+5]=l(e[s+5]),u[t+6]=l(e[s+6]),u[t+7]=l(e[s+7]),u[t+8]=l(e[s+8]),u[t+9]=l(e[s+9]),u[t+10]=l(e[s+10]),u[t+11]=l(e[s+11]),u[t+12]=l(e[s+12]),u[t+13]=l(e[s+13]),u[t+14]=l(e[s+14]),u[t+15]=l(e[s+15]);return u}function w(e,l){var n=e.length;if(!n)return[];var t,s,r=15&n,i=1&r,u=[];for(i&&l(e[0])&&u.push(e[0]),t=i;t<r;t+=2)l(e[s=t])&&u.push(e[s]),l(e[++s])&&u.push(e[s]);for(t=r;t<n;t+=16)l(e[s=t])&&u.push(e[s]),l(e[++s])&&u.push(e[s]),l(e[++s])&&u.push(e[s]),l(e[++s])&&u.push(e[s]),l(e[++s])&&u.push(e[s]),l(e[++s])&&u.push(e[s]),l(e[++s])&&u.push(e[s]),l(e[++s])&&u.push(e[s]),l(e[++s])&&u.push(e[s]),l(e[++s])&&u.push(e[s]),l(e[++s])&&u.push(e[s]),l(e[++s])&&u.push(e[s]),l(e[++s])&&u.push(e[s]),l(e[++s])&&u.push(e[s]),l(e[++s])&&u.push(e[s]),l(e[++s])&&u.push(e[s]);return u}function y(e,l,n){var t,s,r="";if(e&&e.length)for(n=null==n?",":n,r=e[0][l],t=1,s=e.length;t<s;t++)r+=n+e[t][l];return r}function S(e,l,n,t,s,r,i,u,a,o,c){var f=this;if(f._col=e,f.col=l,f._tbl=n,f.tbl=t,f._dtb=s,f.dtb=r,f._alias=i,f._qualified=a,f.qualified=o,f.full=f.qualified,f._func=null==c?[]:c,f._func.length)for(var d=0,p=f._func.length;d<p;d++)f.full=f._func[d]+"("+f.full+")";null!=f._alias?(f.alias=u,f.aliased=f.full+" AS "+f.alias):(f.alias=f.full,f.aliased=f.full)}function L(e){var l=this;if(arguments.length||(e="mysql"),!(l instanceof L))return new L(e);if(e&&D.call(L.aliases,e)&&(e=L.aliases[e]),!e||!L.dialects[e]||!L.dialects[e].clauses)throw new TypeError('Dialect: SQL dialect does not exist for "'+e+'"');l.clau=null,l.clus=null,l.tbls=null,l.cols=null,l.vews={},l.tpls={},l.db=null,l.escdb=null,l.escdbn=null,l.p="",l.type=e,l.clauses=L.dialects[l.type].clauses,l.q=L.dialects[l.type].quotes[0],l.qn=L.dialects[l.type].quotes[1],l.e=L.dialects[l.type].quotes[2]||["","","",""]}var q="prototype",M=Object.keys,C=Object[q].toString,D=Object[q].hasOwnProperty,B="charAt",k="charCodeAt",U=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,G=/^\s+|\s+$/g,F=String[q].trim?function(e){return e.trim()}:function(e){return e.replace(G,"")},j=String.fromCharCode(0);l.GUID=0,n.VERSION="1.0.0",n.defaultArgs=/\$(-?[0-9]+)/g,n.guid=l,n.multisplit=function(e,l,n){var t,s,r,i,u,a,o,c,f,d;n=!!n,a=[[1,e]];for(t in l)if(D.call(l,t)){for(c=[],s=n?l[t]:t,r=[0,l[t]],i=0,f=a.length;i<f;i++)if(1===a[i][0]){if(o=a[i][1].split(s),d=o.length,c.push([1,o[0]]),d>1)for(u=0;u<d-1;u++)c.push(r),c.push([1,o[u+1]])}else c.push(a[i]);a=c}return a},n.multisplit_re=function(e,l){l=l.global?l:new RegExp(l.source,l.ignoreCase?"gi":"g");for(var n,t=[],s=0;n=l.exec(e);)t.push([1,e.slice(s,l.lastIndex-n[0].length)]),t.push([0,n[1]?n[1]:n[0]]),s=l.lastIndex;return t.push([1,e.slice(s)]),t},n.arg=function(e,l){var n,t,s,r,i,u="args";if(arguments.length&&null!=e)for(r=(e=e.substr?e.length?e.split("."):[]:[e]).length,i=!(!l||!l.substr),n=0;n<r;n++)s=+(t=e[n]),isNaN(s)?u+='["'+t+'"]':(s<0&&(t=i?l+-s:u+".length-"+-s),u+="["+t+"]");return u},n.compile=function(e,l){var t,s,r,i,u=e.length;if(!0===l){for(i='"use strict"; return (',t=0;t<u;t++)s=e[t][0],r=e[t][1],i+=s?r:n.arg(r);i+=");"}else{for(i='"use strict"; var argslen=args.length; return (',t=0;t<u;t++)s=e[t][0],r=e[t][1],i+=s?"'"+r.replace(SQUOTE,"\\'").replace(NEWLINE,"' + \"\\n\" + '")+"'":" + String("+n.arg(r,"argslen")+") + ";i+=");"}return new Function("args",i)},n[q]={constructor:n,id:null,tpl:null,_parsed:!1,_args:null,_renderer:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e._parsed=null,e._args=null,e._renderer=null,e},fixRenderer:function(){var e=this;return e.render="function"==typeof e._renderer?e._renderer:e.constructor[q].render,e},parse:function(){var e=this;if(!1===e._parsed){e._parsed=!0;var l=e._args[0],t=e._args[1],s=e._args[2];e._args=null,e.tpl=t instanceof RegExp?n.multisplit_re(l,t):n.multisplit(l,t),!0===s&&(e._renderer=n.compile(e.tpl),e.fixRenderer())}return e},render:function(e){var l=this;if(e=e||[],!1===l._parsed&&(l.parse(),l._renderer))return l._renderer(e);var n,t,s,r=l.tpl,i=r.length,u=e.length,a="";for(n=0;n<i;n++)1===(t=r[n])[0]?a+=t[1]:(+(s=t[1])===s&&s<0&&(s=u+s),a+=e[s]);return a}},p.VERSION="3.0.0",p.defaultDelimiters=["<",">","[","]"],p.fnGlobal={},p.subGlobal={},p.guid=l,p.multisplit=function(e,n,s){var i,u,c,f,d,p,_,h,E,T,v,g,I,m,b,N,A,O,R,w,y,S,L,q,M,C,D=n[0],k=n[1],U=n[2],G=n[3],j=D.length,H=k.length,Y=U.length,x=G.length,W="#"+G,P=null,V=0,X=0,K=0,J=0,Q=e.length,$=[D,j,k,H],Z=[U,Y,G,x],z=[null,0,null,0,null,0,null,0];for(s=!0===s,R={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},y=E=new o({type:0,val:"",algn:""}),S=null,w=null,b={},A=null,N={},O=null,$[1]<$[3]&&(v=$[0],$[2]=$[0],$[0]=v,g=$[1],$[3]=$[1],$[1]=g),Z[1]<Z[3]&&(v=Z[0],Z[2]=Z[0],Z[0]=v,g=Z[1],Z[3]=Z[1],Z[1]=g),u=0,c=0,g=0;4>u&&4>c;)$[u+1]<Z[c+1]?(z[g]=Z[c],z[g+1]=Z[c+1],c+=2):(z[g]=$[u],z[g+1]=$[u+1],u+=2),g+=2;for(;4>u;)z[g]=$[u],z[g+1]=$[u+1],u+=2,g+=2;for(;4>c;)z[g]=Z[c],z[g+1]=Z[c+1],c+=2,g+=2;for(_=null,v="",g=0;g<Q;)if("\\"!==(h=e[B](g)))if(C=null,z[0]===e.substr(g,z[1])?C=z[0]:z[2]===e.substr(g,z[3])?C=z[2]:z[4]===e.substr(g,z[5])?C=z[4]:z[6]===e.substr(g,z[7])&&(C=z[6]),D===C)g+=j,v.length&&(0===E.node.type?E.node.val+=v:E=new o({type:0,val:v,algn:""},E)),v="";else if(k===C){if(g+=H,d=v,v="",-1<(p=d.indexOf("|"))?(P=d.slice(p+1),d=d.slice(0,p)):P=null,"?"===(h=s?g<Q?e[B](g):"":d[B](0))||"*"===h)X=1,"*"===h?(u=1,c=-1):(u=0,c=0),s?(g+=1)<Q&&"!"===e[B](g)?(V=1,g+=1):V=0:"!"===d[B](1)?(V=1,d=d.slice(2)):(V=0,d=d.slice(1));else if("{"===h){if(s){for(v="",I=g+1,m=Q;I<m&&"}"!==e[B](I);)v+=e[B](I++);g=I+1}else{for(v="",I=1,m=d.length;I<m&&"}"!==d[B](I);)v+=d[B](I++);d=d.slice(I+1)}(v=v.split(",")).length>1?(u=(u=F(v[0])).length?0|+u:0,c=(c=F(v[1])).length?0|+c:-1,X=1):(c=u=(u=F(v[0])).length?0|+u:0,X=0),v="",V=0}else X=0,V=0,u=0,c=0;if(V&&null===P&&(P=""),"@"===(h=d[B](0))?(K=1,d=d.slice(1)):K=0,"."===(h=d[B](0))?(J=1,d=d.slice(1)):J=0,f=-1<d.indexOf(":")?d.split(":"):[d,null],d=f[0],f=f[1],i=-1<d.indexOf(".")?d.split("."):null,A&&!t(N,A)&&(N[A]={}),":="+U===e.substr(g,2+Y)&&(g+=2,O=f=f&&f.length?f:"grtpl--"+l(),A&&d.length&&(N[A][d]=f)),!d.length)continue;null==f&&A&&t(N,A)&&t(N[A],d)&&(f=N[A][d]),X&&!R.opt?(R.name=d,R.key=i,R.stpl=f,R.dval=P,R.opt=X,R.neg=V,R.algn=K,R.loc=J,R.start=u,R.end=c,w=new a(null,[d,i,V,u,c,X,J])):X?(u!==c&&R.start===R.end&&(R.name=d,R.key=i,R.stpl=f,R.dval=P,R.opt=X,R.neg=V,R.algn=K,R.loc=J,R.start=u,R.end=c),w=new a(w,[d,i,V,u,c,X,J])):X||null!==R.name||(R.name=d,R.key=i,R.stpl=f,R.dval=P,R.opt=0,R.neg=V,R.algn=K,R.loc=J,R.start=u,R.end=c,w=new a(null,[d,i,V,u,c,0,J])),0===E.node.type&&(E.node.algn=r(E.node.val,0,E.node.val.length)),E=new o({type:1,name:d,key:i,stpl:f,dval:P,opt:X,algn:K,loc:J,start:u,end:c},E)}else if(U===C){if(g+=Y,v.length&&(0===E.node.type?E.node.val+=v:E=new o({type:0,val:v,algn:""},E)),v="","#"===e[B](g)){for(I=g+1,m=Q;I<m&&W!==e.substr(I,x+1);)v+=e[B](I++);g=I+x+1,0===E.node.type&&(E.node.algn=r(E.node.val,0,E.node.val.length)),E=new o({type:-100,val:v},E),v="";continue}_=new a(_,[E,S,R,w,A,O]),O&&(A=O),O=null,R={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},w=null,S=E=new o({type:0,val:"",algn:""})}else G===C?(g+=x,T=E,L=S,q=R,M=w,_?(E=_.value[0],S=_.value[1],R=_.value[2],w=_.value[3],A=_.value[4],O=_.value[5],_=_.prev):E=null,v.length&&(0===T.node.type?T.node.val+=v:T=new o({type:0,val:v,algn:""},T)),v="",O?(b[O]=new o({type:2,name:q.name,key:q.key,loc:q.loc,algn:q.algn,start:q.start,end:q.end,opt_args:null,tpl:L}),O=null):(0===E.node.type&&(E.node.algn=r(E.node.val,0,E.node.val.length)),E=new o({type:-1,name:q.name,key:q.key,loc:q.loc,algn:q.algn,start:q.start,end:q.end,opt_args:M,tpl:L},E))):"\n"===(h=e[B](g++))?(v.length&&(0===E.node.type?E.node.val+=v:E=new o({type:0,val:v,algn:""},E)),v="",0===E.node.type&&(E.node.algn=r(E.node.val,0,E.node.val.length)),E=new o({type:100,val:"\n"},E)):v+=h;else v+=g+1<Q?e[B](g+1):"",g+=2;return v.length&&(0===E.node.type?E.node.val+=v:E=new o({type:0,val:v,algn:""},E)),0===E.node.type&&(E.node.algn=r(E.node.val,0,E.node.val.length)),[y,b]},p.align=i,p.main=d,p[q]={constructor:p,id:null,tpl:null,fn:null,_args:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e.fn=null,e._args=null,e},parse:function(){var e=this;return null===e.tpl&&null!==e._args&&(e.tpl=p.multisplit(e._args[0],e._args[1],e._args[2]),e._args=null),e},render:function(e){var l=this;return null===l.tpl&&l.parse(),p.main(null==e?{}:e,l.tpl[0],l.tpl[1],l.fn)}};var H=/\s/,Y=/[0-9]/,x=/[a-z_]/i;S.parse=function(e,l){var n,t,s,r,i,u,a,o,c,f,d,p,_,h,E,T,v,g,I,m,b,N,A,O,R=["AS"];for(t=(e=F(e)).length,n=0,r=(s=[[]])[0],i=[],u=[],a="",o=null,d=0,p=null;n<t;){if('"'===(_=e.charAt(n++))||"`"===_||"'"===_||"["===_||"]"===_){if(!p){if(a.length||"]"===_){o=["invalid",n];break}p="["===_?"]":_;continue}if(p===_){if(n<t&&_===e.charAt(n)){a+=_,n++;continue}if(!a.length){o=["invalid",n];break}r.unshift([1,a]),i.unshift(a),a="",p=null;continue}if(p){a+=_;continue}}if(p)a+=_;else if("*"===_){if(a.length){o=["invalid",n];break}r.unshift([10,"*"]),i.unshift(10)}else if("."===_){if(a.length&&(r.unshift([1,a]),i.unshift(a),a=""),!r.length||1!==r[0][0]){o=["invalid",n];break}r.unshift([0,"."]),i.unshift(0)}else if("("===_){if(d++,a.length&&(r.unshift([2,a]),u.unshift(a),a=""),!r.length||2!==r[0][0]&&1!==r[0][0]){o=["invalid",n];break}1===r[0][0]&&(r[0][0]=2,u.unshift(i.shift())),s.unshift([]),r=s[0]}else if(")"===_){if(d--,a.length&&(h=-1<R.indexOf(a.toUpperCase()),r.unshift([h?5:1,a]),i.unshift(h?5:a),a=""),s.length<2){o=["invalid",n];break}s[1].unshift([100,s.shift()]),r=s[0]}else{if(H.test(_)){a.length&&(h=-1<R.indexOf(a.toUpperCase()),r.unshift([h?5:1,a]),i.unshift(h?5:a),a="");continue}if(Y.test(_)){if(!a.length){o=["invalid",n];break}a+=_}else{if(!x.test(_)){o=["invalid",n];break}a+=_}}}if(a.length&&(r.unshift([1,a]),i.unshift(a),a=""),!o&&d&&(o=["paren",t]),!o&&p&&(o=["quote",t]),o||1===s.length||(o=["invalid",t]),o)throw c=o[1]-1,"paren"==(f=o[0])?new TypeError('Dialect: Mismatched parentheses "'+e+'" at position '+c+"."):"quote"==f?new TypeError('Dialect: Mismatched quotes "'+e+'" at position '+c+"."):new TypeError('Dialect: Invalid character "'+e+'" at position '+c+".");return b=null,N="",i.length>=3&&5===i[1]&&"string"==typeof i[0]&&(b=i.shift(),N=l.quote_name(b),i.shift()),E=null,T="",!i.length||"string"!=typeof i[0]&&10!==i[0]||(10===i[0]?(i.shift(),E=T="*"):(E=i.shift(),T=l.quote_name(E))),v=null,g="",i.length>=2&&0===i[0]&&"string"==typeof i[1]&&(i.shift(),v=i.shift(),g=l.quote_name(v)),I=null,m="",i.length>=2&&0===i[0]&&"string"==typeof i[1]&&(i.shift(),I=i.shift(),m=l.quote_name(I)),A=(I?I+".":"")+(v?v+".":"")+(E||""),O=(I?m+".":"")+(v?g+".":"")+(E?T:""),new S(E,T,v,g,I,m,b,N,A,O,u)},S[q]={constructor:S,_func:null,_col:null,col:null,_tbl:null,tbl:null,_dtb:null,dtb:null,_alias:null,alias:null,_qualified:null,qualified:null,full:null,aliased:null,cloned:function(e,l,n){var t=this;return arguments.length?l=l||e:(e=t._alias,l=t.alias),null==n&&(n=t._func),new S(t._col,t.col,t._tbl,t.tbl,t._dtb,t.dtb,e,l,t._qualified,t.qualified,n)},dispose:function(){var e=this;return e._func=null,e._col=null,e.col=null,e._tbl=null,e.tbl=null,e._dtb=null,e.dtb=null,e._alias=null,e.alias=null,e._qualified=null,e.qualified=null,e.full=null,e.aliased=null,e}};var W={mysql:{quotes:[["'","'","\\'","\\'"],["`","`","``","``"],["","","",""]],functions:{strpos:["POSITION(",2," IN ",1,")"],strlen:["LENGTH(",1,")"],strlower:["LCASE(",1,")"],strupper:["UCASE(",1,")"],trim:["TRIM(",1,")"],quote:["QUOTE(",1,")"],random:["RAND()"],now:["NOW()"]},types:{BINARY:"VARBINARY",SMALLINT:"TINYINT",MEDIUMINT:"MEDIUMINT",INT:"UNSIGNED INT",SIGNED_INT:"INT",BIGINT:"UNSIGNED BIGINT",SIGNED_BIGINT:"BIGINT",FLOAT:"FLOAT",DOUBLE:"DOUBLE",BOOL:"TINYINT",TIMESTAMP:"TIMESTAMP",DATETIME:"DATETIME",DATE:"DATE",TIME:"TIME",VARCHAR:"VARCHAR",TEXT:"TEXT",BLOB:"BLOB"},clauses:"[<?start_transaction_clause|>START TRANSACTION <type|>;][<?commit_transaction_clause|>COMMIT;][<?rollback_transaction_clause|>ROLLBACK;][<?transact_clause|>START TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE VIEW <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]UNIQUE KEY <name|> <type|> (<?uniquekey>[,<*uniquekey>])][[CONSTRAINT <?constraint> ]PRIMARY KEY <type|> (<?primarykey>)][[<?!index>KEY][<?index|>INDEX] <name|> <type|> (<?key>[,<*key>])][CHECK (<?check>)][<?column> <type>[ <?!isnull><?isnotnull|>NOT NULL][ <?!isnotnull><?isnull|>NULL][ DEFAULT <?default_value>][ <?auto_increment|>AUTO_INCREMENT][ <?!primary><?unique|>UNIQUE KEY][ <?!unique><?primary|>PRIMARY KEY][ COMMENT '<?comment>'][ COLUMN_FORMAT <?format>][ STORAGE <?storage>]]][,\n<*col:COL>]]\n)][ <?options>:=[<opt:OPT>:=[[ENGINE=<?engine>][AUTO_INCREMENT=<?auto_increment>][CHARACTER SET=<?charset>][COLLATE=<?collation>]][, <*opt:OPT>]]][\nAS <?query>]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>[<?temporary|>TEMPORARY ]TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\n[VALUES <?values_values>[,<*values_values>]]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]][<?delete_clause|>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]]"},postgresql:{quotes:[["'","'","''","''"],['"','"','""','""'],["E","","E",""]],functions:{strpos:["position(",2," in ",1,")"],strlen:["length(",1,")"],strlower:["lower(",1,")"],strupper:["upper(",1,")"],trim:["trim(",1,")"],quote:["quote(",1,")"],random:["random()"],now:["now()"]},types:{BINARY:"BYTEA",SMALLINT:"SMALLINT",MEDIUMINT:"INTEGER",INT:"SERIAL",SIGNED_INT:"INTEGER",BIGINT:"BIGSERIAL",SIGNED_BIGINT:"BIGINT",FLOAT:"REAL",DOUBLE:"DOUBLE PRECISION",BOOL:"BOOLEAN",TIMESTAMP:"TIMESTAMP WITHOUT TIME ZONE",DATETIME:"TIMESTAMP WITHOUT TIME ZONE",DATE:"DATE",TIME:"TIME WITHOUT TIME ZONE",VARCHAR:"VARCHAR",TEXT:"TEXT",BLOB:"BLOB"},clauses:"[<?start_transaction_clause|>START TRANSACTION <type|>;][<?commit_transaction_clause|>COMMIT;][<?rollback_transaction_clause|>ROLLBACK;][<?transact_clause|>START TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>:=[<col:COL>:=[[<?column> <type>[ COLLATE <?collation>][ CONSTRAINT <?constraint>][ <?!isnull><?isnotnull|>NOT NULL][ <?!isnotnull><?isnull|>NULL][ DEFAULT <?default_value>][ CHECK (<?check>)][ <?unique|>UNIQUE][ <?primary|>PRIMARY KEY]]][,\n<*col:COL>]]\n)]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\n[VALUES <?values_values>[,<*values_values>]]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]][<?delete_clause|>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]]"},transactsql:{quotes:[["'","'","''","''"],["[","]","[","]"],[""," ESCAPE '\\'","",""]],functions:{strpos:["CHARINDEX(",2,",",1,")"],strlen:["LEN(",1,")"],strlower:["LOWER(",1,")"],strupper:["UPPER(",1,")"],trim:["LTRIM(RTRIM(",1,"))"],quote:["QUOTENAME(",1,',"\'")'],random:["RAND()"],now:["CURRENT_TIMESTAMP"]},types:{BINARY:"VARBINARY",SMALLINT:"TINYINT",MEDIUMINT:"SMALLINT",INT:"INT",SIGNED_INT:"INT",BIGINT:"BIGINT",SIGNED_BIGINT:"BIGINT",FLOAT:"FLOAT",DOUBLE:"REAL",BOOL:"BIT",TIMESTAMP:"DATETIME",DATETIME:"DATETIME",DATE:"DATE",TIME:"TIME",VARCHAR:"VARCHAR",TEXT:"TEXT",BLOB:"TEXT"},clauses:"[<?start_transaction_clause|>BEGIN TRANSACTION <type|>;][<?commit_transaction_clause|>COMMIT;][<?rollback_transaction_clause|>ROLLBACK;][<?transact_clause|>BEGIN TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>[<?ifnotexists|>IF NOT EXISTS (SELECT * FROM sysobjects WHERE name=<create_table> AND xtype='U')\n]CREATE TABLE <create_table> [<?!query>(\n<columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]<?column> <type|>[ <?isnotnull|>NOT NULL][ [CONSTRAINT <?constraint> ]DEFAULT <?default_value>][ CHECK (<?check>)][ <?!primary><?unique|>UNIQUE][ <?!unique><?primary|>PRIMARY KEY[ COLLATE <?collation>]]]][,\n<*col:COL>]]\n)][<?ifnotexists|>\nGO]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>][\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]][<?!order_conditions>[\nORDER BY 1\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\n[VALUES <?values_values>[,<*values_values>]]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]][<?delete_clause|>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]]"},sqlite:{quotes:[["'","'","''","''"],['"','"','""','""'],[""," ESCAPE '\\'","",""]],functions:{strpos:["instr(",2,",",1,")"],strlen:["length(",1,")"],strlower:["lower(",1,")"],strupper:["upper(",1,")"],trim:["trim(",1,")"],quote:["quote(",1,")"],random:["random()"],now:["datetime('now')"]},types:{BINARY:"BLOB",SMALLINT:"INTEGER",MEDIUMINT:"INTEGER",INT:"INTEGER",SIGNED_INT:"INTEGER",BIGINT:"INTEGER",SIGNED_BIGINT:"INTEGER",FLOAT:"REAL",DOUBLE:"REAL",BOOL:"INTEGER",TIMESTAMP:"TEXT",DATETIME:"TEXT",DATE:"TEXT",TIME:"TEXT",VARCHAR:"TEXT",TEXT:"TEXT",BLOB:"BLOB"},clauses:"[<?start_transaction_clause|>BEGIN <type|> TRANSACTION;][<?commit_transaction_clause|>COMMIT;][<?rollback_transaction_clause|>ROLLBACK;][<?transact_clause|>BEGIN <type|> TRANSACTION;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [<?!query>(\n<columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]<?column> <type|>[ <?isnotnull|>NOT NULL][ DEFAULT <?default_value>][ CHECK (<?check>)][ <?!primary><?unique|>UNIQUE][ <?!unique><?primary|>PRIMARY KEY[ <?auto_increment|>AUTOINCREMENT][ COLLATE <?collation>]]]][,\n<*col:COL>]]\n)[ <?without_rowid|>WITHOUT ROWID]][AS <?query>]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\n[VALUES <?values_values>[,<*values_values>]]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>]][<?delete_clause|>[<?!order_conditions><?!count>DELETE FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]][DELETE FROM <from_tables> [, <*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]\nORDER BY <?order_conditions> [, <*order_conditions>][\nLIMIT <?count> OFFSET <offset|0>]\n)][<?!order_conditions>DELETE FROM <from_tables> [, <*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]\nLIMIT <?count> OFFSET <offset|0>\n)]]"}},P={mysqli:"mysql",mariadb:"mysql",sqlserver:"transactsql",postgres:"postgresql",postgre:"postgresql"};return L.VERSION="1.1.0",L.dialects=W,L.aliases=P,L.StringTemplate=n,L.GrammarTemplate=p,L.Ref=S,L[q]={constructor:L,clau:null,clus:null,tbls:null,cols:null,vews:null,tpls:null,db:null,escdb:null,escdbn:null,p:null,type:null,clauses:null,q:null,qn:null,e:null,dispose:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e.vews=null,e.tpls=null,e.db=null,e.escdb=null,e.escdbn=null,e.p=null,e.type=null,e.clauses=null,e.q=null,e.qn=null,e.e=null,e},toString:function(){return this.sql()||""},driver:function(e){var l=this;return arguments.length?(l.db=e||null,l):l.db},escape:function(e,l){var n=this;return 2>arguments.length&&(l=!1),arguments.length?(n.escdb=e&&E(e)?[e,!!l]:null,n):n.escdb},escapeId:function(e,l){var n=this;return 2>arguments.length&&(l=!1),arguments.length?(n.escdbn=e&&E(e)?[e,!!l]:null,n):n.escdbn},prefix:function(e){var l=this;return arguments.length?(l.p=e&&e.length?e:"",l):l.p},reset:function(e){var l=this;return l.clus={},l.tbls={},l.cols={},l.clau=e,l.clauses instanceof L.GrammarTemplate||(l.clauses=new L.GrammarTemplate(l.clauses)),l},clear:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e},subquery:function(){var e,l,n,t=this;return(e=new L(t.type)).driver(t.driver()).prefix(t.prefix()),l=t.escape(),n=t.escapeId(),l&&e.escape(l[0],l[1]),n&&e.escapeId(n[0],n[1]),e.vews=t.vews,e},sql:function(){var e=this,l=null;return e.clau&&(D.call(e.clus,"select_columns")&&(e.clus.select_columns=y(e.clus.select_columns,"aliased")),D.call(e.clus,"from_tables")&&(e.clus.from_tables=y(e.clus.from_tables,"aliased")),D.call(e.clus,"insert_tables")&&(e.clus.insert_tables=y(e.clus.insert_tables,"aliased")),D.call(e.clus,"insert_columns")&&(e.clus.insert_columns=y(e.clus.insert_columns,"full")),D.call(e.clus,"update_tables")&&(e.clus.update_tables=y(e.clus.update_tables,"aliased")),D.call(e.clus,"create_table")&&(e.clus.create_table=y(e.clus.create_table,"full")),D.call(e.clus,"alter_table")&&(e.clus.alter_table=y(e.clus.alter_table,"full")),D.call(e.clus,"drop_tables")&&(e.clus.drop_tables=y(e.clus.drop_tables,"full")),D.call(e.clus,"where_conditions_required")&&(e.clus.where_conditions=D.call(e.clus,"where_conditions")?"("+e.clus.where_conditions_required+") AND ("+e.clus.where_conditions+")":e.clus.where_conditions_required,delete e.clus.where_conditions_required),D.call(e.clus,"having_conditions_required")&&(e.clus.having_conditions=D.call(e.clus,"having_conditions")?"("+e.clus.having_conditions_required+") AND ("+e.clus.having_conditions+")":e.clus.having_conditions_required,delete e.clus.having_conditions_required),e.clus[e.clau+"_clause"]=1,l=e.clauses.render(e.clus)||""),e.clear(),l},createView:function(e){var l=this;return e&&l.clau&&(l.vews[e]={clau:l.clau,clus:l.clus,tbls:l.tbls,cols:l.cols},D.call(l.vews[e].clus,"where_conditions")&&(l.vews[e].clus.where_conditions&&(l.vews[e].clus.where_conditions_required=l.vews[e].clus.where_conditions),delete l.vews[e].clus.where_conditions),D.call(l.vews[e].clus,"having_conditions")&&(l.vews[e].clus.having_conditions&&(l.vews[e].clus.having_conditions_required=l.vews[e].clus.having_conditions),delete l.vews[e].clus.having_conditions),l.clear()),l},useView:function(e){var l,n,t=this;if(l=t.clus.select_columns,e=t.vews[e],t.clus=O(t.clus,e.clus,!0,!0),t.tbls=O({},e.tbls,!0),t.cols=O({},e.cols,!0),l){n=[];for(var s=0,r=(l=t.refs(l,t.cols,!0)).length;s<r;s++)"*"===l[s].full?n=n.concat(t.clus.select_columns):n.push(l[s]);t.clus.select_columns=n}return t},dropView:function(e){var l=this;return e&&D.call(l.vews,e)&&delete l.vews[e],l},prepareTpl:function(e){var l,n,t,s,r,i,u,a,o=this;return I(e)||(1===(s=(t=arguments).length)?(r=null,i=null,u=null,a=!0):2===s?(r=t[1],i=null,u=null,a=!1):3===s?(r=null,i=t[1],u=t[2],a=!0):(r=t[1],i=t[2],u=t[3],a=!1),l=_((i=i?h(i):"%")+"(([rlfds]:)?[0-9a-zA-Z_]+)"+(u=u?h(u):"%")),n=a?new L.StringTemplate(o.sql(),l):new L.StringTemplate(r,l),o.tpls[e]={sql:n,types:null}),o},prepared:function(e,l){var n,t,s,r,i,u,a,o,c,f=this;if(!I(e)&&D.call(f.tpls,e)){if(n=f.tpls[e].sql,null===(t=f.tpls[e].types)){for(n.parse(),t={},u=0,a=n.tpl.length;u<a;u++)0===(o=n.tpl[u])[0]&&((c=o[1].split(":")).length>1?(t[c[1]]=c[0],n.tpl[u][1]=c[1]):(t[c[0]]="s",n.tpl[u][1]=c[0]));f.tpls[e].types=t}s={};for(c in l)if(D.call(l,c))switch(r=l[c],D.call(t,c)?t[c]:"s"){case"r":v(r)?s[c]=r.join(","):s[c]=r;break;case"l":s[c]=f.like(r);break;case"f":if(v(r))for(i=N(r),s[c]=S.parse(i[0],f).aliased,u=1,a=i.length;u<a;u++)s[c]+=","+S.parse(i[u],f).aliased;else s[c]=S.parse(r,f).aliased;break;case"d":v(r)?s[c]=f.intval(N(r)).join(","):s[c]=f.intval(r);break;case"s":default:v(r)?s[c]=f.quote(N(r)).join(","):s[c]=f.quote(r)}return n.render(s)}return""},prepare:function(e,l,n,t){var s,r,i,u,a,o,c,f,d,p=this;if(e&&l){for(s=_((n=n?h(n):"%")+"([rlfds]:)?([0-9a-zA-Z_]+)"+(t=t?h(t):"%")),d="";e.length&&(r=e.match(s));){if(i=r.index,u=r[0].length,f=r[2],D.call(l,f)){switch(r[1]?r[1].slice(0,-1):"s"){case"r":f=v(l[f])?l[f].join(","):l[f];break;case"l":f=p.like(l[f]);break;case"f":if(v(l[f]))for(c=N(l[f]),f=S.parse(c[0],p).aliased,a=1,o=c.length;a<o;a++)f+=","+S.parse(c[a],p).aliased;else f=S.parse(l[f],p).aliased;break;case"d":f=v(l[f])?p.intval(N(l[f])).join(","):p.intval(l[f]);break;case"s":default:f=v(l[f])?p.quote(N(l[f])).join(","):p.quote(l[f])}d+=e.slice(0,i)+f}else d+=e.slice(0,i)+p.quote("");e=e.slice(i+u)}return e.length&&(d+=e),d}return e},dropTpl:function(e){var l=this;return!I(e)&&D.call(l.tpls,e)&&(l.tpls[e].sql.dispose(),delete l.tpls[e]),l},StartTransaction:function(e,l){var n=this;return l=l||"start_transaction",n.clau!==l&&n.reset(l),n.clus.type=e||null,n},CommitTransaction:function(e){var l=this;return e=e||"commit_transaction",l.clau!==e&&l.reset(e),l},RollbackTransaction:function(e){var l=this;return e=e||"rollback_transaction",l.clau!==e&&l.reset(e),l},Transaction:function(e,l){var n,t=this;return l=l||"transact",t.clau!==l&&t.reset(l),e=e||{},t.clus.type=e.type||null,t.clus.rollback=e.rollback?1:null,I(e.statements)||(n=N(n),t.clus.statements?t.clus.statements=t.clus.statements.concat(n):t.clus.statements=n),t},Create:function(e,l,n){var t,s,r=this;return n=n||"create",r.clau!==n&&r.reset(n),l=l||{ifnotexists:1},r.clus.create_table=r.refs(e,r.tbls),r.clus.view=l.view?1:null,r.clus.ifnotexists=l.ifnotexists?1:null,r.clus.temporary=l.temporary?1:null,r.clus.query=I(l.query)?null:l.query,I(l.columns)||(t=N(l.columns),r.clus.columns?r.clus.columns=r.clus.columns.concat(t):r.clus.columns=t),I(l.table)||(s=N(l.table),r.clus.options?r.clus.options=r.clus.options.concat(s):r.clus.options=s),r},Alter:function(e,l,n){var t,s,r=this;return n=n||"alter",r.clau!==n&&r.reset(n),r.clus.alter_table=r.refs(e,r.tbls),l=l||{},r.clus.view=l.view?1:null,I(l.columns)||(t=N(l.columns),r.clus.columns?r.clus.columns=r.clus.columns.concat(t):r.clus.columns=t),I(l.table)||(s=N(l.table),r.clus.options?r.clus.options=r.clus.options.concat(s):r.clus.options=s),r},Drop:function(e,l,n){var t,s=this;return n=n||"drop",s.clau!==n&&s.reset(n),t=v(e)?e[0]:e,D.call(s.vews,t)?(s.dropView(t),s):(e=s.refs(null==e?"*":e,s.tbls),l=l||{ifexists:1},s.clus.view=l.view?1:null,s.clus.ifexists=l.ifexists?1:null,s.clus.temporary=l.temporary?1:null,s.clus.drop_tables?s.clus.drop_tables=s.clus.drop_tables.concat(e):s.clus.drop_tables=e,s)},Select:function(e,l){var n=this;return l=l||"select",n.clau!==l&&n.reset(l),e=n.refs(null==e?"*":e,n.cols),n.clus.select_columns?n.clus.select_columns=n.clus.select_columns.concat(e):n.clus.select_columns=e,n},Insert:function(e,l,n){var t,s=this;return n=n||"insert",s.clau!==n&&s.reset(n),t=v(e)?e[0]:e,D.call(s.vews,t)&&s.clau===s.vews[t].clau?s.useView(t):(e=s.refs(e,s.tbls),l=s.refs(l,s.cols),s.clus.insert_tables?s.clus.insert_tables=s.clus.insert_tables.concat(e):s.clus.insert_tables=e,s.clus.insert_columns?s.clus.insert_columns=s.clus.insert_columns.concat(l):s.clus.insert_columns=l),s},Values:function(l){var n,t,s,r,i,u,a,o,c=this;if(I(l))return c;for(e!==l[0]&&v(l[0])||(l=[l]),n=l.length,t=[],r=0;r<n;r++)if((o=N(l[r])).length){for(s=[],u=0,a=o.length;u<a;u++)g(i=o[u])?D.call(i,"raw")?s.push(i.raw):D.call(i,"integer")?s.push(c.intval(i.integer)):D.call(i,"string")&&s.push(c.quote(i.string)):s.push(null===i?"NULL":b(i)?i:c.quote(i));t.push("("+s.join(",")+")")}return t=t.join(","),c.clus.values_values&&(t=c.clus.values_values+","+t),c.clus.values_values=t,c},Update:function(e,l){var n,t=this;return l=l||"update",t.clau!==l&&t.reset(l),n=v(e)?e[0]:e,D.call(t.vews,n)&&t.clau===t.vews[n].clau?t.useView(n):(e=t.refs(e,t.tbls),t.clus.update_tables?t.clus.update_tables=t.clus.update_tables.concat(e):t.clus.update_tables=e),t},Set:function(e){var l,n,t,s,r,i,u=this;if(I(e))return u;l=[],i=u.cols;for(t in e)if(D.call(e,t))if(s=u.refs(t,i)[0].full,r=e[t],g(r)){if(D.call(r,"raw"))l.push(s+" = "+r.raw);else if(D.call(r,"integer"))l.push(s+" = "+u.intval(r.integer));else if(D.call(r,"string"))l.push(s+" = "+u.quote(r.string));else if(D.call(r,"increment"))l.push(s+" = "+s+" + "+u.intval(r.increment));else if(D.call(r,"decrement"))l.push(s+" = "+s+" - "+u.intval(r.increment));else if(D.call(r,"case")){if(n=s+" = CASE",D.call(r.case,"when")){for(case_value in r.case.when)D.call(r.case.when,case_value)&&(n+="\nWHEN "+u.conditions(r.case.when[case_value],!1)+" THEN "+u.quote(case_value));D.call(r.case,"else")&&(n+="\nELSE "+u.quote(r.case.else))}else for(case_value in r.case)D.call(r.case,case_value)&&(n+="\nWHEN "+u.conditions(r.case[case_value],!1)+" THEN "+u.quote(case_value));n+="\nEND",l.push(n)}}else l.push(s+" = "+(null===r?"NULL":b(r)?r:u.quote(r)));return l=l.join(","),u.clus.set_values&&(l=u.clus.set_values+","+l),u.clus.set_values=l,u},Delete:function(e){var l=this;return e=e||"delete",l.clau!==e&&l.reset(e),l},From:function(e){var l,e,n=this;return I(e)?n:(l=v(e)?e[0]:e,D.call(n.vews,l)&&n.clau===n.vews[l].clau?n.useView(l):(e=n.refs(e,n.tbls),n.clus.from_tables?n.clus.from_tables=n.clus.from_tables.concat(e):n.clus.from_tables=e),n)},Join:function(e,l,n){var t,s,r,i=this;if(e=i.refs(e,i.tbls)[0].aliased,n=I(n)?null:n.toUpperCase(),I(l))t={table:e,type:n};else{if(T(l))l="("+(l=i.refs(l.split("="),i.cols))[0].full+"="+l[1].full+")";else{for(s in l)D.call(l,s)&&(g(r=l[s])||(l[s]={eq:r,type:"identifier"}));l="("+i.conditions(l,!1)+")"}t={table:e,type:n,cond:l}}return i.clus.join_clauses?i.clus.join_clauses.push(t):i.clus.join_clauses=[t],i},Where:function(e,l){var n=this;return I(e)?n:("OR"!==(l=l?l.toUpperCase():"AND")&&(l="AND"),e=n.conditions(e,!1),n.clus.where_conditions&&(e=n.clus.where_conditions+" "+l+" "+e),n.clus.where_conditions=e,n)},Group:function(e){var l,n=this;return l=n.refs(e,n.cols)[0].alias,n.clus.group_conditions&&(l=n.clus.group_conditions+","+l),n.clus.group_conditions=l,n},Having:function(e,l){var n=this;return I(e)?n:("OR"!==(l=l?l.toUpperCase():"AND")&&(l="AND"),e=n.conditions(e,!0),n.clus.having_conditions&&(e=n.clus.having_conditions+" "+l+" "+e),n.clus.having_conditions=e,n)},Order:function(e,l){var n,t=this;return"DESC"!==(l=l?l.toUpperCase():"ASC")&&(l="ASC"),n=t.refs(e,t.cols)[0].alias+" "+l,t.clus.order_conditions&&(n=t.clus.order_conditions+","+n),t.clus.order_conditions=n,t},Limit:function(e,l){var n=this;return n.clus.count=m(e),n.clus.offset=m(l),n},Page:function(e,l){var n=this;return e=m(e),l=m(l),n.Limit(l,e*l)},conditions:function(e,l){var n,t,s,r,i,u,a,o,c,f,d,p,_,h=this;if(I(e))return"";if(T(e))return e;n="",t=[],f=h.cols,u=!0===l?"alias":"full";for(s in e)if(D.call(e,s))if(i=e[s],g(i)){if(D.call(i,"raw")){t.push(String(i.raw));continue}if(D.call(i,"or")){d=[];for(var E=0,v=i.or.length;E<v;E++)p=i.or[E],d.push(h.conditions(p,l));t.push(d.join(" OR "));continue}if(D.call(i,"and")){d=[];for(var E=0,v=i.and.length;E<v;E++)p=i.and[E],d.push(h.conditions(p,l));t.push(d.join(" AND "));continue}if(D.call(i,"either")){d=[];for(var E=0,v=i.either.length;E<v;E++)(p={})[s]=i.either[E],d.push(h.conditions(p,l));t.push(d.join(" OR "));continue}if(D.call(i,"together")){d=[];for(var E=0,v=i.together.length;E<v;E++)(p={})[s]=i.together[E],d.push(h.conditions(p,l));t.push(d.join(" AND "));continue}if(r=h.refs(s,f)[0][u],o=D.call(i,"type")?i.type:"string",D.call(i,"case")){if(d=r+" = CASE",D.call(i.case,"when")){for(_ in i.case.when)D.call(i.case.when,_)&&(d+=" WHEN "+h.conditions(i.case.when[_],l)+" THEN "+h.quote(_));D.call(i.case,"else")&&(d+=" ELSE "+h.quote(i.case.else))}else for(_ in i.case)D.call(i.case,_)&&(d+=" WHEN "+h.conditions(i.case[_],l)+" THEN "+h.quote(_));d+=" END",t.push(d)}else D.call(i,"multi_like")?t.push(h.multi_like(r,i.multi_like)):D.call(i,"like")?t.push(r+" LIKE "+("raw"===o?i.like:h.like(i.like))):D.call(i,"not_like")?t.push(r+" NOT LIKE "+("raw"===o?i.not_like:h.like(i.not_like))):D.call(i,"contains")?(c=String(i.contains),"raw"===o||(c=h.quote(c)),t.push(h.sql_function("strpos",[r,c])+" > 0")):D.call(i,"not_contains")?(c=String(i.not_contains),"raw"===o||(c=h.quote(c)),t.push(h.sql_function("strpos",[r,c])+" = 0")):D.call(i,"in")?(c=N(i.in),"raw"===o||(c="integer"===o||b(c[0])?h.intval(c):h.quote(c)),t.push(r+" IN ("+c.join(",")+")")):D.call(i,"not_in")?(c=N(i.not_in),"raw"===o||(c="integer"===o||b(c[0])?h.intval(c):h.quote(c)),t.push(r+" NOT IN ("+c.join(",")+")")):D.call(i,"between")?null==(c=N(i.between))[0]?("raw"===o||("integer"===o||b(c[1])?c[1]=h.intval(c[1]):c[1]=h.quote(c[1])),t.push(r+" <= "+c[1])):null==c[1]?("raw"===o||("integer"===o||b(c[0])?c[0]=h.intval(c[0]):c[0]=h.quote(c[0])),t.push(r+" >= "+c[0])):("raw"===o||(c="integer"===o||b(c[0])&&b(c[1])?h.intval(c):h.quote(c)),t.push(r+" BETWEEN "+c[0]+" AND "+c[1])):D.call(i,"not_between")?null==(c=N(i.not_between))[0]?("raw"===o||("integer"===o||b(c[1])?c[1]=h.intval(c[1]):c[1]=h.quote(c[1])),t.push(r+" > "+c[1])):null==c[1]?("raw"===o||("integer"===o||b(c[0])?c[0]=h.intval(c[0]):c[0]=h.quote(c[0])),t.push(r+" < "+c[0])):("raw"===o||(c="integer"===o||b(c[0])&&b(c[1])?h.intval(c):h.quote(c)),t.push(r+" < "+c[0]+" OR "+r+" > "+c[1])):D.call(i,"gt")||D.call(i,"gte")?(c=i[a=D.call(i,"gt")?"gt":"gte"],"raw"===o||(c="integer"===o||b(c)?h.intval(c):"identifier"===o||"field"===o?h.refs(c,f)[0][u]:h.quote(c)),t.push(r+("gt"===a?" > ":" >= ")+c)):D.call(i,"lt")||D.call(i,"lte")?(c=i[a=D.call(i,"lt")?"lt":"lte"],"raw"===o||(c="integer"===o||b(c)?h.intval(c):"identifier"===o||"field"===o?h.refs(c,f)[0][u]:h.quote(c)),t.push(r+("lt"===a?" < ":" <= ")+c)):D.call(i,"not_equal")||D.call(i,"not_eq")?(c=i[a=D.call(i,"not_eq")?"not_eq":"not_equal"],"raw"===o||null===c||(c="integer"===o||b(c)?h.intval(c):"identifier"===o||"field"===o?h.refs(c,f)[0][u]:h.quote(c)),t.push(null===c?r+" IS NOT NULL":r+" <> "+c)):(D.call(i,"equal")||D.call(i,"eq"))&&(c=i[a=D.call(i,"eq")?"eq":"equal"],"raw"===o||null===c||(c="integer"===o||b(c)?h.intval(c):"identifier"===o||"field"===o?h.refs(c,f)[0][u]:h.quote(c)),t.push(null===c?r+" IS NULL":r+" = "+c))}else r=h.refs(s,f)[0][u],t.push(null===i?r+" IS NULL":r+" = "+(b(i)?i:h.quote(i)));return t.length&&(n="("+t.join(") AND (")+")"),n},joinConditions:function(e,l){var n,t,s,r,i,u,a,o,c,f,d=this,p=0;for(n in l)D.call(l,n)&&(t=S.parse(n,d)._col,D.call(e,t)&&(s=l[n],i=e[t].table,u=e[t].id,a=e[t].join,o=e[t].join_id,c=a+ ++p,r={},D.call(e[t],"key")&&t!==e[t].key?r[c+"."+(f=e[t].key)]=t:f=t,D.call(e[t],"value")?r[c+"."+e[t].value]=s:r[c+"."+f]=s,d.Join(a+" AS "+c,i+"."+u+"="+c+"."+o,"inner").Where(r),delete l[n]));return d},refs:function(e,l,n){var t=this;if(!0===n){var s,r,i;for(u=0,a=e.length;u<a;u++)_=(p=e[u]).alias,h=p.qualified,"*"!==(r=p.full)&&(D.call(l,_)?e[u]=l[_]:D.call(l,r)?(i=(s=l[r]).alias,s.full!==r&&i!==_&&i===r&&(s=s.cloned(p.alias),e[u]=l[_]=s)):D.call(l,h)?((s=l[h]).qualified!==h&&(s=l[s.qualified]),s=p.full!==p.alias?s.cloned(p.alias,null,p._func):s.cloned(null,s.alias,p._func),e[u]=l[s.alias]=s,s.alias===s.full||D.call(l,s.full)||(l[s.full]=s)):(l[_]=p,_===r||D.call(l,r)||(l[r]=p)))}else{var u,a,o,c,f,d,p,_,h;for(d=N(e),e=[],u=0,a=d.length;u<a;u++)for(o=0,c=(f=d[u].split(",")).length;o<c;o++)_=(p=S.parse(f[o],t)).alias,h=p.full,D.call(l,_)?p=l[_]:(l[_]=p,h===_||D.call(l,h)||(l[h]=p)),e.push(p)}return e},tbl:function(e){var l=this;if(v(e)){for(var n=0,t=e.length;n<t;n++)e[n]=l.tbl(e[n]);return e}return l.p+e},intval:function(e){var l=this;if(v(e)){for(var n=0,t=e.length;n<t;n++)e[n]=l.intval(e[n]);return e}return parseInt(e,10)},quote_name:function(e,l){var n,t,s,r,i=this,u=i.qn,a=i.escdbn;if(l=!0===l,v(e)){for(n=0,t=e.length,s=new Array(t);n<t;n++)s[n]=i.quote_name(e[n],l);return s}if(e=String(e),l&&u[0]===e.slice(0,u[0].length)&&u[1]===e.slice(-u[1].length))return e;if(a)return a[1]?a[0](e):u[0]+a[0](e)+u[1];for(n=0,t=e.length,s="";n<t;n++)r=e.charAt(n),u[0]===r?s+=u[2]:u[1]===r?s+=u[3]:s+=r;return u[0]+s+u[1]},quote:function(e){var l,n=this,t=n.q,s=n.e,r=n.escdb;if(v(e)){for(var i=0,u=e.length,a=new Array(u);i<u;i++)a[i]=n.quote(e[i]);return a}return e=String(e),l=-1!==e.indexOf("\\"),r?r[1]?r[0](e):(l?s[2]:"")+t[0]+r[0](e)+t[1]+(l?s[3]:""):(l?s[2]:"")+t[0]+n.esc(e)+t[1]+(l?s[3]:"")},esc:function(e){var l,n,t,s,r,i,u,a=this;if(v(e)){for(t=0,s=e.length,u=new Array(s);t<s;t++)u[t]=a.esc(e[t]);return u}if(a.escdb&&!a.escdb[1])return a.escdb[0](e);for(i=a.q,l=j+"\\",n="\\",u="",t=0,s=(e=String(e)).length;t<s;t++)r=e.charAt(t),i[0]===r?u+=i[2]:i[1]===r?u+=i[3]:u+=A(r,l,n);return u},esc_like:function(e){var l=this;if(v(e)){for(var n=0,t=e.length,s=new Array(t);n<t;n++)s[n]=l.esc_like(e[n]);return s}return A(e,"_%","\\")},like:function(e){var l,n,t=this;if(v(e)){for(var s=0,r=e.length,i=new Array(r);s<r;s++)i[s]=t.like(e[s]);return i}return l=t.q,(n=t.escdb?["","","",""]:t.e)[0]+l[0]+"%"+t.esc_like(t.esc(e))+"%"+l[1]+n[1]},multi_like:function(e,l,n){var t,s,r,i,u,a,o,c=this;for(n=!1!==n,t=e+" LIKE ",s=l.split(","),n&&(s=w(R(s,F),Boolean)),i=0,u=s.length;i<u;i++){for(r=s[i].split("+"),n&&(r=w(R(r,F),Boolean)),a=0,o=r.length;a<o;a++)r[a]=t+c.like(r[a]);s[i]="("+r.join(" AND ")+")"}return s.join(" OR ")},sql_function:function(e,l){var n,t,s,r,i,u,a=this;if(!D.call(L.dialects[a.type].functions,e))throw new TypeError('Dialect: SQL function "'+e+'" does not exist for dialect "'+a.type+'"');for(e=L.dialects[a.type].functions[e],u=(l=null!=l?N(l):[]).length,n="",t=!1,s=0,r=e.length;s<r;s++)i=e[s],n+=t?0<i&&u>=i?l[i-1]:"":i,t=!t;return n},sql_type:function(e){var l=this;if(e=String(e).toUpperCase(),!D.call(L.dialects[l.type].types,e))throw new TypeError('Dialect: SQL type "'+e+'" does not exist for dialect "'+l.type+'"');return L.dialects[l.type].types[e]}},L});