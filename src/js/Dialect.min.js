/**
*   Dialect, 
*   a simple and flexible Cross-Platform SQL Builder for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 0.6.0
*   https://github.com/foo123/Dialect
*
*   Abstract the construction of SQL queries
*   Support multiple DB vendors
*   Intuitive and Flexible API
**/
!function(e,n,t){"use strict";var s;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.EXPORTED_SYMBOLS=[n])&&(e[n]=t.call(e)):"object"==typeof module&&module.exports?module.exports=t.call(e):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["require","exports","module"],function(){return t.call(e)}):n in e||(e[n]=s=t.call(e))&&"function"==typeof define&&define.amd&&define(function(){return s})}(this,"Dialect",function(e,n){"use strict";function t(e,n){return new Function(e,n)}function s(e,n){return new RegExp(e,n||"")}function l(e){return e.replace(S,"\\$&")}function i(e){return"function"==typeof e}function r(e){return"string"==typeof e}function o(e){return e instanceof Array||"[object Array]"===T.call(e)}function u(e){return e instanceof Object||"[object Object]"===T.call(e)}function c(e){if(!e)return!0;var n=T.call(e);return(e instanceof Array||e instanceof String||"[object Array]"===n||"[object String]"===n)&&!e.length?!0:(e instanceof Object||"[object Array]"===n)&&!R(e).length?!0:!1}function a(e){return parseInt(e||0,10)||0}function f(e){return e===+e&&isFinite(e)&&!(e%1)}function d(e){return o(e)?e:[e]}function _(e,n,t){var s,l,i,r="";for(3>arguments.length&&(t="\\"),2>arguments.length&&(n="\\\"'"+N),s=0,l=e.length;l>s;s++)i=e[A](s),r+=-1===n.indexOf(i)?i:0===i[O](0)?"\\0":t+i;return r}function h(e,n,t){t=!0===t;for(var s in n)n[m](s)&&(t||!e[m](s))&&(e[s]=n[s]);return e}function p(e,n){var t=e.length;if(!t)return[];var s,l,i=15&t,r=1&i,o=new Array(t);for(r&&(o[0]=n(e[0])),s=r;i>s;s+=2)l=s,o[s]=n(e[l]),o[s+1]=n(e[l+1]);for(s=i;t>s;s+=16)l=s,o[s]=n(e[l]),o[s+1]=n(e[l+1]),o[s+2]=n(e[l+2]),o[s+3]=n(e[l+3]),o[s+4]=n(e[l+4]),o[s+5]=n(e[l+5]),o[s+6]=n(e[l+6]),o[s+7]=n(e[l+7]),o[s+8]=n(e[l+8]),o[s+9]=n(e[l+9]),o[s+10]=n(e[l+10]),o[s+11]=n(e[l+11]),o[s+12]=n(e[l+12]),o[s+13]=n(e[l+13]),o[s+14]=n(e[l+14]),o[s+15]=n(e[l+15]);return o}function g(e,n){var t=e.length;if(!t)return[];var s,l,i=15&t,r=1&i,o=[];for(r&&n(e[0])&&o.push(e[0]),s=r;i>s;s+=2)l=s,n(e[l])&&o.push(e[l]),n(e[++l])&&o.push(e[l]);for(s=i;t>s;s+=16)l=s,n(e[l])&&o.push(e[l]),n(e[++l])&&o.push(e[l]),n(e[++l])&&o.push(e[l]),n(e[++l])&&o.push(e[l]),n(e[++l])&&o.push(e[l]),n(e[++l])&&o.push(e[l]),n(e[++l])&&o.push(e[l]),n(e[++l])&&o.push(e[l]),n(e[++l])&&o.push(e[l]),n(e[++l])&&o.push(e[l]),n(e[++l])&&o.push(e[l]),n(e[++l])&&o.push(e[l]),n(e[++l])&&o.push(e[l]),n(e[++l])&&o.push(e[l]),n(e[++l])&&o.push(e[l]),n(e[++l])&&o.push(e[l]);return o}var v,E,b,q,w="prototype",m="hasOwnProperty",R=Object.keys,T=Object[w].toString,A="charAt",O="charCodeAt",S=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,I=/^\s+|\s+$/g,D=String[w].trim?function(e){return e.trim()}:function(e){return e.replace(I,"")},N=String.fromCharCode(0);v=function F(e,n,t){var s=this;return s instanceof F?(s.id=null,s._renderer=null,n=n||F.defaultArgs,s.tpl=n instanceof RegExp?F.multisplit_re(e||"",n):F.multisplit(e||"",n),!0===t&&(s._renderer=F.compile(s.tpl)),void s.fixRenderer()):new F(e,n,t)},v.defaultArgs=/\$(-?[0-9]+)/g,v.multisplit=function(e,n,t){var s,l,i,r,o,u,c,a,f,d;t=!!t,u=[[1,e]];for(s in n)if(n.hasOwnProperty(s)){for(a=[],l=t?n[s]:s,i=[0,n[s]],r=0,f=u.length;f>r;r++)if(1===u[r][0]){if(c=u[r][1].split(l),d=c.length,a.push([1,c[0]]),d>1)for(o=0;d-1>o;o++)a.push(i),a.push([1,c[o+1]])}else a.push(u[r]);u=a}return u},v.multisplit_re=function(e,n){n=n.global?n:new RegExp(n.source,n.ignoreCase?"gi":"g");for(var t,s=[],l=0;t=n.exec(e);)s.push([1,e.slice(l,n.lastIndex-t[0].length)]),s.push([0,t[1]?t[1]:t[0]]),l=n.lastIndex;return s.push([1,e.slice(l)]),s},v.arg=function(e,n){var t,s,l,i,r,o="args";if(arguments.length&&null!=e)for(e=e.substr?e.length?e.split("."):[]:[e],i=e.length,r=!(!n||!n.substr),t=0;i>t;t++)s=e[t],l=+s,isNaN(l)?o+='["'+s+'"]':(0>l&&(s=r?n+-l:o+".length-"+-l),o+="["+s+"]");return o},v.compile=function(e,n){var s,l,i,r,o=e.length;if(!0===n){for(r='"use strict"; return (',s=0;o>s;s++)l=e[s][0],i=e[s][1],r+=l?i:v.arg(i);r+=");"}else{for(r='"use strict"; var argslen=args.length; return (',s=0;o>s;s++)l=e[s][0],i=e[s][1],r+=l?"'"+i.replace(SQUOTE,"\\'").replace(NEWLINE,"' + \"\\n\" + '")+"'":" + String("+v.arg(i,"argslen")+") + ";r+=");"}return t("args",r)},v[w]={constructor:v,id:null,tpl:null,_renderer:null,dispose:function(){return this.id=null,this.tpl=null,this._renderer=null,this},fixRenderer:function(){return this.render="function"==typeof this._renderer?this._renderer:this.constructor[w].render,this},render:function(e){e=e||[];var n,t,s,l=this.tpl,i=l.length,r=e.length,o="";for(n=0;i>n;n++)t=l[n],1===t[0]?o+=t[1]:(s=t[1],+s===s&&0>s&&(s=r+s),o+=e[s]);return o}},E=function H(e,n){var t=this;return t instanceof H?(t.id=null,void(t.tpl=H.multisplit(e||"",n||H.defaultDelims))):new H(e,n)},E.defaultDelims=["<",">","[","]"],E.multisplit=function(e,n){var t,s,l,i,r,o,u,c,a,f,d,_,h=n[0],p=n[1],g=n[2],v=n[3],E=h.length,b=p.length,q=g.length,w=v.length,m="?",R="*",T="!",O="|",S="{",I="}",N=null,L=0,y=0,j=e.length;for(f=0,u=[[],null,0,0,0,0,null],r=[],a="";j>f;)if(h===e.substr(f,E))f+=E,a.length&&u[0].push([0,a]),a="";else if(p===e.substr(f,b)){if(f+=b,l=a,a="",-1<(i=l.indexOf(O))?(N=l.slice(i+1),l=l.slice(0,i)):N=null,o=l[A](0),m===o||R===o)y=1,R===o?(t=1,s=-1):(t=0,s=0),l=l.slice(1),T===l[A](0)?(L=1,l=l.slice(1)):L=0;else if(S===o){for(a="",d=1,_=l.length;_>d&&I!==l[A](d);)a+=l[A](d++);l=l.slice(d+1),a=a.split(","),a.length>1?(t=D(a[0]),t=t.length?parseInt(t,10)||0:0,s=D(a[1]),s=s.length?parseInt(s,10)||0:-1,y=1):(t=D(a[0]),t=t.length?parseInt(t,10)||0:0,s=t,y=0),a="",L=0}else y=0,L=0,t=0,s=0;L&&null===N&&(N=""),y&&!u[2]?(u[1]=l,u[2]=y,u[3]=L,u[4]=t,u[5]=s,u[6]=[[l,L,t,s]]):y?u[6].push([l,L,t,s]):y||null!==u[1]||(u[1]=l,u[2]=0,u[3]=L,u[4]=t,u[5]=s,u[6]=[[l,L,t,s]]),u[0].push([1,l,N,y,L,t,s])}else g===e.substr(f,q)?(f+=q,a.length&&u[0].push([0,a]),a="",r.push(u),u=[[],null,0,0,0,0,null]):v===e.substr(f,w)?(f+=w,c=u,u=r.pop(),a.length&&c[0].push([0,a]),a="",u[0].push([-1,c[1],c[2],c[3],c[4],c[5],c[6],c[0]])):a+=e[A](f++);return a.length&&u[0].push([0,a]),u[0]},E[w]={constructor:E,id:null,tpl:null,dispose:function(){return this.id=null,this.tpl=null,this},render:function(e){e=e||{};var n,t,s,l,i,r,u,c,a,f,d,_,h,p=this.tpl,g=p.length,v=[],E=Math.min,b=null,q=0,w="";for(s=0;g>s||v.length;)if(s>=g)n=v.pop(),p=n[0],s=n[1],g=n[2],b=n[3]||null,q=n[4]||0;else{if(l=p[s],i=l[0],r=l[1],-1===i){if(a=l[6],a&&a.length){for(f=!0,d=0,_=a.length;_>d;d++)if(h=a[d],0===h[1]&&!e[m](h[0])||1===h[1]&&e[m](h[0])){f=!1;break}if(f){if(1===l[3]){v.push([p,s+1,g,b,q]),p=l[7],s=0,g=p.length,b=null,q=0;continue}if(t=o(e[r]),t&&l[4]!==l[5]&&e[r].length>l[4]){if(u=l[4],c=-1===l[5]?e[r].length-1:E(l[5],e[r].length-1),c>=u){for(v.push([p,s+1,g,b,q]),p=l[7],s=0,g=p.length,b=r,q=c;q>u;q--)v.push([p,0,g,b,q]);q=u;continue}}else if(!t&&l[4]===l[5]){v.push([p,s+1,g,b,q]),p=l[7],s=0,g=p.length,b=r,q=0;continue}}}}else w+=1===i?e[m](r)||null===l[2]?o(e[r])?r===b?e[r][l[5]===l[6]?l[5]:q]:e[r][l[5]]:e[r]:l[2]:r;s++}return w}},b=function(e,n,t,s,l,i,r,o,u,c,a){var f=this;if(f.col=e,f.col_q=n,f.tbl=t,f.tbl_q=s,f.dtb=l,f.dtb_q=i,f.alias=r,f.tbl_col=u,f.tbl_col_q=c,f.full=f.tbl_col_q,f.func=null==a?[]:a,f.func.length)for(var d=0,_=f.func.length;_>d;d++)f.full=f.func[d]+"("+f.full+")";null!=f.alias?(f.alias_q=o,f.aliased=f.full+" AS "+f.alias_q):(f.alias_q=f.full,f.aliased=f.full)};var L=/\s/,y=/[0-9]/,j=/[a-z_]/i;b.parse=function(e,n){var t,s,l,i,r,o,u,c,a,f,d,_,h,p,g,v,E,q,w,m,R,T,A,O,S=["AS"];for(e=D(e),s=e.length,t=0,l=[[]],i=l[0],r=[],o=[],u="",c=null,d=0,_=null;s>t;){if(h=e.charAt(t++),'"'===h||"`"===h||"'"===h||"["===h||"]"===h){if(!_){if(u.length||"]"===h){c=["invalid",t];break}_="["===h?"]":h;continue}if(_===h){if(!u.length){c=["invalid",t];break}i.unshift([1,u]),r.unshift(u),u="",_=null;continue}if(_){u+=h;continue}}if(_)u+=h;else if("*"===h){if(u.length){c=["invalid",t];break}i.unshift([10,"*"]),r.unshift(10)}else if("."===h){if(u.length&&(i.unshift([1,u]),r.unshift(u),u=""),!i.length||1!==i[0][0]){c=["invalid",t];break}i.unshift([0,"."]),r.unshift(0)}else if("("===h){if(d++,u.length&&(i.unshift([2,u]),o.unshift(u),u=""),!i.length||2!==i[0][0]&&1!==i[0][0]){c=["invalid",t];break}1===i[0][0]&&(i[0][0]=2,o.unshift(r.shift())),l.unshift([]),i=l[0]}else if(")"===h){if(d--,u.length&&(p=-1<S.indexOf(u.toUpperCase()),i.unshift([p?5:1,u]),r.unshift(p?5:u),u=""),l.length<2){c=["invalid",t];break}l[1].unshift([100,l.shift()]),i=l[0]}else{if(L.test(h)){u.length&&(p=-1<S.indexOf(u.toUpperCase()),i.unshift([p?5:1,u]),r.unshift(p?5:u),u="");continue}if(y.test(h)){if(!u.length){c=["invalid",t];break}u+=h}else{if(!j.test(h)){c=["invalid",t];break}u+=h}}}if(u.length&&(i.unshift([1,u]),r.unshift(u),u=""),!c&&d&&(c=["paren",s]),!c&&_&&(c=["quote",s]),c||1===l.length||(c=["invalid",s]),c)throw a=c[1]-1,f=c[0],new TypeError("paren"==f?'Dialect: Mismatched parentheses "'+e+'" at position '+a+".":"quote"==f?'Dialect: Mismatched quotes "'+e+'" at position '+a+".":'Dialect: Invalid character "'+e+'" at position '+a+".");return R=null,T="",r.length>=3&&5===r[1]&&"string"==typeof r[0]&&(R=r.shift(),T=n.quote_name(R),r.shift()),g=null,v="",!r.length||"string"!=typeof r[0]&&10!==r[0]||(10===r[0]?(r.shift(),g=v="*"):(g=r.shift(),v=n.quote_name(g))),E=null,q="",r.length>=2&&0===r[0]&&"string"==typeof r[1]&&(r.shift(),E=r.shift(),q=n.quote_name(E)),w=null,m="",r.length>=2&&0===r[0]&&"string"==typeof r[1]&&(r.shift(),w=r.shift(),m=n.quote_name(w)),A=(w?w+".":"")+(E?E+".":"")+(g?g:""),O=(w?m+".":"")+(E?q+".":"")+(g?v:""),new b(g,v,E,q,w,m,R,T,A,O,o)},b[w]={constructor:b,col:null,col_q:null,tbl:null,tbl_q:null,dtb:null,dtb_q:null,alias:null,alias_q:null,tbl_col:null,tbl_col_q:null,full:null,aliased:null,func:null,cloned:function(e,n){var t=this;return arguments.length?n=n||e:(e=t.alias,n=t.alias_q),new b(t.col,t.col_q,t.tbl,t.tbl_q,t.dtb,t.dtb_q,e,n,t.tbl_col,t.tbl_col_q,t.func)},dispose:function(){var e=this;return e.col=null,e.col_q=null,e.tbl=null,e.tbl_q=null,e.dtb=null,e.dtb_q=null,e.alias=null,e.alias_q=null,e.tbl_col=null,e.tbl_col_q=null,e.full=null,e.aliased=null,e.func=null,e}};var k={mysql:{quotes:[["'","'","\\'","\\'"],["`","`"],["",""]],clauses:{create:"CREATE TABLE IF NOT EXISTS <create_table>\n(<create_defs>)[<?create_opts>]",alter:"ALTER TABLE <alter_table>\n<alter_defs>[<?alter_opts>]",drop:"DROP TABLE IF EXISTS <drop_tables>[,<*drop_tables>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>[\n<*join_clauses>]][\nWHERE (<?where_conditions_required>) [AND (<?where_conditions>)]][<?!where_conditions_required>[\nWHERE <?where_conditions>]][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING (<?having_conditions_required>) [AND (<?having_conditions>)]][<?!having_conditions_required>[\nHAVING <?having_conditions>]][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE (<?where_conditions_required>) [AND (<?where_conditions>)]][<?!where_conditions_required>[\nWHERE <?where_conditions>]][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]","delete":"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) [AND (<?where_conditions>)]][<?!where_conditions_required>[\nWHERE <?where_conditions>]][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]"}},postgres:{quotes:[["E'","'","''","''"],['"','"'],["",""]],clauses:{create:"CREATE TABLE IF NOT EXISTS <create_table>\n(<create_defs>)[<?create_opts>]",alter:"ALTER TABLE <alter_table>\n<alter_defs>[<?alter_opts>]",drop:"DROP TABLE IF EXISTS <drop_tables>[,<*drop_tables>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>[\n<*join_clauses>]][\nWHERE (<?where_conditions_required>) [AND (<?where_conditions>)]][<?!where_conditions_required>[\nWHERE <?where_conditions>]][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING (<?having_conditions_required>) [AND (<?having_conditions>)]][<?!having_conditions_required>[\nHAVING <?having_conditions>]][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][[\nWHERE (<?where_conditions_required>) [AND (<?where_conditions>)]][<?!where_conditions_required>[\nWHERE <?where_conditions>]][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]","delete":"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) [AND (<?where_conditions>)]][<?!where_conditions_required>[\nWHERE <?where_conditions>]][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]"}},sqlserver:{quotes:[["'","'","''","''"],["[","]"],[""," ESCAPE '\\'"]],clauses:{create:"CREATE TABLE IF NOT EXISTS <create_table>\n(<create_defs>)[<?create_opts>]",alter:"ALTER TABLE <alter_table>\n<alter_defs>[<?alter_opts>]",drop:"DROP TABLE IF EXISTS <drop_tables>[,<*drop_tables>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>[\n<*join_clauses>]][\nWHERE (<?where_conditions_required>) [AND (<?where_conditions>)]][<?!where_conditions_required>[\nWHERE <?where_conditions>]][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING (<?having_conditions_required>) [AND (<?having_conditions>)]][<?!having_conditions_required>[\nHAVING <?having_conditions>]][\nORDER BY <?order_conditions>[,<*order_conditions>][\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]][<?!order_conditions>[\nORDER BY 1\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE (<?where_conditions_required>) [AND (<?where_conditions>)]][<?!where_conditions_required>[\nWHERE <?where_conditions>]][\nORDER BY <?order_conditions>[,<*order_conditions>]]","delete":"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) [AND (<?where_conditions>)]][<?!where_conditions_required>[\nWHERE <?where_conditions>]][\nORDER BY <?order_conditions>[,<*order_conditions>]]"}},sqlite:{quotes:[["'","'","''","''"],['"','"'],[""," ESCAPE '\\'"]],clauses:{create:"CREATE TABLE IF NOT EXISTS <create_table>\n(<create_defs>)[<?create_opts>]",alter:"ALTER TABLE <alter_table>\n<alter_defs>[<?alter_opts>]",drop:"DROP TABLE IF EXISTS <drop_tables>[,<*drop_tables>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>[\n<*join_clauses>]][\nWHERE (<?where_conditions_required>) [AND (<?where_conditions>)]][<?!where_conditions_required>[\nWHERE <?where_conditions>]][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING (<?having_conditions_required>) [AND (<?having_conditions>)]][<?!having_conditions_required>[\nHAVING <?having_conditions>]][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE (<?where_conditions_required>) [AND (<?where_conditions>)]][<?!where_conditions_required>[\nWHERE <?where_conditions>]]","delete":"[<?!order_conditions>[<?!count>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) [AND (<?where_conditions>)]][<?!where_conditions_required>[\nWHERE <?where_conditions>]]]][DELETE \nFROM <from_tables>[,<*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) [AND (<?where_conditions>)]][<?!where_conditions_required>[\nWHERE <?where_conditions>]]\nORDER BY <?order_conditions>[,<*order_conditions>][\nLIMIT <?count> OFFSET <offset|0>]\n)][<?!order_conditions>[DELETE \nFROM <from_tables>[,<*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables>[,<*from_tables>][[\nWHERE (<?where_conditions_required>) [AND (<?where_conditions>)]][<?!where_conditions_required>[\nWHERE <?where_conditions>]]\nLIMIT <?count> OFFSET <offset|0>\n)]]"}}};return q=function C(e){var n=this;if(!(n instanceof C))return new C(e);if(arguments.length||(e="mysql"),!e||!C.dialects[e]||!C.dialects[e].clauses)throw new TypeError('Dialect: SQL dialect does not exist for "'+e+'"');n.clau=null,n.clus=null,n.tbls=null,n.cols=null,n.vews={},n.tpls={},n.db=null,n.escdb=null,n.p="",n.type=e,n.clauses=C.dialects[n.type].clauses,n.q=C.dialects[n.type].quotes[0],n.qn=C.dialects[n.type].quotes[1],n.e=C.dialects[n.type].quotes[2]||["",""]},q.VERSION="0.6.0",q.TPL_RE=/\$\(([^\)]+)\)/g,q.dialects=k,q.GrammTpl=E,q.Tpl=v,q.Ref=b,q[w]={constructor:q,clau:null,clus:null,tbls:null,cols:null,vews:null,tpls:null,db:null,escdb:null,p:null,type:null,clauses:null,q:null,qn:null,e:null,dispose:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e.vews=null,e.tpls=null,e.db=null,e.escdb=null,e.p=null,e.type=null,e.clauses=null,e.q=null,e.qn=null,e.e=null,e},toString:function(){return this.sql()||""},driver:function(e){var n=this;return arguments.length?(n.db=e?e:null,n):n.db},escape:function(e){var n=this;return arguments.length?(n.escdb=e&&i(e)?e:null,n):n.escdb},prefix:function(e){var n=this;return arguments.length?(n.p=e&&e.length?e:"",n):n.p},reset:function(e){var n=this;if(!e||!n.clauses[m](e))throw new TypeError('Dialect: SQL clause "'+e+'" does not exist for dialect "'+n.type+'"');return n.clus={},n.tbls={},n.cols={},n.clau=e,n.clauses[n.clau]instanceof E||(n.clauses[n.clau]=new E(n.clauses[n.clau])),n},clear:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e},sql:function(){var e=this,n=null;return e.clau&&e.clauses[m](e.clau)&&(n=e.clauses[e.clau].render(e.clus)||""),e.clear(),n},prepare:function(e,n,t,i){var r,u,c,a,f,_,h,p,g,v,E=this;if(e&&n){for(t=t?l(t):"%",i=i?l(i):"%",r=s(t+"([rlfds]:)?([0-9a-zA-Z_]+)"+i),v="";e.length&&(u=e.match(r));){if(c=u.index,a=u[0].length,p=u[2],n[m](p)){switch(g=u[1]?u[1].slice(0,-1):"s"){case"r":p=o(n[p])?n[p].join(","):n[p];break;case"l":p=E.like(n[p]);break;case"f":if(o(n[p]))for(h=d(n[p]),p=b.parse(h[0],E).aliased,f=1,_=h.length;_>f;f++)p+=","+b.parse(h[f],E).aliased;else p=b.parse(n[p],E).aliased;break;case"d":p=o(n[p])?E.intval(d(n[p])).join(","):E.intval(n[p]);break;case"s":default:p=o(n[p])?E.quote(d(n[p])).join(","):E.quote(n[p])}v+=e.slice(0,c)+p}else v+=e.slice(0,c)+E.quote("");e=e.slice(c+a)}return e.length&&(v+=e),v}return e},make_view:function(e){var n=this;return e&&n.clau&&(n.vews[e]={clau:n.clau,clus:n.clus,tbls:n.tbls,cols:n.cols},n.vews[e].clus[m]("where_conditions")&&(n.vews[e].clus.where_conditions&&(n.vews[e].clus.where_conditions_required=n.vews[e].clus.where_conditions),delete n.vews[e].clus.where_conditions),n.vews[e].clus[m]("having_conditions")&&(n.vews[e].clus.having_conditions&&(n.vews[e].clus.having_conditions_required=n.vews[e].clus.having_conditions),delete n.vews[e].clus.having_conditions),n.clear()),n},clear_view:function(e){var n=this;return e&&n.vews[m](e)&&delete n.vews[e],n},prepare_tpl:function(e){var n,t,i,r,o,u,a,f,d,_,h,p,g,E=this;if(!c(e)){for(f=arguments,d=f.length,1===d?(_=null,h=null,p=null,g=!0):2===d?(_=f[1],h=null,p=null,g=!1):3===d?(_=null,h=f[1],p=f[2],g=!0):(_=f[1],h=f[2],p=f[3],g=!1),h=h?l(h):"%",p=p?l(p):"%",n=s(h+"(([rlfds]:)?[0-9a-zA-Z_]+)"+p),t=g?new v(E.sql(),n):new v(_,n),i={},r=0,o=t.tpl.length;o>r;r++)u=t.tpl[r],0===u[0]&&(a=u[1].split(":"),a.length>1?(i[a[1]]=a[0],t.tpl[r][1]=a[1]):(i[a[0]]="s",t.tpl[r][1]=a[0]));E.tpls[e]={sql:t,types:i}}return E},prepared:function(e,n){var t,s,l,i,r,u,a,f,_,h=this;if(!c(e)&&h.tpls[m](e)){t=h.tpls[e].sql,s=h.tpls[e].types,i={};for(r in n)if(n[m](r))switch(u=n[r],l=s[m](r)?s[r]:"s"){case"r":i[r]=o(u)?u.join(","):u;break;case"l":i[r]=h.like(u);break;case"f":if(o(u))for(a=d(u),i[r]=b.parse(a[0],h).aliased,f=1,_=a.length;_>f;f++)i[r]+=","+b.parse(a[f],h).aliased;else i[r]=DialectRef.parse(u,h).aliased;break;case"d":i[r]=o(u)?h.intval(d(u)).join(","):h.intval(u);break;case"s":default:i[r]=o(u)?h.quote(d(u)).join(","):h.quote(u)}return t.render(i)}return""},clear_tpl:function(e){var n=this;return!c(e)&&n.tpls[m](e)&&(n.tpls[e].sql.dispose(),delete n.tpls[e]),n},create:function(e,n,t,s){var l=this;return l.reset(s||"create"),e=l.refs(e,l.tbls)[0].full,l.clus.create_table=e,l.clus.create_defs&&(n=l.clus.create_defs+","+n),l.clus.create_defs=n,t&&(l.clus.create_opts&&(t=l.clus.create_opts+","+t),l.clus.create_opts=t),l},alter:function(e,n,t,s){var l=this;return l.reset(s||"alter"),e=l.refs(e,l.tbls)[0].full,l.clus.alter_table=e,l.clus.alter_defs&&(n=l.clus.alter_defs+","+n),l.clus.alter_defs=n,t&&(l.clus.alter_opts&&(t=l.clus.alter_opts+","+t),l.clus.alter_opts=t),l},drop:function(e,n){var t,s,l,i=this;if(i.reset(n||"drop"),e&&e.length&&"*"!==e)for(l=i.refs(e,i.tbls),e=l[0].full,t=1,s=l.length;s>t;t++)e+=","+l[t].full;else e="*";return i.clus.drop_tables&&(e=i.clus.drop_tables+","+e),i.clus.drop_tables=e,i},select:function(e,n){var t,s,l,i=this;if(i.reset(n||"select"),e&&e.length&&"*"!==e)for(e=i.refs(e,i.cols),l=e[0].aliased,t=1,s=e.length;s>t;t++)l+=","+e[t].aliased;else l="*";return i.clus.select_columns&&(l=i.clus.select_columns+","+l),i.clus.select_columns=l,i},insert:function(e,n,t){var s,l,i,r,u,c=this;if(c.reset(t||"insert"),i=o(e)?e[0]:e,c.vews[m](i)&&c.clau===c.vews[i].clau)i=c.vews[i],c.clus=h(c.clus,i.clus,!0),c.tbls=h({},i.tbls,!0),c.cols=h({},i.cols,!0);else{for(e=c.refs(e,c.tbls),n=c.refs(n,c.cols),r=e[0].aliased,u=n[0].full,s=1,l=e.length;l>s;s++)r+=","+e[s].aliased;for(s=1,l=n.length;l>s;s++)u+=","+n[s].full;c.clus.insert_tables&&(r=c.clus.insert_tables+","+r),c.clus.insert_columns&&(u=c.clus.insert_columns+","+u),c.clus.insert_tables=r,c.clus.insert_columns=u}return c},values:function(e){var t,s,l,i,r,a,_,h,p=this;if(c(e))return p;for(n!==e[0]&&o(e[0])||(e=[e]),t=e.length,s=[],i=0;t>i;i++)if(h=d(e[i]),h.length){for(l=[],a=0,_=h.length;_>a;a++)r=h[a],u(r)?r[m]("integer")?l.push(p.intval(r.integer)):r[m]("raw")?l.push(r.raw):r[m]("string")&&l.push(p.quote(r.string)):l.push(f(r)?r:p.quote(r));s.push("("+l.join(",")+")")}return s=s.join(","),p.clus.values_values&&(s=p.clus.values_values+","+s),p.clus.values_values=s,p},update:function(e,n){var t,s,l,i,r=this;if(r.reset(n||"update"),l=o(e)?e[0]:e,r.vews[m](l)&&r.clau===r.vews[l].clau)l=r.vews[l],r.clus=h(r.clus,l.clus,!0),r.tbls=h({},l.tbls,!0),r.cols=h({},l.cols,!0);else{for(e=r.refs(e,r.tbls),i=e[0].aliased,t=1,s=e.length;s>t;t++)i+=","+e[t].aliased;r.clus.update_tables&&(i=r.clus.update_tables+","+i),r.clus.update_tables=i}return r},set:function(e){var n,t,s,l,i,r=this;if(c(e))return r;n=[],i=r.cols;for(t in e)e[m](t)&&(s=r.refs(t,i)[0].full,l=e[t],u(l)?l[m]("integer")?n.push(s+" = "+r.intval(l.integer)):l[m]("raw")?n.push(s+" = "+l.raw):l[m]("string")?n.push(s+" = "+r.quote(l.string)):l[m]("increment")?n.push(s+" = "+s+" + "+r.intval(l.increment)):l[m]("decrement")&&n.push(s+" = "+s+" - "+r.intval(l.increment)):n.push(s+" = "+(f(l)?l:r.quote(l))));return n=n.join(","),r.clus.set_values&&(n=r.clus.set_values+","+n),r.clus.set_values=n,r},del:function(e){var n=this;return n.reset(e||"delete"),n},from:function(e){var n,t,s,l,i,r,u=this;if(c(e))return u;if(s=o(e)?e[0]:e,u.vews[m](s)&&u.clau===u.vews[s].clau){if(i=c(u.clus.select_columns)||"*"==u.clus.select_columns?null:u.refs(u.clus.select_columns,{}),s=u.vews[s],u.clus=h(u.clus,s.clus,!0),u.tbls=h({},s.tbls,!0),u.cols=h({},s.cols,!0),i){for(i=u.refs2(i,u.cols),r=i[0].aliased,n=1,t=i.length;t>n;n++)r+=","+i[n].aliased;u.clus.select_columns=r}}else{for(e=u.refs(e,u.tbls),l=e[0].aliased,n=1,t=e.length;t>n;n++)l+=","+e[n].aliased;u.clus.from_tables&&(l=u.clus.from_tables+","+l),u.clus.from_tables=l}return u},join:function(e,n,t){var s,l,i,o=this;if(e=o.refs(e,o.tbls)[0].aliased,c(n))s=e;else{if(r(n))n=o.refs(n.split("="),o.cols),n="("+n[0].full+"="+n[1].full+")";else{for(l in n)n[m](l)&&(i=n[l],u(i)||(n[l]={eq:i,type:"identifier"}));n="("+o.conditions(n,!1)+")"}s=e+" ON "+n}return s=(c(t)?"JOIN ":t.toUpperCase()+" JOIN ")+s,o.clus.join_clauses&&(s=o.clus.join_clauses+"\n"+s),o.clus.join_clauses=s,o},where:function(e,n){var t=this;return c(e)?t:(n=n?n.toUpperCase():"AND","OR"!==n&&(n="AND"),e=t.conditions(e,!1),t.clus.where_conditions&&(e=t.clus.where_conditions+" "+n+" "+e),t.clus.where_conditions=e,t)},group:function(e,n){var t,s=this;return n=n?n.toUpperCase():"ASC","DESC"!==n&&(n="ASC"),t=s.refs(e,s.cols)[0].alias_q+" "+n,s.clus.group_conditions&&(t=s.clus.group_conditions+","+t),s.clus.group_conditions=t,s},having:function(e,n){var t=this;return c(e)?t:(n=n?n.toUpperCase():"AND","OR"!==n&&(n="AND"),e=t.conditions(e,!0),t.clus.having_conditions&&(e=t.clus.having_conditions+" "+n+" "+e),t.clus.having_conditions=e,t)},order:function(e,n){var t,s=this;return n=n?n.toUpperCase():"ASC","DESC"!==n&&(n="ASC"),t=s.refs(e,s.cols)[0].alias_q+" "+n,s.clus.order_conditions&&(t=s.clus.order_conditions+","+t),s.clus.order_conditions=t,s},limit:function(e,n){var t=this;return t.clus.count=a(e),t.clus.offset=a(n),t},page:function(e,n){var t=this;return e=a(e),n=a(n),t.limit(n,e*n)},refs:function(e,n){var t,s,l,i,r,o,u,c,a,f=this;for(o=d(e),e=[],t=0,s=o.length;s>t;t++)for(r=o[t].split(","),l=0,i=r.length;i>l;l++)u=b.parse(r[l],f),c=u.alias_q,a=u.full,n[m](c)?u=n[c]:(n[c]=u,a===c||n[m](a)||(n[a]=u)),e.push(u);return e},refs2:function(e,n){var t,s,l,i,r,o,u,c;for(t=0,s=e.length;s>t;t++)l=e[t],r=l.alias_q,o=l.full,n[m](r)?e[t]=n[r]:n[m](o)?(i=n[o],u=i.alias_q,c=i.full,c!==o&&u!==r&&u===o&&(c!==u&&n[m](u)&&delete n[u],i=i.cloned(l.alias_q),e[t]=n[c]=i,r===c||n[m](r)||(n[r]=i))):(n[r]=l,r===o||n[m](o)||(n[o]=l));return e},join_conditions:function(e,n){var t,s,l,i,r,o,u,c,a,f,d,_,h=this,p=0;for(t in n)n[m](t)&&(s=b.parse(t,h),l=s.col,e[m](l)&&(i=n[t],o=e[l].table,u=e[l].id,c=e[l].join,a=e[l].join_id,p++,f=c+p,r={},e[l][m]("key")&&l!==e[l].key?(d=e[l].key,r[f+"."+d]=l):d=l,e[l][m]("value")?(_=e[l].value,r[f+"."+_]=i):(_=d,r[f+"."+_]=i),h.join(c+" AS "+f,o+"."+u+"="+f+"."+a,"inner").where(r),delete n[t]));return h},conditions:function(e,n){var t,s,l,i,o,a,_,h,p,g,v=this;if(c(e))return"";if(r(e))return e;t="",s=[],g=v.cols,a=!0===n?"alias_q":"full";for(l in e)e[m](l)&&(i=v.refs(l,g)[0][a],o=e[l],u(o)?(h=o[m]("type")?o.type:"string",o[m]("multi_like")?s.push(v.multi_like(i,o.multi_like)):o[m]("like")?s.push(i+" LIKE "+("raw"===h?o.like:v.like(o.like))):o[m]("not_like")?s.push(i+" NOT LIKE "+("raw"===h?o.not_like:v.like(o.not_like))):o[m]("in")?(p=d(o["in"]),"raw"===h||(p="integer"===h||f(p[0])?v.intval(p):v.quote(p)),s.push(i+" IN ("+p.join(",")+")")):o[m]("not_in")?(p=d(o.not_in),"raw"===h||(p="integer"===h||f(p[0])?v.intval(p):v.quote(p)),s.push(i+" NOT IN ("+p.join(",")+")")):o[m]("between")?(p=d(o.between),"raw"===h||(p="integer"===h||f(p[0])&&f(p[1])?v.intval(p):v.quote(p)),s.push(i+" BETWEEN "+p[0]+" AND "+p[1])):o[m]("not_between")?(p=d(o.not_between),"raw"===h||(p="integer"===h||f(p[0])&&f(p[1])?v.intval(p):v.quote(p)),s.push(i+" < "+p[0]+" OR "+i+" > "+p[1])):o[m]("gt")||o[m]("gte")?(_=o[m]("gt")?"gt":"gte",p=o[_],"raw"===h||(p="integer"===h||f(p)?v.intval(p):"identifier"===h||"field"===h?v.refs(p,g)[0][a]:v.quote(p)),s.push(i+("gt"===_?" > ":" >= ")+p)):o[m]("lt")||o[m]("lte")?(_=o[m]("lt")?"lt":"lte",p=o[_],"raw"===h||(p="integer"===h||f(p)?v.intval(p):"identifier"===h||"field"===h?v.refs(p,g)[0][a]:v.quote(p)),s.push(i+("lt"===_?" < ":" <= ")+p)):o[m]("not_equal")||o[m]("not_eq")?(_=o[m]("not_eq")?"not_eq":"not_equal",p=o[_],"raw"===h||(p="integer"===h||f(p)?v.intval(p):"identifier"===h||"field"===h?v.refs(p,g)[0][a]:v.quote(p)),s.push(i+" <> "+p)):(o[m]("equal")||o[m]("eq"))&&(_=o[m]("eq")?"eq":"equal",p=o[_],"raw"===h||(p="integer"===h||f(p)?v.intval(p):"identifier"===h||"field"===h?v.refs(p,g)[0][a]:v.quote(p)),s.push(i+" = "+p))):s.push(i+" = "+(f(o)?o:v.quote(o))));return s.length&&(t="("+s.join(") AND (")+")"),t},tbl:function(e){var n=this;if(o(e)){for(var t=0,s=e.length;s>t;t++)e[t]=n.tbl(e[t]);return e}return n.p+e},intval:function(e){var n=this;if(o(e)){for(var t=0,s=e.length;s>t;t++)e[t]=n.intval(e[t]);return e}return parseInt(e,10)},quote_name:function(e,n){var t=this,s=t.qn;if(n=!0===n,o(e)){for(var l=0,i=e.length;i>l;l++)e[l]=t.quote_name(e[l],n);return e}return"*"===e?e:(n||s[0]!=e.slice(0,s[0].length)?s[0]:"")+e+(n||s[1]!=e.slice(-s[1].length)?s[1]:"")},quote:function(e){var n=this,t=n.q;if(o(e)){for(var s=0,l=e.length;l>s;s++)e[s]=n.quote(e[s]);return e}return t[0]+n.esc(e)+t[1]},like:function(e){var n,t,s=this;if(o(e)){for(var l=0,i=e.length;i>l;l++)e[l]=s.like(e[l]);return e}return n=s.q,t=s.escdb?["",""]:s.e,t[0]+n[0]+"%"+s.esc_like(s.esc(e))+"%"+n[1]+t[1]},multi_like:function(e,n,t){var s,l,i,r,o,u,c,a=this;for(t=!1!==t,s=e+" LIKE ",l=n.split(","),t&&(l=g(p(l,D),Boolean)),r=0,o=l.length;o>r;r++){for(i=l[r].split("+"),t&&(i=g(p(i,D),Boolean)),u=0,c=i.length;c>u;u++)i[u]=s+a.like(i[u]);l[r]="("+i.join(" AND ")+")"}return l.join(" OR ")},esc:function(e){var n,t,s,l,i,r,u,c=this;if(o(e)){for(s=0,l=e.length;l>s;s++)e[s]=c.esc(e[s]);return e}if(c.escdb)return c.escdb(e);for(u=c.q,n="\\"+N,t="\\",e=String(e),i="",s=0,l=e.length;l>s;s++)r=e.charAt(s),i+=u[0]===r?u[2]:u[1]===r?u[3]:_(r,n,t);return i},esc_like:function(e){var n=this;if(o(e)){for(var t=0,s=e.length;s>t;t++)e[t]=n.esc_like(e[t]);return e}return _(e,"_%","\\")}},q});