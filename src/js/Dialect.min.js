/**
*   Dialect, 
*   a simple and flexible Cross-Platform SQL Builder for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 0.8.4
*   https://github.com/foo123/Dialect
*
*   Abstract the construction of SQL queries
*   Support multiple DB vendors
*   Intuitive and Flexible API
**/
!function(e,n,l){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import?(e.$deps=e.$deps||{})&&(e.EXPORTED_SYMBOLS=[n])&&(e[n]=e.$deps[n]=l.call(e)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=l.call(e)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System.import?System.register(n,[],function(t){t(n,l.call(e))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return l.moduleUri=n.uri,l.call(e)}):n in e||(e[n]=l.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[n]})}(this,"Dialect",function(e){"use strict";function n(){return n.GUID+=1,s((new Date).getTime().toString(16),12)+"--"+s(n.GUID.toString(16),4)}function l(e,n,t){var s=this;if(!(s instanceof l))return new l(e,n,t);s.id=null,s.tpl=null,s._renderer=null,s._args=[e||"",n||l.defaultArgs,t],s._parsed=!1}function t(e,n){return e&&B.call(e,n)?1:0}function s(e,n,l,t){var s=String(e);if(l=l||"0",t)for(;s.length<n;)s+=l;else for(;s.length<n;)s=l+s;return s}function r(e,n,l){for(var t,s="";n<l&&(" "===(t=e[k](n))||"\r"===t||"\t"===t||"\v"===t||"\0"===t);)s+=t,n+=1;return s}function i(e,n){var l,t,s,r=e.length;if(r&&n.length)for(l="",s=0;s<r;s++)l+=t=e[k](s),"\n"===t&&(l+=n);else l=e;return l}function u(e,n,l,t){var s,r,i,u,o=0;if(n)for(s=e,r=n.length,i=0,o=1;i<r;){if(u=n[i++],null==s||null==s[u]){o=0;break}s=s[u]}if(!o&&l)for(s=e,r=l.length,i=0,o=1;i<r;){if(u=l[i++],null==s||null==s[u]){o=0;break}s=s[u]}if(!o&&null!=t&&t!==e){if(n)for(s=t,r=n.length,i=0,o=1;i<r;){if(u=n[i++],null==s||null==s[u]){o=0;break}s=s[u]}if(!o&&l)for(s=t,r=l.length,i=0,o=1;i<r;){if(u=l[i++],null==s||null==s[u]){o=0;break}s=s[u]}}return o?s:null}function o(e,n){this.prev=e||null,this.value=n||null}function a(e,n){n&&(n.next=this),this.node=e||null,this.prev=n||null,this.next=null}function c(e,n,l,t,s,r,i){var o,a,c,f,d,_,h,E,T=null,g="";if(-1===n.type){if((o=n.opt_args)&&o.value[5])for(;o;){if(a=o.value,c=u(e,a[1],[String(a[0])],a[6]?null:i),null===T&&n.name===a[0]&&(T=c),0===a[2]&&null==c||1===a[2]&&null!=c)return"";o=o.prev}}else T=u(e,n.key,[String(n.name)],n.loc?null:i);if(f=v(T),E=f?T.length:-1,f&&E>n.start)for(d=n.start,_=-1===n.end?E-1:Math.min(n.end,E-1),h=d;h<=_;h++)g+=p(e,n.tpl,l,t,h,r,i);else f||n.start!==n.end||(g=p(e,n.tpl,l,t,null,r,i));return g}function f(e,n,l,s,r,o,a){var f,p,_,h,E="";return n.stpl&&(t(l,n.stpl)||t(d.subGlobal,n.stpl)||t(s,n.stpl)||t(s,"*")||t(d.fnGlobal,n.stpl)||t(d.fnGlobal,"*"))?(f=u(e,n.key,[String(n.name)],n.loc?null:a),t(l,n.stpl)||t(d.subGlobal,n.stpl)?(null==r||0===r&&n.start===n.end&&n.opt||!v(f)||(f=r<f.length?f[r]:null),null==f&&null!==n.dval?E=n.dval:(_=t(l,n.stpl)?l[n.stpl].node:d.subGlobal[n.stpl].node,p={},null!=f&&(v(f)?p[_.name]=f:p=f),E=c(p,_,l,s,null,n.algn?o:"",null==a?e:a))):(h=null,t(s,n.stpl)?h=s[n.stpl]:t(s,"*")?h=s["*"]:t(d.fnGlobal,n.stpl)?h=d.fnGlobal[n.stpl]:d.fnGlobal["*"]&&(h=d.fnGlobal["*"]),v(f)&&(f=(r=null!=r?r:n.start)<f.length?f[r]:null),E=null==(f="function"==typeof h?h(f,{symbol:n,index:r,currentArguments:e,originalArguments:a,alignment:o}):String(h))&&null!==n.dval?n.dval:String(f),n.algn&&(E=i(E,o)))):n.opt&&null!==n.dval?E=n.dval:(v(f=u(e,n.key,[String(n.name)],n.loc?null:a))&&(f=(r=null!=r?r:n.start)<f.length?f[r]:null),E=null==f&&null!==n.dval?n.dval:String(f),n.algn&&(E=i(E,o))),E}function p(e,n,l,t,s,r,i){for(var u,o=r=r||"",a="";n;)-1===(u=n.node.type)?a+=c(e,n.node,l,t,s,n.node.algn?o:r,i):1===u?a+=f(e,n.node,l,t,s,n.node.algn?o:r,i):0===u?(o+=n.node.algn,a+=n.node.val):100===u&&(o=r,a+="\n"+r),n=n.next;return a}function d(e,n,l){var t=this;if(!(t instanceof d))return new d(e,n,l);t.id=null,t.tpl=null,t.fn={},t._args=[e||"",n||d.defaultDelimiters,l||!1]}function _(e,n){return new RegExp(e,n||"")}function h(e){return e.replace(G,"\\$&")}function E(e){return"function"==typeof e}function T(e){return e instanceof String||"[object String]"===D.call(e)}function v(e){return e instanceof Array||"[object Array]"===D.call(e)}function g(e){return e instanceof Object||"[object Object]"===D.call(e)}function I(e){if(!e)return!0;var n=D.call(e);return(e instanceof Array||e instanceof String||"[object Array]"===n||"[object String]"===n)&&!e.length||(e instanceof Object||"[object Array]"===n)&&!C(e).length}function m(e){return parseInt(e||0,10)||0}function b(e){return e===+e&&isFinite(e)&&!(e%1)}function N(e){return v(e)?e:[e]}function A(e,n,l){var t,s,r,i="";for(3>arguments.length&&(l="\\"),2>arguments.length&&(n="\\\"'"+H),t=0,s=e.length;t<s;t++)r=e[k](t),i+=-1===n.indexOf(r)?r:0===r[U](0)?"\\0":l+r;return i}function O(e,n,l,t){l=!0===l,t=!0===t;for(var s in n)n[M](s)&&(!l&&e[M](s)||(e[s]=t&&n[s].slice?n[s].slice():n[s]));return e}function R(e,n){var l=e.length;if(!l)return[];var t,s,r=15&l,i=1&r,u=new Array(l);for(i&&(u[0]=n(e[0])),t=i;t<r;t+=2)s=t,u[t]=n(e[s]),u[t+1]=n(e[s+1]);for(t=r;t<l;t+=16)s=t,u[t]=n(e[s]),u[t+1]=n(e[s+1]),u[t+2]=n(e[s+2]),u[t+3]=n(e[s+3]),u[t+4]=n(e[s+4]),u[t+5]=n(e[s+5]),u[t+6]=n(e[s+6]),u[t+7]=n(e[s+7]),u[t+8]=n(e[s+8]),u[t+9]=n(e[s+9]),u[t+10]=n(e[s+10]),u[t+11]=n(e[s+11]),u[t+12]=n(e[s+12]),u[t+13]=n(e[s+13]),u[t+14]=n(e[s+14]),u[t+15]=n(e[s+15]);return u}function w(e,n){var l=e.length;if(!l)return[];var t,s,r=15&l,i=1&r,u=[];for(i&&n(e[0])&&u.push(e[0]),t=i;t<r;t+=2)n(e[s=t])&&u.push(e[s]),n(e[++s])&&u.push(e[s]);for(t=r;t<l;t+=16)n(e[s=t])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]);return u}function y(e,n,l){var t,s,r="";if(e&&e.length)for(l=null==l?",":l,r=e[0][n],t=1,s=e.length;t<s;t++)r+=l+e[t][n];return r}function S(e,n,l,t,s,r,i,u,o,a,c){var f=this;if(f._col=e,f.col=n,f._tbl=l,f.tbl=t,f._dtb=s,f.dtb=r,f._alias=i,f._qualified=o,f.qualified=a,f.full=f.qualified,f._func=null==c?[]:c,f._func.length)for(var p=0,d=f._func.length;p<d;p++)f.full=f._func[p]+"("+f.full+")";null!=f._alias?(f.alias=u,f.aliased=f.full+" AS "+f.alias):(f.alias=f.full,f.aliased=f.full)}function L(e){var n=this;if(!(n instanceof L))return new L(e);if(arguments.length||(e="mysql"),e&&L.aliases[e]&&(e=L.aliases[e]),!e||!L.dialects[e]||!L.dialects[e].clauses)throw new TypeError('Dialect: SQL dialect does not exist for "'+e+'"');n.clau=null,n.clus=null,n.tbls=null,n.cols=null,n.vews={},n.tpls={},n.db=null,n.escdb=null,n.p="",n.type=e,n.clauses=L.dialects[n.type].clauses,n.q=L.dialects[n.type].quotes[0],n.qn=L.dialects[n.type].quotes[1],n.e=L.dialects[n.type].quotes[2]||["",""]}var q="prototype",M="hasOwnProperty",C=Object.keys,D=Object[q].toString,B=Object[q].hasOwnProperty,k="charAt",U="charCodeAt",G=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,F=/^\s+|\s+$/g,j=String[q].trim?function(e){return e.trim()}:function(e){return e.replace(F,"")},H=String.fromCharCode(0);n.GUID=0,l.VERSION="1.0.0",l.defaultArgs=/\$(-?[0-9]+)/g,l.guid=n,l.multisplit=function(e,n,l){var t,s,r,i,u,o,a,c,f,p;l=!!l,o=[[1,e]];for(t in n)if(n.hasOwnProperty(t)){for(c=[],s=l?n[t]:t,r=[0,n[t]],i=0,f=o.length;i<f;i++)if(1===o[i][0]){if(a=o[i][1].split(s),p=a.length,c.push([1,a[0]]),p>1)for(u=0;u<p-1;u++)c.push(r),c.push([1,a[u+1]])}else c.push(o[i]);o=c}return o},l.multisplit_re=function(e,n){n=n.global?n:new RegExp(n.source,n.ignoreCase?"gi":"g");for(var l,t=[],s=0;l=n.exec(e);)t.push([1,e.slice(s,n.lastIndex-l[0].length)]),t.push([0,l[1]?l[1]:l[0]]),s=n.lastIndex;return t.push([1,e.slice(s)]),t},l.arg=function(e,n){var l,t,s,r,i,u="args";if(arguments.length&&null!=e)for(r=(e=e.substr?e.length?e.split("."):[]:[e]).length,i=!(!n||!n.substr),l=0;l<r;l++)s=+(t=e[l]),isNaN(s)?u+='["'+t+'"]':(s<0&&(t=i?n+-s:u+".length-"+-s),u+="["+t+"]");return u},l.compile=function(e,n){var t,s,r,i,u=e.length;if(!0===n){for(i='"use strict"; return (',t=0;t<u;t++)s=e[t][0],r=e[t][1],i+=s?r:l.arg(r);i+=");"}else{for(i='"use strict"; var argslen=args.length; return (',t=0;t<u;t++)s=e[t][0],r=e[t][1],i+=s?"'"+r.replace(SQUOTE,"\\'").replace(NEWLINE,"' + \"\\n\" + '")+"'":" + String("+l.arg(r,"argslen")+") + ";i+=");"}return new Function("args",i)},l[q]={constructor:l,id:null,tpl:null,_parsed:!1,_args:null,_renderer:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e._parsed=null,e._args=null,e._renderer=null,e},fixRenderer:function(){var e=this;return e.render="function"==typeof e._renderer?e._renderer:e.constructor[q].render,e},parse:function(){var e=this;if(!1===e._parsed){e._parsed=!0;var n=e._args[0],t=e._args[1],s=e._args[2];e._args=null,e.tpl=t instanceof RegExp?l.multisplit_re(n,t):l.multisplit(n,t),!0===s&&(e._renderer=l.compile(e.tpl),e.fixRenderer())}return e},render:function(e){var n=this;if(e=e||[],!1===n._parsed&&(n.parse(),n._renderer))return n._renderer(e);var l,t,s,r=n.tpl,i=r.length,u=e.length,o="";for(l=0;l<i;l++)1===(t=r[l])[0]?o+=t[1]:(+(s=t[1])===s&&s<0&&(s=u+s),o+=e[s]);return o}},d.VERSION="3.0.0",d.defaultDelimiters=["<",">","[","]"],d.fnGlobal={},d.subGlobal={},d.guid=n,d.multisplit=function(e,l,s){var i,u,c,f,p,d,_,h,E,T,v,g,I,m,b,N,A,O,R,w,y,S,L,q,M,C,D=l[0],B=l[1],U=l[2],G=l[3],F=D.length,H=B.length,Y=U.length,W=G.length,x="#"+G,P=null,V=0,X=0,K=0,J=0,Q=e.length,$=[D,F,B,H],Z=[U,Y,G,W],z=[null,0,null,0,null,0,null,0];for(s=!0===s,R={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},y=E=new a({type:0,val:"",algn:""}),S=null,w=null,b={},A=null,N={},O=null,$[1]<$[3]&&(v=$[0],$[2]=$[0],$[0]=v,g=$[1],$[3]=$[1],$[1]=g),Z[1]<Z[3]&&(v=Z[0],Z[2]=Z[0],Z[0]=v,g=Z[1],Z[3]=Z[1],Z[1]=g),u=0,c=0,g=0;4>u&&4>c;)$[u+1]<Z[c+1]?(z[g]=Z[c],z[g+1]=Z[c+1],c+=2):(z[g]=$[u],z[g+1]=$[u+1],u+=2),g+=2;for(;4>u;)z[g]=$[u],z[g+1]=$[u+1],u+=2,g+=2;for(;4>c;)z[g]=Z[c],z[g+1]=Z[c+1],c+=2,g+=2;for(_=null,v="",g=0;g<Q;)if("\\"!==(h=e[k](g)))if(C=null,z[0]===e.substr(g,z[1])?C=z[0]:z[2]===e.substr(g,z[3])?C=z[2]:z[4]===e.substr(g,z[5])?C=z[4]:z[6]===e.substr(g,z[7])&&(C=z[6]),D===C)g+=F,v.length&&(0===E.node.type?E.node.val+=v:E=new a({type:0,val:v,algn:""},E)),v="";else if(B===C){if(g+=H,p=v,v="",-1<(d=p.indexOf("|"))?(P=p.slice(d+1),p=p.slice(0,d)):P=null,"?"===(h=s?g<Q?e[k](g):"":p[k](0))||"*"===h)X=1,"*"===h?(u=1,c=-1):(u=0,c=0),s?(g+=1)<Q&&"!"===e[k](g)?(V=1,g+=1):V=0:"!"===p[k](1)?(V=1,p=p.slice(2)):(V=0,p=p.slice(1));else if("{"===h){if(s){for(v="",I=g+1,m=Q;I<m&&"}"!==e[k](I);)v+=e[k](I++);g=I+1}else{for(v="",I=1,m=p.length;I<m&&"}"!==p[k](I);)v+=p[k](I++);p=p.slice(I+1)}(v=v.split(",")).length>1?(u=(u=j(v[0])).length?0|+u:0,c=(c=j(v[1])).length?0|+c:-1,X=1):(c=u=(u=j(v[0])).length?0|+u:0,X=0),v="",V=0}else X=0,V=0,u=0,c=0;if(V&&null===P&&(P=""),"@"===(h=p[k](0))?(K=1,p=p.slice(1)):K=0,"."===(h=p[k](0))?(J=1,p=p.slice(1)):J=0,f=-1<p.indexOf(":")?p.split(":"):[p,null],p=f[0],f=f[1],i=-1<p.indexOf(".")?p.split("."):null,A&&!t(N,A)&&(N[A]={}),":="+U===e.substr(g,2+Y)&&(g+=2,O=f=f&&f.length?f:"grtpl--"+n(),A&&p.length&&(N[A][p]=f)),!p.length)continue;null==f&&A&&t(N,A)&&t(N[A],p)&&(f=N[A][p]),X&&!R.opt?(R.name=p,R.key=i,R.stpl=f,R.dval=P,R.opt=X,R.neg=V,R.algn=K,R.loc=J,R.start=u,R.end=c,w=new o(null,[p,i,V,u,c,X,J])):X?(u!==c&&R.start===R.end&&(R.name=p,R.key=i,R.stpl=f,R.dval=P,R.opt=X,R.neg=V,R.algn=K,R.loc=J,R.start=u,R.end=c),w=new o(w,[p,i,V,u,c,X,J])):X||null!==R.name||(R.name=p,R.key=i,R.stpl=f,R.dval=P,R.opt=0,R.neg=V,R.algn=K,R.loc=J,R.start=u,R.end=c,w=new o(null,[p,i,V,u,c,0,J])),0===E.node.type&&(E.node.algn=r(E.node.val,0,E.node.val.length)),E=new a({type:1,name:p,key:i,stpl:f,dval:P,opt:X,algn:K,loc:J,start:u,end:c},E)}else if(U===C){if(g+=Y,v.length&&(0===E.node.type?E.node.val+=v:E=new a({type:0,val:v,algn:""},E)),v="","#"===e[k](g)){for(I=g+1,m=Q;I<m&&x!==e.substr(I,W+1);)v+=e[k](I++);g=I+W+1,0===E.node.type&&(E.node.algn=r(E.node.val,0,E.node.val.length)),E=new a({type:-100,val:v},E),v="";continue}_=new o(_,[E,S,R,w,A,O]),O&&(A=O),O=null,R={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},w=null,S=E=new a({type:0,val:"",algn:""})}else G===C?(g+=W,T=E,L=S,q=R,M=w,_?(E=_.value[0],S=_.value[1],R=_.value[2],w=_.value[3],A=_.value[4],O=_.value[5],_=_.prev):E=null,v.length&&(0===T.node.type?T.node.val+=v:T=new a({type:0,val:v,algn:""},T)),v="",O?(b[O]=new a({type:2,name:q.name,key:q.key,loc:q.loc,algn:q.algn,start:q.start,end:q.end,opt_args:null,tpl:L}),O=null):(0===E.node.type&&(E.node.algn=r(E.node.val,0,E.node.val.length)),E=new a({type:-1,name:q.name,key:q.key,loc:q.loc,algn:q.algn,start:q.start,end:q.end,opt_args:M,tpl:L},E))):"\n"===(h=e[k](g++))?(v.length&&(0===E.node.type?E.node.val+=v:E=new a({type:0,val:v,algn:""},E)),v="",0===E.node.type&&(E.node.algn=r(E.node.val,0,E.node.val.length)),E=new a({type:100,val:"\n"},E)):v+=h;else v+=g+1<Q?e[k](g+1):"",g+=2;return v.length&&(0===E.node.type?E.node.val+=v:E=new a({type:0,val:v,algn:""},E)),0===E.node.type&&(E.node.algn=r(E.node.val,0,E.node.val.length)),[y,b]},d.align=i,d.main=p,d[q]={constructor:d,id:null,tpl:null,fn:null,_args:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e.fn=null,e._args=null,e},parse:function(){var e=this;return null===e.tpl&&null!==e._args&&(e.tpl=d.multisplit(e._args[0],e._args[1],e._args[2]),e._args=null),e},render:function(e){var n=this;return null===n.tpl&&n.parse(),d.main(null==e?{}:e,n.tpl[0],n.tpl[1],n.fn)}};var Y=/\s/,W=/[0-9]/,x=/[a-z_]/i;S.parse=function(e,n){var l,t,s,r,i,u,o,a,c,f,p,d,_,h,E,T,v,g,I,m,b,N,A,O,R=["AS"];for(t=(e=j(e)).length,l=0,r=(s=[[]])[0],i=[],u=[],o="",a=null,p=0,d=null;l<t;){if('"'===(_=e.charAt(l++))||"`"===_||"'"===_||"["===_||"]"===_){if(!d){if(o.length||"]"===_){a=["invalid",l];break}d="["===_?"]":_;continue}if(d===_){if(!o.length){a=["invalid",l];break}r.unshift([1,o]),i.unshift(o),o="",d=null;continue}if(d){o+=_;continue}}if(d)o+=_;else if("*"===_){if(o.length){a=["invalid",l];break}r.unshift([10,"*"]),i.unshift(10)}else if("."===_){if(o.length&&(r.unshift([1,o]),i.unshift(o),o=""),!r.length||1!==r[0][0]){a=["invalid",l];break}r.unshift([0,"."]),i.unshift(0)}else if("("===_){if(p++,o.length&&(r.unshift([2,o]),u.unshift(o),o=""),!r.length||2!==r[0][0]&&1!==r[0][0]){a=["invalid",l];break}1===r[0][0]&&(r[0][0]=2,u.unshift(i.shift())),s.unshift([]),r=s[0]}else if(")"===_){if(p--,o.length&&(h=-1<R.indexOf(o.toUpperCase()),r.unshift([h?5:1,o]),i.unshift(h?5:o),o=""),s.length<2){a=["invalid",l];break}s[1].unshift([100,s.shift()]),r=s[0]}else{if(Y.test(_)){o.length&&(h=-1<R.indexOf(o.toUpperCase()),r.unshift([h?5:1,o]),i.unshift(h?5:o),o="");continue}if(W.test(_)){if(!o.length){a=["invalid",l];break}o+=_}else{if(!x.test(_)){a=["invalid",l];break}o+=_}}}if(o.length&&(r.unshift([1,o]),i.unshift(o),o=""),!a&&p&&(a=["paren",t]),!a&&d&&(a=["quote",t]),a||1===s.length||(a=["invalid",t]),a)throw c=a[1]-1,"paren"==(f=a[0])?new TypeError('Dialect: Mismatched parentheses "'+e+'" at position '+c+"."):"quote"==f?new TypeError('Dialect: Mismatched quotes "'+e+'" at position '+c+"."):new TypeError('Dialect: Invalid character "'+e+'" at position '+c+".");return b=null,N="",i.length>=3&&5===i[1]&&"string"==typeof i[0]&&(b=i.shift(),N=n.quote_name(b),i.shift()),E=null,T="",!i.length||"string"!=typeof i[0]&&10!==i[0]||(10===i[0]?(i.shift(),E=T="*"):(E=i.shift(),T=n.quote_name(E))),v=null,g="",i.length>=2&&0===i[0]&&"string"==typeof i[1]&&(i.shift(),v=i.shift(),g=n.quote_name(v)),I=null,m="",i.length>=2&&0===i[0]&&"string"==typeof i[1]&&(i.shift(),I=i.shift(),m=n.quote_name(I)),A=(I?I+".":"")+(v?v+".":"")+(E||""),O=(I?m+".":"")+(v?g+".":"")+(E?T:""),new S(E,T,v,g,I,m,b,N,A,O,u)},S[q]={constructor:S,_func:null,_col:null,col:null,_tbl:null,tbl:null,_dtb:null,dtb:null,_alias:null,alias:null,_qualified:null,qualified:null,full:null,aliased:null,cloned:function(e,n,l){var t=this;return arguments.length?n=n||e:(e=t._alias,n=t.alias),null==l&&(l=t._func),new S(t._col,t.col,t._tbl,t.tbl,t._dtb,t.dtb,e,n,t._qualified,t.qualified,l)},dispose:function(){var e=this;return e._func=null,e._col=null,e.col=null,e._tbl=null,e.tbl=null,e._dtb=null,e.dtb=null,e._alias=null,e.alias=null,e._qualified=null,e.qualified=null,e.full=null,e.aliased=null,e}};var P={mysqli:{quotes:[["'","'","\\'","\\'"],["`","`"],["",""]],functions:{strpos:["POSITION(",2," IN ",1,")"],strlen:["LENGTH(",1,")"],strlower:["LCASE(",1,")"],strupper:["UCASE(",1,")"],trim:["TRIM(",1,")"],quote:["QUOTE(",1,")"],random:["RAND()"],now:["NOW()"]},types:{BINARY:"VARBINARY",SMALLINT:"TINYINT",MEDIUMINT:"MEDIUMINT",INT:"UNSIGNED INT",SIGNED_INT:"INT",BIGINT:"UNSIGNED BIGINT",SIGNED_BIGINT:"BIGINT",FLOAT:"FLOAT",DOUBLE:"DOUBLE",BOOL:"TINYINT",TIMESTAMP:"TIMESTAMP",DATETIME:"DATETIME",DATE:"DATE",TIME:"TIME",VARCHAR:"VARCHAR",TEXT:"TEXT",BLOB:"BLOB"},clauses:"[<?transact_clause|>START TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE VIEW <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]UNIQUE KEY <name|> <type|> (<?uniquekey>[,<*uniquekey>])][[CONSTRAINT <?constraint> ]PRIMARY KEY <type|> (<?primarykey>)][[<?!index>KEY][<?index|>INDEX] <name|> <type|> (<?key>[,<*key>])][CHECK (<?check>)][<?column> <type>[ <?!isnull><?isnotnull|>NOT NULL][ <?!isnotnull><?isnull|>NULL][ DEFAULT <?default_value>][ <?auto_increment|>AUTO_INCREMENT][ <?!primary><?unique|>UNIQUE KEY][ <?!unique><?primary|>PRIMARY KEY][ COMMENT '<?comment>'][ COLUMN_FORMAT <?format>][ STORAGE <?storage>]]][,\n<*col:COL>]]\n)][ <?options>:=[<opt:OPT>:=[[ENGINE=<?engine>][AUTO_INCREMENT=<?auto_increment>][CHARACTER SET=<?charset>][COLLATE=<?collation>]][, <*opt:OPT>]]][\nAS <?query>]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>[<?temporary|>TEMPORARY ]TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]][<?delete_clause|>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]]"},postgresql:{quotes:[["E'","'","''","''"],['"','"'],["",""]],functions:{strpos:["position(",2," in ",1,")"],strlen:["length(",1,")"],strlower:["lower(",1,")"],strupper:["upper(",1,")"],trim:["trim(",1,")"],quote:["quote(",1,")"],random:["random()"],now:["now()"]},types:{BINARY:"BYTEA",SMALLINT:"SMALLINT",MEDIUMINT:"INTEGER",INT:"SERIAL",SIGNED_INT:"INTEGER",BIGINT:"BIGSERIAL",SIGNED_BIGINT:"BIGINT",FLOAT:"REAL",DOUBLE:"DOUBLE PRECISION",BOOL:"BOOLEAN",TIMESTAMP:"TIMESTAMP WITHOUT TIME ZONE",DATETIME:"TIMESTAMP WITHOUT TIME ZONE",DATE:"DATE",TIME:"TIME WITHOUT TIME ZONE",VARCHAR:"VARCHAR",TEXT:"TEXT",BLOB:"BLOB"},clauses:"[<?transact_clause|>START TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>:=[<col:COL>:=[[<?column> <type>[ COLLATE <?collation>][ CONSTRAINT <?constraint>][ <?!isnull><?isnotnull|>NOT NULL][ <?!isnotnull><?isnull|>NULL][ DEFAULT <?default_value>][ CHECK (<?check>)][ <?unique|>UNIQUE][ <?primary|>PRIMARY KEY]]][,\n<*col:COL>]]\n)]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]][<?delete_clause|>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]]"},transactsql:{quotes:[["'","'","''","''"],["[","]"],[""," ESCAPE '\\'"]],functions:{strpos:["CHARINDEX(",2,",",1,")"],strlen:["LEN(",1,")"],strlower:["LOWER(",1,")"],strupper:["UPPER(",1,")"],trim:["LTRIM(RTRIM(",1,"))"],quote:["QUOTENAME(",1,',"\'")'],random:["RAND()"],now:["CURRENT_TIMESTAMP"]},types:{BINARY:"VARBINARY",SMALLINT:"TINYINT",MEDIUMINT:"SMALLINT",INT:"INT",SIGNED_INT:"INT",BIGINT:"BIGINT",SIGNED_BIGINT:"BIGINT",FLOAT:"FLOAT",DOUBLE:"REAL",BOOL:"BIT",TIMESTAMP:"DATETIME",DATETIME:"DATETIME",DATE:"DATE",TIME:"TIME",VARCHAR:"VARCHAR",TEXT:"TEXT",BLOB:"TEXT"},clauses:"[<?transact_clause|>BEGIN TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>[<?ifnotexists|>IF NOT EXISTS (SELECT * FROM sysobjects WHERE name=<create_table> AND xtype='U')\n]CREATE TABLE <create_table> [<?!query>(\n<columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]<?column> <type|>[ <?isnotnull|>NOT NULL][ [CONSTRAINT <?constraint> ]DEFAULT <?default_value>][ CHECK (<?check>)][ <?!primary><?unique|>UNIQUE][ <?!unique><?primary|>PRIMARY KEY[ COLLATE <?collation>]]]][,\n<*col:COL>]]\n)][<?ifnotexists|>\nGO]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>][\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]][<?!order_conditions>[\nORDER BY 1\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]][<?delete_clause|>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]]"},sqlite:{quotes:[["'","'","''","''"],['"','"'],[""," ESCAPE '\\'"]],functions:{strpos:["instr(",2,",",1,")"],strlen:["length(",1,")"],strlower:["lower(",1,")"],strupper:["upper(",1,")"],trim:["trim(",1,")"],quote:["quote(",1,")"],random:["random()"],now:["datetime('now')"]},types:{BINARY:"BLOB",SMALLINT:"INTEGER",MEDIUMINT:"INTEGER",INT:"INTEGER",SIGNED_INT:"INTEGER",BIGINT:"INTEGER",SIGNED_BIGINT:"INTEGER",FLOAT:"REAL",DOUBLE:"REAL",BOOL:"INTEGER",TIMESTAMP:"TEXT",DATETIME:"TEXT",DATE:"TEXT",TIME:"TEXT",VARCHAR:"TEXT",TEXT:"TEXT",BLOB:"BLOB"},clauses:"[<?transact_clause|>BEGIN <type|> TRANSACTION;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [<?!query>(\n<columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]<?column> <type|>[ <?isnotnull|>NOT NULL][ DEFAULT <?default_value>][ CHECK (<?check>)][ <?!primary><?unique|>UNIQUE][ <?!unique><?primary|>PRIMARY KEY[ <?auto_increment|>AUTOINCREMENT][ COLLATE <?collation>]]]][,\n<*col:COL>]]\n)[ <?without_rowid|>WITHOUT ROWID]][AS <?query>]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>]][<?delete_clause|>[<?!order_conditions><?!count>DELETE FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]][DELETE FROM <from_tables> [, <*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]\nORDER BY <?order_conditions> [, <*order_conditions>][\nLIMIT <?count> OFFSET <offset|0>]\n)][<?!order_conditions>DELETE FROM <from_tables> [, <*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]\nLIMIT <?count> OFFSET <offset|0>\n)]]"}},V={mysql:"mysqli",sqlserver:"transactsql",postgres:"postgresql"};return L.VERSION="0.8.4",L.dialects=P,L.aliases=V,L.StringTemplate=l,L.GrammarTemplate=d,L.Ref=S,L[q]={constructor:L,clau:null,clus:null,tbls:null,cols:null,vews:null,tpls:null,db:null,escdb:null,p:null,type:null,clauses:null,q:null,qn:null,e:null,dispose:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e.vews=null,e.tpls=null,e.db=null,e.escdb=null,e.p=null,e.type=null,e.clauses=null,e.q=null,e.qn=null,e.e=null,e},toString:function(){return this.sql()||""},driver:function(e){var n=this;return arguments.length?(n.db=e||null,n):n.db},escape:function(e){var n=this;return arguments.length?(n.escdb=e&&E(e)?e:null,n):n.escdb},prefix:function(e){var n=this;return arguments.length?(n.p=e&&e.length?e:"",n):n.p},reset:function(e){var n=this;return n.clus={},n.tbls={},n.cols={},n.clau=e,n.clauses instanceof L.GrammarTemplate||(n.clauses=new L.GrammarTemplate(n.clauses)),n},clear:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e},subquery:function(){var e,n=this;return(e=new L(n.type)).driver(n.driver()).escape(n.escape()).prefix(n.prefix()),e.vews=n.vews,e},sql:function(){var e=this,n=null;return e.clau&&(e.clus[M]("select_columns")&&(e.clus.select_columns=y(e.clus.select_columns,"aliased")),e.clus[M]("from_tables")&&(e.clus.from_tables=y(e.clus.from_tables,"aliased")),e.clus[M]("insert_tables")&&(e.clus.insert_tables=y(e.clus.insert_tables,"aliased")),e.clus[M]("insert_columns")&&(e.clus.insert_columns=y(e.clus.insert_columns,"full")),e.clus[M]("update_tables")&&(e.clus.update_tables=y(e.clus.update_tables,"aliased")),e.clus[M]("create_table")&&(e.clus.create_table=y(e.clus.create_table,"full")),e.clus[M]("alter_table")&&(e.clus.alter_table=y(e.clus.alter_table,"full")),e.clus[M]("drop_tables")&&(e.clus.drop_tables=y(e.clus.drop_tables,"full")),e.clus[M]("where_conditions_required")&&(e.clus.where_conditions=e.clus[M]("where_conditions")?"("+e.clus.where_conditions_required+") AND ("+e.clus.where_conditions+")":e.clus.where_conditions_required,delete e.clus.where_conditions_required),e.clus[M]("having_conditions_required")&&(e.clus.having_conditions=e.clus[M]("having_conditions")?"("+e.clus.having_conditions_required+") AND ("+e.clus.having_conditions+")":e.clus.having_conditions_required,delete e.clus.having_conditions_required),e.clus[e.clau+"_clause"]=1,n=e.clauses.render(e.clus)||""),e.clear(),n},createView:function(e){var n=this;return e&&n.clau&&(n.vews[e]={clau:n.clau,clus:n.clus,tbls:n.tbls,cols:n.cols},n.vews[e].clus[M]("where_conditions")&&(n.vews[e].clus.where_conditions&&(n.vews[e].clus.where_conditions_required=n.vews[e].clus.where_conditions),delete n.vews[e].clus.where_conditions),n.vews[e].clus[M]("having_conditions")&&(n.vews[e].clus.having_conditions&&(n.vews[e].clus.having_conditions_required=n.vews[e].clus.having_conditions),delete n.vews[e].clus.having_conditions),n.clear()),n},useView:function(e){var n,l,t=this;if(n=t.clus.select_columns,e=t.vews[e],t.clus=O(t.clus,e.clus,!0,!0),t.tbls=O({},e.tbls,!0),t.cols=O({},e.cols,!0),n){l=[];for(var s=0,r=(n=t.refs(n,t.cols,!0)).length;s<r;s++)"*"===n[s].full?l=l.concat(t.clus.select_columns):l.push(n[s]);t.clus.select_columns=l}return t},dropView:function(e){var n=this;return e&&n.vews[M](e)&&delete n.vews[e],n},prepareTpl:function(e){var n,l,t,s,r,i,u,o,a=this;return I(e)||(1===(s=(t=arguments).length)?(r=null,i=null,u=null,o=!0):2===s?(r=t[1],i=null,u=null,o=!1):3===s?(r=null,i=t[1],u=t[2],o=!0):(r=t[1],i=t[2],u=t[3],o=!1),n=_((i=i?h(i):"%")+"(([rlfds]:)?[0-9a-zA-Z_]+)"+(u=u?h(u):"%")),l=o?new L.StringTemplate(a.sql(),n):new L.StringTemplate(r,n),a.tpls[e]={sql:l,types:null}),a},prepared:function(e,n){var l,t,s,r,i,u,o,a,c,f=this;if(!I(e)&&f.tpls[M](e)){if(l=f.tpls[e].sql,null===(t=f.tpls[e].types)){for(l.parse(),t={},u=0,o=l.tpl.length;u<o;u++)0===(a=l.tpl[u])[0]&&((c=a[1].split(":")).length>1?(t[c[1]]=c[0],l.tpl[u][1]=c[1]):(t[c[0]]="s",l.tpl[u][1]=c[0]));f.tpls[e].types=t}s={};for(c in n)if(n[M](c))switch(r=n[c],t[M](c)?t[c]:"s"){case"r":v(r)?s[c]=r.join(","):s[c]=r;break;case"l":s[c]=f.like(r);break;case"f":if(v(r))for(i=N(r),s[c]=S.parse(i[0],f).aliased,u=1,o=i.length;u<o;u++)s[c]+=","+S.parse(i[u],f).aliased;else s[c]=S.parse(r,f).aliased;break;case"d":v(r)?s[c]=f.intval(N(r)).join(","):s[c]=f.intval(r);break;case"s":default:v(r)?s[c]=f.quote(N(r)).join(","):s[c]=f.quote(r)}return l.render(s)}return""},prepare:function(e,n,l,t){var s,r,i,u,o,a,c,f,p,d=this;if(e&&n){for(s=_((l=l?h(l):"%")+"([rlfds]:)?([0-9a-zA-Z_]+)"+(t=t?h(t):"%")),p="";e.length&&(r=e.match(s));){if(i=r.index,u=r[0].length,f=r[2],n[M](f)){switch(r[1]?r[1].slice(0,-1):"s"){case"r":f=v(n[f])?n[f].join(","):n[f];break;case"l":f=d.like(n[f]);break;case"f":if(v(n[f]))for(c=N(n[f]),f=S.parse(c[0],d).aliased,o=1,a=c.length;o<a;o++)f+=","+S.parse(c[o],d).aliased;else f=S.parse(n[f],d).aliased;break;case"d":f=v(n[f])?d.intval(N(n[f])).join(","):d.intval(n[f]);break;case"s":default:f=v(n[f])?d.quote(N(n[f])).join(","):d.quote(n[f])}p+=e.slice(0,i)+f}else p+=e.slice(0,i)+d.quote("");e=e.slice(i+u)}return e.length&&(p+=e),p}return e},dropTpl:function(e){var n=this;return!I(e)&&n.tpls[M](e)&&(n.tpls[e].sql.dispose(),delete n.tpls[e]),n},Transaction:function(e,n){var l,t=this;return n=n||"transact",t.clau!==n&&t.reset(n),e=e||{},t.clus.type=e.type||null,t.clus.rollback=e.rollback?1:null,I(e.statements)||(l=N(l),t.clus.statements?t.clus.statements=t.clus.statements.concat(l):t.clus.statements=l),t},Create:function(e,n,l){var t,s,r=this;return l=l||"create",r.clau!==l&&r.reset(l),n=n||{ifnotexists:1},r.clus.create_table=r.refs(e,r.tbls),r.clus.view=n.view?1:null,r.clus.ifnotexists=n.ifnotexists?1:null,r.clus.temporary=n.temporary?1:null,r.clus.query=I(n.query)?null:n.query,I(n.columns)||(t=N(n.columns),r.clus.columns?r.clus.columns=r.clus.columns.concat(t):r.clus.columns=t),I(n.table)||(s=N(n.table),r.clus.options?r.clus.options=r.clus.options.concat(s):r.clus.options=s),r},Alter:function(e,n,l){var t,s,r=this;return l=l||"alter",r.clau!==l&&r.reset(l),r.clus.alter_table=r.refs(e,r.tbls),n=n||{},r.clus.view=n.view?1:null,I(n.columns)||(t=N(n.columns),r.clus.columns?r.clus.columns=r.clus.columns.concat(t):r.clus.columns=t),I(n.table)||(s=N(n.table),r.clus.options?r.clus.options=r.clus.options.concat(s):r.clus.options=s),r},Drop:function(e,n,l){var t,s=this;return l=l||"drop",s.clau!==l&&s.reset(l),t=v(e)?e[0]:e,s.vews[M](t)?(s.dropView(t),s):(e=s.refs(null==e?"*":e,s.tbls),n=n||{ifexists:1},s.clus.view=n.view?1:null,s.clus.ifexists=n.ifexists?1:null,s.clus.temporary=n.temporary?1:null,s.clus.drop_tables?s.clus.drop_tables=s.clus.drop_tables.concat(e):s.clus.drop_tables=e,s)},Select:function(e,n){var l=this;return n=n||"select",l.clau!==n&&l.reset(n),e=l.refs(null==e?"*":e,l.cols),l.clus.select_columns?l.clus.select_columns=l.clus.select_columns.concat(e):l.clus.select_columns=e,l},Insert:function(e,n,l){var t,s=this;return l=l||"insert",s.clau!==l&&s.reset(l),t=v(e)?e[0]:e,s.vews[M](t)&&s.clau===s.vews[t].clau?s.useView(t):(e=s.refs(e,s.tbls),n=s.refs(n,s.cols),s.clus.insert_tables?s.clus.insert_tables=s.clus.insert_tables.concat(e):s.clus.insert_tables=e,s.clus.insert_columns?s.clus.insert_columns=s.clus.insert_columns.concat(n):s.clus.insert_columns=n),s},Values:function(n){var l,t,s,r,i,u,o,a,c=this;if(I(n))return c;for(e!==n[0]&&v(n[0])||(n=[n]),l=n.length,t=[],r=0;r<l;r++)if((a=N(n[r])).length){for(s=[],u=0,o=a.length;u<o;u++)g(i=a[u])?i[M]("integer")?s.push(c.intval(i.integer)):i[M]("raw")?s.push(i.raw):i[M]("string")&&s.push(c.quote(i.string)):s.push(b(i)?i:c.quote(i));t.push("("+s.join(",")+")")}return t=t.join(","),c.clus.values_values&&(t=c.clus.values_values+","+t),c.clus.values_values=t,c},Update:function(e,n){var l,t=this;return n=n||"update",t.clau!==n&&t.reset(n),l=v(e)?e[0]:e,t.vews[M](l)&&t.clau===t.vews[l].clau?t.useView(l):(e=t.refs(e,t.tbls),t.clus.update_tables?t.clus.update_tables=t.clus.update_tables.concat(e):t.clus.update_tables=e),t},Set:function(e){var n,l,t,s,r,i,u=this;if(I(e))return u;n=[],i=u.cols;for(t in e)if(e[M](t))if(s=u.refs(t,i)[0].full,r=e[t],g(r)){if(r[M]("integer"))n.push(s+" = "+u.intval(r.integer));else if(r[M]("raw"))n.push(s+" = "+r.raw);else if(r[M]("string"))n.push(s+" = "+u.quote(r.string));else if(r[M]("increment"))n.push(s+" = "+s+" + "+u.intval(r.increment));else if(r[M]("decrement"))n.push(s+" = "+s+" - "+u.intval(r.increment));else if(r[M]("case")){if(l=s+" = CASE",r.case[M]("when")){for(case_value in r.case.when)r.case.when[M](case_value)&&(l+="\nWHEN "+u.conditions(r.case.when[case_value],!1)+" THEN "+u.quote(case_value));r.case[M]("else")&&(l+="\nELSE "+u.quote(r.case.else))}else for(case_value in r.case)r.case[M](case_value)&&(l+="\nWHEN "+u.conditions(r.case[case_value],!1)+" THEN "+u.quote(case_value));l+="\nEND",n.push(l)}}else n.push(s+" = "+(b(r)?r:u.quote(r)));return n=n.join(","),u.clus.set_values&&(n=u.clus.set_values+","+n),u.clus.set_values=n,u},Delete:function(e){var n=this;return e=e||"delete",n.clau!==e&&n.reset(e),n},From:function(e){var n,e,l=this;return I(e)?l:(n=v(e)?e[0]:e,l.vews[M](n)&&l.clau===l.vews[n].clau?l.useView(n):(e=l.refs(e,l.tbls),l.clus.from_tables?l.clus.from_tables=l.clus.from_tables.concat(e):l.clus.from_tables=e),l)},Join:function(e,n,l){var t,s,r,i=this;if(e=i.refs(e,i.tbls)[0].aliased,l=I(l)?null:l.toUpperCase(),I(n))t={table:e,type:l};else{if(T(n))n="("+(n=i.refs(n.split("="),i.cols))[0].full+"="+n[1].full+")";else{for(s in n)n[M](s)&&(g(r=n[s])||(n[s]={eq:r,type:"identifier"}));n="("+i.conditions(n,!1)+")"}t={table:e,type:l,cond:n}}return i.clus.join_clauses?i.clus.join_clauses.push(t):i.clus.join_clauses=[t],i},Where:function(e,n){var l=this;return I(e)?l:("OR"!==(n=n?n.toUpperCase():"AND")&&(n="AND"),e=l.conditions(e,!1),l.clus.where_conditions&&(e=l.clus.where_conditions+" "+n+" "+e),l.clus.where_conditions=e,l)},Group:function(e,n){var l,t=this;return"DESC"!==(n=n?n.toUpperCase():"ASC")&&(n="ASC"),l=t.refs(e,t.cols)[0].alias+" "+n,t.clus.group_conditions&&(l=t.clus.group_conditions+","+l),t.clus.group_conditions=l,t},Having:function(e,n){var l=this;return I(e)?l:("OR"!==(n=n?n.toUpperCase():"AND")&&(n="AND"),e=l.conditions(e,!0),l.clus.having_conditions&&(e=l.clus.having_conditions+" "+n+" "+e),l.clus.having_conditions=e,l)},Order:function(e,n){var l,t=this;return"DESC"!==(n=n?n.toUpperCase():"ASC")&&(n="ASC"),l=t.refs(e,t.cols)[0].alias+" "+n,t.clus.order_conditions&&(l=t.clus.order_conditions+","+l),t.clus.order_conditions=l,t},Limit:function(e,n){var l=this;return l.clus.count=m(e),l.clus.offset=m(n),l},Page:function(e,n){var l=this;return e=m(e),n=m(n),l.Limit(n,e*n)},conditions:function(e,n){var l,t,s,r,i,u,o,a,c,f,p,d,_,h=this;if(I(e))return"";if(T(e))return e;l="",t=[],f=h.cols,u=!0===n?"alias":"full";for(s in e)if(e[M](s))if(i=e[s],g(i)){if(i[M]("raw")){t.push(String(i.raw));continue}if(i[M]("or")){p=[];for(var E=0,v=i.or.length;E<v;E++)d=i.or[E],p.push(h.conditions(d,n));t.push(p.join(" OR "));continue}if(i[M]("and")){p=[];for(var E=0,v=i.and.length;E<v;E++)d=i.and[E],p.push(h.conditions(d,n));t.push(p.join(" AND "));continue}if(i[M]("either")){p=[];for(var E=0,v=i.either.length;E<v;E++)(d={})[s]=i.either[E],p.push(h.conditions(d,n));t.push(p.join(" OR "));continue}if(i[M]("together")){p=[];for(var E=0,v=i.together.length;E<v;E++)(d={})[s]=i.together[E],p.push(h.conditions(d,n));t.push(p.join(" AND "));continue}if(r=h.refs(s,f)[0][u],a=i[M]("type")?i.type:"string",i[M]("case")){if(p=r+" = CASE",i.case[M]("when")){for(_ in i.case.when)i.case.when[M](_)&&(p+=" WHEN "+h.conditions(i.case.when[_],n)+" THEN "+h.quote(_));i.case[M]("else")&&(p+=" ELSE "+h.quote(i.case.else))}else for(_ in i.case)i.case[M](_)&&(p+=" WHEN "+h.conditions(i.case[_],n)+" THEN "+h.quote(_));p+=" END",t.push(p)}else i[M]("multi_like")?t.push(h.multi_like(r,i.multi_like)):i[M]("like")?t.push(r+" LIKE "+("raw"===a?i.like:h.like(i.like))):i[M]("not_like")?t.push(r+" NOT LIKE "+("raw"===a?i.not_like:h.like(i.not_like))):i[M]("contains")?(c=String(i.contains),"raw"===a||(c=h.quote(c)),t.push(h.sql_function("strpos",[r,c])+" > 0")):i[M]("not_contains")?(c=String(i.not_contains),"raw"===a||(c=h.quote(c)),t.push(h.sql_function("strpos",[r,c])+" = 0")):i[M]("in")?(c=N(i.in),"raw"===a||(c="integer"===a||b(c[0])?h.intval(c):h.quote(c)),t.push(r+" IN ("+c.join(",")+")")):i[M]("not_in")?(c=N(i.not_in),"raw"===a||(c="integer"===a||b(c[0])?h.intval(c):h.quote(c)),t.push(r+" NOT IN ("+c.join(",")+")")):i[M]("between")?null==(c=N(i.between))[0]?("raw"===a||("integer"===a||b(c[1])?c[1]=h.intval(c[1]):c[1]=h.quote(c[1])),t.push(r+" <= "+c[1])):null==c[1]?("raw"===a||("integer"===a||b(c[0])?c[0]=h.intval(c[0]):c[0]=h.quote(c[0])),t.push(r+" >= "+c[0])):("raw"===a||(c="integer"===a||b(c[0])&&b(c[1])?h.intval(c):h.quote(c)),t.push(r+" BETWEEN "+c[0]+" AND "+c[1])):i[M]("not_between")?null==(c=N(i.not_between))[0]?("raw"===a||("integer"===a||b(c[1])?c[1]=h.intval(c[1]):c[1]=h.quote(c[1])),t.push(r+" > "+c[1])):null==c[1]?("raw"===a||("integer"===a||b(c[0])?c[0]=h.intval(c[0]):c[0]=h.quote(c[0])),t.push(r+" < "+c[0])):("raw"===a||(c="integer"===a||b(c[0])&&b(c[1])?h.intval(c):h.quote(c)),t.push(r+" < "+c[0]+" OR "+r+" > "+c[1])):i[M]("gt")||i[M]("gte")?(c=i[o=i[M]("gt")?"gt":"gte"],"raw"===a||(c="integer"===a||b(c)?h.intval(c):"identifier"===a||"field"===a?h.refs(c,f)[0][u]:h.quote(c)),t.push(r+("gt"===o?" > ":" >= ")+c)):i[M]("lt")||i[M]("lte")?(c=i[o=i[M]("lt")?"lt":"lte"],"raw"===a||(c="integer"===a||b(c)?h.intval(c):"identifier"===a||"field"===a?h.refs(c,f)[0][u]:h.quote(c)),t.push(r+("lt"===o?" < ":" <= ")+c)):i[M]("not_equal")||i[M]("not_eq")?(c=i[o=i[M]("not_eq")?"not_eq":"not_equal"],"raw"===a||(c="integer"===a||b(c)?h.intval(c):"identifier"===a||"field"===a?h.refs(c,f)[0][u]:h.quote(c)),t.push(r+" <> "+c)):(i[M]("equal")||i[M]("eq"))&&(c=i[o=i[M]("eq")?"eq":"equal"],"raw"===a||(c="integer"===a||b(c)?h.intval(c):"identifier"===a||"field"===a?h.refs(c,f)[0][u]:h.quote(c)),t.push(r+" = "+c))}else r=h.refs(s,f)[0][u],t.push(r+" = "+(b(i)?i:h.quote(i)));return t.length&&(l="("+t.join(") AND (")+")"),l},joinConditions:function(e,n){var l,t,s,r,i,u,o,a,c,f,p=this,d=0;for(l in n)n[M](l)&&(t=S.parse(l,p)._col,e[M](t)&&(s=n[l],i=e[t].table,u=e[t].id,o=e[t].join,a=e[t].join_id,c=o+ ++d,r={},e[t][M]("key")&&t!==e[t].key?r[c+"."+(f=e[t].key)]=t:f=t,e[t][M]("value")?r[c+"."+e[t].value]=s:r[c+"."+f]=s,p.Join(o+" AS "+c,i+"."+u+"="+c+"."+a,"inner").Where(r),delete n[l]));return p},refs:function(e,n,l){var t=this;if(!0===l){var s,r,i;for(u=0,o=e.length;u<o;u++)_=(d=e[u]).alias,h=d.qualified,"*"!==(r=d.full)&&(n[M](_)?e[u]=n[_]:n[M](r)?(i=(s=n[r]).alias,s.full!==r&&i!==_&&i===r&&(s=s.cloned(d.alias),e[u]=n[_]=s)):n[M](h)?((s=n[h]).qualified!==h&&(s=n[s.qualified]),s=d.full!==d.alias?s.cloned(d.alias,null,d._func):s.cloned(null,s.alias,d._func),e[u]=n[s.alias]=s,s.alias===s.full||n[M](s.full)||(n[s.full]=s)):(n[_]=d,_===r||n[M](r)||(n[r]=d)))}else{var u,o,a,c,f,p,d,_,h;for(p=N(e),e=[],u=0,o=p.length;u<o;u++)for(a=0,c=(f=p[u].split(",")).length;a<c;a++)_=(d=S.parse(f[a],t)).alias,h=d.full,n[M](_)?d=n[_]:(n[_]=d,h===_||n[M](h)||(n[h]=d)),e.push(d)}return e},tbl:function(e){var n=this;if(v(e)){for(var l=0,t=e.length;l<t;l++)e[l]=n.tbl(e[l]);return e}return n.p+e},intval:function(e){var n=this;if(v(e)){for(var l=0,t=e.length;l<t;l++)e[l]=n.intval(e[l]);return e}return parseInt(e,10)},quote_name:function(e,n){var l=this,t=l.qn;if(n=!0===n,v(e)){for(var s=0,r=e.length;s<r;s++)e[s]=l.quote_name(e[s],n);return e}return n?(t[0]==e.slice(0,t[0].length)?"":t[0])+e+(t[1]==e.slice(-t[1].length)?"":t[1]):t[0]+e+t[1]},quote:function(e){var n=this,l=n.q;if(v(e)){for(var t=0,s=e.length;t<s;t++)e[t]=n.quote(e[t]);return e}return l[0]+n.esc(e)+l[1]},like:function(e){var n,l,t=this;if(v(e)){for(var s=0,r=e.length;s<r;s++)e[s]=t.like(e[s]);return e}return n=t.q,(l=t.escdb?["",""]:t.e)[0]+n[0]+"%"+t.esc_like(t.esc(e))+"%"+n[1]+l[1]},multi_like:function(e,n,l){var t,s,r,i,u,o,a,c=this;for(l=!1!==l,t=e+" LIKE ",s=n.split(","),l&&(s=w(R(s,j),Boolean)),i=0,u=s.length;i<u;i++){for(r=s[i].split("+"),l&&(r=w(R(r,j),Boolean)),o=0,a=r.length;o<a;o++)r[o]=t+c.like(r[o]);s[i]="("+r.join(" AND ")+")"}return s.join(" OR ")},esc:function(e){var n,l,t,s,r,i,u,o=this;if(v(e)){for(t=0,s=e.length;t<s;t++)e[t]=o.esc(e[t]);return e}if(o.escdb)return o.escdb(e);for(u=o.q,n="\\"+H,l="\\",r="",t=0,s=(e=String(e)).length;t<s;t++)i=e.charAt(t),u[0]===i?r+=u[2]:u[1]===i?r+=u[3]:r+=A(i,n,l);return r},esc_like:function(e){var n=this;if(v(e)){for(var l=0,t=e.length;l<t;l++)e[l]=n.esc_like(e[l]);return e}return A(e,"_%","\\")},sql_function:function(e,n){var l,t,s,r,i,u,o=this;if(null==L.dialects[o.type].functions[e])throw new TypeError('Dialect: SQL function "'+e+'" does not exist for dialect "'+o.type+'"');for(e=L.dialects[o.type].functions[e],u=(n=null!=n?N(n):[]).length,l="",t=!1,s=0,r=e.length;s<r;s++)i=e[s],l+=t?0<i&&u>=i?n[i-1]:"":i,t=!t;return l},sql_type:function(e){var n=this;if(e=String(e).toUpperCase(),null==L.dialects[n.type].types[e])throw new TypeError('Dialect: SQL type "'+e+'" does not exist for dialect "'+n.type+'"');return L.dialects[n.type].types[e]}},L});