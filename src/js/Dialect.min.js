/**
*   Dialect, 
*   a simple and flexible Cross-Platform SQL Builder for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 0.8.2
*   https://github.com/foo123/Dialect
*
*   Abstract the construction of SQL queries
*   Support multiple DB vendors
*   Intuitive and Flexible API
**/
!function(e,n,l){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.$deps=e.$deps||{})&&(e.EXPORTED_SYMBOLS=[n])&&(e[n]=e.$deps[n]=l.call(e)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=l.call(e)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(n,[],function(t){t(n,l.call(e))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return l.moduleUri=n.uri,l.call(e)}):n in e||(e[n]=l.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[n]})}(this,"Dialect",function(e){"use strict";function n(){return n.GUID+=1,s((new Date).getTime().toString(16),12)+"--"+s(n.GUID.toString(16),4)}function l(e,n,t){var s=this;return s instanceof l?(s.id=null,s.tpl=null,s._renderer=null,s._args=[e||"",n||l.defaultArgs,t],void(s._parsed=!1)):new l(e,n,t)}function t(e,n){return e&&U.call(e,n)?1:0}function s(e,n,l,t){var s=String(e);if(l=l||"0",t)for(;s.length<n;)s+=l;else for(;s.length<n;)s=l+s;return s}function i(e,n,l){for(var t,s="";l>n&&(t=e[j](n)," "===t||"\r"===t||"	"===t||"\x0B"===t||"\x00"===t);)s+=t,n+=1;return s}function r(e,n){var l,t,s,i=e.length;if(i&&n.length)for(l="",s=0;i>s;s++)t=e[j](s),l+=t,"\n"===t&&(l+=n);else l=e;return l}function u(e,n,l,t){var s,i,r,u,o=0;if(n)for(s=e,i=n.length,r=0,o=1;i>r;){if(u=n[r++],null==s||null==s[u]){o=0;break}s=s[u]}if(!o&&l)for(s=e,i=l.length,r=0,o=1;i>r;){if(u=l[r++],null==s||null==s[u]){o=0;break}s=s[u]}if(!o&&null!=t&&t!==e){if(n)for(s=t,i=n.length,r=0,o=1;i>r;){if(u=n[r++],null==s||null==s[u]){o=0;break}s=s[u]}if(!o&&l)for(s=t,i=l.length,r=0,o=1;i>r;){if(u=l[r++],null==s||null==s[u]){o=0;break}s=s[u]}}return o?s:null}function o(e,n){this.prev=e||null,this.value=n||null}function a(e,n){n&&(n.next=this),this.node=e||null,this.prev=n||null,this.next=null}function c(e,l,s){var r,u,c,f,d,p,_,h,v,g,E,m,b,w,T,O,y,R,q,A,I,N,S,L,C,k,D=l[0],M=l[1],U=l[2],F=l[3],x=D.length,W=M.length,H=U.length,Y=F.length,P="\\",G="?",V="*",K="!",X="|",J="#",Q=":=",$="{",z="}",Z=".",ee=":",ne="@",le=J+F,te=null,se=0,ie=0,re=0,ue=0,oe=e.length,ae=[D,x,M,W],ce=[U,H,F,Y],fe=[null,0,null,0,null,0,null,0];for(s=!0===s,v=new a({type:0,val:"",algn:""}),q={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},I=v,N=null,A=null,T={},y=null,O={},R=null,ae[1]<ae[3]&&(E=ae[0],ae[2]=ae[0],ae[0]=E,m=ae[1],ae[3]=ae[1],ae[1]=m),ce[1]<ce[3]&&(E=ce[0],ce[2]=ce[0],ce[0]=E,m=ce[1],ce[3]=ce[1],ce[1]=m),u=0,c=0,m=0;4>u&&4>c;)ae[u+1]<ce[c+1]?(fe[m]=ce[c],fe[m+1]=ce[c+1],c+=2):(fe[m]=ae[u],fe[m+1]=ae[u+1],u+=2),m+=2;for(;4>u;)fe[m]=ae[u],fe[m+1]=ae[u+1],u+=2,m+=2;for(;4>c;)fe[m]=ce[c],fe[m+1]=ce[c+1],c+=2,m+=2;for(_=null,E="",m=0;oe>m;)if(h=e[j](m),P!==h)if(k=null,fe[0]===e.substr(m,fe[1])?k=fe[0]:fe[2]===e.substr(m,fe[3])?k=fe[2]:fe[4]===e.substr(m,fe[5])?k=fe[4]:fe[6]===e.substr(m,fe[7])&&(k=fe[6]),D===k)m+=x,E.length&&(0===v.node.type?v.node.val+=E:v=new a({type:0,val:E,algn:""},v)),E="";else if(M===k){if(m+=W,d=E,E="",-1<(p=d.indexOf(X))?(te=d.slice(p+1),d=d.slice(0,p)):te=null,h=s?oe>m?e[j](m):"":d[j](0),G===h||V===h)ie=1,V===h?(u=1,c=-1):(u=0,c=0),s?(m+=1,oe>m&&K===e[j](m)?(se=1,m+=1):se=0):K===d[j](1)?(se=1,d=d.slice(2)):(se=0,d=d.slice(1));else if($===h){if(s){for(E="",b=m+1,w=oe;w>b&&z!==e[j](b);)E+=e[j](b++);m=b+1}else{for(E="",b=1,w=d.length;w>b&&z!==d[j](b);)E+=d[j](b++);d=d.slice(b+1)}E=E.split(","),E.length>1?(u=B(E[0]),u=u.length?0|+u:0,c=B(E[1]),c=c.length?0|+c:-1,ie=1):(u=B(E[0]),u=u.length?0|+u:0,c=u,ie=0),E="",se=0}else ie=0,se=0,u=0,c=0;if(se&&null===te&&(te=""),h=d[j](0),ne===h?(re=1,d=d.slice(1)):re=0,h=d[j](0),Z===h?(ue=1,d=d.slice(1)):ue=0,f=-1<d.indexOf(ee)?d.split(ee):[d,null],d=f[0],f=f[1],r=-1<d.indexOf(Z)?d.split(Z):null,y&&!t(O,y)&&(O[y]={}),Q+U===e.substr(m,2+H)&&(m+=2,f=f&&f.length?f:"grtpl--"+n(),R=f,y&&d.length&&(O[y][d]=f)),!d.length)continue;null==f&&y&&t(O,y)&&t(O[y],d)&&(f=O[y][d]),ie&&!q.opt?(q.name=d,q.key=r,q.stpl=f,q.dval=te,q.opt=ie,q.neg=se,q.algn=re,q.loc=ue,q.start=u,q.end=c,A=new o(null,[d,r,se,u,c,ie,ue])):ie?(u!==c&&q.start===q.end&&(q.name=d,q.key=r,q.stpl=f,q.dval=te,q.opt=ie,q.neg=se,q.algn=re,q.loc=ue,q.start=u,q.end=c),A=new o(A,[d,r,se,u,c,ie,ue])):ie||null!==q.name||(q.name=d,q.key=r,q.stpl=f,q.dval=te,q.opt=0,q.neg=se,q.algn=re,q.loc=ue,q.start=u,q.end=c,A=new o(null,[d,r,se,u,c,0,ue])),0===v.node.type&&(v.node.algn=i(v.node.val,0,v.node.val.length)),v=new a({type:1,name:d,key:r,stpl:f,dval:te,opt:ie,algn:re,loc:ue,start:u,end:c},v)}else if(U===k){if(m+=H,E.length&&(0===v.node.type?v.node.val+=E:v=new a({type:0,val:E,algn:""},v)),E="",J===e[j](m)){for(b=m+1,w=oe;w>b&&le!==e.substr(b,Y+1);)E+=e[j](b++);m=b+Y+1,0===v.node.type&&(v.node.algn=i(v.node.val,0,v.node.val.length)),v=new a({type:-100,val:E},v),E="";continue}_=new o(_,[v,N,q,A,y,R]),R&&(y=R),R=null,q={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},A=null,v=new a({type:0,val:"",algn:""}),N=v}else F===k?(m+=Y,g=v,S=N,L=q,C=A,_?(v=_.value[0],N=_.value[1],q=_.value[2],A=_.value[3],y=_.value[4],R=_.value[5],_=_.prev):v=null,E.length&&(0===g.node.type?g.node.val+=E:g=new a({type:0,val:E,algn:""},g)),E="",R?(T[R]=new a({type:2,name:L.name,key:L.key,loc:L.loc,algn:L.algn,start:L.start,end:L.end,opt_args:null,tpl:S}),R=null):(0===v.node.type&&(v.node.algn=i(v.node.val,0,v.node.val.length)),v=new a({type:-1,name:L.name,key:L.key,loc:L.loc,algn:L.algn,start:L.start,end:L.end,opt_args:C,tpl:S},v))):(h=e[j](m++),"\n"===h?(E.length&&(0===v.node.type?v.node.val+=E:v=new a({type:0,val:E,algn:""},v)),E="",0===v.node.type&&(v.node.algn=i(v.node.val,0,v.node.val.length)),v=new a({type:100,val:"\n"},v)):E+=h);else E+=oe>m+1?e[j](m+1):"",m+=2;return E.length&&(0===v.node.type?v.node.val+=E:v=new a({type:0,val:E,algn:""},v)),0===v.node.type&&(v.node.algn=i(v.node.val,0,v.node.val.length)),[I,T]}function f(e,n,l,t,s,i,r){var o,a,c,f,d,_,h,v,g=null,E="";if(-1===n.type){if(o=n.opt_args,o&&o.value[5])for(;o;){if(a=o.value,c=u(e,a[1],[String(a[0])],a[6]?null:r),null===g&&n.name===a[0]&&(g=c),0===a[2]&&null==c||1===a[2]&&null!=c)return"";o=o.prev}}else g=u(e,n.key,[String(n.name)],n.loc?null:r);if(f=m(g),v=f?g.length:-1,f&&v>n.start)for(d=n.start,_=-1===n.end?v-1:Math.min(n.end,v-1),h=d;_>=h;h++)E+=p(e,n.tpl,l,t,h,i,r);else f||n.start!==n.end||(E=p(e,n.tpl,l,t,null,i,r));return E}function d(e,n,l,s,i,o,a){var c,d,p,h,v="";if(n.stpl&&(t(l,n.stpl)||t(_.subGlobal,n.stpl)||t(s,n.stpl)||t(s,"*")||t(_.fnGlobal,n.stpl)||t(_.fnGlobal,"*")))if(c=u(e,n.key,[String(n.name)],n.loc?null:a),t(l,n.stpl)||t(_.subGlobal,n.stpl))null==i||0===i&&n.start===n.end&&n.opt||!m(c)||(c=i<c.length?c[i]:null),null==c&&null!==n.dval?v=n.dval:(p=t(l,n.stpl)?l[n.stpl].node:_.subGlobal[n.stpl].node,d={},null!=c&&(m(c)?d[p.name]=c:d=c),v=f(d,p,l,s,null,n.algn?o:"",null==a?e:a));else{if(h=null,t(s,n.stpl)?h=s[n.stpl]:t(s,"*")?h=s["*"]:t(_.fnGlobal,n.stpl)?h=_.fnGlobal[n.stpl]:_.fnGlobal["*"]&&(h=_.fnGlobal["*"]),m(c)&&(i=null!=i?i:n.start,c=i<c.length?c[i]:null),"function"==typeof h){var g={symbol:n,index:i,currentArguments:e,originalArguments:a,alignment:o};c=h(c,g)}else c=String(h);v=null==c&&null!==n.dval?n.dval:String(c),n.algn&&(v=r(v,o))}else n.opt&&null!==n.dval?v=n.dval:(c=u(e,n.key,[String(n.name)],n.loc?null:a),m(c)&&(i=null!=i?i:n.start,c=i<c.length?c[i]:null),v=null==c&&null!==n.dval?n.dval:String(c),n.algn&&(v=r(v,o)));return v}function p(e,n,l,t,s,i,r){i=i||"";for(var u,o=i,a="";n;)u=n.node.type,-1===u?a+=f(e,n.node,l,t,s,n.node.algn?o:i,r):1===u?a+=d(e,n.node,l,t,s,n.node.algn?o:i,r):0===u?(o+=n.node.algn,a+=n.node.val):100===u&&(o=i,a+="\n"+i),n=n.next;return a}function _(e,n,l){var t=this;return t instanceof _?(t.id=null,t.tpl=null,t.fn={},void(t._args=[e||"",n||_.defaultDelimiters,l||!1])):new _(e,n,l)}function h(e,n){return new RegExp(e,n||"")}function v(e){return e.replace(x,"\\$&")}function g(e){return"function"==typeof e}function E(e){return e instanceof String||"[object String]"===M.call(e)}function m(e){return e instanceof Array||"[object Array]"===M.call(e)}function b(e){return e instanceof Object||"[object Object]"===M.call(e)}function w(e){if(!e)return!0;var n=M.call(e);return(e instanceof Array||e instanceof String||"[object Array]"===n||"[object String]"===n)&&!e.length?!0:(e instanceof Object||"[object Array]"===n)&&!D(e).length}function T(e){return parseInt(e||0,10)||0}function O(e){return e===+e&&isFinite(e)&&!(e%1)}function y(e){return m(e)?e:[e]}function R(e,n,l){var t,s,i,r="";for(3>arguments.length&&(l="\\"),2>arguments.length&&(n="\\\"'"+H),t=0,s=e.length;s>t;t++)i=e[j](t),r+=-1===n.indexOf(i)?i:0===i[F](0)?"\\0":l+i;return r}function q(e,n,l,t){l=!0===l,t=!0===t;for(var s in n)n[k](s)&&(!l&&e[k](s)||(e[s]=t&&n[s].slice?n[s].slice():n[s]));return e}function A(e,n){var l=e.length;if(!l)return[];var t,s,i=15&l,r=1&i,u=new Array(l);for(r&&(u[0]=n(e[0])),t=r;i>t;t+=2)s=t,u[t]=n(e[s]),u[t+1]=n(e[s+1]);for(t=i;l>t;t+=16)s=t,u[t]=n(e[s]),u[t+1]=n(e[s+1]),u[t+2]=n(e[s+2]),u[t+3]=n(e[s+3]),u[t+4]=n(e[s+4]),u[t+5]=n(e[s+5]),u[t+6]=n(e[s+6]),u[t+7]=n(e[s+7]),u[t+8]=n(e[s+8]),u[t+9]=n(e[s+9]),u[t+10]=n(e[s+10]),u[t+11]=n(e[s+11]),u[t+12]=n(e[s+12]),u[t+13]=n(e[s+13]),u[t+14]=n(e[s+14]),u[t+15]=n(e[s+15]);return u}function I(e,n){var l=e.length;if(!l)return[];var t,s,i=15&l,r=1&i,u=[];for(r&&n(e[0])&&u.push(e[0]),t=r;i>t;t+=2)s=t,n(e[s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]);for(t=i;l>t;t+=16)s=t,n(e[s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]);return u}function N(e,n,l){var t,s,i="";if(e&&e.length)for(l=null==l?",":l,i=e[0][n],t=1,s=e.length;s>t;t++)i+=l+e[t][n];return i}function S(e,n,l,t,s,i,r,u,o,a,c){var f=this;if(f._col=e,f.col=n,f._tbl=l,f.tbl=t,f._dtb=s,f.dtb=i,f._alias=r,f._qualified=o,f.qualified=a,f.full=f.qualified,f._func=null==c?[]:c,f._func.length)for(var d=0,p=f._func.length;p>d;d++)f.full=f._func[d]+"("+f.full+")";null!=f._alias?(f.alias=u,f.aliased=f.full+" AS "+f.alias):(f.alias=f.full,f.aliased=f.full)}function L(e){var n=this;if(!(n instanceof L))return new L(e);if(arguments.length||(e="mysql"),e&&L.aliases[e]&&(e=L.aliases[e]),!e||!L.dialects[e]||!L.dialects[e].clauses)throw new TypeError('Dialect: SQL dialect does not exist for "'+e+'"');n.clau=null,n.clus=null,n.tbls=null,n.cols=null,n.vews={},n.tpls={},n.db=null,n.escdb=null,n.p="",n.type=e,n.clauses=L.dialects[n.type].clauses,n.q=L.dialects[n.type].quotes[0],n.qn=L.dialects[n.type].quotes[1],n.e=L.dialects[n.type].quotes[2]||["",""]}var C="prototype",k="hasOwnProperty",D=Object.keys,M=Object[C].toString,U=Object[C].hasOwnProperty,j="charAt",F="charCodeAt",x=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,W=/^\s+|\s+$/g,B=String[C].trim?function(e){return e.trim()}:function(e){return e.replace(W,"")},H=String.fromCharCode(0);n.GUID=0,l.VERSION="1.0.0",l.defaultArgs=/\$(-?[0-9]+)/g,l.guid=n,l.multisplit=function(e,n,l){var t,s,i,r,u,o,a,c,f,d;l=!!l,o=[[1,e]];for(t in n)if(n.hasOwnProperty(t)){for(c=[],s=l?n[t]:t,i=[0,n[t]],r=0,f=o.length;f>r;r++)if(1===o[r][0]){if(a=o[r][1].split(s),d=a.length,c.push([1,a[0]]),d>1)for(u=0;d-1>u;u++)c.push(i),c.push([1,a[u+1]])}else c.push(o[r]);o=c}return o},l.multisplit_re=function(e,n){n=n.global?n:new RegExp(n.source,n.ignoreCase?"gi":"g");for(var l,t=[],s=0;l=n.exec(e);)t.push([1,e.slice(s,n.lastIndex-l[0].length)]),t.push([0,l[1]?l[1]:l[0]]),s=n.lastIndex;return t.push([1,e.slice(s)]),t},l.arg=function(e,n){var l,t,s,i,r,u="args";if(arguments.length&&null!=e)for(e=e.substr?e.length?e.split("."):[]:[e],i=e.length,r=!(!n||!n.substr),l=0;i>l;l++)t=e[l],s=+t,isNaN(s)?u+='["'+t+'"]':(0>s&&(t=r?n+-s:u+".length-"+-s),u+="["+t+"]");return u},l.compile=function(e,n){var t,s,i,r,u=e.length;if(!0===n){for(r='"use strict"; return (',t=0;u>t;t++)s=e[t][0],i=e[t][1],r+=s?i:l.arg(i);r+=");"}else{for(r='"use strict"; var argslen=args.length; return (',t=0;u>t;t++)s=e[t][0],i=e[t][1],r+=s?"'"+i.replace(SQUOTE,"\\'").replace(NEWLINE,"' + \"\\n\" + '")+"'":" + String("+l.arg(i,"argslen")+") + ";r+=");"}return new Function("args",r)},l[C]={constructor:l,id:null,tpl:null,_parsed:!1,_args:null,_renderer:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e._parsed=null,e._args=null,e._renderer=null,e},fixRenderer:function(){var e=this;return e.render="function"==typeof e._renderer?e._renderer:e.constructor[C].render,e},parse:function(){var e=this;if(!1===e._parsed){e._parsed=!0;var n=e._args[0],t=e._args[1],s=e._args[2];e._args=null,e.tpl=t instanceof RegExp?l.multisplit_re(n,t):l.multisplit(n,t),!0===s&&(e._renderer=l.compile(e.tpl),e.fixRenderer())}return e},render:function(e){var n=this;if(e=e||[],!1===n._parsed&&(n.parse(),n._renderer))return n._renderer(e);var l,t,s,i=n.tpl,r=i.length,u=e.length,o="";for(l=0;r>l;l++)t=i[l],1===t[0]?o+=t[1]:(s=t[1],+s===s&&0>s&&(s=u+s),o+=e[s]);return o}},_.VERSION="3.0.0",_.defaultDelimiters=["<",">","[","]"],_.fnGlobal={},_.subGlobal={},_.guid=n,_.multisplit=c,_.align=r,_.main=p,_[C]={constructor:_,id:null,tpl:null,fn:null,_args:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e.fn=null,e._args=null,e},parse:function(){var e=this;return null===e.tpl&&null!==e._args&&(e.tpl=_.multisplit(e._args[0],e._args[1],e._args[2]),e._args=null),e},render:function(e){var n=this;return null===n.tpl&&n.parse(),_.main(null==e?{}:e,n.tpl[0],n.tpl[1],n.fn)}};var Y=/\s/,P=/[0-9]/,G=/[a-z_]/i;S.parse=function(e,n){var l,t,s,i,r,u,o,a,c,f,d,p,_,h,v,g,E,m,b,w,T,O,y,R,q=["AS"];for(e=B(e),t=e.length,l=0,s=[[]],i=s[0],r=[],u=[],o="",a=null,d=0,p=null;t>l;){if(_=e.charAt(l++),'"'===_||"`"===_||"'"===_||"["===_||"]"===_){if(!p){if(o.length||"]"===_){a=["invalid",l];break}p="["===_?"]":_;continue}if(p===_){if(!o.length){a=["invalid",l];break}i.unshift([1,o]),r.unshift(o),o="",p=null;continue}if(p){o+=_;continue}}if(p)o+=_;else if("*"===_){if(o.length){a=["invalid",l];break}i.unshift([10,"*"]),r.unshift(10)}else if("."===_){if(o.length&&(i.unshift([1,o]),r.unshift(o),o=""),!i.length||1!==i[0][0]){a=["invalid",l];break}i.unshift([0,"."]),r.unshift(0)}else if("("===_){if(d++,o.length&&(i.unshift([2,o]),u.unshift(o),o=""),!i.length||2!==i[0][0]&&1!==i[0][0]){a=["invalid",l];break}1===i[0][0]&&(i[0][0]=2,u.unshift(r.shift())),s.unshift([]),i=s[0]}else if(")"===_){if(d--,o.length&&(h=-1<q.indexOf(o.toUpperCase()),i.unshift([h?5:1,o]),r.unshift(h?5:o),o=""),s.length<2){a=["invalid",l];break}s[1].unshift([100,s.shift()]),i=s[0]}else{if(Y.test(_)){o.length&&(h=-1<q.indexOf(o.toUpperCase()),i.unshift([h?5:1,o]),r.unshift(h?5:o),o="");continue}if(P.test(_)){if(!o.length){a=["invalid",l];break}o+=_}else{if(!G.test(_)){a=["invalid",l];break}o+=_}}}if(o.length&&(i.unshift([1,o]),r.unshift(o),o=""),!a&&d&&(a=["paren",t]),!a&&p&&(a=["quote",t]),a||1===s.length||(a=["invalid",t]),a)throw c=a[1]-1,f=a[0],"paren"==f?new TypeError('Dialect: Mismatched parentheses "'+e+'" at position '+c+"."):"quote"==f?new TypeError('Dialect: Mismatched quotes "'+e+'" at position '+c+"."):new TypeError('Dialect: Invalid character "'+e+'" at position '+c+".");return T=null,O="",r.length>=3&&5===r[1]&&"string"==typeof r[0]&&(T=r.shift(),O=n.quote_name(T),r.shift()),v=null,g="",!r.length||"string"!=typeof r[0]&&10!==r[0]||(10===r[0]?(r.shift(),v=g="*"):(v=r.shift(),g=n.quote_name(v))),E=null,m="",r.length>=2&&0===r[0]&&"string"==typeof r[1]&&(r.shift(),E=r.shift(),m=n.quote_name(E)),b=null,w="",r.length>=2&&0===r[0]&&"string"==typeof r[1]&&(r.shift(),b=r.shift(),w=n.quote_name(b)),y=(b?b+".":"")+(E?E+".":"")+(v?v:""),R=(b?w+".":"")+(E?m+".":"")+(v?g:""),new S(v,g,E,m,b,w,T,O,y,R,u)},S[C]={constructor:S,_func:null,_col:null,col:null,_tbl:null,tbl:null,_dtb:null,dtb:null,_alias:null,alias:null,_qualified:null,qualified:null,full:null,aliased:null,cloned:function(e,n,l){var t=this;return arguments.length?n=n||e:(e=t._alias,n=t.alias),null==l&&(l=t._func),new S(t._col,t.col,t._tbl,t.tbl,t._dtb,t.dtb,e,n,t._qualified,t.qualified,l)},dispose:function(){var e=this;return e._func=null,e._col=null,e.col=null,e._tbl=null,e.tbl=null,e._dtb=null,e.dtb=null,e._alias=null,e.alias=null,e._qualified=null,e.qualified=null,e.full=null,e.aliased=null,e}};var V={mysqli:{quotes:[["'","'","\\'","\\'"],["`","`"],["",""]],functions:{strpos:["POSITION(",2," IN ",1,")"],strlen:["LENGTH(",1,")"],strlower:["LCASE(",1,")"],strupper:["UCASE(",1,")"],trim:["TRIM(",1,")"],quote:["QUOTE(",1,")"],random:["RAND()"],now:["NOW()"]},clauses:"[<?transact_clause|>START TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE VIEW <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]UNIQUE KEY <name|> <type|> (<?uniquekey>[,<*uniquekey>])][[CONSTRAINT <?constraint> ]PRIMARY KEY <type|> (<?primarykey>)][[<?!index>KEY][<?index|>INDEX] <name|> <type|> (<?key>[,<*key>])][CHECK (<?check>)][<?column> <type>[ <?!isnull><?isnotnull|>NOT NULL][ <?!isnotnull><?isnull|>NULL][ DEFAULT <?default_value>][ <?auto_increment|>AUTO_INCREMENT][ <?!primary><?unique|>UNIQUE KEY][ <?!unique><?primary|>PRIMARY KEY][ COMMENT '<?comment>'][ COLUMN_FORMAT <?format>][ STORAGE <?storage>]]][,\n<*col:COL>]]\n)][ <?options>:=[<opt:OPT>:=[[ENGINE=<?engine>][AUTO_INCREMENT=<?auto_increment>][CHARACTER SET=<?charset>][COLLATE=<?collation>]][, <*opt:OPT>]]][\nAS <?query>]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>[<?temporary|>TEMPORARY ]TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]][<?delete_clause|>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]]"},postgres:{quotes:[["E'","'","''","''"],['"','"'],["",""]],functions:{strpos:["position(",2," in ",1,")"],strlen:["length(",1,")"],strlower:["lower(",1,")"],strupper:["upper(",1,")"],trim:["trim(",1,")"],quote:["quote(",1,")"],random:["random()"],now:["now()"]},clauses:"[<?transact_clause|>START TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>:=[<col:COL>:=[[<?column> <type>[ COLLATE <?collation>][ CONSTRAINT <?constraint>][ <?!isnull><?isnotnull|>NOT NULL][ <?!isnotnull><?isnull|>NULL][ DEFAULT <?default_value>][ CHECK (<?check>)][ <?unique|>UNIQUE][ <?primary|>PRIMARY KEY]]][,\n<*col:COL>]]\n)]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]][<?delete_clause|>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]]"},transactsql:{quotes:[["'","'","''","''"],["[","]"],[""," ESCAPE '\\'"]],functions:{strpos:["CHARINDEX(",2,",",1,")"],strlen:["LEN(",1,")"],strlower:["LOWER(",1,")"],strupper:["UPPER(",1,")"],trim:["LTRIM(RTRIM(",1,"))"],quote:["QUOTENAME(",1,',"\'")'],random:["RAND()"],now:["CURRENT_TIMESTAMP"]},clauses:"[<?transact_clause|>BEGIN TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>[<?ifnotexists|>IF NOT EXISTS (SELECT * FROM sysobjects WHERE name=<create_table> AND xtype='U')\n]CREATE TABLE <create_table> [<?!query>(\n<columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]<?column> <type|>[ <?isnotnull|>NOT NULL][ [CONSTRAINT <?constraint> ]DEFAULT <?default_value>][ CHECK (<?check>)][ <?!primary><?unique|>UNIQUE][ <?!unique><?primary|>PRIMARY KEY[ COLLATE <?collation>]]]][,\n<*col:COL>]]\n)][<?ifnotexists|>\nGO]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>][\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]][<?!order_conditions>[\nORDER BY 1\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]][<?delete_clause|>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]]"},sqlite:{quotes:[["'","'","''","''"],['"','"'],[""," ESCAPE '\\'"]],functions:{strpos:["instr(",2,",",1,")"],strlen:["length(",1,")"],strlower:["lower(",1,")"],strupper:["upper(",1,")"],trim:["trim(",1,")"],quote:["quote(",1,")"],random:["random()"],now:["datetime('now')"]},clauses:"[<?transact_clause|>BEGIN <type|> TRANSACTION;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [<?!query>(\n<columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]<?column> <type|>[ <?isnotnull|>NOT NULL][ DEFAULT <?default_value>][ CHECK (<?check>)][ <?!primary><?unique|>UNIQUE][ <?!unique><?primary|>PRIMARY KEY[ <?auto_increment|>AUTOINCREMENT][ COLLATE <?collation>]]]][,\n<*col:COL>]]\n)[ <?without_rowid|>WITHOUT ROWID]][AS <?query>]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>]][<?delete_clause|>[<?!order_conditions><?!count>DELETE FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]][DELETE FROM <from_tables> [, <*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]\nORDER BY <?order_conditions> [, <*order_conditions>][\nLIMIT <?count> OFFSET <offset|0>]\n)][<?!order_conditions>DELETE FROM <from_tables> [, <*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]\nLIMIT <?count> OFFSET <offset|0>\n)]]"}},K={mysql:"mysqli",sqlserver:"transactsql"};return L.VERSION="0.8.2",L.dialects=V,L.aliases=K,L.StringTemplate=l,L.GrammarTemplate=_,L.Ref=S,L[C]={constructor:L,clau:null,clus:null,tbls:null,cols:null,vews:null,tpls:null,db:null,escdb:null,p:null,type:null,clauses:null,q:null,qn:null,e:null,dispose:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e.vews=null,e.tpls=null,e.db=null,e.escdb=null,e.p=null,e.type=null,e.clauses=null,e.q=null,e.qn=null,e.e=null,e},toString:function(){return this.sql()||""},driver:function(e){var n=this;return arguments.length?(n.db=e?e:null,n):n.db},escape:function(e){var n=this;return arguments.length?(n.escdb=e&&g(e)?e:null,n):n.escdb},prefix:function(e){var n=this;return arguments.length?(n.p=e&&e.length?e:"",n):n.p},reset:function(e){var n=this;return n.clus={},n.tbls={},n.cols={},n.clau=e,n.clauses instanceof L.GrammarTemplate||(n.clauses=new L.GrammarTemplate(n.clauses)),n},clear:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e},subquery:function(){var e,n=this;return e=new L(n.type),e.driver(n.driver()).escape(n.escape()).prefix(n.prefix()),e.vews=n.vews,e},sql:function(){var e=this,n=null;return e.clau&&(e.clus[k]("select_columns")&&(e.clus.select_columns=N(e.clus.select_columns,"aliased")),e.clus[k]("from_tables")&&(e.clus.from_tables=N(e.clus.from_tables,"aliased")),e.clus[k]("insert_tables")&&(e.clus.insert_tables=N(e.clus.insert_tables,"aliased")),e.clus[k]("insert_columns")&&(e.clus.insert_columns=N(e.clus.insert_columns,"full")),e.clus[k]("update_tables")&&(e.clus.update_tables=N(e.clus.update_tables,"aliased")),e.clus[k]("create_table")&&(e.clus.create_table=N(e.clus.create_table,"full")),e.clus[k]("alter_table")&&(e.clus.alter_table=N(e.clus.alter_table,"full")),e.clus[k]("drop_tables")&&(e.clus.drop_tables=N(e.clus.drop_tables,"full")),e.clus[k]("where_conditions_required")&&(e.clus.where_conditions=e.clus[k]("where_conditions")?"("+e.clus.where_conditions_required+") AND ("+e.clus.where_conditions+")":e.clus.where_conditions_required,delete e.clus.where_conditions_required),e.clus[k]("having_conditions_required")&&(e.clus.having_conditions=e.clus[k]("having_conditions")?"("+e.clus.having_conditions_required+") AND ("+e.clus.having_conditions+")":e.clus.having_conditions_required,delete e.clus.having_conditions_required),e.clus[e.clau+"_clause"]=1,n=e.clauses.render(e.clus)||""),e.clear(),n},createView:function(e){var n=this;return e&&n.clau&&(n.vews[e]={clau:n.clau,clus:n.clus,tbls:n.tbls,cols:n.cols},n.vews[e].clus[k]("where_conditions")&&(n.vews[e].clus.where_conditions&&(n.vews[e].clus.where_conditions_required=n.vews[e].clus.where_conditions),delete n.vews[e].clus.where_conditions),n.vews[e].clus[k]("having_conditions")&&(n.vews[e].clus.having_conditions&&(n.vews[e].clus.having_conditions_required=n.vews[e].clus.having_conditions),delete n.vews[e].clus.having_conditions),n.clear()),n},useView:function(e){var n,l,t=this;if(n=t.clus.select_columns,e=t.vews[e],t.clus=q(t.clus,e.clus,!0,!0),t.tbls=q({},e.tbls,!0),t.cols=q({},e.cols,!0),n){n=t.refs(n,t.cols,!0),l=[];for(var s=0,i=n.length;i>s;s++)"*"===n[s].full?l=l.concat(t.clus.select_columns):l.push(n[s]);t.clus.select_columns=l}return t},dropView:function(e){var n=this;return e&&n.vews[k](e)&&delete n.vews[e],n},prepareTpl:function(e){var n,l,t,s,i,r,u,o,a=this;return w(e)||(t=arguments,s=t.length,1===s?(i=null,r=null,u=null,o=!0):2===s?(i=t[1],r=null,u=null,o=!1):3===s?(i=null,r=t[1],u=t[2],o=!0):(i=t[1],r=t[2],u=t[3],o=!1),r=r?v(r):"%",u=u?v(u):"%",n=h(r+"(([rlfds]:)?[0-9a-zA-Z_]+)"+u),l=o?new L.StringTemplate(a.sql(),n):new L.StringTemplate(i,n),a.tpls[e]={sql:l,types:null}),a},prepared:function(e,n){var l,t,s,i,r,u,o,a,c,f,r,d=this;if(!w(e)&&d.tpls[k](e)){if(l=d.tpls[e].sql,t=d.tpls[e].types,null===t){for(l.parse(),t={},a=0,c=l.tpl.length;c>a;a++)f=l.tpl[a],0===f[0]&&(r=f[1].split(":"),r.length>1?(t[r[1]]=r[0],l.tpl[a][1]=r[1]):(t[r[0]]="s",l.tpl[a][1]=r[0]));d.tpls[e].types=t}i={};for(r in n)if(n[k](r))switch(u=n[r],s=t[k](r)?t[r]:"s"){case"r":m(u)?i[r]=u.join(","):i[r]=u;break;case"l":i[r]=d.like(u);break;case"f":if(m(u))for(o=y(u),i[r]=S.parse(o[0],d).aliased,a=1,c=o.length;c>a;a++)i[r]+=","+S.parse(o[a],d).aliased;else i[r]=S.parse(u,d).aliased;break;case"d":m(u)?i[r]=d.intval(y(u)).join(","):i[r]=d.intval(u);break;case"s":default:m(u)?i[r]=d.quote(y(u)).join(","):i[r]=d.quote(u)}return l.render(i)}return""},prepare:function(e,n,l,t){var s,i,r,u,o,a,c,f,d,p,_=this;if(e&&n){for(l=l?v(l):"%",t=t?v(t):"%",s=h(l+"([rlfds]:)?([0-9a-zA-Z_]+)"+t),p="";e.length&&(i=e.match(s));){if(r=i.index,u=i[0].length,f=i[2],n[k](f)){switch(d=i[1]?i[1].slice(0,-1):"s"){case"r":f=m(n[f])?n[f].join(","):n[f];break;case"l":f=_.like(n[f]);break;case"f":if(m(n[f]))for(c=y(n[f]),f=S.parse(c[0],_).aliased,o=1,a=c.length;a>o;o++)f+=","+S.parse(c[o],_).aliased;else f=S.parse(n[f],_).aliased;break;case"d":f=m(n[f])?_.intval(y(n[f])).join(","):_.intval(n[f]);break;case"s":default:f=m(n[f])?_.quote(y(n[f])).join(","):_.quote(n[f])}p+=e.slice(0,r)+f}else p+=e.slice(0,r)+_.quote("");e=e.slice(r+u)}return e.length&&(p+=e),p}return e},dropTpl:function(e){var n=this;return!w(e)&&n.tpls[k](e)&&(n.tpls[e].sql.dispose(),delete n.tpls[e]),n},Transaction:function(e,n){var l,t=this;return n=n||"transact",t.clau!==n&&t.reset(n),e=e||{},t.clus.type=e.type||null,t.clus.rollback=e.rollback?1:null,w(e.statements)||(l=y(l),t.clus.statements?t.clus.statements=t.clus.statements.concat(l):t.clus.statements=l),t},Create:function(e,n,l){var t,s,i=this;return l=l||"create",i.clau!==l&&i.reset(l),n=n||{ifnotexists:1},i.clus.create_table=i.refs(e,i.tbls),i.clus.view=n.view?1:null,i.clus.ifnotexists=n.ifnotexists?1:null,i.clus.temporary=n.temporary?1:null,i.clus.query=w(n.query)?null:n.query,w(n.columns)||(t=y(n.columns),i.clus.columns?i.clus.columns=i.clus.columns.concat(t):i.clus.columns=t),w(n.table)||(s=y(n.table),i.clus.options?i.clus.options=i.clus.options.concat(s):i.clus.options=s),i},Alter:function(e,n,l){var t,s,i=this;return l=l||"alter",i.clau!==l&&i.reset(l),i.clus.alter_table=i.refs(e,i.tbls),n=n||{},i.clus.view=n.view?1:null,w(n.columns)||(t=y(n.columns),i.clus.columns?i.clus.columns=i.clus.columns.concat(t):i.clus.columns=t),w(n.table)||(s=y(n.table),i.clus.options?i.clus.options=i.clus.options.concat(s):i.clus.options=s),i},Drop:function(e,n,l){
var t,s=this;return l=l||"drop",s.clau!==l&&s.reset(l),t=m(e)?e[0]:e,s.vews[k](t)?(s.dropView(t),s):(e=s.refs(null==e?"*":e,s.tbls),n=n||{ifexists:1},s.clus.view=n.view?1:null,s.clus.ifexists=n.ifexists?1:null,s.clus.temporary=n.temporary?1:null,s.clus.drop_tables?s.clus.drop_tables=s.clus.drop_tables.concat(e):s.clus.drop_tables=e,s)},Select:function(e,n){var l=this;return n=n||"select",l.clau!==n&&l.reset(n),e=l.refs(null==e?"*":e,l.cols),l.clus.select_columns?l.clus.select_columns=l.clus.select_columns.concat(e):l.clus.select_columns=e,l},Insert:function(e,n,l){var t,s=this;return l=l||"insert",s.clau!==l&&s.reset(l),t=m(e)?e[0]:e,s.vews[k](t)&&s.clau===s.vews[t].clau?s.useView(t):(e=s.refs(e,s.tbls),n=s.refs(n,s.cols),s.clus.insert_tables?s.clus.insert_tables=s.clus.insert_tables.concat(e):s.clus.insert_tables=e,s.clus.insert_columns?s.clus.insert_columns=s.clus.insert_columns.concat(n):s.clus.insert_columns=n),s},Values:function(n){var l,t,s,i,r,u,o,a,c=this;if(w(n))return c;for(e!==n[0]&&m(n[0])||(n=[n]),l=n.length,t=[],i=0;l>i;i++)if(a=y(n[i]),a.length){for(s=[],u=0,o=a.length;o>u;u++)r=a[u],b(r)?r[k]("integer")?s.push(c.intval(r.integer)):r[k]("raw")?s.push(r.raw):r[k]("string")&&s.push(c.quote(r.string)):s.push(O(r)?r:c.quote(r));t.push("("+s.join(",")+")")}return t=t.join(","),c.clus.values_values&&(t=c.clus.values_values+","+t),c.clus.values_values=t,c},Update:function(e,n){var l,t=this;return n=n||"update",t.clau!==n&&t.reset(n),l=m(e)?e[0]:e,t.vews[k](l)&&t.clau===t.vews[l].clau?t.useView(l):(e=t.refs(e,t.tbls),t.clus.update_tables?t.clus.update_tables=t.clus.update_tables.concat(e):t.clus.update_tables=e),t},Set:function(e){var n,l,t,s,i,r,u=this;if(w(e))return u;n=[],r=u.cols;for(t in e)if(e[k](t))if(s=u.refs(t,r)[0].full,i=e[t],b(i)){if(i[k]("integer"))n.push(s+" = "+u.intval(i.integer));else if(i[k]("raw"))n.push(s+" = "+i.raw);else if(i[k]("string"))n.push(s+" = "+u.quote(i.string));else if(i[k]("increment"))n.push(s+" = "+s+" + "+u.intval(i.increment));else if(i[k]("decrement"))n.push(s+" = "+s+" - "+u.intval(i.increment));else if(i[k]("case")){if(l=s+" = CASE",i["case"][k]("when")){for(case_value in i["case"].when)i["case"].when[k](case_value)&&(l+="\nWHEN "+u.conditions(i["case"].when[case_value],!1)+" THEN "+u.quote(case_value));i["case"][k]("else")&&(l+="\nELSE "+u.quote(i["case"]["else"]))}else for(case_value in i["case"])i["case"][k](case_value)&&(l+="\nWHEN "+u.conditions(i["case"][case_value],!1)+" THEN "+u.quote(case_value));l+="\nEND",n.push(l)}}else n.push(s+" = "+(O(i)?i:u.quote(i)));return n=n.join(","),u.clus.set_values&&(n=u.clus.set_values+","+n),u.clus.set_values=n,u},Delete:function(e){var n=this;return e=e||"delete",n.clau!==e&&n.reset(e),n},From:function(e){var n,e,l=this;return w(e)?l:(n=m(e)?e[0]:e,l.vews[k](n)&&l.clau===l.vews[n].clau?l.useView(n):(e=l.refs(e,l.tbls),l.clus.from_tables?l.clus.from_tables=l.clus.from_tables.concat(e):l.clus.from_tables=e),l)},Join:function(e,n,l){var t,s,i,r=this;if(e=r.refs(e,r.tbls)[0].aliased,l=w(l)?null:l.toUpperCase(),w(n))t={table:e,type:l};else{if(E(n))n=r.refs(n.split("="),r.cols),n="("+n[0].full+"="+n[1].full+")";else{for(s in n)n[k](s)&&(i=n[s],b(i)||(n[s]={eq:i,type:"identifier"}));n="("+r.conditions(n,!1)+")"}t={table:e,type:l,cond:n}}return r.clus.join_clauses?r.clus.join_clauses.push(t):r.clus.join_clauses=[t],r},Where:function(e,n){var l=this;return w(e)?l:(n=n?n.toUpperCase():"AND","OR"!==n&&(n="AND"),e=l.conditions(e,!1),l.clus.where_conditions&&(e=l.clus.where_conditions+" "+n+" "+e),l.clus.where_conditions=e,l)},Group:function(e,n){var l,t=this;return n=n?n.toUpperCase():"ASC","DESC"!==n&&(n="ASC"),l=t.refs(e,t.cols)[0].alias+" "+n,t.clus.group_conditions&&(l=t.clus.group_conditions+","+l),t.clus.group_conditions=l,t},Having:function(e,n){var l=this;return w(e)?l:(n=n?n.toUpperCase():"AND","OR"!==n&&(n="AND"),e=l.conditions(e,!0),l.clus.having_conditions&&(e=l.clus.having_conditions+" "+n+" "+e),l.clus.having_conditions=e,l)},Order:function(e,n){var l,t=this;return n=n?n.toUpperCase():"ASC","DESC"!==n&&(n="ASC"),l=t.refs(e,t.cols)[0].alias+" "+n,t.clus.order_conditions&&(l=t.clus.order_conditions+","+l),t.clus.order_conditions=l,t},Limit:function(e,n){var l=this;return l.clus.count=T(e),l.clus.offset=T(n),l},Page:function(e,n){var l=this;return e=T(e),n=T(n),l.Limit(n,e*n)},conditions:function(e,n){var l,t,s,i,r,u,o,a,c,f,d,p,_,h=this;if(w(e))return"";if(E(e))return e;l="",t=[],f=h.cols,u=!0===n?"alias":"full";for(s in e)if(e[k](s))if(r=e[s],b(r)){if(r[k]("raw")){t.push(String(r.raw));continue}if(r[k]("or")){d=[];for(var v=0,g=r.or.length;g>v;v++)p=r.or[v],d.push(h.conditions(p,n));t.push(d.join(" OR "));continue}if(r[k]("and")){d=[];for(var v=0,g=r.and.length;g>v;v++)p=r.and[v],d.push(h.conditions(p,n));t.push(d.join(" AND "));continue}if(r[k]("either")){d=[];for(var v=0,g=r.either.length;g>v;v++)p={},p[s]=r.either[v],d.push(h.conditions(p,n));t.push(d.join(" OR "));continue}if(r[k]("together")){d=[];for(var v=0,g=r.together.length;g>v;v++)p={},p[s]=r.together[v],d.push(h.conditions(p,n));t.push(d.join(" AND "));continue}if(i=h.refs(s,f)[0][u],a=r[k]("type")?r.type:"string",r[k]("case")){if(d=i+" = CASE",r["case"][k]("when")){for(_ in r["case"].when)r["case"].when[k](_)&&(d+=" WHEN "+h.conditions(r["case"].when[_],n)+" THEN "+h.quote(_));r["case"][k]("else")&&(d+=" ELSE "+h.quote(r["case"]["else"]))}else for(_ in r["case"])r["case"][k](_)&&(d+=" WHEN "+h.conditions(r["case"][_],n)+" THEN "+h.quote(_));d+=" END",t.push(d)}else r[k]("multi_like")?t.push(h.multi_like(i,r.multi_like)):r[k]("like")?t.push(i+" LIKE "+("raw"===a?r.like:h.like(r.like))):r[k]("not_like")?t.push(i+" NOT LIKE "+("raw"===a?r.not_like:h.like(r.not_like))):r[k]("contains")?(c=String(r.contains),"raw"===a||(c=h.quote(c)),t.push(h.sql_function("strpos",[i,c])+" > 0")):r[k]("not_contains")?(c=String(r.not_contains),"raw"===a||(c=h.quote(c)),t.push(h.sql_function("strpos",[i,c])+" = 0")):r[k]("in")?(c=y(r["in"]),"raw"===a||(c="integer"===a||O(c[0])?h.intval(c):h.quote(c)),t.push(i+" IN ("+c.join(",")+")")):r[k]("not_in")?(c=y(r.not_in),"raw"===a||(c="integer"===a||O(c[0])?h.intval(c):h.quote(c)),t.push(i+" NOT IN ("+c.join(",")+")")):r[k]("between")?(c=y(r.between),null==c[0]?("raw"===a||("integer"===a||O(c[1])?c[1]=h.intval(c[1]):c[1]=h.quote(c[1])),t.push(i+" <= "+c[1])):null==c[1]?("raw"===a||("integer"===a||O(c[0])?c[0]=h.intval(c[0]):c[0]=h.quote(c[0])),t.push(i+" >= "+c[0])):("raw"===a||(c="integer"===a||O(c[0])&&O(c[1])?h.intval(c):h.quote(c)),t.push(i+" BETWEEN "+c[0]+" AND "+c[1]))):r[k]("not_between")?(c=y(r.not_between),null==c[0]?("raw"===a||("integer"===a||O(c[1])?c[1]=h.intval(c[1]):c[1]=h.quote(c[1])),t.push(i+" > "+c[1])):null==c[1]?("raw"===a||("integer"===a||O(c[0])?c[0]=h.intval(c[0]):c[0]=h.quote(c[0])),t.push(i+" < "+c[0])):("raw"===a||(c="integer"===a||O(c[0])&&O(c[1])?h.intval(c):h.quote(c)),t.push(i+" < "+c[0]+" OR "+i+" > "+c[1]))):r[k]("gt")||r[k]("gte")?(o=r[k]("gt")?"gt":"gte",c=r[o],"raw"===a||(c="integer"===a||O(c)?h.intval(c):"identifier"===a||"field"===a?h.refs(c,f)[0][u]:h.quote(c)),t.push(i+("gt"===o?" > ":" >= ")+c)):r[k]("lt")||r[k]("lte")?(o=r[k]("lt")?"lt":"lte",c=r[o],"raw"===a||(c="integer"===a||O(c)?h.intval(c):"identifier"===a||"field"===a?h.refs(c,f)[0][u]:h.quote(c)),t.push(i+("lt"===o?" < ":" <= ")+c)):r[k]("not_equal")||r[k]("not_eq")?(o=r[k]("not_eq")?"not_eq":"not_equal",c=r[o],"raw"===a||(c="integer"===a||O(c)?h.intval(c):"identifier"===a||"field"===a?h.refs(c,f)[0][u]:h.quote(c)),t.push(i+" <> "+c)):(r[k]("equal")||r[k]("eq"))&&(o=r[k]("eq")?"eq":"equal",c=r[o],"raw"===a||(c="integer"===a||O(c)?h.intval(c):"identifier"===a||"field"===a?h.refs(c,f)[0][u]:h.quote(c)),t.push(i+" = "+c))}else i=h.refs(s,f)[0][u],t.push(i+" = "+(O(r)?r:h.quote(r)));return t.length&&(l="("+t.join(") AND (")+")"),l},joinConditions:function(e,n){var l,t,s,i,r,u,o,a,c,f,d,p,_=this,h=0;for(l in n)n[k](l)&&(t=S.parse(l,_),s=t._col,e[k](s)&&(i=n[l],u=e[s].table,o=e[s].id,a=e[s].join,c=e[s].join_id,h++,f=a+h,r={},e[s][k]("key")&&s!==e[s].key?(d=e[s].key,r[f+"."+d]=s):d=s,e[s][k]("value")?(p=e[s].value,r[f+"."+p]=i):(p=d,r[f+"."+p]=i),_.Join(a+" AS "+f,u+"."+o+"="+f+"."+c,"inner").Where(r),delete n[l]));return _},refs:function(e,n,l){var t=this;if(!0===l){var s,i,r,u,o,a,c,f,d;for(s=0,i=e.length;i>s;s++)r=e[s],o=r.alias,a=r.qualified,c=r.full,"*"!==c&&(n[k](o)?e[s]=n[o]:n[k](c)?(u=n[c],f=u.alias,d=u.full,d!==c&&f!==o&&f===c&&(u=u.cloned(r.alias),e[s]=n[o]=u)):n[k](a)?(u=n[a],u.qualified!==a&&(u=n[u.qualified]),u=r.full!==r.alias?u.cloned(r.alias,null,r._func):u.cloned(null,u.alias,r._func),e[s]=n[u.alias]=u,u.alias===u.full||n[k](u.full)||(n[u.full]=u)):(n[o]=r,o===c||n[k](c)||(n[c]=r)))}else{var s,i,p,_,h,v,r,o,a;for(v=y(e),e=[],s=0,i=v.length;i>s;s++)for(h=v[s].split(","),p=0,_=h.length;_>p;p++)r=S.parse(h[p],t),o=r.alias,a=r.full,n[k](o)?r=n[o]:(n[o]=r,a===o||n[k](a)||(n[a]=r)),e.push(r)}return e},tbl:function(e){var n=this;if(m(e)){for(var l=0,t=e.length;t>l;l++)e[l]=n.tbl(e[l]);return e}return n.p+e},intval:function(e){var n=this;if(m(e)){for(var l=0,t=e.length;t>l;l++)e[l]=n.intval(e[l]);return e}return parseInt(e,10)},quote_name:function(e,n){var l=this,t=l.qn;if(n=!0===n,m(e)){for(var s=0,i=e.length;i>s;s++)e[s]=l.quote_name(e[s],n);return e}return n?(t[0]==e.slice(0,t[0].length)?"":t[0])+e+(t[1]==e.slice(-t[1].length)?"":t[1]):t[0]+e+t[1]},quote:function(e){var n=this,l=n.q;if(m(e)){for(var t=0,s=e.length;s>t;t++)e[t]=n.quote(e[t]);return e}return l[0]+n.esc(e)+l[1]},like:function(e){var n,l,t=this;if(m(e)){for(var s=0,i=e.length;i>s;s++)e[s]=t.like(e[s]);return e}return n=t.q,l=t.escdb?["",""]:t.e,l[0]+n[0]+"%"+t.esc_like(t.esc(e))+"%"+n[1]+l[1]},multi_like:function(e,n,l){var t,s,i,r,u,o,a,c=this;for(l=!1!==l,t=e+" LIKE ",s=n.split(","),l&&(s=I(A(s,B),Boolean)),r=0,u=s.length;u>r;r++){for(i=s[r].split("+"),l&&(i=I(A(i,B),Boolean)),o=0,a=i.length;a>o;o++)i[o]=t+c.like(i[o]);s[r]="("+i.join(" AND ")+")"}return s.join(" OR ")},esc:function(e){var n,l,t,s,i,r,u,o=this;if(m(e)){for(t=0,s=e.length;s>t;t++)e[t]=o.esc(e[t]);return e}if(o.escdb)return o.escdb(e);for(u=o.q,n="\\"+H,l="\\",e=String(e),i="",t=0,s=e.length;s>t;t++)r=e.charAt(t),i+=u[0]===r?u[2]:u[1]===r?u[3]:R(r,n,l);return i},esc_like:function(e){var n=this;if(m(e)){for(var l=0,t=e.length;t>l;l++)e[l]=n.esc_like(e[l]);return e}return R(e,"_%","\\")},sql_function:function(e,n){var l,t,s,i,r,u,o=this;if(null==L.dialects[o.type].functions[e])throw new TypeError('Dialect: SQL function "'+e+'" does not exist for dialect "'+o.type+'"');for(e=L.dialects[o.type].functions[e],n=null!=n?y(n):[],u=n.length,l="",t=!1,s=0,i=e.length;i>s;s++)r=e[s],l+=t?r>0&&u>=r?n[r-1]:"":r,t=!t;return l}},L});