/**
*   Dialect, 
*   a simple and flexible Cross-Platform SQL Builder for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 0.6.0
*   https://github.com/foo123/Dialect
*
*   Abstract the construction of SQL queries
*   Support multiple DB vendors
*   Intuitive and Flexible API
**/
!function(e,n,t){"use strict";var l;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.EXPORTED_SYMBOLS=[n])&&(e[n]=t.call(e)):"object"==typeof module&&module.exports?module.exports=t.call(e):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["require","exports","module"],function(){return t.call(e)}):n in e||(e[n]=l=t.call(e))&&"function"==typeof define&&define.amd&&define(function(){return l})}(this,"Dialect",function(e,n){"use strict";function t(e,n){return new Function(e,n)}function l(e,n){return new RegExp(e,n||"")}function s(e){return e.replace(S,"\\$&")}function i(e){return"function"==typeof e}function r(e){return"string"==typeof e}function u(e){return e instanceof Array||"[object Array]"===T.call(e)}function o(e){return e instanceof Object||"[object Object]"===T.call(e)}function c(e){if(!e)return!0;var n=T.call(e);return(e instanceof Array||e instanceof String||"[object Array]"===n||"[object String]"===n)&&!e.length?!0:(e instanceof Object||"[object Array]"===n)&&!R(e).length?!0:!1}function a(e){return parseInt(e||0,10)||0}function f(e){return e===+e&&isFinite(e)&&!(e%1)}function d(e){return u(e)?e:[e]}function _(e,n,t){var l,s,i,r="";for(3>arguments.length&&(t="\\"),2>arguments.length&&(n="\\\"'"+D),l=0,s=e.length;s>l;l++)i=e[A](l),r+=-1===n.indexOf(i)?i:0===i[O](0)?"\\0":t+i;return r}function h(e,n,t){t=!0===t;for(var l in n)n[m](l)&&(t||!e[m](l))&&(e[l]=n[l]);return e}function p(e,n){var t=e.length;if(!t)return[];var l,s,i=15&t,r=1&i,u=new Array(t);for(r&&(u[0]=n(e[0])),l=r;i>l;l+=2)s=l,u[l]=n(e[s]),u[l+1]=n(e[s+1]);for(l=i;t>l;l+=16)s=l,u[l]=n(e[s]),u[l+1]=n(e[s+1]),u[l+2]=n(e[s+2]),u[l+3]=n(e[s+3]),u[l+4]=n(e[s+4]),u[l+5]=n(e[s+5]),u[l+6]=n(e[s+6]),u[l+7]=n(e[s+7]),u[l+8]=n(e[s+8]),u[l+9]=n(e[s+9]),u[l+10]=n(e[s+10]),u[l+11]=n(e[s+11]),u[l+12]=n(e[s+12]),u[l+13]=n(e[s+13]),u[l+14]=n(e[s+14]),u[l+15]=n(e[s+15]);return u}function g(e,n){var t=e.length;if(!t)return[];var l,s,i=15&t,r=1&i,u=[];for(r&&n(e[0])&&u.push(e[0]),l=r;i>l;l+=2)s=l,n(e[s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]);for(l=i;t>l;l+=16)s=l,n(e[s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]),n(e[++s])&&u.push(e[s]);return u}var v,E,b,w,q="prototype",m="hasOwnProperty",R=Object.keys,T=Object[q].toString,A="charAt",O="charCodeAt",S=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,I=/^\s+|\s+$/g,N=String[q].trim?function(e){return e.trim()}:function(e){return e.replace(I,"")},D=String.fromCharCode(0);v=function F(e,n,t){var l=this;return l instanceof F?(l.id=null,l._renderer=null,n=n||F.defaultArgs,l.tpl=n instanceof RegExp?F.multisplit_re(e||"",n):F.multisplit(e||"",n),!0===t&&(l._renderer=F.compile(l.tpl)),void l.fixRenderer()):new F(e,n,t)},v.defaultArgs=/\$(-?[0-9]+)/g,v.multisplit=function(e,n,t){var l,s,i,r,u,o,c,a,f,d;t=!!t,o=[[1,e]];for(l in n)if(n.hasOwnProperty(l)){for(a=[],s=t?n[l]:l,i=[0,n[l]],r=0,f=o.length;f>r;r++)if(1===o[r][0]){if(c=o[r][1].split(s),d=c.length,a.push([1,c[0]]),d>1)for(u=0;d-1>u;u++)a.push(i),a.push([1,c[u+1]])}else a.push(o[r]);o=a}return o},v.multisplit_re=function(e,n){n=n.global?n:new RegExp(n.source,n.ignoreCase?"gi":"g");for(var t,l=[],s=0;t=n.exec(e);)l.push([1,e.slice(s,n.lastIndex-t[0].length)]),l.push([0,t[1]?t[1]:t[0]]),s=n.lastIndex;return l.push([1,e.slice(s)]),l},v.arg=function(e,n){var t,l,s,i,r,u="args";if(arguments.length&&null!=e)for(e=e.substr?e.length?e.split("."):[]:[e],i=e.length,r=!(!n||!n.substr),t=0;i>t;t++)l=e[t],s=+l,isNaN(s)?u+='["'+l+'"]':(0>s&&(l=r?n+-s:u+".length-"+-s),u+="["+l+"]");return u},v.compile=function(e,n){var l,s,i,r,u=e.length;if(!0===n){for(r='"use strict"; return (',l=0;u>l;l++)s=e[l][0],i=e[l][1],r+=s?i:v.arg(i);r+=");"}else{for(r='"use strict"; var argslen=args.length; return (',l=0;u>l;l++)s=e[l][0],i=e[l][1],r+=s?"'"+i.replace(SQUOTE,"\\'").replace(NEWLINE,"' + \"\\n\" + '")+"'":" + String("+v.arg(i,"argslen")+") + ";r+=");"}return t("args",r)},v[q]={constructor:v,id:null,tpl:null,_renderer:null,dispose:function(){return this.id=null,this.tpl=null,this._renderer=null,this},fixRenderer:function(){return this.render="function"==typeof this._renderer?this._renderer:this.constructor[q].render,this},render:function(e){e=e||[];var n,t,l,s=this.tpl,i=s.length,r=e.length,u="";for(n=0;i>n;n++)t=s[n],1===t[0]?u+=t[1]:(l=t[1],+l===l&&0>l&&(l=r+l),u+=e[l]);return u}},E=function H(e,n){var t=this;return t instanceof H?(t.id=null,void(t.tpl=H.multisplit(e||"",n||H.defaultDelims))):new H(e,n)},E.defaultDelims=["<",">","[","]"],E.multisplit=function(e,n){var t,l,s,i,r,u,o,c,a,f,d,_,h=n[0],p=n[1],g=n[2],v=n[3],E=h.length,b=p.length,w=g.length,q=v.length,m="?",R="*",T="!",O="|",S="{",I="}",D=null,L=0,y=0,j=e.length;for(f=0,o=[[],null,0,0,0,0,null],r=[],a="";j>f;)if(h===e.substr(f,E))f+=E,a.length&&o[0].push([0,a]),a="";else if(p===e.substr(f,b)){if(f+=b,s=a,a="",-1<(i=s.indexOf(O))?(D=s.slice(i+1),s=s.slice(0,i)):D=null,u=s[A](0),m===u||R===u)y=1,R===u?(t=1,l=-1):(t=0,l=0),s=s.slice(1),T===s[A](0)?(L=1,s=s.slice(1)):L=0;else if(S===u){for(a="",d=1,_=s.length;_>d&&I!==s[A](d);)a+=s[A](d++);s=s.slice(d+1),a=a.split(","),a.length>1?(t=N(a[0]),t=t.length?parseInt(t,10)||0:0,l=N(a[1]),l=l.length?parseInt(l,10)||0:-1,y=1):(t=N(a[0]),t=t.length?parseInt(t,10)||0:0,l=t,y=0),a="",L=0}else y=0,L=0,t=0,l=0;L&&null===D&&(D=""),y&&!o[2]?(o[1]=s,o[2]=y,o[3]=L,o[4]=t,o[5]=l,o[6]=[[s,L,t,l]]):y?o[6].push([s,L,t,l]):y||null!==o[1]||(o[1]=s,o[2]=0,o[3]=L,o[4]=t,o[5]=l,o[6]=[[s,L,t,l]]),o[0].push([1,s,D,y,L,t,l])}else g===e.substr(f,w)?(f+=w,a.length&&o[0].push([0,a]),a="",r.push(o),o=[[],null,0,0,0,0,null]):v===e.substr(f,q)?(f+=q,c=o,o=r.pop(),a.length&&c[0].push([0,a]),a="",o[0].push([-1,c[1],c[2],c[3],c[4],c[5],c[6],c[0]])):a+=e[A](f++);return a.length&&o[0].push([0,a]),o[0]},E[q]={constructor:E,id:null,tpl:null,dispose:function(){return this.id=null,this.tpl=null,this},render:function(e){e=e||{};var n,t,l,s,i,r,o,c,a,f,d,_,h,p=this.tpl,g=p.length,v=[],E=Math.min,b=null,w=0,q="";for(l=0;g>l||v.length;)if(l>=g)n=v.pop(),p=n[0],l=n[1],g=n[2],b=n[3]||null,w=n[4]||0;else{if(s=p[l],i=s[0],r=s[1],-1===i){if(a=s[6],a&&a.length){for(f=!0,d=0,_=a.length;_>d;d++)if(h=a[d],0===h[1]&&!e[m](h[0])||1===h[1]&&e[m](h[0])){f=!1;break}if(f){if(1===s[3]){v.push([p,l+1,g,b,w]),p=s[7],l=0,g=p.length,b=null,w=0;continue}if(t=u(e[r]),t&&s[4]!==s[5]&&e[r].length>s[4]){if(o=s[4],c=-1===s[5]?e[r].length-1:E(s[5],e[r].length-1),c>=o){for(v.push([p,l+1,g,b,w]),p=s[7],l=0,g=p.length,b=r,w=c;w>o;w--)v.push([p,0,g,b,w]);w=o;continue}}else if(!t&&s[4]===s[5]){v.push([p,l+1,g,b,w]),p=s[7],l=0,g=p.length,b=r,w=0;continue}}}}else q+=1===i?e[m](r)||null===s[2]?u(e[r])?r===b?e[r][s[5]===s[6]?s[5]:w]:e[r][s[5]]:e[r]:s[2]:r;l++}return q}},b=function(e,n,t,l,s,i,r,u,o,c,a){var f=this;if(f._col=e,f.col=n,f._tbl=t,f.tbl=l,f._dtb=s,f.dtb=i,f._alias=r,f._qualified=o,f.qualified=c,f.full=f.qualified,f._func=null==a?[]:a,f._func.length)for(var d=0,_=f._func.length;_>d;d++)f.full=f._func[d]+"("+f.full+")";null!=f._alias?(f.alias=u,f.aliased=f.full+" AS "+f.alias):(f.alias=f.full,f.aliased=f.full)};var L=/\s/,y=/[0-9]/,j=/[a-z_]/i;b.parse=function(e,n){var t,l,s,i,r,u,o,c,a,f,d,_,h,p,g,v,E,w,q,m,R,T,A,O,S=["AS"];for(e=N(e),l=e.length,t=0,s=[[]],i=s[0],r=[],u=[],o="",c=null,d=0,_=null;l>t;){if(h=e.charAt(t++),'"'===h||"`"===h||"'"===h||"["===h||"]"===h){if(!_){if(o.length||"]"===h){c=["invalid",t];break}_="["===h?"]":h;continue}if(_===h){if(!o.length){c=["invalid",t];break}i.unshift([1,o]),r.unshift(o),o="",_=null;continue}if(_){o+=h;continue}}if(_)o+=h;else if("*"===h){if(o.length){c=["invalid",t];break}i.unshift([10,"*"]),r.unshift(10)}else if("."===h){if(o.length&&(i.unshift([1,o]),r.unshift(o),o=""),!i.length||1!==i[0][0]){c=["invalid",t];break}i.unshift([0,"."]),r.unshift(0)}else if("("===h){if(d++,o.length&&(i.unshift([2,o]),u.unshift(o),o=""),!i.length||2!==i[0][0]&&1!==i[0][0]){c=["invalid",t];break}1===i[0][0]&&(i[0][0]=2,u.unshift(r.shift())),s.unshift([]),i=s[0]}else if(")"===h){if(d--,o.length&&(p=-1<S.indexOf(o.toUpperCase()),i.unshift([p?5:1,o]),r.unshift(p?5:o),o=""),s.length<2){c=["invalid",t];break}s[1].unshift([100,s.shift()]),i=s[0]}else{if(L.test(h)){o.length&&(p=-1<S.indexOf(o.toUpperCase()),i.unshift([p?5:1,o]),r.unshift(p?5:o),o="");continue}if(y.test(h)){if(!o.length){c=["invalid",t];break}o+=h}else{if(!j.test(h)){c=["invalid",t];break}o+=h}}}if(o.length&&(i.unshift([1,o]),r.unshift(o),o=""),!c&&d&&(c=["paren",l]),!c&&_&&(c=["quote",l]),c||1===s.length||(c=["invalid",l]),c)throw a=c[1]-1,f=c[0],new TypeError("paren"==f?'Dialect: Mismatched parentheses "'+e+'" at position '+a+".":"quote"==f?'Dialect: Mismatched quotes "'+e+'" at position '+a+".":'Dialect: Invalid character "'+e+'" at position '+a+".");return R=null,T="",r.length>=3&&5===r[1]&&"string"==typeof r[0]&&(R=r.shift(),T=n.quote_name(R),r.shift()),g=null,v="",!r.length||"string"!=typeof r[0]&&10!==r[0]||(10===r[0]?(r.shift(),g=v="*"):(g=r.shift(),v=n.quote_name(g))),E=null,w="",r.length>=2&&0===r[0]&&"string"==typeof r[1]&&(r.shift(),E=r.shift(),w=n.quote_name(E)),q=null,m="",r.length>=2&&0===r[0]&&"string"==typeof r[1]&&(r.shift(),q=r.shift(),m=n.quote_name(q)),A=(q?q+".":"")+(E?E+".":"")+(g?g:""),O=(q?m+".":"")+(E?w+".":"")+(g?v:""),new b(g,v,E,w,q,m,R,T,A,O,u)},b[q]={constructor:b,_func:null,_col:null,col:null,_tbl:null,tbl:null,_dtb:null,dtb:null,_alias:null,alias:null,_qualified:null,qualified:null,full:null,aliased:null,cloned:function(e,n,t){var l=this;return arguments.length?n=n||e:(e=l._alias,n=l.alias),null==t&&(t=l._func),new b(l._col,l.col,l._tbl,l.tbl,l._dtb,l.dtb,e,n,l._qualified,l.qualified,t)},dispose:function(){var e=this;return e._func=null,e._col=null,e.col=null,e._tbl=null,e.tbl=null,e._dtb=null,e.dtb=null,e._alias=null,e.alias=null,e._qualified=null,e.qualified=null,e.full=null,e.aliased=null,e}};var k={mysql:{quotes:[["'","'","\\'","\\'"],["`","`"],["",""]],clauses:{create:"CREATE TABLE IF NOT EXISTS <create_table>\n(<create_defs>)[<?create_opts>]",alter:"ALTER TABLE <alter_table>\n<alter_defs>[<?alter_opts>]",drop:"DROP TABLE IF EXISTS <drop_tables>[,<*drop_tables>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>[\n<*join_clauses>]][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING (<?having_conditions_required>) AND (<?having_conditions>)][\nHAVING <?!having_conditions_required><?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]","delete":"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]"}},postgres:{quotes:[["E'","'","''","''"],['"','"'],["",""]],clauses:{create:"CREATE TABLE IF NOT EXISTS <create_table>\n(<create_defs>)[<?create_opts>]",alter:"ALTER TABLE <alter_table>\n<alter_defs>[<?alter_opts>]",drop:"DROP TABLE IF EXISTS <drop_tables>[,<*drop_tables>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>[\n<*join_clauses>]][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING (<?having_conditions_required>) AND (<?having_conditions>)][\nHAVING <?!having_conditions_required><?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]","delete":"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]"}},sqlserver:{quotes:[["'","'","''","''"],["[","]"],[""," ESCAPE '\\'"]],clauses:{create:"CREATE TABLE IF NOT EXISTS <create_table>\n(<create_defs>)[<?create_opts>]",alter:"ALTER TABLE <alter_table>\n<alter_defs>[<?alter_opts>]",drop:"DROP TABLE IF EXISTS <drop_tables>[,<*drop_tables>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>[\n<*join_clauses>]][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING (<?having_conditions_required>) AND (<?having_conditions>)][\nHAVING <?!having_conditions_required><?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>][\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]][<?!order_conditions>[\nORDER BY 1\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]","delete":"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]"}},sqlite:{quotes:[["'","'","''","''"],['"','"'],[""," ESCAPE '\\'"]],clauses:{create:"CREATE TABLE IF NOT EXISTS <create_table>\n(<create_defs>)[<?create_opts>]",alter:"ALTER TABLE <alter_table>\n<alter_defs>[<?alter_opts>]",drop:"DROP TABLE IF EXISTS <drop_tables>[,<*drop_tables>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>[\n<*join_clauses>]][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING (<?having_conditions_required>) AND (<?having_conditions>)][\nHAVING <?!having_conditions_required><?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>]","delete":"[<?!order_conditions>[<?!count>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>]]][DELETE \nFROM <from_tables>[,<*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>]\nORDER BY <?order_conditions>[,<*order_conditions>][\nLIMIT <?count> OFFSET <offset|0>]\n)][<?!order_conditions>[DELETE \nFROM <from_tables>[,<*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables>[,<*from_tables>][[\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>]\nLIMIT <?count> OFFSET <offset|0>\n)]]"}}};return w=function C(e){var n=this;if(!(n instanceof C))return new C(e);if(arguments.length||(e="mysql"),!e||!C.dialects[e]||!C.dialects[e].clauses)throw new TypeError('Dialect: SQL dialect does not exist for "'+e+'"');n.clau=null,n.clus=null,n.tbls=null,n.cols=null,n.vews={},n.tpls={},n.db=null,n.escdb=null,n.p="",n.type=e,n.clauses=C.dialects[n.type].clauses,n.q=C.dialects[n.type].quotes[0],n.qn=C.dialects[n.type].quotes[1],n.e=C.dialects[n.type].quotes[2]||["",""]},w.VERSION="0.6.0",w.TPL_RE=/\$\(([^\)]+)\)/g,w.dialects=k,w.GrammTpl=E,w.Tpl=v,w.Ref=b,w[q]={constructor:w,clau:null,clus:null,tbls:null,cols:null,vews:null,tpls:null,db:null,escdb:null,p:null,type:null,clauses:null,q:null,qn:null,e:null,dispose:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e.vews=null,e.tpls=null,e.db=null,e.escdb=null,e.p=null,e.type=null,e.clauses=null,e.q=null,e.qn=null,e.e=null,e},toString:function(){return this.sql()||""},driver:function(e){var n=this;return arguments.length?(n.db=e?e:null,n):n.db},escape:function(e){var n=this;return arguments.length?(n.escdb=e&&i(e)?e:null,n):n.escdb},prefix:function(e){var n=this;return arguments.length?(n.p=e&&e.length?e:"",n):n.p},reset:function(e){var n=this;if(!e||!n.clauses[m](e))throw new TypeError('Dialect: SQL clause "'+e+'" does not exist for dialect "'+n.type+'"');return n.clus={},n.tbls={},n.cols={},n.clau=e,n.clauses[n.clau]instanceof E||(n.clauses[n.clau]=new E(n.clauses[n.clau])),n},clear:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e},sql:function(){var e=this,n=null;return e.clau&&e.clauses[m](e.clau)&&(n=e.clauses[e.clau].render(e.clus)||""),e.clear(),n},prepare:function(e,n,t,i){var r,o,c,a,f,_,h,p,g,v,E=this;if(e&&n){for(t=t?s(t):"%",i=i?s(i):"%",r=l(t+"([rlfds]:)?([0-9a-zA-Z_]+)"+i),v="";e.length&&(o=e.match(r));){if(c=o.index,a=o[0].length,p=o[2],n[m](p)){switch(g=o[1]?o[1].slice(0,-1):"s"){case"r":p=u(n[p])?n[p].join(","):n[p];break;case"l":p=E.like(n[p]);break;case"f":if(u(n[p]))for(h=d(n[p]),p=b.parse(h[0],E).aliased,f=1,_=h.length;_>f;f++)p+=","+b.parse(h[f],E).aliased;else p=b.parse(n[p],E).aliased;break;case"d":p=u(n[p])?E.intval(d(n[p])).join(","):E.intval(n[p]);break;case"s":default:p=u(n[p])?E.quote(d(n[p])).join(","):E.quote(n[p])}v+=e.slice(0,c)+p}else v+=e.slice(0,c)+E.quote("");e=e.slice(c+a)}return e.length&&(v+=e),v}return e},make_view:function(e){var n=this;return e&&n.clau&&(n.vews[e]={clau:n.clau,clus:n.clus,tbls:n.tbls,cols:n.cols},n.vews[e].clus[m]("where_conditions")&&(n.vews[e].clus.where_conditions&&(n.vews[e].clus.where_conditions_required=n.vews[e].clus.where_conditions),delete n.vews[e].clus.where_conditions),n.vews[e].clus[m]("having_conditions")&&(n.vews[e].clus.having_conditions&&(n.vews[e].clus.having_conditions_required=n.vews[e].clus.having_conditions),delete n.vews[e].clus.having_conditions),n.clear()),n},clear_view:function(e){var n=this;return e&&n.vews[m](e)&&delete n.vews[e],n},prepare_tpl:function(e){var n,t,i,r,u,o,a,f,d,_,h,p,g,E=this;if(!c(e)){for(f=arguments,d=f.length,1===d?(_=null,h=null,p=null,g=!0):2===d?(_=f[1],h=null,p=null,g=!1):3===d?(_=null,h=f[1],p=f[2],g=!0):(_=f[1],h=f[2],p=f[3],g=!1),h=h?s(h):"%",p=p?s(p):"%",n=l(h+"(([rlfds]:)?[0-9a-zA-Z_]+)"+p),t=g?new v(E.sql(),n):new v(_,n),i={},r=0,u=t.tpl.length;u>r;r++)o=t.tpl[r],0===o[0]&&(a=o[1].split(":"),a.length>1?(i[a[1]]=a[0],t.tpl[r][1]=a[1]):(i[a[0]]="s",t.tpl[r][1]=a[0]));E.tpls[e]={sql:t,types:i}}return E},prepared:function(e,n){var t,l,s,i,r,o,a,f,_,h=this;if(!c(e)&&h.tpls[m](e)){t=h.tpls[e].sql,l=h.tpls[e].types,i={};for(r in n)if(n[m](r))switch(o=n[r],s=l[m](r)?l[r]:"s"){case"r":i[r]=u(o)?o.join(","):o;break;case"l":i[r]=h.like(o);break;case"f":if(u(o))for(a=d(o),i[r]=b.parse(a[0],h).aliased,f=1,_=a.length;_>f;f++)i[r]+=","+b.parse(a[f],h).aliased;else i[r]=b.parse(o,h).aliased;break;case"d":i[r]=u(o)?h.intval(d(o)).join(","):h.intval(o);break;case"s":default:i[r]=u(o)?h.quote(d(o)).join(","):h.quote(o)}return t.render(i)}return""},clear_tpl:function(e){var n=this;return!c(e)&&n.tpls[m](e)&&(n.tpls[e].sql.dispose(),delete n.tpls[e]),n},create:function(e,n,t,l){var s=this;return s.reset(l||"create"),e=s.refs(e,s.tbls)[0].full,s.clus.create_table=e,s.clus.create_defs&&(n=s.clus.create_defs+","+n),s.clus.create_defs=n,t&&(s.clus.create_opts&&(t=s.clus.create_opts+","+t),s.clus.create_opts=t),s},alter:function(e,n,t,l){var s=this;return s.reset(l||"alter"),e=s.refs(e,s.tbls)[0].full,s.clus.alter_table=e,s.clus.alter_defs&&(n=s.clus.alter_defs+","+n),s.clus.alter_defs=n,t&&(s.clus.alter_opts&&(t=s.clus.alter_opts+","+t),s.clus.alter_opts=t),s},drop:function(e,n){var t,l,s,i=this;if(i.reset(n||"drop"),e&&e.length&&"*"!==e)for(s=i.refs(e,i.tbls),e=s[0].full,t=1,l=s.length;l>t;t++)e+=","+s[t].full;else e="*";return i.clus.drop_tables&&(e=i.clus.drop_tables+","+e),i.clus.drop_tables=e,i},select:function(e,n){var t,l,s,i=this;if(i.reset(n||"select"),e&&e.length&&"*"!==e)for(e=i.refs(e,i.cols),s=e[0].aliased,t=1,l=e.length;l>t;t++)s+=","+e[t].aliased;else s="*";return i.clus.select_columns&&(s=i.clus.select_columns+","+s),i.clus.select_columns=s,i},insert:function(e,n,t){var l,s,i,r,o,c=this;if(c.reset(t||"insert"),i=u(e)?e[0]:e,c.vews[m](i)&&c.clau===c.vews[i].clau)i=c.vews[i],c.clus=h(c.clus,i.clus,!0),c.tbls=h({},i.tbls,!0),c.cols=h({},i.cols,!0);else{for(e=c.refs(e,c.tbls),n=c.refs(n,c.cols),r=e[0].aliased,o=n[0].full,l=1,s=e.length;s>l;l++)r+=","+e[l].aliased;for(l=1,s=n.length;s>l;l++)o+=","+n[l].full;c.clus.insert_tables&&(r=c.clus.insert_tables+","+r),c.clus.insert_columns&&(o=c.clus.insert_columns+","+o),c.clus.insert_tables=r,c.clus.insert_columns=o}return c},values:function(e){var t,l,s,i,r,a,_,h,p=this;if(c(e))return p;for(n!==e[0]&&u(e[0])||(e=[e]),t=e.length,l=[],i=0;t>i;i++)if(h=d(e[i]),h.length){for(s=[],a=0,_=h.length;_>a;a++)r=h[a],o(r)?r[m]("integer")?s.push(p.intval(r.integer)):r[m]("raw")?s.push(r.raw):r[m]("string")&&s.push(p.quote(r.string)):s.push(f(r)?r:p.quote(r));l.push("("+s.join(",")+")")}return l=l.join(","),p.clus.values_values&&(l=p.clus.values_values+","+l),p.clus.values_values=l,p},update:function(e,n){var t,l,s,i,r=this;if(r.reset(n||"update"),s=u(e)?e[0]:e,r.vews[m](s)&&r.clau===r.vews[s].clau)s=r.vews[s],r.clus=h(r.clus,s.clus,!0),r.tbls=h({},s.tbls,!0),r.cols=h({},s.cols,!0);else{for(e=r.refs(e,r.tbls),i=e[0].aliased,t=1,l=e.length;l>t;t++)i+=","+e[t].aliased;r.clus.update_tables&&(i=r.clus.update_tables+","+i),r.clus.update_tables=i}return r},set:function(e){var n,t,l,s,i,r=this;if(c(e))return r;n=[],i=r.cols;for(t in e)e[m](t)&&(l=r.refs(t,i)[0].full,s=e[t],o(s)?s[m]("integer")?n.push(l+" = "+r.intval(s.integer)):s[m]("raw")?n.push(l+" = "+s.raw):s[m]("string")?n.push(l+" = "+r.quote(s.string)):s[m]("increment")?n.push(l+" = "+l+" + "+r.intval(s.increment)):s[m]("decrement")&&n.push(l+" = "+l+" - "+r.intval(s.increment)):n.push(l+" = "+(f(s)?s:r.quote(s))));return n=n.join(","),r.clus.set_values&&(n=r.clus.set_values+","+n),r.clus.set_values=n,r},del:function(e){var n=this;return n.reset(e||"delete"),n},from:function(e){var n,t,l,s,i,r,o=this;if(c(e))return o;if(l=u(e)?e[0]:e,o.vews[m](l)&&o.clau===o.vews[l].clau){if(i=c(o.clus.select_columns)||"*"==o.clus.select_columns?null:o.refs(o.clus.select_columns,{}),l=o.vews[l],o.clus=h(o.clus,l.clus,!0),o.tbls=h({},l.tbls,!0),o.cols=h({},l.cols,!0),i){for(i=o.refs2(i,o.cols),r="*"===i[0].qualified?o.clus.select_columns:i[0].aliased,n=1,t=i.length;t>n;n++)r+=","+("*"===i[n].qualified?o.clus.select_columns:i[n].aliased);o.clus.select_columns=r}}else{for(e=o.refs(e,o.tbls),s=e[0].aliased,n=1,t=e.length;t>n;n++)s+=","+e[n].aliased;o.clus.from_tables&&(s=o.clus.from_tables+","+s),o.clus.from_tables=s}return o},join:function(e,n,t){var l,s,i,u=this;if(e=u.refs(e,u.tbls)[0].aliased,c(n))l=e;else{if(r(n))n=u.refs(n.split("="),u.cols),n="("+n[0].full+"="+n[1].full+")";else{for(s in n)n[m](s)&&(i=n[s],o(i)||(n[s]={eq:i,type:"identifier"}));n="("+u.conditions(n,!1)+")"}l=e+" ON "+n}return l=(c(t)?"JOIN ":t.toUpperCase()+" JOIN ")+l,u.clus.join_clauses&&(l=u.clus.join_clauses+"\n"+l),u.clus.join_clauses=l,u},where:function(e,n){var t=this;return c(e)?t:(n=n?n.toUpperCase():"AND","OR"!==n&&(n="AND"),e=t.conditions(e,!1),t.clus.where_conditions&&(e=t.clus.where_conditions+" "+n+" "+e),t.clus.where_conditions=e,t)},group:function(e,n){var t,l=this;return n=n?n.toUpperCase():"ASC","DESC"!==n&&(n="ASC"),t=l.refs(e,l.cols)[0].alias+" "+n,l.clus.group_conditions&&(t=l.clus.group_conditions+","+t),l.clus.group_conditions=t,l},having:function(e,n){var t=this;return c(e)?t:(n=n?n.toUpperCase():"AND","OR"!==n&&(n="AND"),e=t.conditions(e,!0),t.clus.having_conditions&&(e=t.clus.having_conditions+" "+n+" "+e),t.clus.having_conditions=e,t)},order:function(e,n){var t,l=this;return n=n?n.toUpperCase():"ASC","DESC"!==n&&(n="ASC"),t=l.refs(e,l.cols)[0].alias+" "+n,l.clus.order_conditions&&(t=l.clus.order_conditions+","+t),l.clus.order_conditions=t,l},limit:function(e,n){var t=this;return t.clus.count=a(e),t.clus.offset=a(n),t},page:function(e,n){var t=this;return e=a(e),n=a(n),t.limit(n,e*n)},refs:function(e,n){var t,l,s,i,r,u,o,c,a,f=this;for(u=d(e),e=[],t=0,l=u.length;l>t;t++)for(r=u[t].split(","),s=0,i=r.length;i>s;s++)o=b.parse(r[s],f),c=o.alias,a=o.full,n[m](c)?o=n[c]:(n[c]=o,a===c||n[m](a)||(n[a]=o)),e.push(o);return e},refs2:function(e,n){var t,l,s,i,r,u,o,c,a;for(t=0,l=e.length;l>t;t++)s=e[t],r=s.alias,u=s.qualified,o=s.full,n[m](r)?e[t]=n[r]:n[m](o)?(i=n[o],c=i.alias,a=i.full,a!==o&&c!==r&&c===o&&(i=i.cloned(s.alias),e[t]=n[r]=i)):n[m](u)?(i=n[u],i.qualified!==u&&(i=n[i.qualified]),i=i.cloned(s.alias,null,s._func),e[t]=n[i.alias]=i,i.alias===i.full||n[m](i.full)||(n[i.full]=i)):(n[r]=s,r===o||n[m](o)||(n[o]=s));return e},join_conditions:function(e,n){var t,l,s,i,r,u,o,c,a,f,d,_,h=this,p=0;for(t in n)n[m](t)&&(l=b.parse(t,h),s=l._col,e[m](s)&&(i=n[t],u=e[s].table,o=e[s].id,c=e[s].join,a=e[s].join_id,p++,f=c+p,r={},e[s][m]("key")&&s!==e[s].key?(d=e[s].key,r[f+"."+d]=s):d=s,e[s][m]("value")?(_=e[s].value,r[f+"."+_]=i):(_=d,r[f+"."+_]=i),h.join(c+" AS "+f,u+"."+o+"="+f+"."+a,"inner").where(r),delete n[t]));return h},conditions:function(e,n){var t,l,s,i,u,a,_,h,p,g,v=this;if(c(e))return"";if(r(e))return e;t="",l=[],g=v.cols,a=!0===n?"alias":"full";for(s in e)e[m](s)&&(i=v.refs(s,g)[0][a],u=e[s],o(u)?(h=u[m]("type")?u.type:"string",u[m]("multi_like")?l.push(v.multi_like(i,u.multi_like)):u[m]("like")?l.push(i+" LIKE "+("raw"===h?u.like:v.like(u.like))):u[m]("not_like")?l.push(i+" NOT LIKE "+("raw"===h?u.not_like:v.like(u.not_like))):u[m]("in")?(p=d(u["in"]),"raw"===h||(p="integer"===h||f(p[0])?v.intval(p):v.quote(p)),l.push(i+" IN ("+p.join(",")+")")):u[m]("not_in")?(p=d(u.not_in),"raw"===h||(p="integer"===h||f(p[0])?v.intval(p):v.quote(p)),l.push(i+" NOT IN ("+p.join(",")+")")):u[m]("between")?(p=d(u.between),"raw"===h||(p="integer"===h||f(p[0])&&f(p[1])?v.intval(p):v.quote(p)),l.push(i+" BETWEEN "+p[0]+" AND "+p[1])):u[m]("not_between")?(p=d(u.not_between),"raw"===h||(p="integer"===h||f(p[0])&&f(p[1])?v.intval(p):v.quote(p)),l.push(i+" < "+p[0]+" OR "+i+" > "+p[1])):u[m]("gt")||u[m]("gte")?(_=u[m]("gt")?"gt":"gte",p=u[_],"raw"===h||(p="integer"===h||f(p)?v.intval(p):"identifier"===h||"field"===h?v.refs(p,g)[0][a]:v.quote(p)),l.push(i+("gt"===_?" > ":" >= ")+p)):u[m]("lt")||u[m]("lte")?(_=u[m]("lt")?"lt":"lte",p=u[_],"raw"===h||(p="integer"===h||f(p)?v.intval(p):"identifier"===h||"field"===h?v.refs(p,g)[0][a]:v.quote(p)),l.push(i+("lt"===_?" < ":" <= ")+p)):u[m]("not_equal")||u[m]("not_eq")?(_=u[m]("not_eq")?"not_eq":"not_equal",p=u[_],"raw"===h||(p="integer"===h||f(p)?v.intval(p):"identifier"===h||"field"===h?v.refs(p,g)[0][a]:v.quote(p)),l.push(i+" <> "+p)):(u[m]("equal")||u[m]("eq"))&&(_=u[m]("eq")?"eq":"equal",p=u[_],"raw"===h||(p="integer"===h||f(p)?v.intval(p):"identifier"===h||"field"===h?v.refs(p,g)[0][a]:v.quote(p)),l.push(i+" = "+p))):l.push(i+" = "+(f(u)?u:v.quote(u))));return l.length&&(t="("+l.join(") AND (")+")"),t},tbl:function(e){var n=this;if(u(e)){for(var t=0,l=e.length;l>t;t++)e[t]=n.tbl(e[t]);return e}return n.p+e},intval:function(e){var n=this;if(u(e)){for(var t=0,l=e.length;l>t;t++)e[t]=n.intval(e[t]);return e}return parseInt(e,10)},quote_name:function(e,n){var t=this,l=t.qn;if(n=!0===n,u(e)){for(var s=0,i=e.length;i>s;s++)e[s]=t.quote_name(e[s],n);return e}return n?(l[0]==e.slice(0,l[0].length)?"":l[0])+e+(l[1]==e.slice(-l[1].length)?"":l[1]):l[0]+e+l[1]},quote:function(e){var n=this,t=n.q;if(u(e)){for(var l=0,s=e.length;s>l;l++)e[l]=n.quote(e[l]);return e}return t[0]+n.esc(e)+t[1]},like:function(e){var n,t,l=this;if(u(e)){for(var s=0,i=e.length;i>s;s++)e[s]=l.like(e[s]);return e}return n=l.q,t=l.escdb?["",""]:l.e,t[0]+n[0]+"%"+l.esc_like(l.esc(e))+"%"+n[1]+t[1]},multi_like:function(e,n,t){var l,s,i,r,u,o,c,a=this;for(t=!1!==t,l=e+" LIKE ",s=n.split(","),t&&(s=g(p(s,N),Boolean)),r=0,u=s.length;u>r;r++){for(i=s[r].split("+"),t&&(i=g(p(i,N),Boolean)),o=0,c=i.length;c>o;o++)i[o]=l+a.like(i[o]);s[r]="("+i.join(" AND ")+")"}return s.join(" OR ")},esc:function(e){var n,t,l,s,i,r,o,c=this;if(u(e)){for(l=0,s=e.length;s>l;l++)e[l]=c.esc(e[l]);return e}if(c.escdb)return c.escdb(e);for(o=c.q,n="\\"+D,t="\\",e=String(e),i="",l=0,s=e.length;s>l;l++)r=e.charAt(l),i+=o[0]===r?o[2]:o[1]===r?o[3]:_(r,n,t);return i},esc_like:function(e){var n=this;if(u(e)){for(var t=0,l=e.length;l>t;t++)e[t]=n.esc_like(e[t]);return e}return _(e,"_%","\\")}},w});