/**
*   Dialect, 
*   a simple and flexible Cross-Platform SQL Builder for PHP, Python, Node/XPCOM/JS, ActionScript
* 
*   @version: 0.6.0
*   https://github.com/foo123/Dialect
*
*   Abstract the construction of SQL queries
*   Support multiple DB vendors
*   Intuitive and Flexible API
**/
!function(e,n,t){"use strict";var s;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.EXPORTED_SYMBOLS=[n])&&(e[n]=t.call(e)):"object"==typeof module&&module.exports?module.exports=t.call(e):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["require","exports","module"],function(){return t.call(e)}):n in e||(e[n]=s=t.call(e))&&"function"==typeof define&&define.amd&&define(function(){return s})}(this,"Dialect",function(e,n){"use strict";function t(e,n){return new Function(e,n)}function s(e,n){return new RegExp(e,n||"")}function l(e){return e.replace(I,"\\$&")}function i(e){return"function"==typeof e}function r(e){return"string"==typeof e}function u(e){return e instanceof Array||"[object Array]"===A.call(e)}function o(e){return e instanceof Object||"[object Object]"===A.call(e)}function c(e){if(!e)return!0;var n=A.call(e);return(e instanceof Array||e instanceof String||"[object Array]"===n||"[object String]"===n)&&!e.length?!0:(e instanceof Object||"[object Array]"===n)&&!T(e).length?!0:!1}function a(e){return parseInt(e||0,10)||0}function f(e){return e===+e&&isFinite(e)&&!(e%1)}function d(e){return u(e)?e:[e]}function _(e,n,t){var s,l,i,r="";for(3>arguments.length&&(t="\\"),2>arguments.length&&(n="\\\"'"+L),s=0,l=e.length;l>s;s++)i=e[O](s),r+=-1===n.indexOf(i)?i:0===i[S](0)?"\\0":t+i;return r}function h(e,n,t,s){t=!0===t,s=!0===s;for(var l in n)n[R](l)&&(t||!e[R](l))&&(e[l]=s&&n[l].slice?n[l].slice():n[l]);return e}function p(e,n){var t=e.length;if(!t)return[];var s,l,i=15&t,r=1&i,u=new Array(t);for(r&&(u[0]=n(e[0])),s=r;i>s;s+=2)l=s,u[s]=n(e[l]),u[s+1]=n(e[l+1]);for(s=i;t>s;s+=16)l=s,u[s]=n(e[l]),u[s+1]=n(e[l+1]),u[s+2]=n(e[l+2]),u[s+3]=n(e[l+3]),u[s+4]=n(e[l+4]),u[s+5]=n(e[l+5]),u[s+6]=n(e[l+6]),u[s+7]=n(e[l+7]),u[s+8]=n(e[l+8]),u[s+9]=n(e[l+9]),u[s+10]=n(e[l+10]),u[s+11]=n(e[l+11]),u[s+12]=n(e[l+12]),u[s+13]=n(e[l+13]),u[s+14]=n(e[l+14]),u[s+15]=n(e[l+15]);return u}function v(e,n){var t=e.length;if(!t)return[];var s,l,i=15&t,r=1&i,u=[];for(r&&n(e[0])&&u.push(e[0]),s=r;i>s;s+=2)l=s,n(e[l])&&u.push(e[l]),n(e[++l])&&u.push(e[l]);for(s=i;t>s;s+=16)l=s,n(e[l])&&u.push(e[l]),n(e[++l])&&u.push(e[l]),n(e[++l])&&u.push(e[l]),n(e[++l])&&u.push(e[l]),n(e[++l])&&u.push(e[l]),n(e[++l])&&u.push(e[l]),n(e[++l])&&u.push(e[l]),n(e[++l])&&u.push(e[l]),n(e[++l])&&u.push(e[l]),n(e[++l])&&u.push(e[l]),n(e[++l])&&u.push(e[l]),n(e[++l])&&u.push(e[l]),n(e[++l])&&u.push(e[l]),n(e[++l])&&u.push(e[l]),n(e[++l])&&u.push(e[l]),n(e[++l])&&u.push(e[l]);return u}function g(e,n,t){var s,l,i="";if(e&&e.length)for(t=null==t?",":t,i=e[0][n],s=1,l=e.length;l>s;s++)i+=t+e[s][n];return i}var E,b,w,q,m="prototype",R="hasOwnProperty",T=Object.keys,A=Object[m].toString,O="charAt",S="charCodeAt",I=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,N=/^\s+|\s+$/g,D=String[m].trim?function(e){return e.trim()}:function(e){return e.replace(N,"")},L=String.fromCharCode(0);E=function F(e,n,t){var s=this;return s instanceof F?(s.id=null,s._renderer=null,n=n||F.defaultArgs,s.tpl=n instanceof RegExp?F.multisplit_re(e||"",n):F.multisplit(e||"",n),!0===t&&(s._renderer=F.compile(s.tpl)),void s.fixRenderer()):new F(e,n,t)},E.defaultArgs=/\$(-?[0-9]+)/g,E.multisplit=function(e,n,t){var s,l,i,r,u,o,c,a,f,d;t=!!t,o=[[1,e]];for(s in n)if(n.hasOwnProperty(s)){for(a=[],l=t?n[s]:s,i=[0,n[s]],r=0,f=o.length;f>r;r++)if(1===o[r][0]){if(c=o[r][1].split(l),d=c.length,a.push([1,c[0]]),d>1)for(u=0;d-1>u;u++)a.push(i),a.push([1,c[u+1]])}else a.push(o[r]);o=a}return o},E.multisplit_re=function(e,n){n=n.global?n:new RegExp(n.source,n.ignoreCase?"gi":"g");for(var t,s=[],l=0;t=n.exec(e);)s.push([1,e.slice(l,n.lastIndex-t[0].length)]),s.push([0,t[1]?t[1]:t[0]]),l=n.lastIndex;return s.push([1,e.slice(l)]),s},E.arg=function(e,n){var t,s,l,i,r,u="args";if(arguments.length&&null!=e)for(e=e.substr?e.length?e.split("."):[]:[e],i=e.length,r=!(!n||!n.substr),t=0;i>t;t++)s=e[t],l=+s,isNaN(l)?u+='["'+s+'"]':(0>l&&(s=r?n+-l:u+".length-"+-l),u+="["+s+"]");return u},E.compile=function(e,n){var s,l,i,r,u=e.length;if(!0===n){for(r='"use strict"; return (',s=0;u>s;s++)l=e[s][0],i=e[s][1],r+=l?i:E.arg(i);r+=");"}else{for(r='"use strict"; var argslen=args.length; return (',s=0;u>s;s++)l=e[s][0],i=e[s][1],r+=l?"'"+i.replace(SQUOTE,"\\'").replace(NEWLINE,"' + \"\\n\" + '")+"'":" + String("+E.arg(i,"argslen")+") + ";r+=");"}return t("args",r)},E[m]={constructor:E,id:null,tpl:null,_renderer:null,dispose:function(){return this.id=null,this.tpl=null,this._renderer=null,this},fixRenderer:function(){return this.render="function"==typeof this._renderer?this._renderer:this.constructor[m].render,this},render:function(e){e=e||[];var n,t,s,l=this.tpl,i=l.length,r=e.length,u="";for(n=0;i>n;n++)t=l[n],1===t[0]?u+=t[1]:(s=t[1],+s===s&&0>s&&(s=r+s),u+=e[s]);return u}},b=function W(e,n){var t=this;return t instanceof W?(t.id=null,void(t.tpl=W.multisplit(e||"",n||W.defaultDelims))):new W(e,n)},b.defaultDelims=["<",">","[","]"],b.multisplit=function(e,n){var t,s,l,i,r,u,o,c,a,f,d,_,h=n[0],p=n[1],v=n[2],g=n[3],E=h.length,b=p.length,w=v.length,q=g.length,m="?",R="*",T="!",A="|",S="{",I="}",N=null,L=0,y=0,H=e.length;for(f=0,o=[[],null,0,0,0,0,null],r=[],a="";H>f;)if(h===e.substr(f,E))f+=E,a.length&&o[0].push([0,a]),a="";else if(p===e.substr(f,b)){if(f+=b,l=a,a="",-1<(i=l.indexOf(A))?(N=l.slice(i+1),l=l.slice(0,i)):N=null,u=l[O](0),m===u||R===u)y=1,R===u?(t=1,s=-1):(t=0,s=0),l=l.slice(1),T===l[O](0)?(L=1,l=l.slice(1)):L=0;else if(S===u){for(a="",d=1,_=l.length;_>d&&I!==l[O](d);)a+=l[O](d++);l=l.slice(d+1),a=a.split(","),a.length>1?(t=D(a[0]),t=t.length?parseInt(t,10)||0:0,s=D(a[1]),s=s.length?parseInt(s,10)||0:-1,y=1):(t=D(a[0]),t=t.length?parseInt(t,10)||0:0,s=t,y=0),a="",L=0}else y=0,L=0,t=0,s=0;L&&null===N&&(N=""),y&&!o[2]?(o[1]=l,o[2]=y,o[3]=L,o[4]=t,o[5]=s,o[6]=[[l,L,t,s]]):y?o[6].push([l,L,t,s]):y||null!==o[1]||(o[1]=l,o[2]=0,o[3]=L,o[4]=t,o[5]=s,o[6]=[[l,L,t,s]]),o[0].push([1,l,N,y,L,t,s])}else v===e.substr(f,w)?(f+=w,a.length&&o[0].push([0,a]),a="",r.push(o),o=[[],null,0,0,0,0,null]):g===e.substr(f,q)?(f+=q,c=o,o=r.pop(),a.length&&c[0].push([0,a]),a="",o[0].push([-1,c[1],c[2],c[3],c[4],c[5],c[6],c[0]])):a+=e[O](f++);return a.length&&o[0].push([0,a]),o[0]},b[m]={constructor:b,id:null,tpl:null,dispose:function(){return this.id=null,this.tpl=null,this},render:function(e){e=e||{};var n,t,s,l,i,r,o,c,a,f,d,_,h,p=this.tpl,v=p.length,g=[],E=Math.min,b=null,w=0,q="";for(s=0;v>s||g.length;)if(s>=v)n=g.pop(),p=n[0],s=n[1],v=n[2],b=n[3]||null,w=n[4]||0;else{if(l=p[s],i=l[0],r=l[1],-1===i){if(a=l[6],a&&a.length){for(f=!0,d=0,_=a.length;_>d;d++)if(h=a[d],0===h[1]&&!e[R](h[0])||1===h[1]&&e[R](h[0])){f=!1;break}if(f){if(1===l[3]){g.push([p,s+1,v,b,w]),p=l[7],s=0,v=p.length,b=null,w=0;continue}if(t=u(e[r]),t&&l[4]!==l[5]&&e[r].length>l[4]){if(o=l[4],c=-1===l[5]?e[r].length-1:E(l[5],e[r].length-1),c>=o){for(g.push([p,s+1,v,b,w]),p=l[7],s=0,v=p.length,b=r,w=c;w>o;w--)g.push([p,0,v,b,w]);w=o;continue}}else if(!t&&l[4]===l[5]){g.push([p,s+1,v,b,w]),p=l[7],s=0,v=p.length,b=r,w=0;continue}}}}else q+=1===i?e[R](r)||null===l[2]?u(e[r])?r===b?e[r][l[5]===l[6]?l[5]:w]:e[r][l[5]]:e[r]:l[2]:r;s++}return q}},w=function(e,n,t,s,l,i,r,u,o,c,a){var f=this;if(f._col=e,f.col=n,f._tbl=t,f.tbl=s,f._dtb=l,f.dtb=i,f._alias=r,f._qualified=o,f.qualified=c,f.full=f.qualified,f._func=null==a?[]:a,f._func.length)for(var d=0,_=f._func.length;_>d;d++)f.full=f._func[d]+"("+f.full+")";null!=f._alias?(f.alias=u,f.aliased=f.full+" AS "+f.alias):(f.alias=f.full,f.aliased=f.full)};var y=/\s/,H=/[0-9]/,j=/[a-z_]/i;w.parse=function(e,n){var t,s,l,i,r,u,o,c,a,f,d,_,h,p,v,g,E,b,q,m,R,T,A,O,S=["AS"];for(e=D(e),s=e.length,t=0,l=[[]],i=l[0],r=[],u=[],o="",c=null,d=0,_=null;s>t;){if(h=e.charAt(t++),'"'===h||"`"===h||"'"===h||"["===h||"]"===h){if(!_){if(o.length||"]"===h){c=["invalid",t];break}_="["===h?"]":h;continue}if(_===h){if(!o.length){c=["invalid",t];break}i.unshift([1,o]),r.unshift(o),o="",_=null;continue}if(_){o+=h;continue}}if(_)o+=h;else if("*"===h){if(o.length){c=["invalid",t];break}i.unshift([10,"*"]),r.unshift(10)}else if("."===h){if(o.length&&(i.unshift([1,o]),r.unshift(o),o=""),!i.length||1!==i[0][0]){c=["invalid",t];break}i.unshift([0,"."]),r.unshift(0)}else if("("===h){if(d++,o.length&&(i.unshift([2,o]),u.unshift(o),o=""),!i.length||2!==i[0][0]&&1!==i[0][0]){c=["invalid",t];break}1===i[0][0]&&(i[0][0]=2,u.unshift(r.shift())),l.unshift([]),i=l[0]}else if(")"===h){if(d--,o.length&&(p=-1<S.indexOf(o.toUpperCase()),i.unshift([p?5:1,o]),r.unshift(p?5:o),o=""),l.length<2){c=["invalid",t];break}l[1].unshift([100,l.shift()]),i=l[0]}else{if(y.test(h)){o.length&&(p=-1<S.indexOf(o.toUpperCase()),i.unshift([p?5:1,o]),r.unshift(p?5:o),o="");continue}if(H.test(h)){if(!o.length){c=["invalid",t];break}o+=h}else{if(!j.test(h)){c=["invalid",t];break}o+=h}}}if(o.length&&(i.unshift([1,o]),r.unshift(o),o=""),!c&&d&&(c=["paren",s]),!c&&_&&(c=["quote",s]),c||1===l.length||(c=["invalid",s]),c)throw a=c[1]-1,f=c[0],new TypeError("paren"==f?'Dialect: Mismatched parentheses "'+e+'" at position '+a+".":"quote"==f?'Dialect: Mismatched quotes "'+e+'" at position '+a+".":'Dialect: Invalid character "'+e+'" at position '+a+".");return R=null,T="",r.length>=3&&5===r[1]&&"string"==typeof r[0]&&(R=r.shift(),T=n.quote_name(R),r.shift()),v=null,g="",!r.length||"string"!=typeof r[0]&&10!==r[0]||(10===r[0]?(r.shift(),v=g="*"):(v=r.shift(),g=n.quote_name(v))),E=null,b="",r.length>=2&&0===r[0]&&"string"==typeof r[1]&&(r.shift(),E=r.shift(),b=n.quote_name(E)),q=null,m="",r.length>=2&&0===r[0]&&"string"==typeof r[1]&&(r.shift(),q=r.shift(),m=n.quote_name(q)),A=(q?q+".":"")+(E?E+".":"")+(v?v:""),O=(q?m+".":"")+(E?b+".":"")+(v?g:""),new w(v,g,E,b,q,m,R,T,A,O,u)},w[m]={constructor:w,_func:null,_col:null,col:null,_tbl:null,tbl:null,_dtb:null,dtb:null,_alias:null,alias:null,_qualified:null,qualified:null,full:null,aliased:null,cloned:function(e,n,t){var s=this;return arguments.length?n=n||e:(e=s._alias,n=s.alias),null==t&&(t=s._func),new w(s._col,s.col,s._tbl,s.tbl,s._dtb,s.dtb,e,n,s._qualified,s.qualified,t)},dispose:function(){var e=this;return e._func=null,e._col=null,e.col=null,e._tbl=null,e.tbl=null,e._dtb=null,e.dtb=null,e._alias=null,e.alias=null,e._qualified=null,e.qualified=null,e.full=null,e.aliased=null,e}};var k={mysql:{quotes:[["'","'","\\'","\\'"],["`","`"],["",""]],clauses:{create:"CREATE TABLE IF NOT EXISTS <create_table>\n(<create_defs>)[<?create_opts>]",alter:"ALTER TABLE <alter_table>\n<alter_defs>[<?alter_opts>]",drop:"DROP TABLE IF EXISTS <drop_tables>[,<*drop_tables>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>[\n<*join_clauses>]][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING (<?having_conditions_required>) AND (<?having_conditions>)][\nHAVING <?!having_conditions_required><?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]","delete":"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]"}},postgres:{quotes:[["E'","'","''","''"],['"','"'],["",""]],clauses:{create:"CREATE TABLE IF NOT EXISTS <create_table>\n(<create_defs>)[<?create_opts>]",alter:"ALTER TABLE <alter_table>\n<alter_defs>[<?alter_opts>]",drop:"DROP TABLE IF EXISTS <drop_tables>[,<*drop_tables>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>[\n<*join_clauses>]][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING (<?having_conditions_required>) AND (<?having_conditions>)][\nHAVING <?!having_conditions_required><?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]","delete":"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]"}},sqlserver:{quotes:[["'","'","''","''"],["[","]"],[""," ESCAPE '\\'"]],clauses:{create:"CREATE TABLE IF NOT EXISTS <create_table>\n(<create_defs>)[<?create_opts>]",alter:"ALTER TABLE <alter_table>\n<alter_defs>[<?alter_opts>]",drop:"DROP TABLE IF EXISTS <drop_tables>[,<*drop_tables>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>[\n<*join_clauses>]][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING (<?having_conditions_required>) AND (<?having_conditions>)][\nHAVING <?!having_conditions_required><?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>][\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]][<?!order_conditions>[\nORDER BY 1\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]","delete":"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]"}},sqlite:{quotes:[["'","'","''","''"],['"','"'],[""," ESCAPE '\\'"]],clauses:{create:"CREATE TABLE IF NOT EXISTS <create_table>\n(<create_defs>)[<?create_opts>]",alter:"ALTER TABLE <alter_table>\n<alter_defs>[<?alter_opts>]",drop:"DROP TABLE IF EXISTS <drop_tables>[,<*drop_tables>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>[\n<*join_clauses>]][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING (<?having_conditions_required>) AND (<?having_conditions>)][\nHAVING <?!having_conditions_required><?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\nVALUES <values_values>[,<*values_values>]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>]","delete":"[<?!order_conditions>[<?!count>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>]]][DELETE \nFROM <from_tables>[,<*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables>[,<*from_tables>][\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>]\nORDER BY <?order_conditions>[,<*order_conditions>][\nLIMIT <?count> OFFSET <offset|0>]\n)][<?!order_conditions>[DELETE \nFROM <from_tables>[,<*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables>[,<*from_tables>][[\nWHERE (<?where_conditions_required>) AND (<?where_conditions>)][\nWHERE <?!where_conditions_required><?where_conditions>]\nLIMIT <?count> OFFSET <offset|0>\n)]]"}}};return q=function C(e){var n=this;if(!(n instanceof C))return new C(e);if(arguments.length||(e="mysql"),!e||!C.dialects[e]||!C.dialects[e].clauses)throw new TypeError('Dialect: SQL dialect does not exist for "'+e+'"');n.clau=null,n.clus=null,n.tbls=null,n.cols=null,n.vews={},n.tpls={},n.db=null,n.escdb=null,n.p="",n.type=e,n.clauses=C.dialects[n.type].clauses,n.q=C.dialects[n.type].quotes[0],n.qn=C.dialects[n.type].quotes[1],n.e=C.dialects[n.type].quotes[2]||["",""]},q.VERSION="0.6.0",q.TPL_RE=/\$\(([^\)]+)\)/g,q.dialects=k,q.GrammTpl=b,q.Tpl=E,q.Ref=w,q[m]={constructor:q,clau:null,clus:null,tbls:null,cols:null,vews:null,tpls:null,db:null,escdb:null,p:null,type:null,clauses:null,q:null,qn:null,e:null,dispose:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e.vews=null,e.tpls=null,e.db=null,e.escdb=null,e.p=null,e.type=null,e.clauses=null,e.q=null,e.qn=null,e.e=null,e},toString:function(){return this.sql()||""},driver:function(e){var n=this;return arguments.length?(n.db=e?e:null,n):n.db},escape:function(e){var n=this;return arguments.length?(n.escdb=e&&i(e)?e:null,n):n.escdb},prefix:function(e){var n=this;return arguments.length?(n.p=e&&e.length?e:"",n):n.p},reset:function(e){var n=this;if(!e||!n.clauses[R](e))throw new TypeError('Dialect: SQL clause "'+e+'" does not exist for dialect "'+n.type+'"');return n.clus={},n.tbls={},n.cols={},n.clau=e,n.clauses[n.clau]instanceof b||(n.clauses[n.clau]=new b(n.clauses[n.clau])),n},clear:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e},sql:function(){var e=this,n=null;return e.clau&&e.clauses[R](e.clau)&&(e.clus[R]("select_columns")&&(e.clus.select_columns=g(e.clus.select_columns,"aliased")),e.clus[R]("from_tables")&&(e.clus.from_tables=g(e.clus.from_tables,"aliased")),e.clus[R]("insert_tables")&&(e.clus.insert_tables=g(e.clus.insert_tables,"aliased")),e.clus[R]("insert_columns")&&(e.clus.insert_columns=g(e.clus.insert_columns,"full")),e.clus[R]("update_tables")&&(e.clus.update_tables=g(e.clus.update_tables,"aliased")),e.clus[R]("create_table")&&(e.clus.create_table=g(e.clus.create_table,"full")),e.clus[R]("alter_table")&&(e.clus.alter_table=g(e.clus.alter_table,"full")),e.clus[R]("drop_tables")&&(e.clus.drop_tables=g(e.clus.drop_tables,"full")),n=e.clauses[e.clau].render(e.clus)||""),e.clear(),n},createView:function(e){var n=this;return e&&n.clau&&(n.vews[e]={clau:n.clau,clus:n.clus,tbls:n.tbls,cols:n.cols},n.vews[e].clus[R]("where_conditions")&&(n.vews[e].clus.where_conditions&&(n.vews[e].clus.where_conditions_required=n.vews[e].clus.where_conditions),delete n.vews[e].clus.where_conditions),n.vews[e].clus[R]("having_conditions")&&(n.vews[e].clus.having_conditions&&(n.vews[e].clus.having_conditions_required=n.vews[e].clus.having_conditions),delete n.vews[e].clus.having_conditions),n.clear()),n},useView:function(e){var n,t,s=this;if(n=s.clus.select_columns,e=s.vews[e],s.clus=h(s.clus,e.clus,!0,!0),s.tbls=h({},e.tbls,!0),s.cols=h({},e.cols,!0),n){n=s.refs(n,s.cols,!0),t=[];for(var l=0,i=n.length;i>l;l++)"*"===n[l].qualified?t=t.concat(s.clus.select_columns):t.push(n[l]);s.clus.select_columns=t}return s},dropView:function(e){var n=this;return e&&n.vews[R](e)&&delete n.vews[e],n},prepareTpl:function(e){var n,t,i,r,u,o,a,f,d,_,h,p,v,g=this;if(!c(e)){for(f=arguments,d=f.length,1===d?(_=null,h=null,p=null,v=!0):2===d?(_=f[1],h=null,p=null,v=!1):3===d?(_=null,h=f[1],p=f[2],v=!0):(_=f[1],h=f[2],p=f[3],v=!1),h=h?l(h):"%",p=p?l(p):"%",n=s(h+"(([rlfds]:)?[0-9a-zA-Z_]+)"+p),t=v?new E(g.sql(),n):new E(_,n),i={},r=0,u=t.tpl.length;u>r;r++)o=t.tpl[r],0===o[0]&&(a=o[1].split(":"),a.length>1?(i[a[1]]=a[0],t.tpl[r][1]=a[1]):(i[a[0]]="s",t.tpl[r][1]=a[0]));g.tpls[e]={sql:t,types:i}}return g},prepared:function(e,n){var t,s,l,i,r,o,a,f,_,h=this;if(!c(e)&&h.tpls[R](e)){t=h.tpls[e].sql,s=h.tpls[e].types,i={};for(r in n)if(n[R](r))switch(o=n[r],l=s[R](r)?s[r]:"s"){case"r":i[r]=u(o)?o.join(","):o;break;case"l":i[r]=h.like(o);break;case"f":if(u(o))for(a=d(o),i[r]=w.parse(a[0],h).aliased,f=1,_=a.length;_>f;f++)i[r]+=","+w.parse(a[f],h).aliased;else i[r]=w.parse(o,h).aliased;break;case"d":i[r]=u(o)?h.intval(d(o)).join(","):h.intval(o);break;case"s":default:i[r]=u(o)?h.quote(d(o)).join(","):h.quote(o)}return t.render(i)}return""},prepare:function(e,n,t,i){var r,o,c,a,f,_,h,p,v,g,E=this;if(e&&n){for(t=t?l(t):"%",i=i?l(i):"%",r=s(t+"([rlfds]:)?([0-9a-zA-Z_]+)"+i),g="";e.length&&(o=e.match(r));){if(c=o.index,a=o[0].length,p=o[2],n[R](p)){switch(v=o[1]?o[1].slice(0,-1):"s"){case"r":p=u(n[p])?n[p].join(","):n[p];break;case"l":p=E.like(n[p]);break;case"f":if(u(n[p]))for(h=d(n[p]),p=w.parse(h[0],E).aliased,f=1,_=h.length;_>f;f++)p+=","+w.parse(h[f],E).aliased;else p=w.parse(n[p],E).aliased;break;case"d":p=u(n[p])?E.intval(d(n[p])).join(","):E.intval(n[p]);break;case"s":default:p=u(n[p])?E.quote(d(n[p])).join(","):E.quote(n[p])}g+=e.slice(0,c)+p}else g+=e.slice(0,c)+E.quote("");e=e.slice(c+a)}return e.length&&(g+=e),g}return e},dropTpl:function(e){var n=this;return!c(e)&&n.tpls[R](e)&&(n.tpls[e].sql.dispose(),delete n.tpls[e]),n},Create:function(e,n,t,s){var l=this;return l.reset(s||"create"),l.clus.create_table=l.refs(e,l.tbls),l.clus.create_defs&&(n=l.clus.create_defs+","+n),l.clus.create_defs=n,t&&(l.clus.create_opts&&(t=l.clus.create_opts+","+t),l.clus.create_opts=t),l},Alter:function(e,n,t,s){var l=this;return l.reset(s||"alter"),l.clus.alter_table=l.refs(e,l.tbls),l.clus.alter_defs&&(n=l.clus.alter_defs+","+n),l.clus.alter_defs=n,t&&(l.clus.alter_opts&&(t=l.clus.alter_opts+","+t),l.clus.alter_opts=t),l},Drop:function(e,n){var t,s=this;return s.reset(n||"drop"),t=u(e)?e[0]:e,s.vews[R](t)?(s.dropView(t),s):(e=s.refs(null==e?"*":e,s.tbls),s.clus.drop_tables=s.clus.drop_tables?s.clus.drop_tables.concat(e):e,s)},Select:function(e,n){var t=this;return t.reset(n||"select"),e=t.refs(null==e?"*":e,t.cols),t.clus.select_columns=t.clus.select_columns?t.clus.select_columns.concat(e):e,t},Insert:function(e,n,t){var s,l=this;return l.reset(t||"insert"),s=u(e)?e[0]:e,l.vews[R](s)&&l.clau===l.vews[s].clau?l.useView(s):(e=l.refs(e,l.tbls),n=l.refs(n,l.cols),l.clus.insert_tables=l.clus.insert_tables?l.clus.insert_tables.concat(e):e,l.clus.insert_columns=l.clus.insert_columns?l.clus.insert_columns.concat(n):n),l},Values:function(e){var t,s,l,i,r,a,_,h,p=this;if(c(e))return p;for(n!==e[0]&&u(e[0])||(e=[e]),t=e.length,s=[],i=0;t>i;i++)if(h=d(e[i]),h.length){for(l=[],a=0,_=h.length;_>a;a++)r=h[a],o(r)?r[R]("integer")?l.push(p.intval(r.integer)):r[R]("raw")?l.push(r.raw):r[R]("string")&&l.push(p.quote(r.string)):l.push(f(r)?r:p.quote(r));s.push("("+l.join(",")+")")}return s=s.join(","),p.clus.values_values&&(s=p.clus.values_values+","+s),p.clus.values_values=s,p},Update:function(e,n){var t,s=this;return s.reset(n||"update"),t=u(e)?e[0]:e,s.vews[R](t)&&s.clau===s.vews[t].clau?s.useView(t):(e=s.refs(e,s.tbls),s.clus.update_tables=s.clus.update_tables?s.clus.update_tables.concat(e):e),s},Set:function(e){var n,t,s,l,i,r,u=this;if(c(e))return u;n=[],r=u.cols;for(s in e)if(e[R](s))if(l=u.refs(s,r)[0].full,i=e[s],o(i)){if(i[R]("integer"))n.push(l+" = "+u.intval(i.integer));else if(i[R]("raw"))n.push(l+" = "+i.raw);else if(i[R]("string"))n.push(l+" = "+u.quote(i.string));else if(i[R]("increment"))n.push(l+" = "+l+" + "+u.intval(i.increment));else if(i[R]("decrement"))n.push(l+" = "+l+" - "+u.intval(i.increment));else if(i[R]("case")){if(t=l+" = CASE",i["case"][R]("when")){for(case_value in i["case"].when)i["case"].when[R](case_value)&&(t+="\nWHEN "+u.conditions(i["case"].when[case_value],!1)+" THEN "+u.quote(case_value));i["case"][R]("else")&&(t+="\nELSE "+u.quote(i["case"]["else"]))}else for(case_value in i["case"])i["case"][R](case_value)&&(t+="\nWHEN "+u.conditions(i["case"][case_value],!1)+" THEN "+u.quote(case_value));t+="\nEND",n.push(t)}}else n.push(l+" = "+(f(i)?i:u.quote(i)));return n=n.join(","),u.clus.set_values&&(n=u.clus.set_values+","+n),u.clus.set_values=n,u},Delete:function(e){var n=this;return n.reset(e||"delete"),n},From:function(e){var n,e,t=this;return c(e)?t:(n=u(e)?e[0]:e,t.vews[R](n)&&t.clau===t.vews[n].clau?t.useView(n):(e=t.refs(e,t.tbls),t.clus.from_tables=t.clus.from_tables?t.clus.from_tables.concat(e):e),t)},Join:function(e,n,t){var s,l,i,u=this;if(e=u.refs(e,u.tbls)[0].aliased,c(n))s=e;else{if(r(n))n=u.refs(n.split("="),u.cols),n="("+n[0].full+"="+n[1].full+")";else{for(l in n)n[R](l)&&(i=n[l],o(i)||(n[l]={eq:i,type:"identifier"}));n="("+u.conditions(n,!1)+")"}s=e+" ON "+n}return s=(c(t)?"JOIN ":t.toUpperCase()+" JOIN ")+s,u.clus.join_clauses&&(s=u.clus.join_clauses+"\n"+s),u.clus.join_clauses=s,u},Where:function(e,n){var t=this;return c(e)?t:(n=n?n.toUpperCase():"AND","OR"!==n&&(n="AND"),e=t.conditions(e,!1),t.clus.where_conditions&&(e=t.clus.where_conditions+" "+n+" "+e),t.clus.where_conditions=e,t)},Group:function(e,n){var t,s=this;return n=n?n.toUpperCase():"ASC","DESC"!==n&&(n="ASC"),t=s.refs(e,s.cols)[0].alias+" "+n,s.clus.group_conditions&&(t=s.clus.group_conditions+","+t),s.clus.group_conditions=t,s},Having:function(e,n){var t=this;return c(e)?t:(n=n?n.toUpperCase():"AND","OR"!==n&&(n="AND"),e=t.conditions(e,!0),t.clus.having_conditions&&(e=t.clus.having_conditions+" "+n+" "+e),t.clus.having_conditions=e,t)},Order:function(e,n){var t,s=this;return n=n?n.toUpperCase():"ASC","DESC"!==n&&(n="ASC"),t=s.refs(e,s.cols)[0].alias+" "+n,s.clus.order_conditions&&(t=s.clus.order_conditions+","+t),s.clus.order_conditions=t,s},Limit:function(e,n){var t=this;return t.clus.count=a(e),t.clus.offset=a(n),t},Page:function(e,n){var t=this;return e=a(e),n=a(n),t.Limit(n,e*n)},conditions:function(e,n){var t,s,l,i,u,a,_,h,p,v,g=this;if(c(e))return"";if(r(e))return e;t="",s=[],v=g.cols,a=!0===n?"alias":"full";for(l in e)e[R](l)&&(i=g.refs(l,v)[0][a],u=e[l],o(u)?(h=u[R]("type")?u.type:"string",u[R]("multi_like")?s.push(g.multi_like(i,u.multi_like)):u[R]("like")?s.push(i+" LIKE "+("raw"===h?u.like:g.like(u.like))):u[R]("not_like")?s.push(i+" NOT LIKE "+("raw"===h?u.not_like:g.like(u.not_like))):u[R]("in")?(p=d(u["in"]),"raw"===h||(p="integer"===h||f(p[0])?g.intval(p):g.quote(p)),s.push(i+" IN ("+p.join(",")+")")):u[R]("not_in")?(p=d(u.not_in),"raw"===h||(p="integer"===h||f(p[0])?g.intval(p):g.quote(p)),s.push(i+" NOT IN ("+p.join(",")+")")):u[R]("between")?(p=d(u.between),"raw"===h||(p="integer"===h||f(p[0])&&f(p[1])?g.intval(p):g.quote(p)),s.push(i+" BETWEEN "+p[0]+" AND "+p[1])):u[R]("not_between")?(p=d(u.not_between),"raw"===h||(p="integer"===h||f(p[0])&&f(p[1])?g.intval(p):g.quote(p)),s.push(i+" < "+p[0]+" OR "+i+" > "+p[1])):u[R]("gt")||u[R]("gte")?(_=u[R]("gt")?"gt":"gte",p=u[_],"raw"===h||(p="integer"===h||f(p)?g.intval(p):"identifier"===h||"field"===h?g.refs(p,v)[0][a]:g.quote(p)),s.push(i+("gt"===_?" > ":" >= ")+p)):u[R]("lt")||u[R]("lte")?(_=u[R]("lt")?"lt":"lte",p=u[_],"raw"===h||(p="integer"===h||f(p)?g.intval(p):"identifier"===h||"field"===h?g.refs(p,v)[0][a]:g.quote(p)),s.push(i+("lt"===_?" < ":" <= ")+p)):u[R]("not_equal")||u[R]("not_eq")?(_=u[R]("not_eq")?"not_eq":"not_equal",p=u[_],"raw"===h||(p="integer"===h||f(p)?g.intval(p):"identifier"===h||"field"===h?g.refs(p,v)[0][a]:g.quote(p)),s.push(i+" <> "+p)):(u[R]("equal")||u[R]("eq"))&&(_=u[R]("eq")?"eq":"equal",p=u[_],"raw"===h||(p="integer"===h||f(p)?g.intval(p):"identifier"===h||"field"===h?g.refs(p,v)[0][a]:g.quote(p)),s.push(i+" = "+p))):s.push(i+" = "+(f(u)?u:g.quote(u))));return s.length&&(t="("+s.join(") AND (")+")"),t},joinConditions:function(e,n){var t,s,l,i,r,u,o,c,a,f,d,_,h=this,p=0;for(t in n)n[R](t)&&(s=w.parse(t,h),l=s._col,e[R](l)&&(i=n[t],u=e[l].table,o=e[l].id,c=e[l].join,a=e[l].join_id,p++,f=c+p,r={},e[l][R]("key")&&l!==e[l].key?(d=e[l].key,r[f+"."+d]=l):d=l,e[l][R]("value")?(_=e[l].value,r[f+"."+_]=i):(_=d,r[f+"."+_]=i),h.Join(c+" AS "+f,u+"."+o+"="+f+"."+a,"inner").Where(r),delete n[t]));return h},refs:function(e,n,t){var s=this;if(!0===t){var l,i,r,u,o,c,a,f,_;for(l=0,i=e.length;i>l;l++)r=e[l],o=r.alias,c=r.qualified,a=r.full,n[R](o)?e[l]=n[o]:n[R](a)?(u=n[a],f=u.alias,_=u.full,_!==a&&f!==o&&f===a&&(u=u.cloned(r.alias),e[l]=n[o]=u)):n[R](c)?(u=n[c],u.qualified!==c&&(u=n[u.qualified]),u=u.cloned(r.alias,null,r._func),e[l]=n[u.alias]=u,u.alias===u.full||n[R](u.full)||(n[u.full]=u)):(n[o]=r,o===a||n[R](a)||(n[a]=r))}else{var l,i,h,p,v,g,r,o,c;for(g=d(e),e=[],l=0,i=g.length;i>l;l++)for(v=g[l].split(","),h=0,p=v.length;p>h;h++)r=w.parse(v[h],s),o=r.alias,c=r.full,n[R](o)?r=n[o]:(n[o]=r,c===o||n[R](c)||(n[c]=r)),e.push(r)}return e},tbl:function(e){var n=this;if(u(e)){for(var t=0,s=e.length;s>t;t++)e[t]=n.tbl(e[t]);return e}return n.p+e},intval:function(e){var n=this;if(u(e)){for(var t=0,s=e.length;s>t;t++)e[t]=n.intval(e[t]);return e}return parseInt(e,10)},quote_name:function(e,n){var t=this,s=t.qn;if(n=!0===n,u(e)){for(var l=0,i=e.length;i>l;l++)e[l]=t.quote_name(e[l],n);return e}return n?(s[0]==e.slice(0,s[0].length)?"":s[0])+e+(s[1]==e.slice(-s[1].length)?"":s[1]):s[0]+e+s[1]},quote:function(e){var n=this,t=n.q;if(u(e)){for(var s=0,l=e.length;l>s;s++)e[s]=n.quote(e[s]);return e}return t[0]+n.esc(e)+t[1]},like:function(e){var n,t,s=this;if(u(e)){for(var l=0,i=e.length;i>l;l++)e[l]=s.like(e[l]);return e}return n=s.q,t=s.escdb?["",""]:s.e,t[0]+n[0]+"%"+s.esc_like(s.esc(e))+"%"+n[1]+t[1]},multi_like:function(e,n,t){var s,l,i,r,u,o,c,a=this;for(t=!1!==t,s=e+" LIKE ",l=n.split(","),t&&(l=v(p(l,D),Boolean)),r=0,u=l.length;u>r;r++){for(i=l[r].split("+"),t&&(i=v(p(i,D),Boolean)),o=0,c=i.length;c>o;o++)i[o]=s+a.like(i[o]);l[r]="("+i.join(" AND ")+")"}return l.join(" OR ")},esc:function(e){var n,t,s,l,i,r,o,c=this;if(u(e)){for(s=0,l=e.length;l>s;s++)e[s]=c.esc(e[s]);return e}if(c.escdb)return c.escdb(e);for(o=c.q,n="\\"+L,t="\\",e=String(e),i="",s=0,l=e.length;l>s;s++)r=e.charAt(s),i+=o[0]===r?o[2]:o[1]===r?o[3]:_(r,n,t);return i},esc_like:function(e){var n=this;if(u(e)){for(var t=0,s=e.length;s>t;t++)e[t]=n.esc_like(e[t]);return e}return _(e,"_%","\\")}},q});