/**
*   Dialect, 
*   a simple and flexible Cross-Platform & Cross-Vendor SQL Query Builder for PHP, Python, Node/XPCOM/JS
* 
*   @version: 1.2.0
*   https://github.com/foo123/Dialect
*
*   Abstract the construction of SQL queries
*   Support multiple DB vendors
*   Intuitive and Flexible API
**/
!function(t,e,s){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import?(t.$deps=t.$deps||{})&&(t.EXPORTED_SYMBOLS=[e])&&(t[e]=t.$deps[e]=s.call(t)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[e]=s.call(t)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System.import?System.register(e,[],function(l){l(e,s.call(t))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(e)?define(e,["module"],function(e){return s.moduleUri=e.uri,s.call(t)}):e in t||(t[e]=s.call(t)||1)&&"function"==typeof define&&define.amd&&define(function(){return t[e]})}("undefined"!=typeof self?self:this,"Dialect",function(t){"use strict";var e="prototype",s=Object.keys,l=Object[e].toString,n=Object[e].hasOwnProperty,i="charAt",u="charCodeAt",r=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,a=/^\s+|\s+$/g,o=String[e].trim?function(t){return t.trim()}:function(t){return t.replace(a,"")},c=String.fromCharCode(0);function h(){return h.GUID+=1,p((new Date).getTime().toString(16),12)+"--"+p(h.GUID.toString(16),4)}function f(t,e,s){if(!(this instanceof f))return new f(t,e,s);this.id=null,this.tpl=null,this._renderer=null,this._args=[t||"",e||f.defaultArgs,s],this._parsed=!1}function d(t,e){return t&&n.call(t,e)?1:0}function p(t,e,s,l){var n=String(t);if(s=s||"0",l)for(;n.length<e;)n+=s;else for(;n.length<e;)n=s+n;return n}function _(t,e,s){for(var l,n="";e<s&&(" "===(l=t[i](e))||"\r"===l||"\t"===l||"\v"===l||"\0"===l);)n+=l,e+=1;return n}function E(t,e){var s,l,n,u=t.length;if(u&&e.length)for(s="",n=0;n<u;n++)s+=l=t[i](n),"\n"===l&&(s+=e);else s=t;return s}function T(t,e,s,l){var n,i,u,r,a=0;if(e)for(n=t,i=e.length,u=0,a=1;u<i;){if(r=e[u++],null==n||null==n[r]){a=0;break}n=n[r]}if(!a&&s)for(n=t,i=s.length,u=0,a=1;u<i;){if(r=s[u++],null==n||null==n[r]){a=0;break}n=n[r]}if(!a&&null!=l&&l!==t){if(e)for(n=l,i=e.length,u=0,a=1;u<i;){if(r=e[u++],null==n||null==n[r]){a=0;break}n=n[r]}if(!a&&s)for(n=l,i=s.length,u=0,a=1;u<i;){if(r=s[u++],null==n||null==n[r]){a=0;break}n=n[r]}}return a?n:null}function g(t,e){this.prev=t||null,this.value=e||null}function v(t,e){e&&(e.next=this),this.node=t||null,this.prev=e||null,this.next=null}function I(t,e,s,l,n,i,u){var r,a,o,c,h,f,d,p,_=null,E="";if(-1===e.type){if((r=e.opt_args)&&r.value[5])for(;r;){if(o=T(t,(a=r.value)[1],[String(a[0])],a[6]?null:u),null===_&&e.name===a[0]&&(_=o),0===a[2]&&null==o||1===a[2]&&null!=o)return"";r=r.prev}}else _=T(t,e.key,[String(e.name)],e.loc?null:u);if(p=(c=y(_))?_.length:-1,c&&p>e.start)for(h=e.start,f=-1===e.end?p-1:Math.min(e.end,p-1),d=h;d<=f;d++)E+=b(t,e.tpl,s,l,d,i,u);else c||e.start!==e.end||(E=b(t,e.tpl,s,l,null,i,u));return E}function m(t,e,s,l,n,i,u){var r,a,o,c,h="";if(e.stpl&&(d(s,e.stpl)||d(N.subGlobal,e.stpl)||d(l,e.stpl)||d(l,"*")||d(N.fnGlobal,e.stpl)||d(N.fnGlobal,"*")))if(r=T(t,e.key,[String(e.name)],e.loc?null:u),d(s,e.stpl)||d(N.subGlobal,e.stpl))null==n||0===n&&e.start===e.end&&e.opt||!y(r)||(r=n<r.length?r[n]:null),null==r&&null!==e.dval?h=e.dval:(o=d(s,e.stpl)?s[e.stpl].node:N.subGlobal[e.stpl].node,a={},null!=r&&(y(r)?a[o.name]=r:a=r),h=I(a,o,s,l,0,e.algn?i:"",null==u?t:u));else{if(c=null,d(l,e.stpl)?c=l[e.stpl]:d(l,"*")?c=l["*"]:d(N.fnGlobal,e.stpl)?c=N.fnGlobal[e.stpl]:N.fnGlobal["*"]&&(c=N.fnGlobal["*"]),y(r)&&(r=(n=null!=n?n:e.start)<r.length?r[n]:null),"function"==typeof c)r=c(r,{symbol:e,index:n,currentArguments:t,originalArguments:u,alignment:i});else r=String(c);h=null==r&&null!==e.dval?e.dval:String(r),e.algn&&(h=E(h,i))}else e.opt&&null!==e.dval?h=e.dval:(y(r=T(t,e.key,[String(e.name)],e.loc?null:u))&&(r=(n=null!=n?n:e.start)<r.length?r[n]:null),h=null==r&&null!==e.dval?e.dval:String(r),e.algn&&(h=E(h,i)));return h}function b(t,e,s,l,n,i,u){for(var r,a=i=i||"",o="";e;)-1===(r=e.node.type)?o+=I(t,e.node,s,l,0,e.node.algn?a:i,u):1===r?o+=m(t,e.node,s,l,n,e.node.algn?a:i,u):0===r?(a+=e.node.algn,o+=e.node.val):100===r&&(a=i,o+="\n"+i),e=e.next;return o}function N(t,e,s){if(!(this instanceof N))return new N(t,e,s);this.id=null,this.tpl=null,this.fn={},this._args=[t||"",e||N.defaultDelimiters,s||!1]}function A(t,e){return new RegExp(t,e||"")}function O(t){return t.replace(r,"\\$&")}function R(t){return"function"==typeof t}function w(t){return t instanceof String||"[object String]"===l.call(t)}function y(t){return t instanceof Array||"[object Array]"===l.call(t)}function S(t){return t instanceof Object||"[object Object]"===l.call(t)}function L(t){if(!t)return!0;var e=l.call(t);return(t instanceof Array||t instanceof String||"[object Array]"===e||"[object String]"===e)&&!t.length||(t instanceof Object||"[object Object]"===e)&&!s(t).length}function q(t){return parseInt(t||0,10)||0}function M(t){return t===+t&&isFinite(t)&&!(t%1)}function C(t){return y(t)?t:[t]}function D(t,e,s){var l,n,r,a="";for(3>arguments.length&&(s="\\"),2>arguments.length&&(e="\\\"'"+c),l=0,n=t.length;l<n;l++)r=t[i](l),a+=-1===e.indexOf(r)?r:0===r[u](0)?"\\0":s+r;return a}function B(t,e,s,l){for(var i in s=!0===s,l=!0===l,e)n.call(e,i)&&(!s&&n.call(t,i)||(t[i]=l&&e[i].slice?e[i].slice():e[i]));return t}function k(t,e){var s=t.length;if(!s)return[];var l,n,i=15&s,u=1&i,r=new Array(s);for(u&&(r[0]=e(t[0])),l=u;l<i;l+=2)n=l,r[l]=e(t[n]),r[l+1]=e(t[n+1]);for(l=i;l<s;l+=16)n=l,r[l]=e(t[n]),r[l+1]=e(t[n+1]),r[l+2]=e(t[n+2]),r[l+3]=e(t[n+3]),r[l+4]=e(t[n+4]),r[l+5]=e(t[n+5]),r[l+6]=e(t[n+6]),r[l+7]=e(t[n+7]),r[l+8]=e(t[n+8]),r[l+9]=e(t[n+9]),r[l+10]=e(t[n+10]),r[l+11]=e(t[n+11]),r[l+12]=e(t[n+12]),r[l+13]=e(t[n+13]),r[l+14]=e(t[n+14]),r[l+15]=e(t[n+15]);return r}function U(t,e){var s=t.length;if(!s)return[];var l,n,i=15&s,u=1&i,r=[];for(u&&e(t[0])&&r.push(t[0]),l=u;l<i;l+=2)e(t[n=l])&&r.push(t[n]),e(t[++n])&&r.push(t[n]);for(l=i;l<s;l+=16)e(t[n=l])&&r.push(t[n]),e(t[++n])&&r.push(t[n]),e(t[++n])&&r.push(t[n]),e(t[++n])&&r.push(t[n]),e(t[++n])&&r.push(t[n]),e(t[++n])&&r.push(t[n]),e(t[++n])&&r.push(t[n]),e(t[++n])&&r.push(t[n]),e(t[++n])&&r.push(t[n]),e(t[++n])&&r.push(t[n]),e(t[++n])&&r.push(t[n]),e(t[++n])&&r.push(t[n]),e(t[++n])&&r.push(t[n]),e(t[++n])&&r.push(t[n]),e(t[++n])&&r.push(t[n]),e(t[++n])&&r.push(t[n]);return r}function G(t,e,s){var l,n,i="";if(t&&t.length)for(s=null==s?",":s,i=t[0][e],l=1,n=t.length;l<n;l++)i+=s+t[l][e];return i}function F(t,e,s,l,n,i,u,r,a,o,c){if(this._col=t,this.col=e,this._tbl=s,this.tbl=l,this._dtb=n,this.dtb=i,this._alias=u,this._qualified=a,this.qualified=o,this.full=this.qualified,this._func=null==c?[]:c,this._func.length)for(var h=0,f=this._func.length;h<f;h++)this.full=this._func[h]+"("+this.full+")";null!=this._alias?(this.alias=r,this.aliased=this.full+" AS "+this.alias):(this.alias=this.full,this.aliased=this.full)}h.GUID=0,f.VERSION="1.0.0",f.defaultArgs=/\$(-?[0-9]+)/g,f.guid=h,f.multisplit=function(t,e,s){var l,i,u,r,a,o,c,h,f,d;for(l in s=!!s,o=[[1,t]],e)if(n.call(e,l)){for(h=[],i=s?e[l]:l,u=[0,e[l]],r=0,f=o.length;r<f;r++)if(1===o[r][0]){if(d=(c=o[r][1].split(i)).length,h.push([1,c[0]]),d>1)for(a=0;a<d-1;a++)h.push(u),h.push([1,c[a+1]])}else h.push(o[r]);o=h}return o},f.multisplit_re=function(t,e){e=e.global?e:new RegExp(e.source,e.ignoreCase?"gi":"g");for(var s,l=[],n=0;s=e.exec(t);)l.push([1,t.slice(n,e.lastIndex-s[0].length)]),l.push([0,s[1]?s[1]:s[0]]),n=e.lastIndex;return l.push([1,t.slice(n)]),l},f.arg=function(t,e){var s,l,n,i,u,r="args";if(arguments.length&&null!=t)for(i=(t=t.substr?t.length?t.split("."):[]:[t]).length,u=!(!e||!e.substr),s=0;s<i;s++)n=+(l=t[s]),isNaN(n)?r+='["'+l+'"]':(n<0&&(l=u?e+-n:r+".length-"+-n),r+="["+l+"]");return r},f.compile=function(t,e){var s,l,n,i,u=t.length;if(!0===e){for(i='"use strict"; return (',s=0;s<u;s++)l=t[s][0],n=t[s][1],i+=l?n:f.arg(n);i+=");"}else{for(i='"use strict"; var argslen=args.length; return (',s=0;s<u;s++)l=t[s][0],n=t[s][1],i+=l?"'"+n.replace(SQUOTE,"\\'").replace(NEWLINE,"' + \"\\n\" + '")+"'":" + String("+f.arg(n,"argslen")+") + ";i+=");"}return new Function("args",i)},f[e]={constructor:f,id:null,tpl:null,_parsed:!1,_args:null,_renderer:null,dispose:function(){return this.id=null,this.tpl=null,this._parsed=null,this._args=null,this._renderer=null,this},fixRenderer:function(){return this.render="function"==typeof this._renderer?this._renderer:this.constructor[e].render,this},parse:function(){if(!1===this._parsed){this._parsed=!0;var t=this._args[0],e=this._args[1],s=this._args[2];this._args=null,this.tpl=e instanceof RegExp?f.multisplit_re(t,e):f.multisplit(t,e),!0===s&&(this._renderer=f.compile(this.tpl),this.fixRenderer())}return this},render:function(t){if(t=t||[],!1===this._parsed&&(this.parse(),this._renderer))return this._renderer(t);var e,s,l,n=this.tpl,i=n.length,u=t.length,r="";for(e=0;e<i;e++)1===(s=n[e])[0]?r+=s[1]:(+(l=s[1])===l&&l<0&&(l=u+l),r+=t[l]);return r}},N.VERSION="3.0.0",N.defaultDelimiters=["<",">","[","]"],N.fnGlobal={},N.subGlobal={},N.guid=h,N.multisplit=function(t,e,s){var l,n,u,r,a,c,f,p,E,T,I,m,b,N,A,O,R,w,y,S,L,q,M,C,D,B,k=e[0],U=e[1],G=e[2],F=e[3],j=k.length,H=U.length,x=G.length,Y=F.length,W="#"+F,P=null,V=0,X=0,K=0,J=0,Q=t.length,$=[k,j,U,H],Z=[G,x,F,Y],z=[null,0,null,0,null,0,null,0];for(s=!0===s,y={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},L=E=new v({type:0,val:"",algn:""}),q=null,S=null,A={},R=null,O={},w=null,$[1]<$[3]&&(I=$[0],$[2]=$[0],$[0]=I,m=$[1],$[3]=$[1],$[1]=m),Z[1]<Z[3]&&(I=Z[0],Z[2]=Z[0],Z[0]=I,m=Z[1],Z[3]=Z[1],Z[1]=m),n=0,u=0,m=0;4>n&&4>u;)$[n+1]<Z[u+1]?(z[m]=Z[u],z[m+1]=Z[u+1],u+=2):(z[m]=$[n],z[m+1]=$[n+1],n+=2),m+=2;for(;4>n;)z[m]=$[n],z[m+1]=$[n+1],n+=2,m+=2;for(;4>u;)z[m]=Z[u],z[m+1]=Z[u+1],u+=2,m+=2;for(f=null,I="",m=0;m<Q;)if("\\"!==(p=t[i](m)))if(B=null,z[0]===t.substr(m,z[1])?B=z[0]:z[2]===t.substr(m,z[3])?B=z[2]:z[4]===t.substr(m,z[5])?B=z[4]:z[6]===t.substr(m,z[7])&&(B=z[6]),k===B)m+=j,I.length&&(0===E.node.type?E.node.val+=I:E=new v({type:0,val:I,algn:""},E)),I="";else if(U===B){if(m+=H,a=I,I="",-1<(c=a.indexOf("|"))?(P=a.slice(c+1),a=a.slice(0,c)):P=null,"?"===(p=s?m<Q?t[i](m):"":a[i](0))||"*"===p)X=1,"*"===p?(n=1,u=-1):(n=0,u=0),s?(m+=1)<Q&&"!"===t[i](m)?(V=1,m+=1):V=0:"!"===a[i](1)?(V=1,a=a.slice(2)):(V=0,a=a.slice(1));else if("{"===p){if(s){for(I="",b=m+1,N=Q;b<N&&"}"!==t[i](b);)I+=t[i](b++);m=b+1}else{for(I="",b=1,N=a.length;b<N&&"}"!==a[i](b);)I+=a[i](b++);a=a.slice(b+1)}(I=I.split(",")).length>1?(n=(n=o(I[0])).length?0|+n:0,u=(u=o(I[1])).length?0|+u:-1,X=1):(u=n=(n=o(I[0])).length?0|+n:0,X=0),I="",V=0}else X=0,V=0,n=0,u=0;if(V&&null===P&&(P=""),"@"===(p=a[i](0))?(K=1,a=a.slice(1)):K=0,"."===(p=a[i](0))?(J=1,a=a.slice(1)):J=0,a=(r=-1<a.indexOf(":")?a.split(":"):[a,null])[0],r=r[1],l=-1<a.indexOf(".")?a.split("."):null,R&&!d(O,R)&&(O[R]={}),":="+G===t.substr(m,2+x)&&(m+=2,w=r=r&&r.length?r:"grtpl--"+h(),R&&a.length&&(O[R][a]=r)),!a.length)continue;null==r&&R&&d(O,R)&&d(O[R],a)&&(r=O[R][a]),X&&!y.opt?(y.name=a,y.key=l,y.stpl=r,y.dval=P,y.opt=X,y.neg=V,y.algn=K,y.loc=J,y.start=n,y.end=u,S=new g(null,[a,l,V,n,u,X,J])):X?(n!==u&&y.start===y.end&&(y.name=a,y.key=l,y.stpl=r,y.dval=P,y.opt=X,y.neg=V,y.algn=K,y.loc=J,y.start=n,y.end=u),S=new g(S,[a,l,V,n,u,X,J])):X||null!==y.name||(y.name=a,y.key=l,y.stpl=r,y.dval=P,y.opt=0,y.neg=V,y.algn=K,y.loc=J,y.start=n,y.end=u,S=new g(null,[a,l,V,n,u,0,J])),0===E.node.type&&(E.node.algn=_(E.node.val,0,E.node.val.length)),E=new v({type:1,name:a,key:l,stpl:r,dval:P,opt:X,algn:K,loc:J,start:n,end:u},E)}else if(G===B){if(m+=x,I.length&&(0===E.node.type?E.node.val+=I:E=new v({type:0,val:I,algn:""},E)),I="","#"===t[i](m)){for(b=m+1,N=Q;b<N&&W!==t.substr(b,Y+1);)I+=t[i](b++);m=b+Y+1,0===E.node.type&&(E.node.algn=_(E.node.val,0,E.node.val.length)),E=new v({type:-100,val:I},E),I="";continue}f=new g(f,[E,q,y,S,R,w]),w&&(R=w),w=null,y={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},S=null,q=E=new v({type:0,val:"",algn:""})}else F===B?(m+=Y,T=E,M=q,C=y,D=S,f?(E=f.value[0],q=f.value[1],y=f.value[2],S=f.value[3],R=f.value[4],w=f.value[5],f=f.prev):E=null,I.length&&(0===T.node.type?T.node.val+=I:T=new v({type:0,val:I,algn:""},T)),I="",w?(A[w]=new v({type:2,name:C.name,key:C.key,loc:C.loc,algn:C.algn,start:C.start,end:C.end,opt_args:null,tpl:M}),w=null):(0===E.node.type&&(E.node.algn=_(E.node.val,0,E.node.val.length)),E=new v({type:-1,name:C.name,key:C.key,loc:C.loc,algn:C.algn,start:C.start,end:C.end,opt_args:D,tpl:M},E))):"\n"===(p=t[i](m++))?(I.length&&(0===E.node.type?E.node.val+=I:E=new v({type:0,val:I,algn:""},E)),I="",0===E.node.type&&(E.node.algn=_(E.node.val,0,E.node.val.length)),E=new v({type:100,val:"\n"},E)):I+=p;else I+=m+1<Q?t[i](m+1):"",m+=2;return I.length&&(0===E.node.type?E.node.val+=I:E=new v({type:0,val:I,algn:""},E)),0===E.node.type&&(E.node.algn=_(E.node.val,0,E.node.val.length)),[L,A]},N.align=E,N.main=b,N[e]={constructor:N,id:null,tpl:null,fn:null,_args:null,dispose:function(){return this.id=null,this.tpl=null,this.fn=null,this._args=null,this},parse:function(){return null===this.tpl&&null!==this._args&&(this.tpl=N.multisplit(this._args[0],this._args[1],this._args[2]),this._args=null),this},render:function(t){return null===this.tpl&&this.parse(),N.main(null==t?{}:t,this.tpl[0],this.tpl[1],this.fn)}};var j=/\s/,H=/[0-9]/,x=/[a-z_]/i;F.parse=function(t,e){if(t instanceof F)return t;var s,l,n,i,u,r,a,c,h,f,d,p,_,E,T,g,v,I,m,b,N,A,O,R,w,y,S,L,q,M,C,D,B=["AS"];for(l=(t=o(t)).length,s=0,i=(n=[[]])[0],u=[],r=[],a="",c=null,d=0,p=null,T=0,g=null,v=null,b=null;s<l;)if("("!==(_=t.charAt(s++))||1!==s)if(0<T){if('"'===_||"`"===_||"'"===_||"["===_||"]"===_){if(g){if(g===_)if(I=('"'===_||"`"===_)&&e.qn[3]===_+_||"'"===_&&e.q[3]===_+_,m=('"'===_||"`"===_)&&e.qn[3]==="\\"+_||"'"===_&&e.q[3]==="\\"+_,I&&s<l&&_===t.charAt(s))s++;else if(m){if(N=!1,-1!==e.e[1].indexOf("'\\'")&&"'\\'"===t.slice(v,s));else for(A=s-2;0<=A&&"\\"===t.charAt(A);)N=!N,A--;N||(g=null,v=null)}else g=null,v=null}else g="["===_?"]":_,v=s-1;continue}if(g)continue;if("("===_){T++;continue}if(")"===_){if(0>--T){c=["paren",s];break}if(0===T){if(g){c=["quote",s];break}a=b=t.slice(0,s);continue}continue}}else{if('"'===_||"`"===_||"'"===_||"["===_||"]"===_){if(!p){if(a.length||"]"===_){c=["invalid",s];break}p="["===_?"]":_;continue}if(p===_){if(s<l&&_===t.charAt(s)){a+=_,s++;continue}if(!a.length){c=["invalid",s];break}i.unshift([1,a]),u.unshift(a),a="",p=null;continue}if(p){a+=_;continue}}if(p)a+=_;else if("*"===_){if(a.length){c=["invalid",s];break}i.unshift([10,"*"]),u.unshift(10)}else if("."===_){if(a.length&&(i.unshift([1,a]),u.unshift(a),a=""),!i.length||1!==i[0][0]){c=["invalid",s];break}i.unshift([0,"."]),u.unshift(0)}else if("("===_){if(d++,a.length&&(i.unshift([2,a]),r.unshift(a),a=""),!i.length||2!==i[0][0]&&1!==i[0][0]){c=["invalid",s];break}1===i[0][0]&&(i[0][0]=2,r.unshift(u.shift())),n.unshift([]),i=n[0]}else if(")"===_){if(d--,a.length&&(E=-1<B.indexOf(a.toUpperCase()),i.unshift([E?5:1,a]),u.unshift(E?5:a),a=""),n.length<2){c=["invalid",s];break}n[1].unshift([100,n.shift()]),i=n[0]}else{if(j.test(_)){a.length&&(E=-1<B.indexOf(a.toUpperCase()),i.unshift([E?5:1,a]),u.unshift(E?5:a),a="");continue}if(H.test(_)){if(!a.length){c=["invalid",s];break}a+=_}else{if(!x.test(_)){c=["invalid",s];break}a+=_}}}else T++;if(a.length&&(i.unshift([1,a]),u.unshift(a),a=""),c||!d&&!T||(c=["paren",l]),c||!p&&!g||(c=["quote",l]),c||1===n.length||(c=["invalid",l]),c)throw h=c[1]-1,"paren"==(f=c[0])?new TypeError('Dialect: Mismatched parentheses "'+t+'" at position '+h+"."):"quote"==f?new TypeError('Dialect: Mismatched quotes "'+t+'" at position '+h+"."):new TypeError('Dialect: Invalid character "'+t+'" at position '+h+".");return q=null,M="",null!=b?(u.length>=3&&5===u[1]&&"string"==typeof u[0]&&(q=u.shift(),M=e.quote_name(q),u.shift()),w=null,y="",S=null,L="",C=O=b,D=R=b):(u.length>=3&&5===u[1]&&"string"==typeof u[0]&&(q=u.shift(),M=e.quote_name(q),u.shift()),O=null,R="",!u.length||"string"!=typeof u[0]&&10!==u[0]||(10===u[0]?(u.shift(),O=R="*"):(O=u.shift(),R=e.quote_name(O))),w=null,y="",u.length>=2&&0===u[0]&&"string"==typeof u[1]&&(u.shift(),w=u.shift(),y=e.quote_name(w)),S=null,L="",u.length>=2&&0===u[0]&&"string"==typeof u[1]&&(u.shift(),S=u.shift(),L=e.quote_name(S)),C=(S?S+".":"")+(w?w+".":"")+(O||""),D=(S?L+".":"")+(w?y+".":"")+(O?R:"")),new F(O,R,w,y,S,L,q,M,C,D,r)},F[e]={constructor:F,_func:null,_col:null,col:null,_tbl:null,tbl:null,_dtb:null,dtb:null,_alias:null,alias:null,_qualified:null,qualified:null,full:null,aliased:null,cloned:function(t,e,s){return arguments.length?e=e||t:(t=this._alias,e=this.alias),null==s&&(s=this._func),new F(this._col,this.col,this._tbl,this.tbl,this._dtb,this.dtb,t,e,this._qualified,this.qualified,s)},dispose:function(){return this._func=null,this._col=null,this.col=null,this._tbl=null,this.tbl=null,this._dtb=null,this.dtb=null,this._alias=null,this.alias=null,this._qualified=null,this.qualified=null,this.full=null,this.aliased=null,this}};function Y(t){if(arguments.length||(t="mysql"),!(this instanceof Y))return new Y(t);if(t&&n.call(Y.aliases,t)&&(t=Y.aliases[t]),!t||!Y.dialects[t]||!Y.dialects[t].clauses)throw new TypeError('Dialect: SQL dialect does not exist for "'+t+'"');this.clau=null,this.clus=null,this.tbls=null,this.cols=null,this.vews={},this.tpls={},this.db=null,this.escdb=null,this.escdbn=null,this.p="",this.type=t,this.clauses=Y.dialects[this.type].clauses,this.q=Y.dialects[this.type].quotes[0],this.qn=Y.dialects[this.type].quotes[1],this.e=Y.dialects[this.type].quotes[2]||["","","",""],this.clauses instanceof Y.GrammarTemplate||(this.clauses=new Y.GrammarTemplate(this.clauses),Y.dialects[this.type].clauses=this.clauses)}return Y.VERSION="1.2.0",Y.dialects={mysql:{quotes:[["'","'","\\'","\\'"],["`","`","``","``"],["","","",""]],functions:{strpos:["POSITION(",2," IN ",1,")"],strlen:["LENGTH(",1,")"],strlower:["LCASE(",1,")"],strupper:["UCASE(",1,")"],trim:["TRIM(",1,")"],quote:["QUOTE(",1,")"],random:["RAND()"],now:["NOW()"]},types:{BINARY:"VARBINARY",SMALLINT:"TINYINT",MEDIUMINT:"MEDIUMINT",INT:"UNSIGNED INT",SIGNED_INT:"INT",BIGINT:"UNSIGNED BIGINT",SIGNED_BIGINT:"BIGINT",FLOAT:"FLOAT",DOUBLE:"DOUBLE",BOOL:"TINYINT",TIMESTAMP:"TIMESTAMP",DATETIME:"DATETIME",DATE:"DATE",TIME:"TIME",VARCHAR:"VARCHAR",TEXT:"TEXT",BLOB:"BLOB"},clauses:"[<?start_transaction_clause|>START TRANSACTION <type|>;][<?commit_transaction_clause|>COMMIT;][<?rollback_transaction_clause|>ROLLBACK;][<?transact_clause|>START TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE VIEW <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]UNIQUE KEY <name|> <type|> (<?uniquekey>[,<*uniquekey>])][[CONSTRAINT <?constraint> ]PRIMARY KEY <type|> (<?primarykey>)][[<?!index>KEY][<?index|>INDEX] <name|> <type|> (<?key>[,<*key>])][CHECK (<?check>)][<?column> <type>[ <?!isnull><?isnotnull|>NOT NULL][ <?!isnotnull><?isnull|>NULL][ DEFAULT <?default_value>][ <?auto_increment|>AUTO_INCREMENT][ <?!primary><?unique|>UNIQUE KEY][ <?!unique><?primary|>PRIMARY KEY][ COMMENT '<?comment>'][ COLUMN_FORMAT <?format>][ STORAGE <?storage>]]][,\n<*col:COL>]]\n)][ <?options>:=[<opt:OPT>:=[[ENGINE=<?engine>][AUTO_INCREMENT=<?auto_increment>][CHARACTER SET=<?charset>][COLLATE=<?collation>]][, <*opt:OPT>]]][\nAS <?query>]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>[<?temporary|>TEMPORARY ]TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\n[VALUES <?values_values>[,<*values_values>]]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]][<?delete_clause|>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]]"},postgresql:{quotes:[["'","'","''","''"],['"','"','""','""'],["E","","E",""]],functions:{strpos:["position(",2," in ",1,")"],strlen:["length(",1,")"],strlower:["lower(",1,")"],strupper:["upper(",1,")"],trim:["trim(",1,")"],quote:["quote(",1,")"],random:["random()"],now:["now()"]},types:{BINARY:"BYTEA",SMALLINT:"SMALLINT",MEDIUMINT:"INTEGER",INT:"SERIAL",SIGNED_INT:"INTEGER",BIGINT:"BIGSERIAL",SIGNED_BIGINT:"BIGINT",FLOAT:"REAL",DOUBLE:"DOUBLE PRECISION",BOOL:"BOOLEAN",TIMESTAMP:"TIMESTAMP WITHOUT TIME ZONE",DATETIME:"TIMESTAMP WITHOUT TIME ZONE",DATE:"DATE",TIME:"TIME WITHOUT TIME ZONE",VARCHAR:"VARCHAR",TEXT:"TEXT",BLOB:"BLOB"},clauses:"[<?start_transaction_clause|>START TRANSACTION <type|>;][<?commit_transaction_clause|>COMMIT;][<?rollback_transaction_clause|>ROLLBACK;][<?transact_clause|>START TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>:=[<col:COL>:=[[<?column> <type>[ COLLATE <?collation>][ CONSTRAINT <?constraint>][ <?!isnull><?isnotnull|>NOT NULL][ <?!isnotnull><?isnull|>NULL][ DEFAULT <?default_value>][ CHECK (<?check>)][ <?unique|>UNIQUE][ <?primary|>PRIMARY KEY]]][,\n<*col:COL>]]\n)]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\n[VALUES <?values_values>[,<*values_values>]]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]][<?delete_clause|>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]]"},transactsql:{quotes:[["'","'","''","''"],["[","]","[","]"],[""," ESCAPE '\\'","",""]],functions:{strpos:["CHARINDEX(",2,",",1,")"],strlen:["LEN(",1,")"],strlower:["LOWER(",1,")"],strupper:["UPPER(",1,")"],trim:["LTRIM(RTRIM(",1,"))"],quote:["QUOTENAME(",1,',"\'")'],random:["RAND()"],now:["CURRENT_TIMESTAMP"]},types:{BINARY:"VARBINARY",SMALLINT:"TINYINT",MEDIUMINT:"SMALLINT",INT:"INT",SIGNED_INT:"INT",BIGINT:"BIGINT",SIGNED_BIGINT:"BIGINT",FLOAT:"FLOAT",DOUBLE:"REAL",BOOL:"BIT",TIMESTAMP:"DATETIME",DATETIME:"DATETIME",DATE:"DATE",TIME:"TIME",VARCHAR:"VARCHAR",TEXT:"TEXT",BLOB:"TEXT"},clauses:"[<?start_transaction_clause|>BEGIN TRANSACTION <type|>;][<?commit_transaction_clause|>COMMIT;][<?rollback_transaction_clause|>ROLLBACK;][<?transact_clause|>BEGIN TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>[<?ifnotexists|>IF NOT EXISTS (SELECT * FROM sysobjects WHERE name=<create_table> AND xtype='U')\n]CREATE TABLE <create_table> [<?!query>(\n<columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]<?column> <type|>[ <?isnotnull|>NOT NULL][ [CONSTRAINT <?constraint> ]DEFAULT <?default_value>][ CHECK (<?check>)][ <?!primary><?unique|>UNIQUE][ <?!unique><?primary|>PRIMARY KEY[ COLLATE <?collation>]]]][,\n<*col:COL>]]\n)][<?ifnotexists|>\nGO]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>][\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]][<?!order_conditions>[\nORDER BY 1\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\n[VALUES <?values_values>[,<*values_values>]]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]][<?delete_clause|>DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]]"},sqlite:{quotes:[["'","'","''","''"],['"','"','""','""'],[""," ESCAPE '\\'","",""]],functions:{strpos:["instr(",2,",",1,")"],strlen:["length(",1,")"],strlower:["lower(",1,")"],strupper:["upper(",1,")"],trim:["trim(",1,")"],quote:["quote(",1,")"],random:["random()"],now:["datetime('now')"]},types:{BINARY:"BLOB",SMALLINT:"INTEGER",MEDIUMINT:"INTEGER",INT:"INTEGER",SIGNED_INT:"INTEGER",BIGINT:"INTEGER",SIGNED_BIGINT:"INTEGER",FLOAT:"REAL",DOUBLE:"REAL",BOOL:"INTEGER",TIMESTAMP:"TEXT",DATETIME:"TEXT",DATE:"TEXT",TIME:"TEXT",VARCHAR:"TEXT",TEXT:"TEXT",BLOB:"BLOB"},clauses:"[<?start_transaction_clause|>BEGIN <type|> TRANSACTION;][<?commit_transaction_clause|>COMMIT;][<?rollback_transaction_clause|>ROLLBACK;][<?transact_clause|>BEGIN <type|> TRANSACTION;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]][<?create_clause|>[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [<?!query>(\n<columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]<?column> <type|>[ <?isnotnull|>NOT NULL][ DEFAULT <?default_value>][ CHECK (<?check>)][ <?!primary><?unique|>UNIQUE][ <?!unique><?primary|>PRIMARY KEY[ <?auto_increment|>AUTOINCREMENT][ COLLATE <?collation>]]]][,\n<*col:COL>]]\n)[ <?without_rowid|>WITHOUT ROWID]][AS <?query>]]][<?alter_clause|>ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]][<?drop_clause|>DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>][<?select_clause|>SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]][<?insert_clause|>INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\n[VALUES <?values_values>[,<*values_values>]]][<?update_clause|>UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>]][<?delete_clause|>[<?!order_conditions><?!count>DELETE FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]][DELETE FROM <from_tables> [, <*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]\nORDER BY <?order_conditions> [, <*order_conditions>][\nLIMIT <?count> OFFSET <offset|0>]\n)][<?!order_conditions>DELETE FROM <from_tables> [, <*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]\nLIMIT <?count> OFFSET <offset|0>\n)]]"}},Y.aliases={mysqli:"mysql",mariadb:"mysql",sqlserver:"transactsql",postgres:"postgresql",postgre:"postgresql"},Y.StringTemplate=f,Y.GrammarTemplate=N,Y.Ref=F,Y[e]={constructor:Y,clau:null,clus:null,tbls:null,cols:null,vews:null,tpls:null,db:null,escdb:null,escdbn:null,p:null,type:null,clauses:null,q:null,qn:null,e:null,dispose:function(){return this.clau=null,this.clus=null,this.tbls=null,this.cols=null,this.vews=null,this.tpls=null,this.db=null,this.escdb=null,this.escdbn=null,this.p=null,this.type=null,this.clauses=null,this.q=null,this.qn=null,this.e=null,this},toString:function(){return this.sql()||""},driver:function(t){return arguments.length?(this.db=t||null,this):this.db},escape:function(t,e){return 2>arguments.length&&(e=!1),arguments.length?(this.escdb=t&&R(t)?[t,!!e]:null,this):this.escdb},escapeId:function(t,e){return 2>arguments.length&&(e=!1),arguments.length?(this.escdbn=t&&R(t)?[t,!!e]:null,this):this.escdbn},prefix:function(t){return arguments.length?(this.p=t&&t.length?t:"",this):this.p},reset:function(t){return this.clus={},this.tbls={},this.cols={},this.clau=t,this},clear:function(){return this.clau=null,this.clus=null,this.tbls=null,this.cols=null,this},subquery:function(){var t,e,s;return(t=new Y(this.type)).driver(this.driver()).prefix(this.prefix()),e=this.escape(),s=this.escapeId(),e&&t.escape(e[0],e[1]),s&&t.escapeId(s[0],s[1]),t.vews=this.vews,t},sql:function(){var t=null;return this.clau&&(n.call(this.clus,"select_columns")&&(this.clus.select_columns=G(this.clus.select_columns,"aliased")),n.call(this.clus,"from_tables")&&(this.clus.from_tables=G(this.clus.from_tables,"aliased")),n.call(this.clus,"insert_tables")&&(this.clus.insert_tables=G(this.clus.insert_tables,"aliased")),n.call(this.clus,"insert_columns")&&(this.clus.insert_columns=G(this.clus.insert_columns,"full")),n.call(this.clus,"update_tables")&&(this.clus.update_tables=G(this.clus.update_tables,"aliased")),n.call(this.clus,"create_table")&&(this.clus.create_table=G(this.clus.create_table,"full")),n.call(this.clus,"alter_table")&&(this.clus.alter_table=G(this.clus.alter_table,"full")),n.call(this.clus,"drop_tables")&&(this.clus.drop_tables=G(this.clus.drop_tables,"full")),n.call(this.clus,"where_conditions_required")&&(this.clus.where_conditions=n.call(this.clus,"where_conditions")?"("+this.clus.where_conditions_required+") AND ("+this.clus.where_conditions+")":this.clus.where_conditions_required,delete this.clus.where_conditions_required),n.call(this.clus,"having_conditions_required")&&(this.clus.having_conditions=n.call(this.clus,"having_conditions")?"("+this.clus.having_conditions_required+") AND ("+this.clus.having_conditions+")":this.clus.having_conditions_required,delete this.clus.having_conditions_required),this.clus[this.clau+"_clause"]=1,t=this.clauses.render(this.clus)||""),this.clear(),t},createView:function(t){return t&&this.clau&&(this.vews[t]={clau:this.clau,clus:this.clus,tbls:this.tbls,cols:this.cols},n.call(this.vews[t].clus,"where_conditions")&&(this.vews[t].clus.where_conditions&&(this.vews[t].clus.where_conditions_required=this.vews[t].clus.where_conditions),delete this.vews[t].clus.where_conditions),n.call(this.vews[t].clus,"having_conditions")&&(this.vews[t].clus.having_conditions&&(this.vews[t].clus.having_conditions_required=this.vews[t].clus.having_conditions),delete this.vews[t].clus.having_conditions),this.clear()),this},useView:function(t){var e,s;if(e=this.clus.select_columns,t=this.vews[t],this.clus=B(this.clus,t.clus,!0,!0),this.tbls=B({},t.tbls,!0),this.cols=B({},t.cols,!0),e){s=[];for(var l=0,n=(e=this.refs(e,this.cols,!0)).length;l<n;l++)"*"===e[l].full?s=s.concat(this.clus.select_columns):s.push(e[l]);this.clus.select_columns=s}return this},dropView:function(t){return t&&n.call(this.vews,t)&&delete this.vews[t],this},prepareTpl:function(t){var e,s,l,n,i,u,r,a;return L(t)||(1===(n=(l=arguments).length)?(i=null,u=null,r=null,a=!0):2===n?(i=l[1],u=null,r=null,a=!1):3===n?(i=null,u=l[1],r=l[2],a=!0):(i=l[1],u=l[2],r=l[3],a=!1),e=A((u=u?O(u):"%")+"(([rlfds]:)?[0-9a-zA-Z_]+)"+(r=r?O(r):"%")),s=a?new Y.StringTemplate(this.sql(),e):new Y.StringTemplate(i,e),this.tpls[t]={sql:s,types:null}),this},prepared:function(t,e){var s,l,i,u,r,a,o,c,h;if(!L(t)&&n.call(this.tpls,t)){if(s=this.tpls[t].sql,null===(l=this.tpls[t].types)){for(s.parse(),l={},a=0,o=s.tpl.length;a<o;a++)0===(c=s.tpl[a])[0]&&((h=c[1].split(":")).length>1?(l[h[1]]=h[0],s.tpl[a][1]=h[1]):(l[h[0]]="s",s.tpl[a][1]=h[0]));this.tpls[t].types=l}for(h in i={},e)if(n.call(e,h))switch(u=e[h],n.call(l,h)?l[h]:"s"){case"r":y(u)?i[h]=u.join(","):i[h]=u;break;case"l":i[h]=this.like(u);break;case"f":if(y(u))for(r=C(u),i[h]=F.parse(r[0],this).aliased,a=1,o=r.length;a<o;a++)i[h]+=","+F.parse(r[a],this).aliased;else i[h]=F.parse(u,this).aliased;break;case"d":y(u)?i[h]=this.intval(C(u)).join(","):i[h]=this.intval(u);break;case"s":default:y(u)?i[h]=this.quote(C(u)).join(","):i[h]=this.quote(u)}return s.render(i)}return""},prepare:function(t,e,s,l){var i,u,r,a,o,c,h,f,d;if(t&&e){for(i=A((s=s?O(s):"%")+"([rlfds]:)?([0-9a-zA-Z_]+)"+(l=l?O(l):"%")),d="";t.length&&(u=t.match(i));){if(r=u.index,a=u[0].length,f=u[2],n.call(e,f)){switch(u[1]?u[1].slice(0,-1):"s"){case"r":f=y(e[f])?e[f].join(","):e[f];break;case"l":f=this.like(e[f]);break;case"f":if(y(e[f]))for(h=C(e[f]),f=F.parse(h[0],this).aliased,o=1,c=h.length;o<c;o++)f+=","+F.parse(h[o],this).aliased;else f=F.parse(e[f],this).aliased;break;case"d":f=y(e[f])?this.intval(C(e[f])).join(","):this.intval(e[f]);break;case"s":default:f=y(e[f])?this.quote(C(e[f])).join(","):this.quote(e[f])}d+=t.slice(0,r)+f}else d+=t.slice(0,r)+this.quote("");t=t.slice(r+a)}return t.length&&(d+=t),d}return t},dropTpl:function(t){return!L(t)&&n.call(this.tpls,t)&&(this.tpls[t].sql.dispose(),delete this.tpls[t]),this},StartTransaction:function(t,e){return e=e||"start_transaction",this.clau!==e&&this.reset(e),this.clus.type=t||null,this},CommitTransaction:function(t){return t=t||"commit_transaction",this.clau!==t&&this.reset(t),this},RollbackTransaction:function(t){return t=t||"rollback_transaction",this.clau!==t&&this.reset(t),this},Transaction:function(t,e){var s;return e=e||"transact",this.clau!==e&&this.reset(e),t=t||{},this.clus.type=t.type||null,this.clus.rollback=t.rollback?1:null,L(t.statements)||(s=C(s),this.clus.statements?this.clus.statements=this.clus.statements.concat(s):this.clus.statements=s),this},Create:function(t,e,s){var l,n;return s=s||"create",this.clau!==s&&this.reset(s),e=e||{ifnotexists:1},this.clus.create_table=this.refs(t,this.tbls),this.clus.view=e.view?1:null,this.clus.ifnotexists=e.ifnotexists?1:null,this.clus.temporary=e.temporary?1:null,this.clus.query=L(e.query)?null:e.query,L(e.columns)||(l=C(e.columns),this.clus.columns?this.clus.columns=this.clus.columns.concat(l):this.clus.columns=l),L(e.table)||(n=C(e.table),this.clus.options?this.clus.options=this.clus.options.concat(n):this.clus.options=n),this},Alter:function(t,e,s){var l,n;return s=s||"alter",this.clau!==s&&this.reset(s),this.clus.alter_table=this.refs(t,this.tbls),e=e||{},this.clus.view=e.view?1:null,L(e.columns)||(l=C(e.columns),this.clus.columns?this.clus.columns=this.clus.columns.concat(l):this.clus.columns=l),L(e.table)||(n=C(e.table),this.clus.options?this.clus.options=this.clus.options.concat(n):this.clus.options=n),this},Drop:function(t,e,s){var l;return s=s||"drop",this.clau!==s&&this.reset(s),l=y(t)?t[0]:t,n.call(this.vews,l)?(this.dropView(l),this):(w(t)&&(t=t.split(",")),t=this.refs(null==t?"*":t,this.tbls),e=e||{ifexists:1},this.clus.view=e.view?1:null,this.clus.ifexists=e.ifexists?1:null,this.clus.temporary=e.temporary?1:null,this.clus.drop_tables?this.clus.drop_tables=this.clus.drop_tables.concat(t):this.clus.drop_tables=t,this)},Select:function(t,e){return e=e||"select",this.clau!==e&&this.reset(e),w(t)&&(t=t.split(",")),t=this.refs(null==t?"*":t,this.cols),this.clus.select_columns?this.clus.select_columns=this.clus.select_columns.concat(t):this.clus.select_columns=t,this},Insert:function(t,e,s){var l;return s=s||"insert",this.clau!==s&&this.reset(s),l=y(t)?t[0]:t,n.call(this.vews,l)&&this.clau===this.vews[l].clau?this.useView(l):(w(t)&&(t=t.split(",")),w(e)&&(e=e.split(",")),t=this.refs(t,this.tbls),e=this.refs(e,this.cols),this.clus.insert_tables?this.clus.insert_tables=this.clus.insert_tables.concat(t):this.clus.insert_tables=t,this.clus.insert_columns?this.clus.insert_columns=this.clus.insert_columns.concat(e):this.clus.insert_columns=e),this},Values:function(e){var s,l,i,u,r,a,o,c;if(L(e))return this;for(t!==e[0]&&y(e[0])||(e=[e]),s=e.length,l=[],u=0;u<s;u++)if((c=C(e[u])).length){for(i=[],a=0,o=c.length;a<o;a++)S(r=c[a])?n.call(r,"raw")?i.push(r.raw):n.call(r,"integer")?i.push(this.intval(r.integer)):n.call(r,"string")&&i.push(this.quote(r.string)):i.push(null===r?"NULL":M(r)?r:this.quote(r));l.push("("+i.join(",")+")")}return l=l.join(","),this.clus.values_values&&(l=this.clus.values_values+","+l),this.clus.values_values=l,this},Update:function(t,e){var s;return e=e||"update",this.clau!==e&&this.reset(e),s=y(t)?t[0]:t,n.call(this.vews,s)&&this.clau===this.vews[s].clau?this.useView(s):(w(t)&&(t=t.split(",")),t=this.refs(t,this.tbls),this.clus.update_tables?this.clus.update_tables=this.clus.update_tables.concat(t):this.clus.update_tables=t),this},Set:function(t){var e,s,l,i,u,r;if(L(t))return this;for(l in e=[],r=this.cols,t)if(n.call(t,l))if(i=this.refs(l,r)[0].full,S(u=t[l])){if(n.call(u,"raw"))e.push(i+" = "+u.raw);else if(n.call(u,"integer"))e.push(i+" = "+this.intval(u.integer));else if(n.call(u,"string"))e.push(i+" = "+this.quote(u.string));else if(n.call(u,"increment"))e.push(i+" = "+i+" + "+this.intval(u.increment));else if(n.call(u,"decrement"))e.push(i+" = "+i+" - "+this.intval(u.increment));else if(n.call(u,"case")){if(s=i+" = CASE",n.call(u.case,"when")){for(case_value in u.case.when)n.call(u.case.when,case_value)&&(s+="\nWHEN "+this.conditions(u.case.when[case_value],!1)+" THEN "+this.quote(case_value));n.call(u.case,"else")&&(s+="\nELSE "+this.quote(u.case.else))}else for(case_value in u.case)n.call(u.case,case_value)&&(s+="\nWHEN "+this.conditions(u.case[case_value],!1)+" THEN "+this.quote(case_value));s+="\nEND",e.push(s)}}else e.push(i+" = "+(null===u?"NULL":M(u)?u:this.quote(u)));return e=e.join(","),this.clus.set_values&&(e=this.clus.set_values+","+e),this.clus.set_values=e,this},Delete:function(t){return t=t||"delete",this.clau!==t&&this.reset(t),this},From:function(t){var e;return L(t)?this:(e=y(t)?t[0]:t,n.call(this.vews,e)&&this.clau===this.vews[e].clau?this.useView(e):(w(t)&&(t=t.split(",")),t=this.refs(t,this.tbls),this.clus.from_tables?this.clus.from_tables=this.clus.from_tables.concat(t):this.clus.from_tables=t),this)},Join:function(t,e,s){var l,i,u;if(t=this.refs(t,this.tbls)[0].aliased,s=L(s)?null:s.toUpperCase(),L(e))l={table:t,type:s};else{if(w(e))e="("+(e=this.refs(e.split("="),this.cols))[0].full+"="+e[1].full+")";else{for(i in e)n.call(e,i)&&(S(u=e[i])||(e[i]={eq:u,type:"identifier"}));e="("+this.conditions(e,!1)+")"}l={table:t,type:s,cond:e}}return this.clus.join_clauses?this.clus.join_clauses.push(l):this.clus.join_clauses=[l],this},Where:function(t,e){return L(t)?this:("OR"!==(e=e?e.toUpperCase():"AND")&&(e="AND"),t=this.conditions(t,!1),this.clus.where_conditions&&(t=this.clus.where_conditions+" "+e+" "+t),this.clus.where_conditions=t,this)},Group:function(t){var e;return e=this.refs(t,this.cols)[0].alias,this.clus.group_conditions&&(e=this.clus.group_conditions+","+e),this.clus.group_conditions=e,this},Having:function(t,e){return L(t)?this:("OR"!==(e=e?e.toUpperCase():"AND")&&(e="AND"),t=this.conditions(t,!0),this.clus.having_conditions&&(t=this.clus.having_conditions+" "+e+" "+t),this.clus.having_conditions=t,this)},Order:function(t,e){var s;return"DESC"!==(e=e?e.toUpperCase():"ASC")&&(e="ASC"),s=this.refs(t,this.cols)[0].alias+" "+e,this.clus.order_conditions&&(s=this.clus.order_conditions+","+s),this.clus.order_conditions=s,this},Limit:function(t,e){return this.clus.count=q(t),this.clus.offset=q(e),this},Page:function(t,e){return t=q(t),e=q(e),this.Limit(e,t*e)},conditions:function(t,e){var s,l,i,u,r,a,o,c,h,f,d,p,_;if(L(t))return"";if(w(t))return t;for(i in s="",l=[],f=this.cols,a=!0===e?"alias":"full",t)if(n.call(t,i))if(S(r=t[i])){if(n.call(r,"raw")){l.push(String(r.raw));continue}if(n.call(r,"or")){d=[];for(var E=0,T=r.or.length;E<T;E++)p=r.or[E],d.push(this.conditions(p,e));l.push(d.join(" OR "));continue}if(n.call(r,"and")){d=[];for(E=0,T=r.and.length;E<T;E++)p=r.and[E],d.push(this.conditions(p,e));l.push(d.join(" AND "));continue}if(n.call(r,"either")){d=[];for(E=0,T=r.either.length;E<T;E++)(p={})[i]=r.either[E],d.push(this.conditions(p,e));l.push(d.join(" OR "));continue}if(n.call(r,"together")){d=[];for(E=0,T=r.together.length;E<T;E++)(p={})[i]=r.together[E],d.push(this.conditions(p,e));l.push(d.join(" AND "));continue}if(u=this.refs(i,f)[0][a],c=n.call(r,"type")?r.type:"string",n.call(r,"case")){if(d=u+" = CASE",n.call(r.case,"when")){for(_ in r.case.when)n.call(r.case.when,_)&&(d+=" WHEN "+this.conditions(r.case.when[_],e)+" THEN "+this.quote(_));n.call(r.case,"else")&&(d+=" ELSE "+this.quote(r.case.else))}else for(_ in r.case)n.call(r.case,_)&&(d+=" WHEN "+this.conditions(r.case[_],e)+" THEN "+this.quote(_));d+=" END",l.push(d)}else n.call(r,"multi_like")?l.push(this.multi_like(u,r.multi_like)):n.call(r,"like")?l.push(u+" LIKE "+("raw"===c?r.like:this.like(r.like))):n.call(r,"not_like")?l.push(u+" NOT LIKE "+("raw"===c?r.not_like:this.like(r.not_like))):n.call(r,"contains")?(h=String(r.contains),"raw"===c||(h=this.quote(h)),l.push(this.sql_function("strpos",[u,h])+" > 0")):n.call(r,"not_contains")?(h=String(r.not_contains),"raw"===c||(h=this.quote(h)),l.push(this.sql_function("strpos",[u,h])+" = 0")):n.call(r,"in")?(h=C(r.in),"raw"===c||(h="integer"===c||M(h[0])?this.intval(h):this.quote(h)),l.push(u+" IN ("+h.join(",")+")")):n.call(r,"not_in")?(h=C(r.not_in),"raw"===c||(h="integer"===c||M(h[0])?this.intval(h):this.quote(h)),l.push(u+" NOT IN ("+h.join(",")+")")):n.call(r,"between")?null==(h=C(r.between))[0]?("raw"===c||("integer"===c||M(h[1])?h[1]=this.intval(h[1]):h[1]=this.quote(h[1])),l.push(u+" <= "+h[1])):null==h[1]?("raw"===c||("integer"===c||M(h[0])?h[0]=this.intval(h[0]):h[0]=this.quote(h[0])),l.push(u+" >= "+h[0])):("raw"===c||(h="integer"===c||M(h[0])&&M(h[1])?this.intval(h):this.quote(h)),l.push(u+" BETWEEN "+h[0]+" AND "+h[1])):n.call(r,"not_between")?null==(h=C(r.not_between))[0]?("raw"===c||("integer"===c||M(h[1])?h[1]=this.intval(h[1]):h[1]=this.quote(h[1])),l.push(u+" > "+h[1])):null==h[1]?("raw"===c||("integer"===c||M(h[0])?h[0]=this.intval(h[0]):h[0]=this.quote(h[0])),l.push(u+" < "+h[0])):("raw"===c||(h="integer"===c||M(h[0])&&M(h[1])?this.intval(h):this.quote(h)),l.push(u+" < "+h[0]+" OR "+u+" > "+h[1])):n.call(r,"gt")||n.call(r,"gte")?(h=r[o=n.call(r,"gt")?"gt":"gte"],"raw"===c||(h="integer"===c||M(h)?this.intval(h):"identifier"===c||"field"===c?this.refs(h,f)[0][a]:this.quote(h)),l.push(u+("gt"===o?" > ":" >= ")+h)):n.call(r,"lt")||n.call(r,"lte")?(h=r[o=n.call(r,"lt")?"lt":"lte"],"raw"===c||(h="integer"===c||M(h)?this.intval(h):"identifier"===c||"field"===c?this.refs(h,f)[0][a]:this.quote(h)),l.push(u+("lt"===o?" < ":" <= ")+h)):n.call(r,"not_equal")||n.call(r,"not_eq")?(h=r[o=n.call(r,"not_eq")?"not_eq":"not_equal"],"raw"===c||null===h||(h="integer"===c||M(h)?this.intval(h):"identifier"===c||"field"===c?this.refs(h,f)[0][a]:this.quote(h)),l.push(null===h?u+" IS NOT NULL":u+" <> "+h)):(n.call(r,"equal")||n.call(r,"eq"))&&(h=r[o=n.call(r,"eq")?"eq":"equal"],"raw"===c||null===h||(h="integer"===c||M(h)?this.intval(h):"identifier"===c||"field"===c?this.refs(h,f)[0][a]:this.quote(h)),l.push(null===h?u+" IS NULL":u+" = "+h))}else u=this.refs(i,f)[0][a],l.push(null===r?u+" IS NULL":u+" = "+(M(r)?r:this.quote(r)));return l.length&&(s="("+l.join(") AND (")+")"),s},joinConditions:function(t,e){var s,l,i,u,r,a,o,c,h,f,d=0;for(s in e)n.call(e,s)&&(l=F.parse(s,this)._col,n.call(t,l)&&(i=e[s],r=t[l].table,a=t[l].id,o=t[l].join,c=t[l].join_id,h=o+ ++d,u={},n.call(t[l],"key")&&l!==t[l].key?u[h+"."+(f=t[l].key)]=l:f=l,n.call(t[l],"value")?u[h+"."+t[l].value]=i:u[h+"."+f]=i,this.Join(o+" AS "+h,r+"."+a+"="+h+"."+c,"inner").Where(u),delete e[s]));return this},refs:function(t,e,s){var l,i,u,r,a,o,c,h,f;if(!0===s)for(r=0,a=t.length;r<a;r++)h=(c=t[r]).alias,f=c.qualified,"*"!==(i=c.full)&&(n.call(e,h)?t[r]=e[h]:n.call(e,i)?(u=(l=e[i]).alias,l.full!==i&&u!==h&&u===i&&(l=l.cloned(c.alias),t[r]=e[h]=l)):n.call(e,f)?((l=e[f]).qualified!==f&&(l=e[l.qualified]),l=c.full!==c.alias?l.cloned(c.alias,null,c._func):l.cloned(null,l.alias,c._func),t[r]=e[l.alias]=l,l.alias===l.full||n.call(e,l.full)||(e[l.full]=l)):(e[h]=c,h===i||n.call(e,i)||(e[i]=c)));else for(o=C(t),t=[],r=0,a=o.length;r<a;r++)h=(c=F.parse(o[r],this)).alias,f=c.full,n.call(e,h)?c=e[h]:(e[h]=c,f===h||n.call(e,f)||(e[f]=c)),t.push(c);return t},tbl:function(t){if(y(t)){for(var e=0,s=t.length;e<s;e++)t[e]=this.tbl(t[e]);return t}return this.p+t},intval:function(t){if(y(t)){for(var e=0,s=t.length;e<s;e++)t[e]=this.intval(t[e]);return t}return parseInt(t,10)},quote_name:function(t,e){var s,l,n,i,u=this.qn,r=this.escdbn;if(e=!0===e,y(t)){for(s=0,l=t.length,n=new Array(l);s<l;s++)n[s]=this.quote_name(t[s],e);return n}if(t=String(t),e&&u[0]===t.slice(0,u[0].length)&&u[1]===t.slice(-u[1].length))return t;if(r)return r[1]?r[0](t):u[0]+r[0](t)+u[1];for(s=0,l=t.length,n="";s<l;s++)i=t.charAt(s),u[0]===i?n+=u[2]:u[1]===i?n+=u[3]:n+=i;return u[0]+n+u[1]},quote:function(t){var e,s=this.q,l=this.e,n=this.escdb;if(y(t)){for(var i=0,u=t.length,r=new Array(u);i<u;i++)r[i]=this.quote(t[i]);return r}return e=-1!==(t=String(t)).indexOf("\\"),n?n[1]?n[0](t):(e?l[2]:"")+s[0]+n[0](t)+s[1]+(e?l[3]:""):(e?l[2]:"")+s[0]+this.esc(t)+s[1]+(e?l[3]:"")},esc:function(t){var e,s,l,n,i,u;if(y(t)){for(s=0,l=t.length,u=new Array(l);s<l;s++)u[s]=this.esc(t[s]);return u}if(this.escdb&&!this.escdb[1])return this.escdb[0](t);for(i=this.q,e=c+"\\","\\",u="",s=0,l=(t=String(t)).length;s<l;s++)n=t.charAt(s),i[0]===n?u+=i[2]:i[1]===n?u+=i[3]:u+=D(n,e,"\\");return u},esc_like:function(t){if(y(t)){for(var e=0,s=t.length,l=new Array(s);e<s;e++)l[e]=this.esc_like(t[e]);return l}return D(t,"_%","\\")},like:function(t){var e,s;if(y(t)){for(var l=0,n=t.length,i=new Array(n);l<n;l++)i[l]=this.like(t[l]);return i}return e=this.q,(s=this.escdb?["","","",""]:this.e)[0]+e[0]+"%"+this.esc_like(this.esc(t))+"%"+e[1]+s[1]},multi_like:function(t,e,s){var l,n,i,u,r,a,c;for(s=!1!==s,l=t+" LIKE ",n=e.split(","),s&&(n=U(k(n,o),Boolean)),u=0,r=n.length;u<r;u++){for(i=n[u].split("+"),s&&(i=U(k(i,o),Boolean)),a=0,c=i.length;a<c;a++)i[a]=l+this.like(i[a]);n[u]="("+i.join(" AND ")+")"}return n.join(" OR ")},sql_function:function(t,e){var s,l,i,u,r,a;if(!n.call(Y.dialects[this.type].functions,t))throw new TypeError('Dialect: SQL function "'+t+'" does not exist for dialect "'+this.type+'"');for(t=Y.dialects[this.type].functions[t],a=(e=null!=e?C(e):[]).length,s="",l=!1,i=0,u=t.length;i<u;i++)r=t[i],s+=l?0<r&&a>=r?e[r-1]:"":r,l=!l;return s},sql_type:function(t){if(t=String(t).toUpperCase(),!n.call(Y.dialects[this.type].types,t))throw new TypeError('Dialect: SQL type "'+t+'" does not exist for dialect "'+this.type+'"');return Y.dialects[this.type].types[t]}},Y});